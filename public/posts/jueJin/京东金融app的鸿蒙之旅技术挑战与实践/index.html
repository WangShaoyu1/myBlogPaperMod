<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>京东金融APP的鸿蒙之旅：技术、挑战与实践 | PaperMod</title>
<meta name="keywords" content="前端">
<meta name="description" content="作者：京东科技高阔一、背景在今年6月份的华为开发者大会上，华为宣布HarmonyOSNEXT面向开发者和先锋用户启动Beta升级，并将于今年四季度正式商用。在9月21日的华为202">
<meta name="author" content="京东云开发者">
<link rel="canonical" href="http://localhost:1313/posts/juejin/%E4%BA%AC%E4%B8%9C%E9%87%91%E8%9E%8Dapp%E7%9A%84%E9%B8%BF%E8%92%99%E4%B9%8B%E6%97%85%E6%8A%80%E6%9C%AF%E6%8C%91%E6%88%98%E4%B8%8E%E5%AE%9E%E8%B7%B5/">
<meta name="google-site-verification" content="XYZabc">
<link crossorigin="anonymous" href="/assets/css/stylesheet.7b92bf4867c997b58ec50f63451b83777173d5bd5593376852abd85746d09d71.css" integrity="sha256-e5K/SGfJl7WOxQ9jRRuDd3Fz1b1VkzdoUqvYV0bQnXE=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<link rel="apple-touch-icon" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<link rel="mask-icon" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="zh" href="http://localhost:1313/posts/juejin/%E4%BA%AC%E4%B8%9C%E9%87%91%E8%9E%8Dapp%E7%9A%84%E9%B8%BF%E8%92%99%E4%B9%8B%E6%97%85%E6%8A%80%E6%9C%AF%E6%8C%91%E6%88%98%E4%B8%8E%E5%AE%9E%E8%B7%B5/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript><meta property="og:title" content="京东金融APP的鸿蒙之旅：技术、挑战与实践" />
<meta property="og:description" content="作者：京东科技高阔一、背景在今年6月份的华为开发者大会上，华为宣布HarmonyOSNEXT面向开发者和先锋用户启动Beta升级，并将于今年四季度正式商用。在9月21日的华为202" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/posts/juejin/%E4%BA%AC%E4%B8%9C%E9%87%91%E8%9E%8Dapp%E7%9A%84%E9%B8%BF%E8%92%99%E4%B9%8B%E6%97%85%E6%8A%80%E6%9C%AF%E6%8C%91%E6%88%98%E4%B8%8E%E5%AE%9E%E8%B7%B5/" />
<meta property="og:image" content="http://localhost:1313/images/papermod-cover.png" />
<meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-10-08T00:00:00+00:00" />
<meta property="article:modified_time" content="2024-10-08T00:00:00+00:00" />


<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="http://localhost:1313/images/papermod-cover.png" />
<meta name="twitter:title" content="京东金融APP的鸿蒙之旅：技术、挑战与实践"/>
<meta name="twitter:description" content="作者：京东科技高阔一、背景在今年6月份的华为开发者大会上，华为宣布HarmonyOSNEXT面向开发者和先锋用户启动Beta升级，并将于今年四季度正式商用。在9月21日的华为202"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "京东金融APP的鸿蒙之旅：技术、挑战与实践",
      "item": "http://localhost:1313/posts/juejin/%E4%BA%AC%E4%B8%9C%E9%87%91%E8%9E%8Dapp%E7%9A%84%E9%B8%BF%E8%92%99%E4%B9%8B%E6%97%85%E6%8A%80%E6%9C%AF%E6%8C%91%E6%88%98%E4%B8%8E%E5%AE%9E%E8%B7%B5/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "京东金融APP的鸿蒙之旅：技术、挑战与实践",
  "name": "京东金融APP的鸿蒙之旅：技术、挑战与实践",
  "description": "作者：京东科技高阔一、背景在今年6月份的华为开发者大会上，华为宣布HarmonyOSNEXT面向开发者和先锋用户启动Beta升级，并将于今年四季度正式商用。在9月21日的华为202",
  "keywords": [
    "前端"
  ],
  "articleBody": "作者：京东科技 高阔\n一、背景 在今年6月份的华为开发者大会上，华为宣布HarmonyOS NEXT面向开发者和先锋用户启动Beta升级，并将于今年四季度正式商用。\n在9月21日的华为2024全联接大会上华为终端总裁宣布，已有超过1万个应用和元服务上架HarmonyOS NEXT应用市场。此外，华为每年投入超过60亿元人民币激励开发者创新，华为开发者联盟注册开发者数量已快速增长至675万。\nHarmonyOS NEXT是建立在OpenHarmony开发基础之上的，实现了\"纯正鸿蒙操作系统\"的体验。与目前的HarmonyOS 4.X版本相比，HarmonyOS NEXT去掉了AOSP的支持并剔除了linux内核，仅支持鸿蒙内核和鸿蒙系统应用，不可以运行Android应用，减少了40%的冗余代码，使系统的流畅度、能效、纯净安全特性大为提升。成为真正意义上和 Android 、iOS同级的操作系统。\n二、京东金融鸿蒙正式版发布 京东金融团队早在2023年11月份就已经开始对HarmonyOS NEXT系统进行调研,并与华为达成合作意向，合作启动了\"京东金融鸿蒙项目\"，并于6月份首次上架了尝鲜版。经过三个季度的攻坚，京东金融于9月19日上线6.9.30正式版本，该版本基于鸿蒙原生能力开发，并使用了系统级AI能力及意图框架，可实现对用户显性与高阶意图的理解，并通过小艺对话、智慧搜索等全场景智慧入口, 在不同终端或者场景中更精准地满足用户的个性化需求。\n三、技术、挑战与实践 下面我们将详细介绍京东金融 APP 鸿蒙版从 0 到 1 的艰辛历程，干货满满！\n1.鸿蒙版的必要性 在\"京东金融鸿蒙项目\"开始之前，团队对京东金融做了机型数据统计，在App日活用户中（除iOS），华为手机用户占比排名第一，并且排名靠前的这些机型也都到了换机周期。同时根据华为官方消息，HarmonyOS NEXT将于今年第三季度或第四季度以新机搭载新系统的形式，随华为mate70一起发布，届时会有6000+主流应用配套发布。因此HarmonyOS NEXT的发布对我们来说既是风险也是机遇。\n风险：\n(1) 如果我们不做适配，就会放弃掉这部分高质量用户。同时华为为了推进鸿蒙生态发展，势必会逐步清理存量机型，存量用户的体验也会逐步降低。\n(2) 竞品在启动，尤其是国内银行类 APP已经率先启动适配工作，也会挤压业务发展空间。\n机遇：\n短期来看，近年来移动行业内最大的热点，占领先机，获取第一波增长红利。长期来看，华为用户的商务属性和金融业务属性契合度极高，为这批用户提供高质量、差异性的服务，更有利于业务转化。\n基于上述考虑, 团队决定启动金融App鸿蒙项目。\n2.敲定正式版功能 京东金融App经过近10年的迭代，整个App功能庞大、页面繁多，共涉及5大业务线共200+个原生和Roma跨端页面，PV大于100的H5页面就有3400+个。如果一次性的把所有的功能全部进行移植势必会耗费大量的人力和时间成本，因此在项目开始前内部就敲定只上核心功能，非核心功能后续逐步迭代。为此我们对App进行了流量分析，对各页面的PV和UV进行了梳理, 经过和产品团队的商定，在9月份发布的正式版本中会上线21个大的功能模块，共包含180+个功能和页面 (只梳理原生和跨端页面)，这些功能基本就覆盖了金融App线上版本90%的能力。\n3.整体架构梳理 在\"京东金融鸿蒙项目\"进入研发阶段前，团队首先对App进行了整体架构梳理，App侧以功能为维度进行层级划分主要分为基建层和业务层 (只有全面理解整体架构才能为后续的方案选择奠定坚实基础)。\n基建层\n为业务层提供基础能力，赋能业务。如: 网络、路由、数据监控、Web容器、Roma跨端框架等。\n业务层\n所有为用户提供的服务。金融App采用容器化的开发模式，业务侧实现方式主要是原生页面、Roma跨端页面、H5页面。\n在金融App中，业务运行在基建层提供的动态化(Roma)容器、H5容器、小程序容器中，这种方案可以使业务层的逻辑和功能被封装在一个\"可重用\"的容器中，在对新系统适配时，无需对底层平台或环境进行大规模的修改和适配，从而让业务团队可以专注于核心业务的开发和优化，而不是花费大量时间和资源去处理与平台兼容性相关的问题。因此只需要对容器进行进行适配，就可以让业务以最小的改动运行在鸿蒙系统中。\n4.技术方案对比 在技术方案选型的阶段，团队明确了以\"低成本\"、“强扩展”、“低风险\"为核心的三个指导原则。首先，在公司\"降本增效\"的大背景下就要求在保证项目质量和功能的前提下，尽可能地降低投入成本，提高资源利用效率。其次，需要充分考虑未来可能会有更多的厂商推出不兼容安卓的自研手机系统(如: 小米澎湃、VIVO蓝河等)，项目需要具备灵活性和适应性。这样当出现更多的操作系统时才能轻松进行扩展适配，而无需从头开始，大大节省了时间和成本。最后，方案需要有较低的风险，这样才能有助于正常的把控项目,保障项目按时交付。\n根据金融App的现有架构和技术特性，在技术方案选型过程中，需要对基建层、H5容器和原生/Roma跨端页面进行单独分析。\n基建层组件:\n基建层提供的功能较为核心，需要有较好的稳定性、兼容性和优异的性能，因此基建层需要使用鸿蒙ArkTS语言重写，这个工作是逃不掉的，但考虑到后期相同的基建层组件需要同时维护三个版本(安卓/IOS/鸿蒙)，因此我们尝试部分组件的三端通用部分使用C/C++来编写，后期该组件稳定后会替换其他两端，实现三端使用同一套代码，该方案走通后，会逐步推广到所有组件。\n例如: 奇点SDK提供了用户行为统计、页面行为统计、APP行为统计、自动埋点、DAU统计、H5基础信息采集、曝光等功能，三端的逻辑基本相同，归纳起来主要是数据采集、存储、上传，在其他两端使用Java和OC实现，在鸿蒙版本上直接使用C/C++来实现，后续三端维护一套代码即可。\nH5容器:\n由于鸿蒙系统ArkWeb组件基于Chrome，因此无需担心ArkWeb对现有H5的兼容性，但App需要对ArkWeb进行封装，提供jsbridge实现H5需要的全部金融App原生能力。\n在工作开始前，统计了金融项目中一共有99个jsbridge，通过调用量对这些jsbridge进行排序，并对每个jsbridge的功能、依赖项、调用方进行分析以便确定必要性和优先级。\n在jsbridge提供的能力依赖外部SDK时，可以适当降低其优先级。例如，51号桥提供风控人脸OCR功能， 虽然每日调用量很高，但由于该功能实现依赖智能团队，因此51号桥也只能把实现优先级降低，等待智能团队提供SDK后再做jsbridge的实现。\n在jsbridge的调用方不在此正式版上线时，该jsbridge可以暂时不实现。例如，94号桥提供添加小组件到系统桌面的能力，但9月份的正式版本暂时不会提供小组件，因此94号桥暂时就不会实现。\n最终在确定所有jsbridge的必要性和优先级后，在正式版一共实现了63个jsbridge，剩余36个待后续根据实际情况依次实现。\n原生页面\u0026Roma跨端页面:\n方案\n﻿\n方案一\n方案二（建议方案-短期）\n方案三 (建议方案-长期)\n介绍\n不使用Roma跨端技术，金融App所有页面及功能使用鸿蒙原生ArkUI实现。\n使用Roma跨端技术，Roma绘制对接鸿蒙原生ArkUI控件，所有金融App页面使用Roma跨端实现。\n使用Roma跨端技术，Roma绘制使用自绘制方案，所有金融App页面使用Roma跨端实现。\n优势\n所有功能使用纯鸿蒙实现，稳定、兼容性好。\n1.Roma跨端页面少量适配。 2.有安卓适配技术参考。\n1.大幅降低多端一致性适配成本。 2.适配后可复用于鸿蒙及其他系统。\n劣势\n工作量大，所有页面都需要重写。\n未来更多系统适配成本高。\n技术难度大、成本高、无法靠多人力并行加速。\n风险点\n系统能力缺失，无法对齐原有安卓能力。\n各平台系统结构不同，JS引擎编译复杂。\n赶不上华为发布节奏。\n对于原生页面和Roma跨端页面，我们梳理出了三种方案，在三种方案中，方案一无疑是最稳定且风险最低的，但方案一工作量巨大，所有页面都需要重写，无法复用现有的技术资产。而方案三无疑是终极方案，如果使用方案三，后续有新操作系统推出，Roma跨端页面几乎不需要适配，Roma框架不需要重新开发，只需要简单适配即可，但该方案技术难度较大，成本较高。\n最后对这三种方案进行了简单的人力成本推算，同时也预判其他手机厂商操作系统短期内不会不兼容安卓，目前各个大手机厂商也无动作，在综合了\"成本”、“扩展性”、“风险\"这三个维度的考量后，我们的最终方案是方案二和方案三相结合，以方案二为主，同时对方案三进行技术预研。\n5.基建组件建设 App基建层架构图\nApp从0-1的过程中，首要任务无疑是基建建设工作，基建层建设就需要详细梳理当前的基建层架构，明确必要基建组件和非必要基建组件，确定所有基建组件的依赖关系和优先级，从而精确评估各项工作的优先顺序以及所需的人力资源。\n定义\n组件\n说明\n优先级\n必要组件\n路由、网络库、信道加密、图片加载、web容器、Roma跨端框架等。\n会堵塞正常的业务研发流程。\n高\n非必要组件\nSGM、埋点、分享、H5离线化等。\n不会堵塞正常的业务研发流程(重要不紧急)。\n较低\n团队早在第一季度就开始了必要组件的研发工作，并同时推动集团内部其他团队进行二方组件的建设，梳理排期，确保不会相互堵塞。通过三个季度的攻坚，完成了30+个P0、P1、P2、P3级别的基础组件开发工作。建设了鸿蒙版乐高框架、web容器、js桥组件、权限控制组件、工具库、push推送、扫一扫、长连接、H5离线化、SGM、路由、科技网关库、Lottie动画库、图片加载库、存储、权限申请、APP统一配置中心、统一分享库、图片浏览器、图片选择器等基础组件(组件可以对集团内赋能, 如需使用请与金融App团队联系)。\n在基建建设过程中，我们面临了一系列前所未有的挑战，主要就是在新系统上\"摸着石头过河”，ArkUI、ArkTS、OHPM、HIVGOR等研发框架对于我们都是全新的，除了官方文档没有任何最佳实践或者参考资料，只能边做边学习探索，团队内部每周都会在例会上分享自己遇到的\"坑\", 大家相互成长。\n面临的部分挑战:\n(1) ArkTS虽然基于TypeScript，但是阉割了动态语言特性，导致实现部分功能较为复杂。\n(2) ArkUI为声明式UI，与客户端常用的命令式UI不同，大家需要在在编程思想上进行转变。\n(3) 早期鸿蒙系统的API丰富度、系统健壮性、开发工具的易用性和健壮性都存在一定问题。\n(4) 鸿蒙生态中的一些新特性，如:意图框架、服务卡片、元服务等新概念也需要花一定时间去理解。\n(5) 集团内二方组件之间相互依赖，需要协调各部门的排期，确保在规定时间完成。\n6.发布尝鲜版 在6月21日华为开发者大会后，华为会向100万受邀用户推送鸿蒙系统，为了让用户能够第一时间使用京东金融App，并借此获得品牌宣传和曝光，我们决定开发金融App鸿蒙尝鲜版本。\n由于任务比较紧急，当时只完成了部分基建组件，Roma跨端框架也未完成，金融App中的所有使用跨端技术的页面均无法在尝鲜版本上使用，因此只能在该版本中使用ArkUI原生和H5的方式进行开发。为了使成本降到最低，对该版本的功能也进行了一定的取舍，尝鲜版本的功能需要满足几个条件，首先上线的功能需要有H5的版本，因为当时Web容器缺少对H5调用本地能力支持，所以该H5必须能够在纯浏览器的环境运行。其次，该功能在其他两端是以原生的技术形式开发的，这样此功能在尝鲜版本开发完后还可以复用到正式版本。\n为了确保H5业务在尝鲜版本上不使用桥能力也能正确展示和使用，除了与H5开发同事高效沟通并解决他们提出的上百个问题外，金融App还内部实现了拦截、转义等能力，确保业务正常运行。\n在不到两个月的时间内开发上线了金融App鸿蒙尝鲜版本，成功京东集团首个上架的鸿蒙原生应用。同时在华为开发者大会上，金融App尝鲜版本成功获得了金融品类的产品曝光。\n7.业务层研发 金融App采用的是混合开发模式，业务侧实现方式主要是原生页面、Roma跨端页面、H5页面。这三种不同类型的页面在研发过程中各具特点，所需的技术手段与工作流程也各有侧重。\nH5页面适配\nH5页面会通过金融App提供的jsbridge调用金融App的原生能力，因此在金融Web容器改造完成并提供原生能力后，H5页面需要进行适配并回归，会有如下的两个式配点。\n(1) Web容器UA适配\nH5页面会依据Web容器的UA中所包含的clientType和osName字段值来识别当前运行的操作系统环境，进而执行相应的逻辑操作，在鸿蒙系统中，Web容器的UA内容会产生变化，因此代码需要增加在鸿蒙系统的判断。金融App会在Web容器原始UA中追加部分信息，其中部分字段的值会产生变动，如:clientType字段值变harmonyos，osName字段值变为harmonyos，src字段值变为AppGrallery。\n(2) 升级jrbridge库\n在H5页面中，所有业务均使用统一提供的jrbridge库调用金融客户端的原生能力，然而当前该库仅识别安卓与iOS系统，尚未涵盖鸿蒙系统。因此，为确保所有H5页面的兼容性，所有H5页面需要对jrbridge进行升级，以适应不同平台的运行需求。\n鸿蒙ArkUI原生页面研发\n(1) ArkUI原生转Roma跨端\n由于历史遗留问题，金融App在版本迭代过程中只把功能变动比较频繁的原生页面修改为Roma跨端页面，App内依旧存在部分原生页面。在鸿蒙项目中，我们依据各页面的功能特性与技术复杂度，逐步将那些遗留的原生页面转化为兼容性更强的Roma跨端界面，以实现更为统一且高效的用户体验。\n(2) 使用鸿蒙ArkUI原生\n首先需要明确哪些页面需要使用ArkUI原生方式，对于这个问题并没有标准的答案，需要对页面的功能、使用时机、性能要求等进行综合分析。通常情况下，对于部分对性能要求非常高或Roma跨端引擎无法完成或基建层的页面需要使用鸿蒙原生ArkUI进行重写。\n例如:大图浏览器页面，这个页面提供了对多张大图的全屏切换浏览的功能，由于该页面是一个通用功能，因此不能有过多的依赖项，这样才能方便其他App复用，并且该页面功能变更也不会很频繁，因此这个页面明显就更适合使用ArkUI原生的方式。\n再如:登录页面也是使用ArkUI原生的方式进行开发。主要原因有两个，第一:登录页面需要调用大量的原生能力，如果使用Roma跨端就需要实现大量的桥，逻辑非常复杂，工作量会比使用ArkUI原生还大。第二:登录页面在App启动后会立刻弹出，对性能要求较高，因此也不太适合使用Roma跨端技术。\n通过使用上述思路进行分析，我们把如首页、文章详情页、登录页、全部服务等页面使用ArkUI原生方式进行开发，这部分工作主要是熟悉ArkUI的语法及属性，但难点在于ArkUI采用声明式UI，而我们的开发之前使用的都是命令式UI，思想需要变化。\nRoma跨端页面适配\n在6月底，我们打通鸿蒙基建、Roma框架、乐高框架、鸿蒙原生的整体链路后，业务研发开始进场适配跨端页面，虽然跨端页面的核心优势就在于其跨设备兼容性，但是第一次在一个全新的操作系统上运行，也会有大量的适配工作，具体适配工作主要体现在如下几个方面。\n(1) Roma扩展模块\u0026扩展标签\nRoma跨端引擎作为一个通用引擎，不可能为金融App提供所有业务功能，所有业务属性较强的功能或UI控件全部需要业务研发以鸿蒙原生的形式去提前实现，然后在Roma页面中动态调用(Android和IOS端也是这样)。在业务进场时，整体链路虽然基本调通，但依旧有许多细节问题需要打磨，由于时间比较紧迫只能是业务和Roma框架并行开发，双方互相反馈细节问题，最终一共开发22个业务扩展标签和32个业务扩展模块。\n(2) UI细节调整\n由于鸿蒙系统布局问题导致Roma框架底层三端无法完全兼容，需要在鸿蒙系统上对UI进行微调。\n(3) 兼容系统层差异\n由于系统层差异，导致跨端页面调用部分系统原生能力时需要判断运行环境执行特定代码。\n8.鸿蒙新特性应用 当前金融App的业务增长压力较大，在完成功能层面迁移的同时团队还探索了鸿蒙系统的新特性，为了寻求业务发展的新突破，金融App结合自身金融属性做了部分新特性的应用，这样不仅提升了用户体验，也拓宽了业务增长的可能性。\n(1) 华为账号服务\nApp接入华为账号服务，用户在使用金融App时，无需输入任何信息就可以通过华为一键登录的方式登录到金融App，缩短登录的链路，提升登录成功率(鸿蒙系统的华为账号登率为100%) 。相比于运营商的一键登录，华为账号服务具有使用成本低、无需接入SDK、不依赖手机号、支持无卡设备登多种优势。\n(2) 智能PhotoPicker\n智能PhotoPicker是基于PhotoPicker的高阶功能，该功能可以从大量图片中根据配置的智能推荐参数快速筛选出符合条件的图片，并在PhotoPicker中推荐给用户选择。目前支持的类型有如:身份证、银行卡、驾驶证、行驶证、二维码、头像等。\n如下图就是金融App在上传实名认证上传身份证的场景中使用智能PhotoPicker后，PhotoPicker快速筛选出身份证照片。\n(3) 意图框架\nHarmonyOS NEXT引入了多项创新特性，其中意图框架能够将应用中的业务功能智能分发至手机的各大系统入口，系统入口包括小艺对话、小艺搜索和小艺建议等。通过这一特性，用户不仅可以主动搜索和调用所需服务，还能享受到系统智能推荐的个性化建议。这将有效提升用户体验，带来全新的流量增长点，并为应用增量提供强大支持。\n结合京东金融自身业务场景，我们在正式版中确定了以下五个场景：\n对小艺说:“查询京东消费明细”。 动作：打开京东金融账单详情页面。\n描述：用户可以方便地查看自己在京东的消费明细，了解每一笔交易的详细信息，从而更好地管理个人财务。\n对小艺说:“查询京东白条账单”。 动作：打开京东金融白条全部账单页面。\n描述：用户可以查看所有京东白条的账单信息，包括账单金额、还款日期等，帮助用户及时还款，避免逾期。\n对小艺说:“还一下京东白条”。 动作：打开京东金融白条还款页面。\n描述：用户可以直接进入还款页面，进行京东白条的还款操作，简化了还款流程，提高了还款效率。\n对小艺说:“推荐京东金融理财产品”。 动作：打开京东金融理财页面。\n描述：系统会根据用户的财务状况和投资偏好，推荐适合的理财产品，帮助用户实现财富增值。\n对小艺说: “查看最近新上的股票”。 动作：打开京东金融新股日历页面。\n描述：用户可以查看最近上市的新股票信息，包括上市日期、公司背景等，帮助用户抓住投资机会。\n通过这些场景的智能分发，京东金融能够为用户提供更加便捷和个性化的金融服务，提升用户体验，增强用户对京东金融的依赖和满意度。\n总结:\n金融App鸿蒙版不仅仅是功能的迁移，而是要充分利用鸿蒙系统新的特性，重新设计用户体验。结合这些新特性挖掘在获客、活跃、降本增效\u0026用户体验上的机会。\n9.发布正式版 由于项目时间比较紧张，前期只专注于功能的建设，在项目进入尾声阶段有两个比较重要的研发类问题急需解决，不解决甚至会直接影响App上架。\n(1) 折叠屏适配\n根据华为的要求，所有应用都需要对折叠屏手机进行适配。如果不对折叠屏进行适配则无法上架应用商店，为保证京东金融顺利通过应用市场的审核，参考华为提供的折叠屏适配方案，综合风险、成本等因素考虑，最终使用所有控件整体放大1.2倍的思路进行适配，并通过华为一多测试，满足上架要求。\n(2) 性能优化\n根据华为的要求，上架的App核心页面需要达到S标或不低于IOS的体验，以金融App为例，通过使用IDE提供的Profiler工具进行分析, 影响性能的原因主要有以下几方面。\n原因:\n(1) ArkUI为声明式UI，使用数据驱动，不支持继承，如果扩展UI组件，只能采取组件外再包一层的方式，这种方式会让UI层级变深，影响渲染速度。\n(2) 鸿蒙的线程内存模型是Actor模型，该模型不允许线程间共享内存，线程间通信非常麻烦，这就使得大量的重载逻辑放在了主线程中执行，影响渲染速度。\n(3) 部分系统API性能较差。\n解决方案:\n(1) 精简UI层级，合理使用状态同步属性，避免产生冗余刷新操作。\n(2) 使用worker和taskpool把非UI的重载操作放到子线程中，把主线程中的同步操作改为异步操作。\n(3) 对于性能较差的非UI系统API放在子线程中执行，部分UI相关API推动华为鸿蒙团队优化性能。\n通过与华为团队的几轮沟通，并共同商讨技术方案，最终京东金融有88%的场景达到S标，满足上架要求。\n除了上述两个和研发相关的问题外，还需要准备华为应用商店要求的上架材料，这里面需要特别注意的主要有三个材料。\n(1) 软件著作权\nApp的软著一般情况只有android版和ios版本，两个平台是单独申请的，所以需要为鸿蒙版的App单独申请软著，申请时效为3个月左右，为保障不影响上架华为应用商店，请提请申请。\n(2) 工信部ICP备案\n和软著类似，客户端一般只ICP备案了android和ios平台，因此需要在工信部对鸿蒙平台进行单独备案，在备案前请准备bundleName、签名MD5、平台公钥，并确保真实有效。\n(3) 更新隐私协议\nApp的隐私政策也需要更新，鸿蒙版的隐私政策既可以和Android/IOS共用一份通用版本，也可以为鸿蒙单独创建一版。\n通用版本指App在iOS、Android、HarmonyOS共用一份隐私声明，此场景要做到对HarmonyOS不歧视。具体规则如下：\n•设备类型/平台类型如果描述Andriod，必须要提HarmonyOS。\n•设备唯一标识/ID的情形、权限相关的描述、SDK相关的描述、个人信息相关的描述：如果描述Android ID等字样，应该补充描述HarmonyOS(OAID/AAID/ODID/UUID/xxx)的一种或几种。\n单独版本指NEXT单独开发的版本，仅描述HarmonyOS NEXT设备上的隐私声明。具体规则如下：\n•设备类型/平台类型不允许出现Android、iOS描述。\n•设备唯一标识/ID的情形、权限相关的描述、SDK相关的描述、个人信息相关的描述：不能描述Android ID等字样，应该描述HarmonyOS(OAID/AAID/ODID/UUID/xxx)的一种或几种。\n总结下来就是通用版本不歧视HarmonyOS，单独版本不露出iOS、Android品牌，尽量露出HarmonyOS品牌。\n鸿蒙项目自3月27日科技内部启动会开始，包括各跨BGBU部门团队成员，共同经历了近六个月的持续努力，期间还经历了尝鲜版本的体验版的攻坚，最终各部门克服了重重技术困难及业务压力，各业务线顺利完成主要业务的鸿蒙建设。金融APP鸿蒙版在9月初完成了首发功能的集成，并面向C端用户的进行了灰度体验。随着鸿蒙Next的正式版发布的临近，金融App鸿蒙版（正式版）于9月20日正式通过华为应用市场审核，全量面向C端用户。\n在整个过程中京东金融团队共完成\n(1) “推荐”、“理财”、“省钱”、“社区”、“我的\"5个频道页的开发。\n(2) “刷新用户数据”、“选取相册”、“扫一扫\"等63个jsbridge的开发, 为H5提供了所有需要用到的原生能力。\n(3) “科技网关”、“Web容器”、“路由”、“SGM”、“奇点\"等30+个基建组件。\n(4) 开发和适配了理财、社区、省钱等5大业务线的180+个功能和页面。\n(5) 22个Roma业务扩展标签和32个Roma业务扩展模块。\n等等。。。\n四.后续规划 1.补全剩余功能\n金融APP鸿蒙6.9.30正式版本功能与金融APP主版本内容非100%一致，各业务还存在约10%的差异，差异部分将通过后续版本迭代补齐。\n2.鸿蒙生态探索\n鸿蒙不是Android或iOS的平替，不是把代码重写一遍，而是重新设计用户体验，后续我们会持续探索鸿蒙生态中的新玩法(如元服务、服务卡片、服务流转、AI等)，为业务带来增量。\n五.总结 HarmonyOS NEXT是一个全新的操作系统，对应用程序而言，无法沿用既有的Android或iOS平台代码，功能需要全部重写。作为首批开启鸿蒙版App研发的团队，我们在开发初期也面临了重重挑战，没有前人经验可供借鉴，只能通过与华为的紧密合作，逐步探索并解决问题。在整个项目周期内，一共给华为提了700+个issuereporter，在反馈问题的同时也为鸿蒙系统提了大量的优化建议。随着更多团队投身于鸿蒙版本的开发，金融团队计划将鸿蒙项目中所遇的种种难题和解决方案，以\u003c京东金融APP的鸿蒙之旅系列专题\u003e形式逐一分享。这些专题涵盖了鸿蒙的UI适配、基础架构打造、工程化实践、新特性运用以及性能优化等关键领域，旨在为后续跟进的开发者们提供宝贵的经验参考。\n",
  "wordCount" : "260",
  "inLanguage": "zh",
  "image": "http://localhost:1313/images/papermod-cover.png","datePublished": "2024-10-08T00:00:00Z",
  "dateModified": "2024-10-08T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "京东云开发者"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/posts/juejin/%E4%BA%AC%E4%B8%9C%E9%87%91%E8%9E%8Dapp%E7%9A%84%E9%B8%BF%E8%92%99%E4%B9%8B%E6%97%85%E6%8A%80%E6%9C%AF%E6%8C%91%E6%88%98%E4%B8%8E%E5%AE%9E%E8%B7%B5/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "PaperMod",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/%3Clink%20/%20abs%20url%3E"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Home (Alt + H)">
                        
                    <img src="http://localhost:1313/images/msg_hu15231257772499651944.png" alt="" aria-label="logo"
                        height="20">Home</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/archives" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="https://github.com/adityatelange/hugo-PaperMod/wiki/" title="WiKi">
                    <span>WiKi</span>&nbsp;
                    <svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12">
                        <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path>
                        <path d="M15 3h6v6"></path>
                        <path d="M10 14L21 3"></path>
                    </svg>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/">主页</a>&nbsp;»&nbsp;<a href="http://localhost:1313/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      京东金融APP的鸿蒙之旅：技术、挑战与实践
    </h1>
    <div class="post-description">
      作者：京东科技高阔一、背景在今年6月份的华为开发者大会上，华为宣布HarmonyOSNEXT面向开发者和先锋用户启动Beta升级，并将于今年四季度正式商用。在9月21日的华为202
    </div>
    <div class="post-meta"><span title='2024-10-08 00:00:00 +0000 UTC'>十月 8, 2024</span>&nbsp;·&nbsp;2 分钟&nbsp;·&nbsp;京东云开发者&nbsp;|&nbsp;<a href="https://github.com/WangShaoyu1/myBlogPaperMod/tree/master/content/posts/jueJin/%e4%ba%ac%e4%b8%9c%e9%87%91%e8%9e%8dAPP%e7%9a%84%e9%b8%bf%e8%92%99%e4%b9%8b%e6%97%85%ef%bc%9a%e6%8a%80%e6%9c%af%e3%80%81%e6%8c%91%e6%88%98%e4%b8%8e%e5%ae%9e%e8%b7%b5.md" rel="noopener noreferrer" target="_blank">Suggest Changes</a>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">目录</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e4%b8%80%e8%83%8c%e6%99%af" aria-label="一、背景">一、背景</a></li>
                <li>
                    <a href="#%e4%ba%8c%e4%ba%ac%e4%b8%9c%e9%87%91%e8%9e%8d%e9%b8%bf%e8%92%99%e6%ad%a3%e5%bc%8f%e7%89%88%e5%8f%91%e5%b8%83" aria-label="二、京东金融鸿蒙正式版发布">二、京东金融鸿蒙正式版发布</a></li>
                <li>
                    <a href="#%e4%b8%89%e6%8a%80%e6%9c%af%e6%8c%91%e6%88%98%e4%b8%8e%e5%ae%9e%e8%b7%b5" aria-label="三、技术、挑战与实践">三、技术、挑战与实践</a><ul>
                        
                <li>
                    <a href="#1%e9%b8%bf%e8%92%99%e7%89%88%e7%9a%84%e5%bf%85%e8%a6%81%e6%80%a7" aria-label="1.鸿蒙版的必要性">1.鸿蒙版的必要性</a></li>
                <li>
                    <a href="#2%e6%95%b2%e5%ae%9a%e6%ad%a3%e5%bc%8f%e7%89%88%e5%8a%9f%e8%83%bd" aria-label="2.敲定正式版功能">2.敲定正式版功能</a></li>
                <li>
                    <a href="#3%e6%95%b4%e4%bd%93%e6%9e%b6%e6%9e%84%e6%a2%b3%e7%90%86" aria-label="3.整体架构梳理">3.整体架构梳理</a></li>
                <li>
                    <a href="#4%e6%8a%80%e6%9c%af%e6%96%b9%e6%a1%88%e5%af%b9%e6%af%94" aria-label="4.技术方案对比">4.技术方案对比</a></li>
                <li>
                    <a href="#5%e5%9f%ba%e5%bb%ba%e7%bb%84%e4%bb%b6%e5%bb%ba%e8%ae%be" aria-label="5.基建组件建设">5.基建组件建设</a></li>
                <li>
                    <a href="#6%e5%8f%91%e5%b8%83%e5%b0%9d%e9%b2%9c%e7%89%88" aria-label="6.发布尝鲜版">6.发布尝鲜版</a></li>
                <li>
                    <a href="#7%e4%b8%9a%e5%8a%a1%e5%b1%82%e7%a0%94%e5%8f%91" aria-label="7.业务层研发">7.业务层研发</a></li>
                <li>
                    <a href="#8%e9%b8%bf%e8%92%99%e6%96%b0%e7%89%b9%e6%80%a7%e5%ba%94%e7%94%a8" aria-label="8.鸿蒙新特性应用">8.鸿蒙新特性应用</a></li>
                <li>
                    <a href="#9%e5%8f%91%e5%b8%83%e6%ad%a3%e5%bc%8f%e7%89%88" aria-label="9.发布正式版">9.发布正式版</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%9b%9b%e5%90%8e%e7%bb%ad%e8%a7%84%e5%88%92" aria-label="四.后续规划">四.后续规划</a></li>
                <li>
                    <a href="#%e4%ba%94%e6%80%bb%e7%bb%93" aria-label="五.总结">五.总结</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p>作者：京东科技 高阔</p>
<h2 id="一背景"><strong>一、背景</strong><a hidden class="anchor" aria-hidden="true" href="#一背景">#</a></h2>
<p><img loading="lazy" src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/157c3e2421f94d52a6df07179ab6e021~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1728961499&amp;x-signature=jfwF7uigaxAKDB4zlhIYmKdC82Q%3D" alt=""  />
</p>
<p>在今年6月份的华为开发者大会上，华为宣布HarmonyOS NEXT面向开发者和先锋用户启动Beta升级，并将于今年四季度正式商用。</p>
<p>在9月21日的华为2024全联接大会上华为终端总裁宣布，已有超过1万个应用和元服务上架HarmonyOS NEXT应用市场。此外，华为每年投入超过60亿元人民币激励开发者创新，华为开发者联盟注册开发者数量已快速增长至675万。</p>
<p>HarmonyOS NEXT是建立在OpenHarmony开发基础之上的，实现了&quot;纯正鸿蒙操作系统&quot;的体验。与目前的HarmonyOS 4.X版本相比，HarmonyOS NEXT去掉了AOSP的支持并剔除了linux内核，仅支持鸿蒙内核和鸿蒙系统应用，不可以运行Android应用，减少了40%的冗余代码，使系统的流畅度、能效、纯净安全特性大为提升。成为真正意义上和 Android 、iOS同级的操作系统。</p>
<h2 id="二京东金融鸿蒙正式版发布"><strong>二、京东金融鸿蒙正式版发布</strong><a hidden class="anchor" aria-hidden="true" href="#二京东金融鸿蒙正式版发布">#</a></h2>
<p>京东金融团队早在2023年11月份就已经开始对HarmonyOS NEXT系统进行调研,并与华为达成合作意向，合作启动了&quot;京东金融鸿蒙项目&quot;，并于6月份首次上架了尝鲜版。经过三个季度的攻坚，京东金融于9月19日上线6.9.30正式版本，该版本基于鸿蒙原生能力开发，并使用了系统级AI能力及意图框架，可实现对用户显性与高阶意图的理解，并通过小艺对话、智慧搜索等全场景智慧入口, 在不同终端或者场景中更精准地满足用户的个性化需求。</p>
<p><img loading="lazy" src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8575b46d815f496b8a3c088bbbc7e911~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1728961499&amp;x-signature=HLUJnGUAkPirm%2Fzqby0T3QBg8nI%3D" alt=""  />
</p>
<p><img loading="lazy" src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2e6b1ee3b2a348ffa567a6e6539deaf7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1728961499&amp;x-signature=QN%2BRmQ13fKzgXg3y%2FnjWI2SZCw8%3D" alt=""  />
</p>
<h2 id="三技术挑战与实践"><strong>三、技术、挑战与实践</strong><a hidden class="anchor" aria-hidden="true" href="#三技术挑战与实践">#</a></h2>
<p>下面我们将详细介绍京东金融 APP 鸿蒙版从 0 到 1 的艰辛历程，干货满满！</p>
<h3 id="1鸿蒙版的必要性"><strong>1.鸿蒙版的必要性</strong><a hidden class="anchor" aria-hidden="true" href="#1鸿蒙版的必要性">#</a></h3>
<p>在&quot;京东金融鸿蒙项目&quot;开始之前，团队对京东金融做了机型数据统计，在App日活用户中（除iOS），华为手机用户占比排名第一，并且排名靠前的这些机型也都到了换机周期。同时根据华为官方消息，HarmonyOS NEXT将于今年第三季度或第四季度以新机搭载新系统的形式，随华为mate70一起发布，届时会有6000+主流应用配套发布。因此HarmonyOS NEXT的发布对我们来说既是风险也是机遇。</p>
<p><strong>风险：</strong></p>
<p>(1) 如果我们不做适配，就会放弃掉这部分高质量用户。同时华为为了推进鸿蒙生态发展，势必会逐步清理存量机型，存量用户的体验也会逐步降低。</p>
<p>(2) 竞品在启动，尤其是国内银行类 APP已经率先启动适配工作，也会挤压业务发展空间。</p>
<p><strong>机遇：</strong></p>
<p>短期来看，近年来移动行业内最大的热点，占领先机，获取第一波增长红利。长期来看，华为用户的商务属性和金融业务属性契合度极高，为这批用户提供高质量、差异性的服务，更有利于业务转化。</p>
<p>基于上述考虑, 团队决定启动金融App鸿蒙项目。</p>
<h3 id="2敲定正式版功能"><strong>2.敲定正式版功能</strong><a hidden class="anchor" aria-hidden="true" href="#2敲定正式版功能">#</a></h3>
<p>京东金融App经过近10年的迭代，整个App功能庞大、页面繁多，共涉及5大业务线共200+个原生和Roma跨端页面，PV大于100的H5页面就有3400+个。如果一次性的把所有的功能全部进行移植势必会耗费大量的人力和时间成本，因此在项目开始前内部就敲定只上核心功能，非核心功能后续逐步迭代。为此我们对App进行了流量分析，对各页面的PV和UV进行了梳理, 经过和产品团队的商定，在9月份发布的正式版本中会上线21个大的功能模块，共包含180+个功能和页面 (只梳理原生和跨端页面)，这些功能基本就覆盖了金融App线上版本90%的能力。</p>
<h3 id="3整体架构梳理"><strong>3.整体架构梳理</strong><a hidden class="anchor" aria-hidden="true" href="#3整体架构梳理">#</a></h3>
<p><img loading="lazy" src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d54c4ac270e4064a9e2c3b932be185a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1728961499&amp;x-signature=OBXdGGnG1oLXT0ylcvTtnrqe7fI%3D" alt=""  />
</p>
<p>在&quot;京东金融鸿蒙项目&quot;进入研发阶段前，团队首先对App进行了整体架构梳理，App侧以功能为维度进行层级划分主要分为基建层和业务层 (只有全面理解整体架构才能为后续的方案选择奠定坚实基础)。</p>
<p><strong>基建层</strong></p>
<p>为业务层提供基础能力，赋能业务。如: 网络、路由、数据监控、Web容器、Roma跨端框架等。</p>
<p><strong>业务层</strong></p>
<p>所有为用户提供的服务。金融App采用容器化的开发模式，业务侧实现方式主要是原生页面、Roma跨端页面、H5页面。</p>
<p>在金融App中，业务运行在基建层提供的动态化(Roma)容器、H5容器、小程序容器中，这种方案可以使业务层的逻辑和功能被封装在一个&quot;可重用&quot;的容器中，在对新系统适配时，无需对底层平台或环境进行大规模的修改和适配，从而让业务团队可以专注于核心业务的开发和优化，而不是花费大量时间和资源去处理与平台兼容性相关的问题。因此只需要对容器进行进行适配，就可以让业务以最小的改动运行在鸿蒙系统中。</p>
<h3 id="4技术方案对比"><strong>4.技术方案对比</strong><a hidden class="anchor" aria-hidden="true" href="#4技术方案对比">#</a></h3>
<p>在技术方案选型的阶段，团队明确了以&quot;低成本&quot;、&ldquo;强扩展&rdquo;、&ldquo;低风险&quot;为核心的三个指导原则。首先，在公司&quot;降本增效&quot;的大背景下就要求在保证项目质量和功能的前提下，尽可能地降低投入成本，提高资源利用效率。其次，需要充分考虑未来可能会有更多的厂商推出不兼容安卓的自研手机系统(如: 小米澎湃、VIVO蓝河等)，项目需要具备灵活性和适应性。这样当出现更多的操作系统时才能轻松进行扩展适配，而无需从头开始，大大节省了时间和成本。最后，方案需要有较低的风险，这样才能有助于正常的把控项目,保障项目按时交付。</p>
<p>根据金融App的现有架构和技术特性，在技术方案选型过程中，需要对基建层、H5容器和原生/Roma跨端页面进行单独分析。</p>
<p><strong>基建层组件:</strong></p>
<p>基建层提供的功能较为核心，需要有较好的稳定性、兼容性和优异的性能，因此基建层需要使用鸿蒙ArkTS语言重写，这个工作是逃不掉的，但考虑到后期相同的基建层组件需要同时维护三个版本(安卓/IOS/鸿蒙)，因此我们尝试部分组件的三端通用部分使用C/C++来编写，后期该组件稳定后会替换其他两端，实现三端使用同一套代码，该方案走通后，会逐步推广到所有组件。</p>
<p>例如: 奇点SDK提供了用户行为统计、页面行为统计、APP行为统计、自动埋点、DAU统计、H5基础信息采集、曝光等功能，三端的逻辑基本相同，归纳起来主要是数据采集、存储、上传，在其他两端使用Java和OC实现，在鸿蒙版本上直接使用C/C++来实现，后续三端维护一套代码即可。</p>
<p><strong>H5容器:</strong></p>
<p>由于鸿蒙系统ArkWeb组件基于Chrome，因此无需担心ArkWeb对现有H5的兼容性，但App需要对ArkWeb进行封装，提供jsbridge实现H5需要的全部金融App原生能力。</p>
<p>在工作开始前，统计了金融项目中一共有99个jsbridge，通过调用量对这些jsbridge进行排序，并对每个jsbridge的功能、依赖项、调用方进行分析以便确定必要性和优先级。</p>
<p>在jsbridge提供的能力依赖外部SDK时，可以适当降低其优先级。例如，51号桥提供风控人脸OCR功能， 虽然每日调用量很高，但由于该功能实现依赖智能团队，因此51号桥也只能把实现优先级降低，等待智能团队提供SDK后再做jsbridge的实现。</p>
<p>在jsbridge的调用方不在此正式版上线时，该jsbridge可以暂时不实现。例如，94号桥提供添加小组件到系统桌面的能力，但9月份的正式版本暂时不会提供小组件，因此94号桥暂时就不会实现。</p>
<p>最终在确定所有jsbridge的必要性和优先级后，在正式版一共实现了63个jsbridge，剩余36个待后续根据实际情况依次实现。</p>
<p><strong>原生页面&amp;Roma跨端页面:</strong></p>
<p>方案</p>
<p>﻿</p>
<p>方案一</p>
<p>方案二（建议方案-短期）</p>
<p>方案三 (建议方案-长期)</p>
<p>介绍</p>
<p>不使用Roma跨端技术，金融App所有页面及功能使用鸿蒙原生ArkUI实现。</p>
<p>使用Roma跨端技术，Roma绘制对接鸿蒙原生ArkUI控件，所有金融App页面使用Roma跨端实现。</p>
<p>使用Roma跨端技术，Roma绘制使用自绘制方案，所有金融App页面使用Roma跨端实现。</p>
<p>优势</p>
<p>所有功能使用纯鸿蒙实现，稳定、兼容性好。</p>
<p>1.Roma跨端页面少量适配。 2.有安卓适配技术参考。</p>
<p>1.大幅降低多端一致性适配成本。 2.适配后可复用于鸿蒙及其他系统。</p>
<p>劣势</p>
<p>工作量大，所有页面都需要重写。</p>
<p>未来更多系统适配成本高。</p>
<p>技术难度大、成本高、无法靠多人力并行加速。</p>
<p>风险点</p>
<p>系统能力缺失，无法对齐原有安卓能力。</p>
<p>各平台系统结构不同，JS引擎编译复杂。</p>
<p>赶不上华为发布节奏。</p>
<p>对于原生页面和Roma跨端页面，我们梳理出了三种方案，在三种方案中，方案一无疑是最稳定且风险最低的，但方案一工作量巨大，所有页面都需要重写，无法复用现有的技术资产。而方案三无疑是终极方案，如果使用方案三，后续有新操作系统推出，Roma跨端页面几乎不需要适配，Roma框架不需要重新开发，只需要简单适配即可，但该方案技术难度较大，成本较高。</p>
<p>最后对这三种方案进行了简单的人力成本推算，同时也预判其他手机厂商操作系统短期内不会不兼容安卓，目前各个大手机厂商也无动作，在综合了&quot;成本&rdquo;、&ldquo;扩展性&rdquo;、&ldquo;风险&quot;这三个维度的考量后，我们的最终方案是方案二和方案三相结合，以方案二为主，同时对方案三进行技术预研。</p>
<h3 id="5基建组件建设"><strong>5.基建组件建设</strong><a hidden class="anchor" aria-hidden="true" href="#5基建组件建设">#</a></h3>
<p><img loading="lazy" src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c2f5861158374f848a0284cdb0aec9c3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1728961499&amp;x-signature=xT1XJSv%2BVMctoGraQmbINzgMMQU%3D" alt=""  />
</p>
<p><strong>App基建层架构图</strong></p>
<p>App从0-1的过程中，首要任务无疑是基建建设工作，基建层建设就需要详细梳理当前的基建层架构，明确必要基建组件和非必要基建组件，确定所有基建组件的依赖关系和优先级，从而精确评估各项工作的优先顺序以及所需的人力资源。</p>
<p>定义</p>
<p>组件</p>
<p>说明</p>
<p>优先级</p>
<p>必要组件</p>
<p>路由、网络库、信道加密、图片加载、web容器、Roma跨端框架等。</p>
<p>会堵塞正常的业务研发流程。</p>
<p>高</p>
<p>非必要组件</p>
<p>SGM、埋点、分享、H5离线化等。</p>
<p>不会堵塞正常的业务研发流程(重要不紧急)。</p>
<p>较低</p>
<p>团队早在第一季度就开始了必要组件的研发工作，并同时推动集团内部其他团队进行二方组件的建设，梳理排期，确保不会相互堵塞。通过三个季度的攻坚，完成了30+个P0、P1、P2、P3级别的基础组件开发工作。建设了鸿蒙版乐高框架、web容器、js桥组件、权限控制组件、工具库、push推送、扫一扫、长连接、H5离线化、SGM、路由、科技网关库、Lottie动画库、图片加载库、存储、权限申请、APP统一配置中心、统一分享库、图片浏览器、图片选择器等基础组件(组件可以对集团内赋能, 如需使用请与金融App团队联系)。</p>
<p>在基建建设过程中，我们面临了一系列前所未有的挑战，主要就是在新系统上&quot;摸着石头过河&rdquo;，ArkUI、ArkTS、OHPM、HIVGOR等研发框架对于我们都是全新的，除了官方文档没有任何最佳实践或者参考资料，只能边做边学习探索，团队内部每周都会在例会上分享自己遇到的&quot;坑&quot;, 大家相互成长。</p>
<p><strong>面临的部分挑战:</strong></p>
<p>(1) ArkTS虽然基于TypeScript，但是阉割了动态语言特性，导致实现部分功能较为复杂。</p>
<p>(2) ArkUI为声明式UI，与客户端常用的命令式UI不同，大家需要在在编程思想上进行转变。</p>
<p>(3) 早期鸿蒙系统的API丰富度、系统健壮性、开发工具的易用性和健壮性都存在一定问题。</p>
<p>(4) 鸿蒙生态中的一些新特性，如:意图框架、服务卡片、元服务等新概念也需要花一定时间去理解。</p>
<p>(5) 集团内二方组件之间相互依赖，需要协调各部门的排期，确保在规定时间完成。</p>
<h3 id="6发布尝鲜版"><strong>6.发布尝鲜版</strong><a hidden class="anchor" aria-hidden="true" href="#6发布尝鲜版">#</a></h3>
<p>在6月21日华为开发者大会后，华为会向100万受邀用户推送鸿蒙系统，为了让用户能够第一时间使用京东金融App，并借此获得品牌宣传和曝光，我们决定开发金融App鸿蒙尝鲜版本。</p>
<p>由于任务比较紧急，当时只完成了部分基建组件，Roma跨端框架也未完成，金融App中的所有使用跨端技术的页面均无法在尝鲜版本上使用，因此只能在该版本中使用ArkUI原生和H5的方式进行开发。为了使成本降到最低，对该版本的功能也进行了一定的取舍，尝鲜版本的功能需要满足几个条件，首先上线的功能需要有H5的版本，因为当时Web容器缺少对H5调用本地能力支持，所以该H5必须能够在纯浏览器的环境运行。其次，该功能在其他两端是以原生的技术形式开发的，这样此功能在尝鲜版本开发完后还可以复用到正式版本。</p>
<p>为了确保H5业务在尝鲜版本上不使用桥能力也能正确展示和使用，除了与H5开发同事高效沟通并解决他们提出的上百个问题外，金融App还内部实现了拦截、转义等能力，确保业务正常运行。</p>
<p>在不到两个月的时间内开发上线了金融App鸿蒙尝鲜版本，成功京东集团首个上架的鸿蒙原生应用。同时在华为开发者大会上，金融App尝鲜版本成功获得了金融品类的产品曝光。</p>
<h3 id="7业务层研发"><strong>7.业务层研发</strong><a hidden class="anchor" aria-hidden="true" href="#7业务层研发">#</a></h3>
<p>金融App采用的是混合开发模式，业务侧实现方式主要是原生页面、Roma跨端页面、H5页面。这三种不同类型的页面在研发过程中各具特点，所需的技术手段与工作流程也各有侧重。</p>
<p><strong>H5页面适配</strong></p>
<p>H5页面会通过金融App提供的jsbridge调用金融App的原生能力，因此在金融Web容器改造完成并提供原生能力后，H5页面需要进行适配并回归，会有如下的两个式配点。</p>
<p><strong>(1) Web容器UA适配</strong></p>
<p>H5页面会依据Web容器的UA中所包含的clientType和osName字段值来识别当前运行的操作系统环境，进而执行相应的逻辑操作，在鸿蒙系统中，Web容器的UA内容会产生变化，因此代码需要增加在鸿蒙系统的判断。金融App会在Web容器原始UA中追加部分信息，其中部分字段的值会产生变动，如:clientType字段值变harmonyos，osName字段值变为harmonyos，src字段值变为AppGrallery。</p>
<p><strong>(2) 升级jrbridge库</strong></p>
<p>在H5页面中，所有业务均使用统一提供的jrbridge库调用金融客户端的原生能力，然而当前该库仅识别安卓与iOS系统，尚未涵盖鸿蒙系统。因此，为确保所有H5页面的兼容性，所有H5页面需要对jrbridge进行升级，以适应不同平台的运行需求。</p>
<p><strong>鸿蒙ArkUI原生页面研发</strong></p>
<p><strong>(1) ArkUI原生转Roma跨端</strong></p>
<p>由于历史遗留问题，金融App在版本迭代过程中只把功能变动比较频繁的原生页面修改为Roma跨端页面，App内依旧存在部分原生页面。在鸿蒙项目中，我们依据各页面的功能特性与技术复杂度，逐步将那些遗留的原生页面转化为兼容性更强的Roma跨端界面，以实现更为统一且高效的用户体验。</p>
<p><strong>(2) 使用鸿蒙ArkUI原生</strong></p>
<p>首先需要明确哪些页面需要使用ArkUI原生方式，对于这个问题并没有标准的答案，需要对页面的功能、使用时机、性能要求等进行综合分析。通常情况下，对于部分对性能要求非常高或Roma跨端引擎无法完成或基建层的页面需要使用鸿蒙原生ArkUI进行重写。</p>
<p>例如:大图浏览器页面，这个页面提供了对多张大图的全屏切换浏览的功能，由于该页面是一个通用功能，因此不能有过多的依赖项，这样才能方便其他App复用，并且该页面功能变更也不会很频繁，因此这个页面明显就更适合使用ArkUI原生的方式。</p>
<p>再如:登录页面也是使用ArkUI原生的方式进行开发。主要原因有两个，第一:登录页面需要调用大量的原生能力，如果使用Roma跨端就需要实现大量的桥，逻辑非常复杂，工作量会比使用ArkUI原生还大。第二:登录页面在App启动后会立刻弹出，对性能要求较高，因此也不太适合使用Roma跨端技术。</p>
<p>通过使用上述思路进行分析，我们把如首页、文章详情页、登录页、全部服务等页面使用ArkUI原生方式进行开发，这部分工作主要是熟悉ArkUI的语法及属性，但难点在于ArkUI采用声明式UI，而我们的开发之前使用的都是命令式UI，思想需要变化。</p>
<p><strong>Roma跨端页面适配</strong></p>
<p>在6月底，我们打通鸿蒙基建、Roma框架、乐高框架、鸿蒙原生的整体链路后，业务研发开始进场适配跨端页面，虽然跨端页面的核心优势就在于其跨设备兼容性，但是第一次在一个全新的操作系统上运行，也会有大量的适配工作，具体适配工作主要体现在如下几个方面。</p>
<p><strong>(1) Roma扩展模块&amp;扩展标签</strong></p>
<p>Roma跨端引擎作为一个通用引擎，不可能为金融App提供所有业务功能，所有业务属性较强的功能或UI控件全部需要业务研发以鸿蒙原生的形式去提前实现，然后在Roma页面中动态调用(Android和IOS端也是这样)。在业务进场时，整体链路虽然基本调通，但依旧有许多细节问题需要打磨，由于时间比较紧迫只能是业务和Roma框架并行开发，双方互相反馈细节问题，最终一共开发22个业务扩展标签和32个业务扩展模块。</p>
<p><strong>(2) UI细节调整</strong></p>
<p>由于鸿蒙系统布局问题导致Roma框架底层三端无法完全兼容，需要在鸿蒙系统上对UI进行微调。</p>
<p><strong>(3) 兼容系统层差异</strong></p>
<p>由于系统层差异，导致跨端页面调用部分系统原生能力时需要判断运行环境执行特定代码。</p>
<h3 id="8鸿蒙新特性应用"><strong>8.鸿蒙新特性应用</strong><a hidden class="anchor" aria-hidden="true" href="#8鸿蒙新特性应用">#</a></h3>
<p>当前金融App的业务增长压力较大，在完成功能层面迁移的同时团队还探索了鸿蒙系统的新特性，为了寻求业务发展的新突破，金融App结合自身金融属性做了部分新特性的应用，这样不仅提升了用户体验，也拓宽了业务增长的可能性。</p>
<p><img loading="lazy" src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d41baddd5574edfaaff0b3162ace8c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1728961499&amp;x-signature=yyJ1%2BV54kQiqp01pWr4mQwZjUZs%3D" alt=""  />
</p>
<p><strong>(1) 华为账号服务</strong></p>
<p>App接入华为账号服务，用户在使用金融App时，无需输入任何信息就可以通过华为一键登录的方式登录到金融App，缩短登录的链路，提升登录成功率(鸿蒙系统的华为账号登率为100%) 。相比于运营商的一键登录，华为账号服务具有使用成本低、无需接入SDK、不依赖手机号、支持无卡设备登多种优势。</p>
<p><img loading="lazy" src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ce195519c344e12a6b2d2b04ca40820~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1728961499&amp;x-signature=y8%2BKYfhAmni68Hy03VqP46olBVM%3D" alt=""  />
</p>
<p><strong>(2) 智能PhotoPicker</strong></p>
<p>智能PhotoPicker是基于PhotoPicker的高阶功能，该功能可以从大量图片中根据配置的智能推荐参数快速筛选出符合条件的图片，并在PhotoPicker中推荐给用户选择。目前支持的类型有如:身份证、银行卡、驾驶证、行驶证、二维码、头像等。</p>
<p>如下图就是金融App在上传实名认证上传身份证的场景中使用智能PhotoPicker后，PhotoPicker快速筛选出身份证照片。</p>
<p><img loading="lazy" src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/85bc2ad64648471da37d1fcc9c6f4fb9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1728961499&amp;x-signature=UtZRJPQ5pNZP18suMOGxnHTugmE%3D" alt=""  />
</p>
<p><strong>(3) 意图框架</strong></p>
<p>HarmonyOS NEXT引入了多项创新特性，其中意图框架能够将应用中的业务功能智能分发至手机的各大系统入口，系统入口包括小艺对话、小艺搜索和小艺建议等。通过这一特性，用户不仅可以主动搜索和调用所需服务，还能享受到系统智能推荐的个性化建议。这将有效提升用户体验，带来全新的流量增长点，并为应用增量提供强大支持。</p>
<p>结合京东金融自身业务场景，我们在正式版中确定了以下五个场景：</p>
<ol>
<li>对小艺说:&ldquo;查询京东消费明细&rdquo;。</li>
</ol>
<p>动作：打开京东金融账单详情页面。</p>
<p>描述：用户可以方便地查看自己在京东的消费明细，了解每一笔交易的详细信息，从而更好地管理个人财务。</p>
<ol start="2">
<li>对小艺说:&ldquo;查询京东白条账单&rdquo;。</li>
</ol>
<p>动作：打开京东金融白条全部账单页面。</p>
<p>描述：用户可以查看所有京东白条的账单信息，包括账单金额、还款日期等，帮助用户及时还款，避免逾期。</p>
<ol start="3">
<li>对小艺说:&ldquo;还一下京东白条&rdquo;。</li>
</ol>
<p>动作：打开京东金融白条还款页面。</p>
<p>描述：用户可以直接进入还款页面，进行京东白条的还款操作，简化了还款流程，提高了还款效率。</p>
<ol start="4">
<li>对小艺说:&ldquo;推荐京东金融理财产品&rdquo;。</li>
</ol>
<p>动作：打开京东金融理财页面。</p>
<p>描述：系统会根据用户的财务状况和投资偏好，推荐适合的理财产品，帮助用户实现财富增值。</p>
<ol start="5">
<li>对小艺说: &ldquo;查看最近新上的股票&rdquo;。</li>
</ol>
<p>动作：打开京东金融新股日历页面。</p>
<p>描述：用户可以查看最近上市的新股票信息，包括上市日期、公司背景等，帮助用户抓住投资机会。</p>
<p>通过这些场景的智能分发，京东金融能够为用户提供更加便捷和个性化的金融服务，提升用户体验，增强用户对京东金融的依赖和满意度。</p>
<p><img loading="lazy" src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5f2c4ca4c39d47b0b2b94aefc64b373d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1728961499&amp;x-signature=UXwkSnZ503Tg8ipTPGHq1DA9%2FRY%3D" alt=""  />
</p>
<p><strong>总结:</strong></p>
<p>金融App鸿蒙版不仅仅是功能的迁移，而是要充分利用鸿蒙系统新的特性，重新设计用户体验。结合这些新特性挖掘在获客、活跃、降本增效&amp;用户体验上的机会。</p>
<h3 id="9发布正式版"><strong>9.发布正式版</strong><a hidden class="anchor" aria-hidden="true" href="#9发布正式版">#</a></h3>
<p>由于项目时间比较紧张，前期只专注于功能的建设，在项目进入尾声阶段有两个比较重要的研发类问题急需解决，不解决甚至会直接影响App上架。</p>
<p><strong>(1) 折叠屏适配</strong></p>
<p>根据华为的要求，所有应用都需要对折叠屏手机进行适配。如果不对折叠屏进行适配则无法上架应用商店，为保证京东金融顺利通过应用市场的审核，参考华为提供的折叠屏适配方案，综合风险、成本等因素考虑，最终使用所有控件整体放大1.2倍的思路进行适配，并通过华为一多测试，满足上架要求。</p>
<p><img loading="lazy" src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ed5be01b6491403e8b6ee1d48999876f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1728961499&amp;x-signature=in9epYx2p5IlsrkVbm5dsymc7BE%3D" alt=""  />
</p>
<p><strong>(2) 性能优化</strong></p>
<p>根据华为的要求，上架的App核心页面需要达到S标或不低于IOS的体验，以金融App为例，通过使用IDE提供的Profiler工具进行分析, 影响性能的原因主要有以下几方面。</p>
<p><strong>原因:</strong></p>
<p>(1) ArkUI为声明式UI，使用数据驱动，不支持继承，如果扩展UI组件，只能采取组件外再包一层的方式，这种方式会让UI层级变深，影响渲染速度。</p>
<p>(2) 鸿蒙的线程内存模型是Actor模型，该模型不允许线程间共享内存，线程间通信非常麻烦，这就使得大量的重载逻辑放在了主线程中执行，影响渲染速度。</p>
<p>(3) 部分系统API性能较差。</p>
<p><strong>解决方案:</strong></p>
<p>(1) 精简UI层级，合理使用状态同步属性，避免产生冗余刷新操作。</p>
<p>(2) 使用worker和taskpool把非UI的重载操作放到子线程中，把主线程中的同步操作改为异步操作。</p>
<p>(3) 对于性能较差的非UI系统API放在子线程中执行，部分UI相关API推动华为鸿蒙团队优化性能。</p>
<p>通过与华为团队的几轮沟通，并共同商讨技术方案，最终京东金融有88%的场景达到S标，满足上架要求。</p>
<p>除了上述两个和研发相关的问题外，还需要准备华为应用商店要求的上架材料，这里面需要特别注意的主要有三个材料。</p>
<p><strong>(1) 软件著作权</strong></p>
<p>App的软著一般情况只有android版和ios版本，两个平台是单独申请的，所以需要为鸿蒙版的App单独申请软著，申请时效为3个月左右，为保障不影响上架华为应用商店，请提请申请。</p>
<p><strong>(2) 工信部ICP备案</strong></p>
<p>和软著类似，客户端一般只ICP备案了android和ios平台，因此需要在工信部对鸿蒙平台进行单独备案，在备案前请准备bundleName、签名MD5、平台公钥，并确保真实有效。</p>
<p><strong>(3) 更新隐私协议</strong></p>
<p>App的隐私政策也需要更新，鸿蒙版的隐私政策既可以和Android/IOS共用一份通用版本，也可以为鸿蒙单独创建一版。</p>
<p><strong>通用版本指App在iOS、Android、HarmonyOS共用一份隐私声明，此场景要做到对HarmonyOS不歧视。具体规则如下：</strong></p>
<p>•设备类型/平台类型如果描述Andriod，必须要提HarmonyOS。</p>
<p>•设备唯一标识/ID的情形、权限相关的描述、SDK相关的描述、个人信息相关的描述：如果描述Android ID等字样，应该补充描述HarmonyOS(OAID/AAID/ODID/UUID/xxx)的一种或几种。</p>
<p><strong>单独版本指NEXT单独开发的版本，仅描述HarmonyOS NEXT设备上的隐私声明。具体规则如下：</strong></p>
<p>•设备类型/平台类型不允许出现Android、iOS描述。</p>
<p>•设备唯一标识/ID的情形、权限相关的描述、SDK相关的描述、个人信息相关的描述：不能描述Android ID等字样，应该描述HarmonyOS(OAID/AAID/ODID/UUID/xxx)的一种或几种。</p>
<p>总结下来就是通用版本不歧视HarmonyOS，单独版本不露出iOS、Android品牌，尽量露出HarmonyOS品牌。</p>
<p>鸿蒙项目自3月27日科技内部启动会开始，包括各跨BGBU部门团队成员，共同经历了近六个月的持续努力，期间还经历了尝鲜版本的体验版的攻坚，最终各部门克服了重重技术困难及业务压力，各业务线顺利完成主要业务的鸿蒙建设。金融APP鸿蒙版在9月初完成了首发功能的集成，并面向C端用户的进行了灰度体验。随着鸿蒙Next的正式版发布的临近，金融App鸿蒙版（正式版）于9月20日正式通过华为应用市场审核，全量面向C端用户。</p>
<p><strong>在整个过程中京东金融团队共完成</strong></p>
<p>(1) &ldquo;推荐&rdquo;、&ldquo;理财&rdquo;、&ldquo;省钱&rdquo;、&ldquo;社区&rdquo;、&ldquo;我的&quot;5个频道页的开发。</p>
<p>(2) &ldquo;刷新用户数据&rdquo;、&ldquo;选取相册&rdquo;、&ldquo;扫一扫&quot;等63个jsbridge的开发, 为H5提供了所有需要用到的原生能力。</p>
<p>(3) &ldquo;科技网关&rdquo;、&ldquo;Web容器&rdquo;、&ldquo;路由&rdquo;、&ldquo;SGM&rdquo;、&ldquo;奇点&quot;等30+个基建组件。</p>
<p>(4) 开发和适配了理财、社区、省钱等5大业务线的180+个功能和页面。</p>
<p>(5) 22个Roma业务扩展标签和32个Roma业务扩展模块。</p>
<p>等等。。。</p>
<h2 id="四后续规划"><strong>四.后续规划</strong><a hidden class="anchor" aria-hidden="true" href="#四后续规划">#</a></h2>
<p><strong>1.补全剩余功能</strong></p>
<p>金融APP鸿蒙6.9.30正式版本功能与金融APP主版本内容非100%一致，各业务还存在约10%的差异，差异部分将通过后续版本迭代补齐。</p>
<p><strong>2.鸿蒙生态探索</strong></p>
<p>鸿蒙不是Android或iOS的平替，不是把代码重写一遍，而是重新设计用户体验，后续我们会持续探索鸿蒙生态中的新玩法(如元服务、服务卡片、服务流转、AI等)，为业务带来增量。</p>
<h2 id="五总结"><strong>五.总结</strong><a hidden class="anchor" aria-hidden="true" href="#五总结">#</a></h2>
<p>HarmonyOS NEXT是一个全新的操作系统，对应用程序而言，无法沿用既有的Android或iOS平台代码，功能需要全部重写。作为首批开启鸿蒙版App研发的团队，我们在开发初期也面临了重重挑战，没有前人经验可供借鉴，只能通过与华为的紧密合作，逐步探索并解决问题。在整个项目周期内，一共给华为提了700+个issuereporter，在反馈问题的同时也为鸿蒙系统提了大量的优化建议。随着更多团队投身于鸿蒙版本的开发，金融团队计划将鸿蒙项目中所遇的种种难题和解决方案，以&lt;京东金融APP的鸿蒙之旅系列专题&gt;形式逐一分享。这些专题涵盖了<strong>鸿蒙的UI适配</strong>、<strong>基础架构打造</strong>、<strong>工程化实践</strong>、<strong>新特性运用</strong>以及<strong>性能优化</strong>等关键领域，旨在为后续跟进的开发者们提供宝贵的经验参考。</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/%E5%89%8D%E7%AB%AF/">前端</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://localhost:1313/posts/wiki/%E8%99%9A%E6%8B%9F%E4%BA%BA%E8%AF%AD%E9%9F%B3%E5%8A%9F%E8%83%BD%E6%BC%94%E7%A4%BA%E8%84%9A%E6%9C%AC%E6%96%87%E6%A1%A3/">
    <span class="title">« 上一页</span>
    <br>
    <span>虚拟人语音功能演示脚本文档</span>
  </a>
  <a class="next" href="http://localhost:1313/posts/juejin/websocket%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/">
    <span class="title">下一页 »</span>
    <br>
    <span>Websocket基本使用</span>
  </a>
</nav>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 京东金融APP的鸿蒙之旅：技术、挑战与实践 on x"
            href="https://x.com/intent/tweet/?text=%e4%ba%ac%e4%b8%9c%e9%87%91%e8%9e%8dAPP%e7%9a%84%e9%b8%bf%e8%92%99%e4%b9%8b%e6%97%85%ef%bc%9a%e6%8a%80%e6%9c%af%e3%80%81%e6%8c%91%e6%88%98%e4%b8%8e%e5%ae%9e%e8%b7%b5&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E4%25BA%25AC%25E4%25B8%259C%25E9%2587%2591%25E8%259E%258Dapp%25E7%259A%2584%25E9%25B8%25BF%25E8%2592%2599%25E4%25B9%258B%25E6%2597%2585%25E6%258A%2580%25E6%259C%25AF%25E6%258C%2591%25E6%2588%2598%25E4%25B8%258E%25E5%25AE%259E%25E8%25B7%25B5%2f&amp;hashtags=%e5%89%8d%e7%ab%af">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 京东金融APP的鸿蒙之旅：技术、挑战与实践 on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E4%25BA%25AC%25E4%25B8%259C%25E9%2587%2591%25E8%259E%258Dapp%25E7%259A%2584%25E9%25B8%25BF%25E8%2592%2599%25E4%25B9%258B%25E6%2597%2585%25E6%258A%2580%25E6%259C%25AF%25E6%258C%2591%25E6%2588%2598%25E4%25B8%258E%25E5%25AE%259E%25E8%25B7%25B5%2f&amp;title=%e4%ba%ac%e4%b8%9c%e9%87%91%e8%9e%8dAPP%e7%9a%84%e9%b8%bf%e8%92%99%e4%b9%8b%e6%97%85%ef%bc%9a%e6%8a%80%e6%9c%af%e3%80%81%e6%8c%91%e6%88%98%e4%b8%8e%e5%ae%9e%e8%b7%b5&amp;summary=%e4%ba%ac%e4%b8%9c%e9%87%91%e8%9e%8dAPP%e7%9a%84%e9%b8%bf%e8%92%99%e4%b9%8b%e6%97%85%ef%bc%9a%e6%8a%80%e6%9c%af%e3%80%81%e6%8c%91%e6%88%98%e4%b8%8e%e5%ae%9e%e8%b7%b5&amp;source=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E4%25BA%25AC%25E4%25B8%259C%25E9%2587%2591%25E8%259E%258Dapp%25E7%259A%2584%25E9%25B8%25BF%25E8%2592%2599%25E4%25B9%258B%25E6%2597%2585%25E6%258A%2580%25E6%259C%25AF%25E6%258C%2591%25E6%2588%2598%25E4%25B8%258E%25E5%25AE%259E%25E8%25B7%25B5%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 京东金融APP的鸿蒙之旅：技术、挑战与实践 on reddit"
            href="https://reddit.com/submit?url=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E4%25BA%25AC%25E4%25B8%259C%25E9%2587%2591%25E8%259E%258Dapp%25E7%259A%2584%25E9%25B8%25BF%25E8%2592%2599%25E4%25B9%258B%25E6%2597%2585%25E6%258A%2580%25E6%259C%25AF%25E6%258C%2591%25E6%2588%2598%25E4%25B8%258E%25E5%25AE%259E%25E8%25B7%25B5%2f&title=%e4%ba%ac%e4%b8%9c%e9%87%91%e8%9e%8dAPP%e7%9a%84%e9%b8%bf%e8%92%99%e4%b9%8b%e6%97%85%ef%bc%9a%e6%8a%80%e6%9c%af%e3%80%81%e6%8c%91%e6%88%98%e4%b8%8e%e5%ae%9e%e8%b7%b5">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 京东金融APP的鸿蒙之旅：技术、挑战与实践 on facebook"
            href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E4%25BA%25AC%25E4%25B8%259C%25E9%2587%2591%25E8%259E%258Dapp%25E7%259A%2584%25E9%25B8%25BF%25E8%2592%2599%25E4%25B9%258B%25E6%2597%2585%25E6%258A%2580%25E6%259C%25AF%25E6%258C%2591%25E6%2588%2598%25E4%25B8%258E%25E5%25AE%259E%25E8%25B7%25B5%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 京东金融APP的鸿蒙之旅：技术、挑战与实践 on whatsapp"
            href="https://api.whatsapp.com/send?text=%e4%ba%ac%e4%b8%9c%e9%87%91%e8%9e%8dAPP%e7%9a%84%e9%b8%bf%e8%92%99%e4%b9%8b%e6%97%85%ef%bc%9a%e6%8a%80%e6%9c%af%e3%80%81%e6%8c%91%e6%88%98%e4%b8%8e%e5%ae%9e%e8%b7%b5%20-%20http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E4%25BA%25AC%25E4%25B8%259C%25E9%2587%2591%25E8%259E%258Dapp%25E7%259A%2584%25E9%25B8%25BF%25E8%2592%2599%25E4%25B9%258B%25E6%2597%2585%25E6%258A%2580%25E6%259C%25AF%25E6%258C%2591%25E6%2588%2598%25E4%25B8%258E%25E5%25AE%259E%25E8%25B7%25B5%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 京东金融APP的鸿蒙之旅：技术、挑战与实践 on telegram"
            href="https://telegram.me/share/url?text=%e4%ba%ac%e4%b8%9c%e9%87%91%e8%9e%8dAPP%e7%9a%84%e9%b8%bf%e8%92%99%e4%b9%8b%e6%97%85%ef%bc%9a%e6%8a%80%e6%9c%af%e3%80%81%e6%8c%91%e6%88%98%e4%b8%8e%e5%ae%9e%e8%b7%b5&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E4%25BA%25AC%25E4%25B8%259C%25E9%2587%2591%25E8%259E%258Dapp%25E7%259A%2584%25E9%25B8%25BF%25E8%2592%2599%25E4%25B9%258B%25E6%2597%2585%25E6%258A%2580%25E6%259C%25AF%25E6%258C%2591%25E6%2588%2598%25E4%25B8%258E%25E5%25AE%259E%25E8%25B7%25B5%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 京东金融APP的鸿蒙之旅：技术、挑战与实践 on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=%e4%ba%ac%e4%b8%9c%e9%87%91%e8%9e%8dAPP%e7%9a%84%e9%b8%bf%e8%92%99%e4%b9%8b%e6%97%85%ef%bc%9a%e6%8a%80%e6%9c%af%e3%80%81%e6%8c%91%e6%88%98%e4%b8%8e%e5%ae%9e%e8%b7%b5&u=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E4%25BA%25AC%25E4%25B8%259C%25E9%2587%2591%25E8%259E%258Dapp%25E7%259A%2584%25E9%25B8%25BF%25E8%2592%2599%25E4%25B9%258B%25E6%2597%2585%25E6%258A%2580%25E6%259C%25AF%25E6%258C%2591%25E6%2588%2598%25E4%25B8%258E%25E5%25AE%259E%25E8%25B7%25B5%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span><a href="https://beian.miit.gov.cn/">粤ICP备2023039897号-1</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = '复制';

        function copyingDone() {
            copybutton.innerHTML = '已复制！';
            setTimeout(() => {
                copybutton.innerHTML = '复制';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
