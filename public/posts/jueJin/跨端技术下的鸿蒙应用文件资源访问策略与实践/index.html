<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>跨端技术下的鸿蒙应用：文件资源访问策略与实践 | PaperMod</title>
<meta name="keywords" content="HarmonyOS, 前端">
<meta name="description" content="作为跨端框架，原生web组件中直接访问本地应用文件资源和远程跨域文件资源是一个常见且必要的应用场景。如双线程技术或混合开发模式下的web组件中对用户文件、应用资源、远程跨域资源的预览。">
<meta name="author" content="九酒">
<link rel="canonical" href="http://localhost:1313/posts/juejin/%E8%B7%A8%E7%AB%AF%E6%8A%80%E6%9C%AF%E4%B8%8B%E7%9A%84%E9%B8%BF%E8%92%99%E5%BA%94%E7%94%A8%E6%96%87%E4%BB%B6%E8%B5%84%E6%BA%90%E8%AE%BF%E9%97%AE%E7%AD%96%E7%95%A5%E4%B8%8E%E5%AE%9E%E8%B7%B5/">
<meta name="google-site-verification" content="XYZabc">
<link crossorigin="anonymous" href="/assets/css/stylesheet.7b92bf4867c997b58ec50f63451b83777173d5bd5593376852abd85746d09d71.css" integrity="sha256-e5K/SGfJl7WOxQ9jRRuDd3Fz1b1VkzdoUqvYV0bQnXE=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<link rel="apple-touch-icon" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<link rel="mask-icon" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="zh" href="http://localhost:1313/posts/juejin/%E8%B7%A8%E7%AB%AF%E6%8A%80%E6%9C%AF%E4%B8%8B%E7%9A%84%E9%B8%BF%E8%92%99%E5%BA%94%E7%94%A8%E6%96%87%E4%BB%B6%E8%B5%84%E6%BA%90%E8%AE%BF%E9%97%AE%E7%AD%96%E7%95%A5%E4%B8%8E%E5%AE%9E%E8%B7%B5/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript><meta property="og:title" content="跨端技术下的鸿蒙应用：文件资源访问策略与实践" />
<meta property="og:description" content="作为跨端框架，原生web组件中直接访问本地应用文件资源和远程跨域文件资源是一个常见且必要的应用场景。如双线程技术或混合开发模式下的web组件中对用户文件、应用资源、远程跨域资源的预览。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/posts/juejin/%E8%B7%A8%E7%AB%AF%E6%8A%80%E6%9C%AF%E4%B8%8B%E7%9A%84%E9%B8%BF%E8%92%99%E5%BA%94%E7%94%A8%E6%96%87%E4%BB%B6%E8%B5%84%E6%BA%90%E8%AE%BF%E9%97%AE%E7%AD%96%E7%95%A5%E4%B8%8E%E5%AE%9E%E8%B7%B5/" />
<meta property="og:image" content="http://localhost:1313/images/papermod-cover.png" />
<meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-09-23T00:00:00+00:00" />
<meta property="article:modified_time" content="2024-09-23T00:00:00+00:00" />


<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="http://localhost:1313/images/papermod-cover.png" />
<meta name="twitter:title" content="跨端技术下的鸿蒙应用：文件资源访问策略与实践"/>
<meta name="twitter:description" content="作为跨端框架，原生web组件中直接访问本地应用文件资源和远程跨域文件资源是一个常见且必要的应用场景。如双线程技术或混合开发模式下的web组件中对用户文件、应用资源、远程跨域资源的预览。"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "跨端技术下的鸿蒙应用：文件资源访问策略与实践",
      "item": "http://localhost:1313/posts/juejin/%E8%B7%A8%E7%AB%AF%E6%8A%80%E6%9C%AF%E4%B8%8B%E7%9A%84%E9%B8%BF%E8%92%99%E5%BA%94%E7%94%A8%E6%96%87%E4%BB%B6%E8%B5%84%E6%BA%90%E8%AE%BF%E9%97%AE%E7%AD%96%E7%95%A5%E4%B8%8E%E5%AE%9E%E8%B7%B5/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "跨端技术下的鸿蒙应用：文件资源访问策略与实践",
  "name": "跨端技术下的鸿蒙应用：文件资源访问策略与实践",
  "description": "作为跨端框架，原生web组件中直接访问本地应用文件资源和远程跨域文件资源是一个常见且必要的应用场景。如双线程技术或混合开发模式下的web组件中对用户文件、应用资源、远程跨域资源的预览。",
  "keywords": [
    "HarmonyOS", "前端"
  ],
  "articleBody": "背景 作为跨端框架，原生 web 组件中直接访问本地应用文件资源和远程跨域文件资源是一个常见且必要的应用场景。如双线程技术或混合开发模式下的 web 组件中对用户文件、应用资源、远程跨域资源的预览。因此，在鸿蒙系统上，同样也需支持以上功能，从而提升跨端应用的开发效率和用户体验。\n然而，目前鸿蒙的 web 组件中并不直接支持用户文件、应用资源和远程跨域资源的预览，此时我们就需要寻求一种解决方案，以实现在鸿蒙系统上对这些资源的有效预览。\n文件基础 在鸿蒙系统中，本地文件主要包括应用文件、用户文件、系统文件。\n应用文件：文件所有者为应用，包括应用安装文件、应用资源文件、应用缓存文件等。 用户文件：文件所有者为登录到该终端设备的用户，包括用户的相册、文档等。 系统文件：与应用和用户无关的其它文件，包括公共库、设备文件、系统资源文件等。 在应用内，应用文件与部分系统文件组合成为一个应用沙箱。应用文件在应用内可以被进行保存和处理；在沙箱内的系统文件在文件应用内是只读的，沙箱外的系统文件是不可访问的；若想在应用内访问用户文件，则还需要通过特定的api，经过用户的相应授权才能进行。\nweb 组件内访问本地应用资源 在鸿蒙系统的应用中可直接通过 file 模块访问和处理应用文件，用户文件则需要通过 file.picker 模块的相关 api 获取到文件的 uri，然后通过 file 模块的 open 功能获取该 uri 文件内容。\n而在鸿蒙系统的 web 组件中直接访问本地文件资源则是无效的，一般可通过以下两种方式在应用进程中将本地文件资源的内容代理到 web 组件中。\n创建通道方式 通过创建应用与 web 通信通道，在应用中读取本地资源内容，向 web 传递读取的内容实现。在通过此种方式传递文件内容时，传递的数据一般为 ArrayBuffer ，当经过通道进行传递时，该ArrayBuffer 对应的内存缓冲区将会被传递到 web 中对应的 ArrayBuffer 对象所拥有，应用内创建的 Arraybuffer 将会被分离（byteLength 为 0）\n此种方式需要注意的是创建 html 侧端口流程需要在 html 侧监听 message 事件之后，否则无法在 web 侧监听到端口创建，也就无法接收到到端口相关的信息。另外，此方式不适用于太大的文件传输，毕竟会在系统侧创建一个内存缓冲区。\n由于此种方式需要读取文件内容，在文件内容（ArrayBuffer）未被使用完成时，不可关闭文件内容的读取，否则在 Web 侧将无法获取到创建的 ArrayBuffer 对象对应的缓冲区的内容。但当文件不再被使用时，需要及时关闭文件，避免后续出现系统问题。因此，可以在当前页面关闭时同时关闭该文件，并且关闭端口。\ntypescript\n代码解读\n复制代码\n// 读取文件内容 getArrayBuffer(filePath: string): ArrayBuffer | undefined { try{ const file: fs.File = fs.openSync(filePath, fs.OpenMode.READ_ONLY) const fileStat = fs.statSync(filePath) // 读取源文件内容并写入至 ArrayBuffer let bufSize = fileStat.size; let readSize = 0; let buf = new ArrayBuffer(bufSize); let readOptions: ReadOptions = { offset: readSize, length: bufSize }; fs.readSync(file.fd, buf, readOptions); this.fileFd = file.fd // 此时不能直接关闭文件，需要在页面关闭时关闭 return buf }catch(err) { return } } // 页面关闭时 aboutToDisappear(): void { try { // 关闭文件 fs.closeSync(this.fileFd) // 关闭端口 this.nativePort?.close() this.fileFd = null } catch (err) { } }\n拦截请求方式 通过 web 组件的 onInterceptRequest ，可以拦截网页内对本地资源的请求，返回本地资源对应的文件句柄（file.fd）使 web 组件中对应请求直接请求到本地资源。\n对于标签上的资源访问和 fetch 的访问有些不同，若在 web 组件中通过 等资源类标签通过 file 协议访问应用资源时，由于它会从本地文件系统加载资源，不会跨域，所以可以在onInterceptRequest 中进行拦截。但对于 web 组件内直接 fetch 网络请求一个file协议的本地资源时，则由于浏览器的安全限制，浏览器通常会阻止这个请求，导致无法触发拦截。\n鸿蒙的 ArkWeb 内核不允许 file 协议或者 resource 协议访问URL上下文中来自跨域的请求。因此，对于网页内通过 fetch 等网络请求的方式请求一个 file 协议或 resource 协议的本地资源时，若不做任何处理，则会存在响应跨域或无法拦截的问题。解决上述问题可以通过创建同域环境来解决，主要的场景有以下两种。\n本地 web 网页 对于访问内置的 Web 页面，可以配置私有域名来创建同域环境。实现 Web 页面中对应用资源的请求\n如： 应用内 Web 页面是 rawfile 下的 index.html， 我们可以创建一个私有域名 domain（尽量不要和网络上真实存在的域名冲突），访问 rawfile 下的文件都设置为 domain + ‘/rawfile/’，访问本地资源的链接都设置为 domain + ‘/localfile/’，这样在Web 组件中拦截时就可以针对性拦截，匹配到 domain + ‘/rawfile/’ 的返回 rawfile 下的文件，匹配到 domain + ‘/localfile/’ 的读取本地文件并返回响应\nkotlin\n代码解读\n复制代码\nlet domain = 'http://gmu.pdfviwer.com' let rawfileDir = domain + '/rawfile/' let localfileDir = domain + '/localfile/' // 组件中拦截 Web({ src: rawfileDir + 'index.html', conroller: this.webController }).onInterceptRequest((event: IRequestIntercept): WebResourceResponse | null =\u003e { if(event) { const url = event.request.getRequestUrl() if (url.startWith(rawfileDir) || url.startWith(localfileDir)) { if(url.startWith(rawfileDir)) { const rawfilePath = url.replace(rawfileDir, '') // 返回rawfile下的文件 this.responseWeb.setResponseData($rawfile(rawfilePath)); this.responseWeb.setResponseEncoding('utf-8'); } if(url.startWith(localfileDir)) { const localfilePath = url.replace(localfileDir, '') // 读取文件并返回应用文件 const file = fs.openSync(localfilePath, fs.OpenMode.READ_ONLY) this.responseWeb.setResponseData(file.fd); } // 获取文件的后缀，响应对应的MimeType const MimeType = this.getMimeType(url) this.responseWeb.setResponseMimeType(MimeType) this.responseWeb.setResponseCode(200); this.responseWeb.setReasonMessage('OK'); this.responseWeb.setResponseIsReady(true); return this.responseWeb; } return null } })\n以上主要用于应用内部创建的 Web 组件，Web 的 index.html 来自于应用内部 rawfile 下的文件，创造同域环境来访问应用内的 rawfile 下的文件和应用中的应用文件和应用外的用户文件。\n远程 web 网页 应用内通过 Web 组件访问的大多数是外部的 http 协议的网页，此时则无需创造同域环境。此时我们可以利用现成的域名，创造访问应用内标准。比如我们产品，在 Web 组件内注入了应用的目录路径 env.USER_DATA_PATH，则在 web 内可通过访问远程 web 网页的 origin + env.USER_DATA_PATH 的方式访问应用内文件。\nUSER_DATA_PATH这个标识主要用于区分远程网页内发起的请求是本身的资源，还是其所在应用的应用资源，因此具有此功能的任意可识别和用于区分的标识都可以。此处使用应用的目录路径。\n如：在 http://www.example.com/pagea 页面中获取到了应用内 pdf 文件的 file 协议地址 file:///data/storage/xxx.pdf，在网页中通过 env.USER_DATA_PATH 获取到 lightreource/files。 在通过 fetch请求访问该应用文件时，则可通过访问 http://www.example.com/lightreource/files/data/storage/xxx.pdf 来创造能够被拦截的环境，在拦截中匹配网页的 origin + USER_DATA_PATH（即http://www.example.com/lightreource/files/ ）来获取到最终应用内的文件句柄，然后进行响应即可实现在远程 web 网页中访问应用内文件资源了。\nweb 组件内访问跨域资源 对于跨端框架或者混合开发模式中，在应用的 Web 组件中访问跨域资源是一个比较常见的场景，而由于同源策略，在 web 浏览器内是不支持响应跨域资源的请求的。因此，在应用内的 Web 中若需要支持跨域资源的请求，可以结合应用的特性，先下载到应用，再发起本地资源请求的方式，结合上述web组件内访问本地应用资源的方式实现。\n总结 通过以上的技术，我们能够在双线程技术下的web组件内直接访问到用户设备上的资源或远程跨域资源，并能够在web 组件内直接进行预览。同时，可以结合原生接口与 web 组件的交互，实现文件内容的快速上传。对于跨端技术实现的鸿蒙应用，也能够更好的适配用户设备上的多媒体资源的上传与预览和一些协议文件预览及签约场景，为用户提供更好的体验。\n",
  "wordCount" : "378",
  "inLanguage": "zh",
  "image": "http://localhost:1313/images/papermod-cover.png","datePublished": "2024-09-23T00:00:00Z",
  "dateModified": "2024-09-23T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "九酒"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/posts/juejin/%E8%B7%A8%E7%AB%AF%E6%8A%80%E6%9C%AF%E4%B8%8B%E7%9A%84%E9%B8%BF%E8%92%99%E5%BA%94%E7%94%A8%E6%96%87%E4%BB%B6%E8%B5%84%E6%BA%90%E8%AE%BF%E9%97%AE%E7%AD%96%E7%95%A5%E4%B8%8E%E5%AE%9E%E8%B7%B5/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "PaperMod",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/%3Clink%20/%20abs%20url%3E"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Home (Alt + H)">
                        
                    <img src="http://localhost:1313/images/msg_hu15231257772499651944.png" alt="" aria-label="logo"
                        height="20">Home</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/archives" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="https://github.com/adityatelange/hugo-PaperMod/wiki/" title="WiKi">
                    <span>WiKi</span>&nbsp;
                    <svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12">
                        <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path>
                        <path d="M15 3h6v6"></path>
                        <path d="M10 14L21 3"></path>
                    </svg>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/">主页</a>&nbsp;»&nbsp;<a href="http://localhost:1313/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      跨端技术下的鸿蒙应用：文件资源访问策略与实践
    </h1>
    <div class="post-description">
      作为跨端框架，原生web组件中直接访问本地应用文件资源和远程跨域文件资源是一个常见且必要的应用场景。如双线程技术或混合开发模式下的web组件中对用户文件、应用资源、远程跨域资源的预览。
    </div>
    <div class="post-meta"><span title='2024-09-23 00:00:00 +0000 UTC'>九月 23, 2024</span>&nbsp;·&nbsp;2 分钟&nbsp;·&nbsp;九酒&nbsp;|&nbsp;<a href="https://github.com/WangShaoyu1/myBlogPaperMod/tree/master/content/posts/jueJin/%e8%b7%a8%e7%ab%af%e6%8a%80%e6%9c%af%e4%b8%8b%e7%9a%84%e9%b8%bf%e8%92%99%e5%ba%94%e7%94%a8%ef%bc%9a%e6%96%87%e4%bb%b6%e8%b5%84%e6%ba%90%e8%ae%bf%e9%97%ae%e7%ad%96%e7%95%a5%e4%b8%8e%e5%ae%9e%e8%b7%b5.md" rel="noopener noreferrer" target="_blank">Suggest Changes</a>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">目录</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e8%83%8c%e6%99%af" aria-label="背景">背景</a></li>
                <li>
                    <a href="#%e6%96%87%e4%bb%b6%e5%9f%ba%e7%a1%80" aria-label="文件基础">文件基础</a></li>
                <li>
                    <a href="#web-%e7%bb%84%e4%bb%b6%e5%86%85%e8%ae%bf%e9%97%ae%e6%9c%ac%e5%9c%b0%e5%ba%94%e7%94%a8%e8%b5%84%e6%ba%90" aria-label="web 组件内访问本地应用资源">web 组件内访问本地应用资源</a><ul>
                        
                <li>
                    <a href="#%e5%88%9b%e5%bb%ba%e9%80%9a%e9%81%93%e6%96%b9%e5%bc%8f" aria-label="创建通道方式">创建通道方式</a></li>
                <li>
                    <a href="#%e6%8b%a6%e6%88%aa%e8%af%b7%e6%b1%82%e6%96%b9%e5%bc%8f" aria-label="拦截请求方式">拦截请求方式</a></li></ul>
                </li>
                <li>
                    <a href="#web-%e7%bb%84%e4%bb%b6%e5%86%85%e8%ae%bf%e9%97%ae%e8%b7%a8%e5%9f%9f%e8%b5%84%e6%ba%90" aria-label="web 组件内访问跨域资源">web 组件内访问跨域资源</a></li>
                <li>
                    <a href="#%e6%80%bb%e7%bb%93" aria-label="总结">总结</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h4 id="背景">背景<a hidden class="anchor" aria-hidden="true" href="#背景">#</a></h4>
<p>作为跨端框架，原生 web 组件中直接访问本地应用文件资源和远程跨域文件资源是一个常见且必要的应用场景。如双线程技术或混合开发模式下的 web 组件中对用户文件、应用资源、远程跨域资源的预览。因此，在鸿蒙系统上，同样也需支持以上功能，从而提升跨端应用的开发效率和用户体验。</p>
<p>然而，目前鸿蒙的 web 组件中并不直接支持用户文件、应用资源和远程跨域资源的预览，此时我们就需要寻求一种解决方案，以实现在鸿蒙系统上对这些资源的有效预览。</p>
<h4 id="文件基础">文件基础<a hidden class="anchor" aria-hidden="true" href="#文件基础">#</a></h4>
<p>在鸿蒙系统中，本地文件主要包括应用文件、用户文件、系统文件。</p>
<ul>
<li>应用文件：文件所有者为应用，包括应用安装文件、应用资源文件、应用缓存文件等。</li>
<li>用户文件：文件所有者为登录到该终端设备的用户，包括用户的相册、文档等。</li>
<li>系统文件：与应用和用户无关的其它文件，包括公共库、设备文件、系统资源文件等。</li>
</ul>
<p><img loading="lazy" src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/88d21c6dae42416db6ac9423d4f90432~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lmd6YWS:q75.awebp?rk3s=f64ab15b&amp;x-expires=1727688328&amp;x-signature=0MhghMLt%2FGONBhMMrkkptgr%2B%2BPo%3D" alt=""  />
</p>
<p>在应用内，应用文件与部分系统文件组合成为一个应用沙箱。应用文件在应用内可以被进行保存和处理；在沙箱内的系统文件在文件应用内是只读的，沙箱外的系统文件是不可访问的；若想在应用内访问用户文件，则还需要通过特定的api，经过用户的相应授权才能进行。</p>
<p><img loading="lazy" src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4fc09578e2824e4b8c0e9ef25dbd23a4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lmd6YWS:q75.awebp?rk3s=f64ab15b&amp;x-expires=1727688328&amp;x-signature=uEfuGshD9%2BptgeT0y%2BI3P4bQMNk%3D" alt=""  />
</p>
<h4 id="web-组件内访问本地应用资源">web 组件内访问本地应用资源<a hidden class="anchor" aria-hidden="true" href="#web-组件内访问本地应用资源">#</a></h4>
<p>在鸿蒙系统的应用中可直接通过 file 模块访问和处理应用文件，用户文件则需要通过 file.picker 模块的相关 api 获取到文件的 uri，然后通过 file 模块的 open 功能获取该 uri 文件内容。</p>
<p>而在鸿蒙系统的 web 组件中直接访问本地文件资源则是无效的，一般可通过以下两种方式在应用进程中将本地文件资源的内容代理到 web 组件中。</p>
<h5 id="创建通道方式">创建通道方式<a hidden class="anchor" aria-hidden="true" href="#创建通道方式">#</a></h5>
<p>通过创建应用与 web 通信通道，在应用中读取本地资源内容，向 web 传递读取的内容实现。在通过此种方式传递文件内容时，传递的数据一般为 ArrayBuffer ，当经过通道进行传递时，该ArrayBuffer 对应的内存缓冲区将会被传递到 web 中对应的 ArrayBuffer 对象所拥有，应用内创建的 Arraybuffer 将会被分离（byteLength 为 0）</p>
<p><img loading="lazy" src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7bc0fc6e572b4e00bebb4da03ffbe255~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lmd6YWS:q75.awebp?rk3s=f64ab15b&amp;x-expires=1727688328&amp;x-signature=%2FO4NOFZV8sP4H4HlOyTN%2BTdhwZc%3D" alt=""  />
</p>
<p>此种方式需要注意的是创建 html 侧端口流程需要在 html 侧监听 message 事件之后，否则无法在 web 侧监听到端口创建，也就无法接收到到端口相关的信息。另外，此方式不适用于太大的文件传输，毕竟会在系统侧创建一个内存缓冲区。</p>
<p>由于此种方式需要读取文件内容，在文件内容（ArrayBuffer）未被使用完成时，不可关闭文件内容的读取，否则在 Web 侧将无法获取到创建的 ArrayBuffer 对象对应的缓冲区的内容。但当文件不再被使用时，需要及时关闭文件，避免后续出现系统问题。因此，可以在当前页面关闭时同时关闭该文件，并且关闭端口。</p>
<p>typescript</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>// 读取文件内容 getArrayBuffer(filePath: string): ArrayBuffer | undefined {   try{     const file: fs.File = fs.openSync(filePath, fs.OpenMode.READ_ONLY)     const fileStat = fs.statSync(filePath)     // 读取源文件内容并写入至 ArrayBuffer     let bufSize = fileStat.size;     let readSize = 0;     let buf = new ArrayBuffer(bufSize);     let readOptions: ReadOptions = {       offset: readSize,       length: bufSize     };     fs.readSync(file.fd, buf, readOptions);     this.fileFd = file.fd     // 此时不能直接关闭文件，需要在页面关闭时关闭     return buf   }catch(err) {     return   } } // 页面关闭时 aboutToDisappear(): void {   try {     // 关闭文件     fs.closeSync(this.fileFd)     // 关闭端口     this.nativePort?.close()     this.fileFd = null   } catch (err) {   } }</code></p>
<h5 id="拦截请求方式">拦截请求方式<a hidden class="anchor" aria-hidden="true" href="#拦截请求方式">#</a></h5>
<p>通过 web 组件的 onInterceptRequest ，可以拦截网页内对本地资源的请求，返回本地资源对应的文件句柄（file.fd）使 web 组件中对应请求直接请求到本地资源。</p>
<p>对于标签上的资源访问和 fetch 的访问有些不同，若在 web 组件中通过  等资源类标签通过 file 协议访问应用资源时，由于它会从本地文件系统加载资源，不会跨域，所以可以在onInterceptRequest 中进行拦截。但对于 web 组件内直接 fetch 网络请求一个file协议的本地资源时，则由于浏览器的安全限制，浏览器通常会阻止这个请求，导致无法触发拦截。</p>
<p><strong>鸿蒙的 ArkWeb 内核不允许 file 协议或者 resource 协议访问URL上下文中来自跨域的请求</strong>。因此，对于网页内通过 fetch 等网络请求的方式请求一个 file 协议或 resource 协议的本地资源时，若不做任何处理，则会存在响应跨域或无法拦截的问题。解决上述问题可以通过创建同域环境来解决，主要的场景有以下两种。</p>
<ol>
<li><strong>本地 web 网页</strong></li>
</ol>
<p>对于访问内置的 Web 页面，可以配置私有域名来创建同域环境。实现 Web 页面中对应用资源的请求</p>
<p>如： 应用内 Web 页面是 rawfile 下的 index.html， 我们可以创建一个私有域名 domain（尽量不要和网络上真实存在的域名冲突），访问 rawfile 下的文件都设置为 domain + &lsquo;/rawfile/&rsquo;，访问本地资源的链接都设置为 domain + &lsquo;/localfile/&rsquo;，这样在Web 组件中拦截时就可以针对性拦截，匹配到 domain + &lsquo;/rawfile/&rsquo; 的返回 rawfile 下的文件，匹配到 domain + &lsquo;/localfile/&rsquo; 的读取本地文件并返回响应</p>
<p>kotlin</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>let domain = 'http://gmu.pdfviwer.com' let rawfileDir = domain + '/rawfile/' let localfileDir = domain + '/localfile/' // 组件中拦截 Web({   src: rawfileDir + 'index.html',   conroller: this.webController }).onInterceptRequest((event: IRequestIntercept): WebResourceResponse | null =&gt; {   if(event) {     const url = event.request.getRequestUrl()     if (url.startWith(rawfileDir) || url.startWith(localfileDir)) {       if(url.startWith(rawfileDir)) {         const rawfilePath = url.replace(rawfileDir, '')         // 返回rawfile下的文件         this.responseWeb.setResponseData($rawfile(rawfilePath));         this.responseWeb.setResponseEncoding('utf-8');       }       if(url.startWith(localfileDir)) {         const localfilePath = url.replace(localfileDir, '')         // 读取文件并返回应用文件         const file = fs.openSync(localfilePath, fs.OpenMode.READ_ONLY)         this.responseWeb.setResponseData(file.fd);       }       // 获取文件的后缀，响应对应的MimeType       const MimeType = this.getMimeType(url)       this.responseWeb.setResponseMimeType(MimeType)       this.responseWeb.setResponseCode(200);       this.responseWeb.setReasonMessage('OK');       this.responseWeb.setResponseIsReady(true);       return this.responseWeb;     }     return null   } })</code></p>
<p>以上主要用于应用内部创建的 Web 组件，Web 的 index.html 来自于应用内部 rawfile 下的文件，创造同域环境来访问应用内的 rawfile 下的文件和应用中的应用文件和应用外的用户文件。</p>
<ol start="2">
<li><strong>远程 web 网页</strong></li>
</ol>
<p>应用内通过 Web 组件访问的大多数是外部的 http 协议的网页，此时则无需创造同域环境。此时我们可以利用现成的域名，创造访问应用内标准。比如我们产品，在 Web 组件内注入了应用的目录路径 <code>env.USER_DATA_PATH</code>，则在 web 内可通过访问远程 web 网页的 origin + <code>env.USER_DATA_PATH</code> 的方式访问应用内文件。</p>
<p><code>USER_DATA_PATH</code>这个标识主要用于区分远程网页内发起的请求是本身的资源，还是其所在应用的应用资源，因此具有此功能的任意可识别和用于区分的标识都可以。此处使用应用的目录路径。</p>
<p>如：在 <code>http://www.example.com/pagea</code> 页面中获取到了应用内 pdf 文件的 file 协议地址 <code>file:///data/storage/xxx.pdf</code>，在网页中通过 env.USER_DATA_PATH 获取到 lightreource/files。 在通过 fetch请求访问该应用文件时，则可通过访问 <code>http://www.example.com/lightreource/files/data/storage/xxx.pdf</code> 来创造能够被拦截的环境，在拦截中匹配网页的 origin + <code>USER_DATA_PATH</code>（即<code>http://www.example.com/lightreource/files/</code> ）来获取到最终应用内的文件句柄，然后进行响应即可实现在远程 web 网页中访问应用内文件资源了。</p>
<p><img loading="lazy" src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4cae90bab84342279377f97b45192d9f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lmd6YWS:q75.awebp?rk3s=f64ab15b&amp;x-expires=1727688328&amp;x-signature=2A4LhmTxVjq1UGejyi8Gog6WQgg%3D" alt=""  />
</p>
<h4 id="web-组件内访问跨域资源">web 组件内访问跨域资源<a hidden class="anchor" aria-hidden="true" href="#web-组件内访问跨域资源">#</a></h4>
<p>对于跨端框架或者混合开发模式中，在应用的 Web 组件中访问跨域资源是一个比较常见的场景，而由于同源策略，在 web 浏览器内是不支持响应跨域资源的请求的。因此，在应用内的 Web 中若需要支持跨域资源的请求，可以结合应用的特性，先下载到应用，再发起本地资源请求的方式，结合上述<strong>web组件内访问本地应用资源</strong>的方式实现。</p>
<p><img loading="lazy" src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/31a2cd59692a46caa79cfa79c8d7c20b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lmd6YWS:q75.awebp?rk3s=f64ab15b&amp;x-expires=1727688328&amp;x-signature=s%2B4v5ceT0Nn6rc3cvc6P3D1Fu3U%3D" alt=""  />
</p>
<h4 id="总结">总结<a hidden class="anchor" aria-hidden="true" href="#总结">#</a></h4>
<p>通过以上的技术，我们能够在双线程技术下的web组件内直接访问到用户设备上的资源或远程跨域资源，并能够在web 组件内直接进行预览。同时，可以结合原生接口与 web 组件的交互，实现文件内容的快速上传。对于跨端技术实现的鸿蒙应用，也能够更好的适配用户设备上的多媒体资源的上传与预览和一些协议文件预览及签约场景，为用户提供更好的体验。</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/harmonyos/">HarmonyOS</a></li>
      <li><a href="http://localhost:1313/tags/%E5%89%8D%E7%AB%AF/">前端</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://localhost:1313/posts/juejin/jetbrains%E5%86%8D%E5%87%BA%E6%89%8B%E6%96%B0%E7%89%88intellijidea2024.2%E6%9C%89%E7%82%B9%E4%B8%9C%E8%A5%BF/">
    <span class="title">« 上一页</span>
    <br>
    <span>JetBrains再出手，新版IntelliJIDEA2024.2有点东西！</span>
  </a>
  <a class="next" href="http://localhost:1313/posts/juejin/%E5%9F%BA%E4%BA%8Eexpress-generator%E5%88%9B%E5%BB%BAtypescript&#43;express&#43;mysql%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE/">
    <span class="title">下一页 »</span>
    <br>
    <span>基于express-generator创建TypeScript&#43;Express&#43;MySQL后端项目</span>
  </a>
</nav>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 跨端技术下的鸿蒙应用：文件资源访问策略与实践 on x"
            href="https://x.com/intent/tweet/?text=%e8%b7%a8%e7%ab%af%e6%8a%80%e6%9c%af%e4%b8%8b%e7%9a%84%e9%b8%bf%e8%92%99%e5%ba%94%e7%94%a8%ef%bc%9a%e6%96%87%e4%bb%b6%e8%b5%84%e6%ba%90%e8%ae%bf%e9%97%ae%e7%ad%96%e7%95%a5%e4%b8%8e%e5%ae%9e%e8%b7%b5&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E8%25B7%25A8%25E7%25AB%25AF%25E6%258A%2580%25E6%259C%25AF%25E4%25B8%258B%25E7%259A%2584%25E9%25B8%25BF%25E8%2592%2599%25E5%25BA%2594%25E7%2594%25A8%25E6%2596%2587%25E4%25BB%25B6%25E8%25B5%2584%25E6%25BA%2590%25E8%25AE%25BF%25E9%2597%25AE%25E7%25AD%2596%25E7%2595%25A5%25E4%25B8%258E%25E5%25AE%259E%25E8%25B7%25B5%2f&amp;hashtags=HarmonyOS%2c%e5%89%8d%e7%ab%af">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 跨端技术下的鸿蒙应用：文件资源访问策略与实践 on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E8%25B7%25A8%25E7%25AB%25AF%25E6%258A%2580%25E6%259C%25AF%25E4%25B8%258B%25E7%259A%2584%25E9%25B8%25BF%25E8%2592%2599%25E5%25BA%2594%25E7%2594%25A8%25E6%2596%2587%25E4%25BB%25B6%25E8%25B5%2584%25E6%25BA%2590%25E8%25AE%25BF%25E9%2597%25AE%25E7%25AD%2596%25E7%2595%25A5%25E4%25B8%258E%25E5%25AE%259E%25E8%25B7%25B5%2f&amp;title=%e8%b7%a8%e7%ab%af%e6%8a%80%e6%9c%af%e4%b8%8b%e7%9a%84%e9%b8%bf%e8%92%99%e5%ba%94%e7%94%a8%ef%bc%9a%e6%96%87%e4%bb%b6%e8%b5%84%e6%ba%90%e8%ae%bf%e9%97%ae%e7%ad%96%e7%95%a5%e4%b8%8e%e5%ae%9e%e8%b7%b5&amp;summary=%e8%b7%a8%e7%ab%af%e6%8a%80%e6%9c%af%e4%b8%8b%e7%9a%84%e9%b8%bf%e8%92%99%e5%ba%94%e7%94%a8%ef%bc%9a%e6%96%87%e4%bb%b6%e8%b5%84%e6%ba%90%e8%ae%bf%e9%97%ae%e7%ad%96%e7%95%a5%e4%b8%8e%e5%ae%9e%e8%b7%b5&amp;source=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E8%25B7%25A8%25E7%25AB%25AF%25E6%258A%2580%25E6%259C%25AF%25E4%25B8%258B%25E7%259A%2584%25E9%25B8%25BF%25E8%2592%2599%25E5%25BA%2594%25E7%2594%25A8%25E6%2596%2587%25E4%25BB%25B6%25E8%25B5%2584%25E6%25BA%2590%25E8%25AE%25BF%25E9%2597%25AE%25E7%25AD%2596%25E7%2595%25A5%25E4%25B8%258E%25E5%25AE%259E%25E8%25B7%25B5%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 跨端技术下的鸿蒙应用：文件资源访问策略与实践 on reddit"
            href="https://reddit.com/submit?url=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E8%25B7%25A8%25E7%25AB%25AF%25E6%258A%2580%25E6%259C%25AF%25E4%25B8%258B%25E7%259A%2584%25E9%25B8%25BF%25E8%2592%2599%25E5%25BA%2594%25E7%2594%25A8%25E6%2596%2587%25E4%25BB%25B6%25E8%25B5%2584%25E6%25BA%2590%25E8%25AE%25BF%25E9%2597%25AE%25E7%25AD%2596%25E7%2595%25A5%25E4%25B8%258E%25E5%25AE%259E%25E8%25B7%25B5%2f&title=%e8%b7%a8%e7%ab%af%e6%8a%80%e6%9c%af%e4%b8%8b%e7%9a%84%e9%b8%bf%e8%92%99%e5%ba%94%e7%94%a8%ef%bc%9a%e6%96%87%e4%bb%b6%e8%b5%84%e6%ba%90%e8%ae%bf%e9%97%ae%e7%ad%96%e7%95%a5%e4%b8%8e%e5%ae%9e%e8%b7%b5">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 跨端技术下的鸿蒙应用：文件资源访问策略与实践 on facebook"
            href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E8%25B7%25A8%25E7%25AB%25AF%25E6%258A%2580%25E6%259C%25AF%25E4%25B8%258B%25E7%259A%2584%25E9%25B8%25BF%25E8%2592%2599%25E5%25BA%2594%25E7%2594%25A8%25E6%2596%2587%25E4%25BB%25B6%25E8%25B5%2584%25E6%25BA%2590%25E8%25AE%25BF%25E9%2597%25AE%25E7%25AD%2596%25E7%2595%25A5%25E4%25B8%258E%25E5%25AE%259E%25E8%25B7%25B5%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 跨端技术下的鸿蒙应用：文件资源访问策略与实践 on whatsapp"
            href="https://api.whatsapp.com/send?text=%e8%b7%a8%e7%ab%af%e6%8a%80%e6%9c%af%e4%b8%8b%e7%9a%84%e9%b8%bf%e8%92%99%e5%ba%94%e7%94%a8%ef%bc%9a%e6%96%87%e4%bb%b6%e8%b5%84%e6%ba%90%e8%ae%bf%e9%97%ae%e7%ad%96%e7%95%a5%e4%b8%8e%e5%ae%9e%e8%b7%b5%20-%20http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E8%25B7%25A8%25E7%25AB%25AF%25E6%258A%2580%25E6%259C%25AF%25E4%25B8%258B%25E7%259A%2584%25E9%25B8%25BF%25E8%2592%2599%25E5%25BA%2594%25E7%2594%25A8%25E6%2596%2587%25E4%25BB%25B6%25E8%25B5%2584%25E6%25BA%2590%25E8%25AE%25BF%25E9%2597%25AE%25E7%25AD%2596%25E7%2595%25A5%25E4%25B8%258E%25E5%25AE%259E%25E8%25B7%25B5%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 跨端技术下的鸿蒙应用：文件资源访问策略与实践 on telegram"
            href="https://telegram.me/share/url?text=%e8%b7%a8%e7%ab%af%e6%8a%80%e6%9c%af%e4%b8%8b%e7%9a%84%e9%b8%bf%e8%92%99%e5%ba%94%e7%94%a8%ef%bc%9a%e6%96%87%e4%bb%b6%e8%b5%84%e6%ba%90%e8%ae%bf%e9%97%ae%e7%ad%96%e7%95%a5%e4%b8%8e%e5%ae%9e%e8%b7%b5&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E8%25B7%25A8%25E7%25AB%25AF%25E6%258A%2580%25E6%259C%25AF%25E4%25B8%258B%25E7%259A%2584%25E9%25B8%25BF%25E8%2592%2599%25E5%25BA%2594%25E7%2594%25A8%25E6%2596%2587%25E4%25BB%25B6%25E8%25B5%2584%25E6%25BA%2590%25E8%25AE%25BF%25E9%2597%25AE%25E7%25AD%2596%25E7%2595%25A5%25E4%25B8%258E%25E5%25AE%259E%25E8%25B7%25B5%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 跨端技术下的鸿蒙应用：文件资源访问策略与实践 on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=%e8%b7%a8%e7%ab%af%e6%8a%80%e6%9c%af%e4%b8%8b%e7%9a%84%e9%b8%bf%e8%92%99%e5%ba%94%e7%94%a8%ef%bc%9a%e6%96%87%e4%bb%b6%e8%b5%84%e6%ba%90%e8%ae%bf%e9%97%ae%e7%ad%96%e7%95%a5%e4%b8%8e%e5%ae%9e%e8%b7%b5&u=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E8%25B7%25A8%25E7%25AB%25AF%25E6%258A%2580%25E6%259C%25AF%25E4%25B8%258B%25E7%259A%2584%25E9%25B8%25BF%25E8%2592%2599%25E5%25BA%2594%25E7%2594%25A8%25E6%2596%2587%25E4%25BB%25B6%25E8%25B5%2584%25E6%25BA%2590%25E8%25AE%25BF%25E9%2597%25AE%25E7%25AD%2596%25E7%2595%25A5%25E4%25B8%258E%25E5%25AE%259E%25E8%25B7%25B5%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span><a href="https://beian.miit.gov.cn/">粤ICP备2023039897号-1</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = '复制';

        function copyingDone() {
            copybutton.innerHTML = '已复制！';
            setTimeout(() => {
                copybutton.innerHTML = '复制';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
