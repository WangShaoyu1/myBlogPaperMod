<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>下一代前端开发利器——Vite（原理源码解析） | PaperMod</title>
<meta name="keywords" content="前端">
<meta name="description" content="前言Hi，大家好！前段时间用Vue3搭建项目时看到同时推出的Vite，只当它是一个新打包工具或者vue-cli的升级版，仍然选择了用Webpack构建项目。最近看了尤雨溪在VueConf上的演讲视">
<meta name="author" content="奇舞精选">
<link rel="canonical" href="http://localhost:1313/posts/juejin/%E4%B8%8B%E4%B8%80%E4%BB%A3%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E5%88%A9%E5%99%A8vite%E5%8E%9F%E7%90%86%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/">
<meta name="google-site-verification" content="XYZabc">
<link crossorigin="anonymous" href="/assets/css/stylesheet.7b92bf4867c997b58ec50f63451b83777173d5bd5593376852abd85746d09d71.css" integrity="sha256-e5K/SGfJl7WOxQ9jRRuDd3Fz1b1VkzdoUqvYV0bQnXE=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<link rel="apple-touch-icon" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<link rel="mask-icon" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="zh" href="http://localhost:1313/posts/juejin/%E4%B8%8B%E4%B8%80%E4%BB%A3%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E5%88%A9%E5%99%A8vite%E5%8E%9F%E7%90%86%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript><meta property="og:title" content="下一代前端开发利器——Vite（原理源码解析）" />
<meta property="og:description" content="前言Hi，大家好！前段时间用Vue3搭建项目时看到同时推出的Vite，只当它是一个新打包工具或者vue-cli的升级版，仍然选择了用Webpack构建项目。最近看了尤雨溪在VueConf上的演讲视" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/posts/juejin/%E4%B8%8B%E4%B8%80%E4%BB%A3%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E5%88%A9%E5%99%A8vite%E5%8E%9F%E7%90%86%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/" />
<meta property="og:image" content="http://localhost:1313/images/papermod-cover.png" />
<meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-03-03T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-03-03T00:00:00+00:00" />


<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="http://localhost:1313/images/papermod-cover.png" />
<meta name="twitter:title" content="下一代前端开发利器——Vite（原理源码解析）"/>
<meta name="twitter:description" content="前言Hi，大家好！前段时间用Vue3搭建项目时看到同时推出的Vite，只当它是一个新打包工具或者vue-cli的升级版，仍然选择了用Webpack构建项目。最近看了尤雨溪在VueConf上的演讲视"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "下一代前端开发利器——Vite（原理源码解析）",
      "item": "http://localhost:1313/posts/juejin/%E4%B8%8B%E4%B8%80%E4%BB%A3%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E5%88%A9%E5%99%A8vite%E5%8E%9F%E7%90%86%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "下一代前端开发利器——Vite（原理源码解析）",
  "name": "下一代前端开发利器——Vite（原理源码解析）",
  "description": "前言Hi，大家好！前段时间用Vue3搭建项目时看到同时推出的Vite，只当它是一个新打包工具或者vue-cli的升级版，仍然选择了用Webpack构建项目。最近看了尤雨溪在VueConf上的演讲视",
  "keywords": [
    "前端"
  ],
  "articleBody": " 本文作者是360奇舞团前端开发工程师 王文健\n前言 Hi，大家好！\n前段时间用Vue3搭建项目时看到同时推出的Vite，只当它是一个新打包工具或者vue-cli的升级版，仍然选择了用Webpack构建项目。最近看了尤雨溪在VueConf上的演讲视频：《Vue3 生态进展和计划》，感觉它确实解决了现阶段前端工程化的一些痛点，也能体会到尤雨溪对Vite的重视和大力推广的决心，再加上Vue本身的庞大用户基数，Vite确实有可能成为下一代前端构建工具的突破口。\n本文将讨论下Vite出现的背景，解决的痛点，核心功能的实现，存在的意义和预期的未来。Vite本身并不复杂。中文官方文档非常清晰简洁，建议大家使用前仔细读下文档。\n大纲 背景 什么是Vite？ 基本用法 实现原理 源码分析 优势与不足 与传统构建工具对比 兼容性 未来 背景 这里的背景介绍会从与Vite紧密相关的两个概念的发展史说起，一个是JavaScript的模块化标准，另一个是前端构建工具。\n共存的模块化标准 为什么JavaScript会有多种共存的模块化标准？因为js在设计之初并没有模块化的概念，随着前端业务复杂度不断提高，模块化越来越受到开发者的重视，社区开始涌现多种模块化解决方案，它们相互借鉴，也争议不断，形成多个派系，从CommonJS开始，到ES6正式推出ES Modules规范结束，所有争论，终成历史，ES Modules也成为前端重要的基础设施。\nCommonJS：现主要用于Node.js（Node@13.2.0开始支持直接使用ES Module） AMD：require.js 依赖前置，市场存量不建议使用 CMD：sea.js 就近执行，市场存量不建议使用 ES Module：ES语言规范，标准，趋势，未来 对模块化发展史感兴趣的可以看下《前端模块化开发那点历史》@玉伯，而Vite的核心正是依靠浏览器对ES Module规范的实现。\n发展中的构建工具 近些年前端工程化发展迅速，各种构建工具层出不穷，目前Webpack仍然占据统治地位，npm 每周下载量达到两千多万次。下面是我按 npm 发版时间线列出的开发者比较熟知的一些构建工具。\n当前工程化痛点 现在常用的构建工具如Webpack，主要是通过抓取-编译-构建整个应用的代码（也就是常说的打包过程），生成一份编译、优化后能良好兼容各个浏览器的的生产环境代码。在开发环境流程也基本相同，需要先将整个应用构建打包后，再把打包后的代码交给dev server（开发服务器）。\nWebpack等构建工具的诞生给前端开发带来了极大的便利，但随着前端业务的复杂化，js代码量呈指数增长，打包构建时间越来越久，dev server（开发服务器）性能遇到瓶颈：\n缓慢的服务启动： 大型项目中dev server启动时间达到几十秒甚至几分钟。\n缓慢的HMR热更新： 即使采用了 HMR 模式，其热更新速度也会随着应用规模的增长而显著下降，已达到性能瓶颈，无多少优化空间。\n缓慢的开发环境，大大降低了开发者的幸福感，在以上背景下Vite应运而生。\n什么是Vite？ 基于esbuild与Rollup，依靠浏览器自身ESM编译功能， 实现极致开发体验的新一代构建工具！\n概念 先介绍以下文中会经常提到的一些基础概念：\n依赖： 指开发不会变动的部分(npm包、UI组件库)，esbuild进行预构建。 源码： 浏览器不能直接执行的非js代码(.jsx、.css、.vue等)，vite只在浏览器请求相关源码的时候进行转换，以提供ESM源码。 开发环境 利用浏览器原生的ES Module编译能力，省略费时的编译环节，直给浏览器开发环境源码，dev server只提供轻量服务。 浏览器执行ESM的import时，会向dev server发起该模块的ajax请求，服务器对源码做简单处理后返回给浏览器。 Vite中HMR是在原生 ESM 上执行的。当编辑一个文件时，Vite 只需要精确地使已编辑的模块失活，使得无论应用大小如何，HMR 始终能保持快速更新。 使用esbuild处理项目依赖，esbuild使用go编写，比一般node.js编写的编译器快几个数量级。 生产环境 集成Rollup打包生产环境代码，依赖其成熟稳定的生态与更简洁的插件机制。 处理流程对比 Webpack通过先将整个应用打包，再将打包后代码提供给dev server，开发者才能开始开发。\nVite直接将源码交给浏览器，实现dev server秒开，浏览器显示页面需要相关模块时，再向dev server发起请求，服务器简单处理后，将该模块返回给浏览器，实现真正意义的按需加载。 基本用法 创建vite项目 1 $ npm create vite@latest 选取模板 Vite 内置6种常用模板与对应的TS版本，可满足前端大部分开发场景，可以点击下列表格中模板直接在 StackBlitz 中在线试用，还有其他更多的 社区维护模板可以使用。\nJavaScript\nTypeScript\nvanilla\nvanilla-ts\nvue\nvue-ts\nreact\nreact-ts\npreact\npreact-ts\nlit\nlit-ts\nsvelte\nsvelte-ts\n启动 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 { \"scripts\": { \"dev\": \"vite\", // 启动开发服务器，别名： ```vite dev`，`vite serve` \"build\": \"vite build\", // 为生产环境构建产物 \"preview\": \"vite preview\" // 本地预览生产构建产物 } }`` * * * 实现原理 ==== ### ESbuild 编译 `esbuild` 使用go编写，cpu密集下更具性能优势，编译速度更快，以下摘自官网的构建速度对比： **浏览器：“开始了吗？”** **服务器：“已经结束了。”** **开发者：“好快，好喜欢！！”** ![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b6ab1cbe74ef49a9a601e0db0265453a~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?) ### 依赖预构建 * **模块化兼容：** 如开头背景所写，现仍共存多种模块化标准代码，`Vite`在预构建阶段将依赖中各种其他模块化规范(CommonJS、UMD)转换 成ESM，以提供给浏览器。 * **性能优化：** npm包中大量的ESM代码，大量的`import`请求，会造成网络拥塞。`Vite`使用`esbuild`，将有大量内部模块的ESM关系转换成单个模块，以减少 `import`模块请求次数。 ### 按需加载 * 服务器只在接受到import请求的时候，才会编译对应的文件，将ESM源码返回给浏览器，实现真正的按需加载。 ### 缓存 * **HTTP缓存：** 充分利用`http`缓存做优化，依赖（不会变动的代码）部分用max-age,immutable **强缓存**，源码部分用304**协商缓存**，提升页面打开速度。 * **文件系统缓存：** `Vite`在预构建阶段，将构建后的依赖缓存到`node_modules/.vite` ，相关配置更改时，或手动控制时才会重新构建，以提升预构建速度。 ### 重写模块路径 浏览器`import`只能引入相对/绝对路径，而开发代码经常使用`npm`包名直接引入`node_module`中的模块，需要做路径转换后交给浏览器。 * `es-module-lexer` 扫描 import 语法 * `magic-string` 重写模块的引入路径 js 代码解读 复制代码 `// 开发代码 import { createApp } from 'vue' // 转换后 import { createApp } from '/node_modules/vue/dist/vue.js'` * * * 源码分析 ==== 与`Webpack-dev-server`类似`Vite`同样使用`WebSocket`与客户端建立连接，实现热更新，源码实现基本可分为两部分，源码位置在: * `vite/packages/vite/src/client` client（用于客户端） * `vite/packages/vite/src/node` server（用于开发服务器） client 代码会在启动服务时注入到客户端，用于客户端对于`WebSocket`消息的处理（如更新页面某个模块、刷新页面）；server 代码是服务端逻辑，用于处理代码的构建与页面模块的请求。 简单看了下源码（vite@2.7.2），核心功能主要是以下几个方法（以下为源码截取，部分逻辑做了删减）： 1. 命令行启动服务`npm run dev`后，源码执行`cli.ts`，调用`createServer`方法，创建http服务，监听开发服务器端口。 js 代码解读 复制代码 `// 源码位置 vite/packages/vite/src/node/cli.ts const { createServer } = await import('./server') try { const server = await createServer({ root, base: options.base, ... }) if (!server.httpServer) { throw new Error('HTTP server not available') } await server.listen() }` 2. `createServer`方法的执行做了很多工作，如整合配置项、创建http服务（早期通过koa创建）、创建`WebSocket`服务、创建源码的文件监听、插件执行、optimize优化等。下面注释中标出。 js 代码解读 复制代码 `// 源码位置 vite/packages/vite/src/node/server/index.ts export async function createServer( inlineConfig: InlineConfig = {} ): Promise { // Vite 配置整合 const config = await resolveConfig(inlineConfig, 'serve', 'development') const root = config.root const serverConfig = config.server // 创建http服务 const httpServer = await resolveHttpServer(serverConfig, middlewares, httpsOptions) // 创建ws服务 const ws = createWebSocketServer(httpServer, config, httpsOptions) // 创建watcher，设置代码文件监听 const watcher = chokidar.watch(path.resolve(root), { ignored: [ '**/node_modules/**', '**/.git/**', ...(Array.isArray(ignored) ? ignored : [ignored]) ], ...watchOptions }) as FSWatcher // 创建server对象 const server: ViteDevServer = { config, middlewares, httpServer, watcher, ws, moduleGraph, listen, ... } // 文件监听变动，websocket向前端通信 watcher.on('change', async (file) =\u003e { ... handleHMRUpdate() }) // 非常多的 middleware middlewares.use(...) // optimize const runOptimize = async () =\u003e {...} return server }` 3. 使用[chokidar](https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fchokidar \"https://www.npmjs.com/package/chokidar\")监听文件变化，绑定监听事件。 js 代码解读 复制代码 `// 源码位置 vite/packages/vite/src/node/server/index.ts const watcher = chokidar.watch(path.resolve(root), { ignored: [ '**/node_modules/**', '**/.git/**', ...(Array.isArray(ignored) ? ignored : [ignored]) ], ignoreInitial: true, ignorePermissionErrors: true, disableGlobbing: true, ...watchOptions }) as FSWatcher` 4. 通过 [ws](https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fws \"https://www.npmjs.com/package/ws\") 来创建`WebSocket`服务，用于监听到文件变化时触发热更新，向客户端发送消息。 js 代码解读 复制代码 `// 源码位置 vite/packages/vite/src/node/server/ws.ts export function createWebSocketServer(...){ let wss: WebSocket const hmr = isObject(config.server.hmr) \u0026\u0026 config.server.hmr const wsServer = (hmr \u0026\u0026 hmr.server) || server if (wsServer) { wss = new WebSocket({ noServer: true }) wsServer.on('upgrade', (req, socket, head) =\u003e { // 服务就绪 if (req.headers['sec-websocket-protocol'] === HMR_HEADER) { wss.handleUpgrade(req, socket as Socket, head, (ws) =\u003e { wss.emit('connection', ws, req) }) } }) } else { ... } // 服务准备就绪，就能在浏览器控制台看到熟悉的打印 [vite] connected. wss.on('connection', (socket) =\u003e { socket.send(JSON.stringify({ type: 'connected' })) ... }) // 失败 wss.on('error', (e: Error \u0026 { code: string }) =\u003e { ... }) // 返回ws对象 return { on: wss.on.bind(wss), off: wss.off.bind(wss), // 向客户端发送信息 // 多个客户端同时触发 send(payload: HMRPayload) { const stringified = JSON.stringify(payload) wss.clients.forEach((client) =\u003e { // readyState 1 means the connection is open client.send(stringified) }) } } }` 5. 在服务启动时会向浏览器注入代码，用于处理客户端接收到的`WebSocket`消息，如重新发起模块请求、刷新页面。 js 代码解读 复制代码 ``//源码位置 vite/packages/vite/src/client/client.ts async function handleMessage(payload: HMRPayload) { switch (payload.type) { case 'connected': console.log(`[vite] connected.`) break case 'update': notifyListeners('vite:beforeUpdate', payload) ... break case 'custom': { notifyListeners(payload.event as CustomEventName, payload.data) ... break } case 'full-reload': notifyListeners('vite:beforeFullReload', payload) ... break case 'prune': notifyListeners('vite:beforePrune', payload) ... break case 'error': { notifyListeners('vite:error', payload) ... break } default: { const check: never = payload return check } } }`` * * * 优势 == * 快！快！非常快！！ * 高度集成，开箱即用。 * 基于ESM急速热更新，无需打包编译。 * 基于`esbuild`的依赖预处理，比`Webpack`等node编写的编译器快几个数量级。 * 兼容`Rollup`庞大的插件机制，插件开发更简洁。 * 不与`Vue`绑定，支持`React`等其他框架，独立的构建工具。 * 内置SSR支持。 * 天然支持TS。 不足 == * `Vue`仍为第一优先支持，量身定做的编译插件，对`React`的支持不如`Vue`强大。 * 虽然已经推出2.0正式版，已经可以用于正式线上生产，但目前市场上实践少。 * 生产环境集成`Rollup`打包，与开发环境最终执行的代码不一致。 * * * 与 webpack 对比 ============ 由于`Vite`主打的是开发环境的极致体验，生产环境集成`Rollup`，这里的对比主要是`Webpack-dev-server`与`Vite-dev-server`的对比： * 到目前很长时间以来`Webpack`在前端工程领域占统治地位，`Vite`推出以来备受关注，社区活跃，GitHub star 数量激增，目前达到37.4K ![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a13034f21bfc43499756af2ae85cdbbd~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp) * `Webpack`配置丰富使用极为灵活但上手成本高，`Vite`开箱即用配置高度集成 * `Webpack`启动服务需打包构建，速度慢，`Vite`免编译可秒开 * `Webpack`热更新需打包构建，速度慢，`Vite`毫秒响应 * `Webpack`成熟稳定、资源丰富、大量实践案例，`Vite`实践较少 * `Vite`使用`esbuild`编译，构建速度比`webpack`快几个数量级 * * * 兼容性 === * 默认目标浏览器是在`script`标签上支持原生 ESM 和 原生 ESM 动态导入 * 可使用官方插件 `@vitejs/plugin-legacy`，转义成传统版本和相对应的`polyfill` * * * 未来探索 ==== * 传统构建工具性能已到瓶颈，主打开发体验的`Vite`，可能会受到欢迎。 * 主流浏览器基本支持ESM，ESM将成为主流。 * `Vite`在`Vue3.0`代替`vue-cli`，作为官方脚手架，会大大提高使用量。 * `Vite2.0`推出后，已可以在实际项目中使用`Vite`。 * 如果觉得直接使用`Vite`太冒险，又确实有`dev server`速度慢的问题需要解决，可以尝试用`Vite`单独搭建一套`dev server` * * * 相关资源 ==== ### 官方插件 除了支持现有的`Rollup`插件系统外，官方提供了四个最关键的插件 * `@vitejs/plugin-vue` 提供 Vue3 单文件组件支持 * `@vitejs/plugin-vue-jsx` 提供 Vue3 JSX 支持（专用的 Babel 转换插件） * `@vitejs/plugin-react` 提供完整的 React 支持 * `@vitejs/plugin-legacy` 为打包后的文件提供传统浏览器兼容性支持 ### UI组件库 * [Element UI](https://link.juejin.cn?target=https%3A%2F%2Felement-plus.gitee.io%2Fzh-CN%2Fguide%2Fquickstart.html%23%25E6%258C%2589%25E9%259C%2580%25E5%25AF%25BC%25E5%2585%25A5 \"https://element-plus.gitee.io/zh-CN/guide/quickstart.html#%E6%8C%89%E9%9C%80%E5%AF%BC%E5%85%A5\")：支持 vite 引入 ### 相关链接 * [Vite官网](https://link.juejin.cn?target=https%3A%2F%2Fcn.vitejs.dev%2F \"https://cn.vitejs.dev/\") * [Vue3 生态进展和计划-尤雨溪](https://link.juejin.cn?target=https%3A%2F%2Fwww.yuque.com%2Fvueconf%2Fmkwv0c%2Fxqyxix \"https://www.yuque.com/vueconf/mkwv0c/xqyxix\") * [Vite源码解析](https://link.juejin.cn?target=http%3A%2F%2Fvite.ssr-fc.com%2F \"http://vite.ssr-fc.com/\") * [Develop with Vite | Vite快速入门 - Anthony Fu • Vue北京聚会 Day 13](https://link.juejin.cn?target=https%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3Dxx8gEHet6n8 \"https://www.youtube.com/watch?v=xx8gEHet6n8\") ",
  "wordCount" : "946",
  "inLanguage": "zh",
  "image": "http://localhost:1313/images/papermod-cover.png","datePublished": "2022-03-03T00:00:00Z",
  "dateModified": "2022-03-03T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "奇舞精选"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/posts/juejin/%E4%B8%8B%E4%B8%80%E4%BB%A3%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E5%88%A9%E5%99%A8vite%E5%8E%9F%E7%90%86%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "PaperMod",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/%3Clink%20/%20abs%20url%3E"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Home (Alt + H)">
                        
                    <img src="http://localhost:1313/images/msg_hu15231257772499651944.png" alt="" aria-label="logo"
                        height="20">Home</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/archives" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="https://github.com/adityatelange/hugo-PaperMod/wiki/" title="WiKi">
                    <span>WiKi</span>&nbsp;
                    <svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12">
                        <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path>
                        <path d="M15 3h6v6"></path>
                        <path d="M10 14L21 3"></path>
                    </svg>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/">主页</a>&nbsp;»&nbsp;<a href="http://localhost:1313/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      下一代前端开发利器——Vite（原理源码解析）
    </h1>
    <div class="post-description">
      前言Hi，大家好！前段时间用Vue3搭建项目时看到同时推出的Vite，只当它是一个新打包工具或者vue-cli的升级版，仍然选择了用Webpack构建项目。最近看了尤雨溪在VueConf上的演讲视
    </div>
    <div class="post-meta"><span title='2022-03-03 00:00:00 +0000 UTC'>三月 3, 2022</span>&nbsp;·&nbsp;5 分钟&nbsp;·&nbsp;奇舞精选&nbsp;|&nbsp;<a href="https://github.com/WangShaoyu1/myBlogPaperMod/tree/master/content/posts/jueJin/%e4%b8%8b%e4%b8%80%e4%bb%a3%e5%89%8d%e7%ab%af%e5%bc%80%e5%8f%91%e5%88%a9%e5%99%a8%e2%80%94%e2%80%94Vite%ef%bc%88%e5%8e%9f%e7%90%86%e6%ba%90%e7%a0%81%e8%a7%a3%e6%9e%90%ef%bc%89.md" rel="noopener noreferrer" target="_blank">Suggest Changes</a>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">目录</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e5%89%8d%e8%a8%80" aria-label="前言">前言</a></li>
                <li>
                    <a href="#%e5%a4%a7%e7%ba%b2" aria-label="大纲">大纲</a></li>
                <li>
                    <a href="#%e8%83%8c%e6%99%af" aria-label="背景">背景</a><ul>
                        <ul>
                        
                <li>
                    <a href="#%e5%85%b1%e5%ad%98%e7%9a%84%e6%a8%a1%e5%9d%97%e5%8c%96%e6%a0%87%e5%87%86" aria-label="共存的模块化标准">共存的模块化标准</a></li>
                <li>
                    <a href="#%e5%8f%91%e5%b1%95%e4%b8%ad%e7%9a%84%e6%9e%84%e5%bb%ba%e5%b7%a5%e5%85%b7" aria-label="发展中的构建工具">发展中的构建工具</a></li>
                <li>
                    <a href="#%e5%bd%93%e5%89%8d%e5%b7%a5%e7%a8%8b%e5%8c%96%e7%97%9b%e7%82%b9" aria-label="当前工程化痛点">当前工程化痛点</a></li></ul>
                    </ul>
                </li>
                <li>
                    <a href="#%e4%bb%80%e4%b9%88%e6%98%afvite" aria-label="什么是Vite？">什么是Vite？</a><ul>
                        <ul>
                        
                <li>
                    <a href="#%e6%a6%82%e5%bf%b5" aria-label="概念">概念</a></li>
                <li>
                    <a href="#%e5%bc%80%e5%8f%91%e7%8e%af%e5%a2%83" aria-label="开发环境">开发环境</a></li>
                <li>
                    <a href="#%e7%94%9f%e4%ba%a7%e7%8e%af%e5%a2%83" aria-label="生产环境">生产环境</a></li>
                <li>
                    <a href="#%e5%a4%84%e7%90%86%e6%b5%81%e7%a8%8b%e5%af%b9%e6%af%94" aria-label="处理流程对比">处理流程对比</a></li></ul>
                    </ul>
                </li>
                <li>
                    <a href="#%e5%9f%ba%e6%9c%ac%e7%94%a8%e6%b3%95" aria-label="基本用法">基本用法</a><ul>
                        <ul>
                        
                <li>
                    <a href="#%e5%88%9b%e5%bb%bavite%e9%a1%b9%e7%9b%ae" aria-label="创建vite项目">创建vite项目</a></li>
                <li>
                    <a href="#%e9%80%89%e5%8f%96%e6%a8%a1%e6%9d%bf" aria-label="选取模板">选取模板</a></li>
                <li>
                    <a href="#%e5%90%af%e5%8a%a8" aria-label="启动">启动</a>
                </li>
            </ul>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><blockquote>
<p>本文作者是360奇舞团前端开发工程师 王文健</p>
</blockquote>
<h1 id="前言">前言<a hidden class="anchor" aria-hidden="true" href="#前言">#</a></h1>
<p>Hi，大家好！</p>
<p>前段时间用<code>Vue3</code>搭建项目时看到同时推出的<code>Vite</code>，只当它是一个新打包工具或者<code>vue-cli</code>的升级版，仍然选择了用<code>Webpack</code>构建项目。最近看了尤雨溪在VueConf上的演讲视频：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.yuque.com%2Fvueconf%2Fmkwv0c%2Fxqyxix" title="https://www.yuque.com/vueconf/mkwv0c/xqyxix">《Vue3 生态进展和计划》</a>，感觉它确实解决了现阶段前端工程化的一些痛点，也能体会到尤雨溪对<code>Vite</code>的重视和大力推广的决心，再加上<code>Vue</code>本身的庞大用户基数，<code>Vite</code>确实有可能成为下一代前端构建工具的突破口。</p>
<p>本文将讨论下<code>Vite</code>出现的背景，解决的痛点，核心功能的实现，存在的意义和预期的未来。<code>Vite</code>本身并不复杂。中文官方文档非常清晰简洁，建议大家使用前仔细读下文档。</p>
<hr>
<h1 id="大纲">大纲<a hidden class="anchor" aria-hidden="true" href="#大纲">#</a></h1>
<ul>
<li>背景</li>
<li>什么是Vite？</li>
<li>基本用法</li>
<li>实现原理</li>
<li>源码分析</li>
<li>优势与不足</li>
<li>与传统构建工具对比</li>
<li>兼容性</li>
<li>未来</li>
</ul>
<hr>
<h1 id="背景">背景<a hidden class="anchor" aria-hidden="true" href="#背景">#</a></h1>
<p>这里的背景介绍会从与<code>Vite</code>紧密相关的两个概念的发展史说起，一个是<code>JavaScript</code>的模块化标准，另一个是前端构建工具。</p>
<h3 id="共存的模块化标准">共存的模块化标准<a hidden class="anchor" aria-hidden="true" href="#共存的模块化标准">#</a></h3>
<p>为什么<code>JavaScript</code>会有多种共存的模块化标准？因为js在设计之初并没有模块化的概念，随着前端业务复杂度不断提高，模块化越来越受到开发者的重视，社区开始涌现多种模块化解决方案，它们相互借鉴，也争议不断，形成多个派系，从<code>CommonJS</code>开始，到<code>ES6</code>正式推出<code>ES Modules</code>规范结束，所有争论，终成历史，<code>ES Modules</code>也成为前端重要的基础设施。</p>
<ul>
<li><strong>CommonJS</strong>：现主要用于Node.js（Node@13.2.0开始支持直接使用ES Module）</li>
<li><strong>AMD</strong>：<code>require.js</code> 依赖前置，市场存量不建议使用</li>
<li><strong>CMD</strong>：<code>sea.js</code> 就近执行，市场存量不建议使用</li>
<li><strong>ES Module</strong>：ES语言规范，标准，趋势，未来</li>
</ul>
<p>对模块化发展史感兴趣的可以看下<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fseajs%2Fseajs%2Fissues%2F588" title="https://github.com/seajs/seajs/issues/588">《前端模块化开发那点历史》@玉伯</a>，而<code>Vite</code>的核心正是依靠浏览器对ES Module规范的实现。</p>
<h3 id="发展中的构建工具">发展中的构建工具<a hidden class="anchor" aria-hidden="true" href="#发展中的构建工具">#</a></h3>
<p>近些年前端工程化发展迅速，各种构建工具层出不穷，目前<code>Webpack</code>仍然占据统治地位，npm 每周下载量达到两千多万次。下面是我按 npm 发版时间线列出的开发者比较熟知的一些构建工具。</p>
<p><img loading="lazy" src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4401a88bf0e04c668e6623d2134c60d7~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?" alt=""  />
</p>
<h3 id="当前工程化痛点">当前工程化痛点<a hidden class="anchor" aria-hidden="true" href="#当前工程化痛点">#</a></h3>
<p>现在常用的构建工具如<code>Webpack</code>，主要是通过抓取-编译-构建整个应用的代码（也就是常说的打包过程），生成一份编译、优化后能良好兼容各个浏览器的的生产环境代码。在开发环境流程也基本相同，需要先将整个应用构建打包后，再把打包后的代码交给<code>dev server</code>（开发服务器）。</p>
<p><code>Webpack</code>等构建工具的诞生给前端开发带来了极大的便利，但随着前端业务的复杂化，js代码量呈指数增长，打包构建时间越来越久，<code>dev server</code>（开发服务器）性能遇到瓶颈：</p>
<ul>
<li>
<p><strong>缓慢的服务启动：</strong> 大型项目中<code>dev server</code>启动时间达到几十秒甚至几分钟。</p>
</li>
<li>
<p><strong>缓慢的HMR热更新：</strong> 即使采用了 HMR 模式，其热更新速度也会随着应用规模的增长而显著下降，已达到性能瓶颈，无多少优化空间。</p>
</li>
</ul>
<p><strong>缓慢的开发环境，大大降低了开发者的幸福感，在以上背景下<code>Vite</code>应运而生。</strong></p>
<hr>
<h1 id="什么是vite">什么是Vite？<a hidden class="anchor" aria-hidden="true" href="#什么是vite">#</a></h1>
<p><strong>基于esbuild与Rollup，依靠浏览器自身ESM编译功能， 实现极致开发体验的新一代构建工具！</strong></p>
<h3 id="概念">概念<a hidden class="anchor" aria-hidden="true" href="#概念">#</a></h3>
<p>先介绍以下文中会经常提到的一些基础概念：</p>
<ul>
<li><strong>依赖：</strong> 指开发不会变动的部分(npm包、UI组件库)，esbuild进行预构建。</li>
<li><strong>源码：</strong> 浏览器不能直接执行的非js代码(.jsx、.css、.vue等)，vite只在浏览器请求相关源码的时候进行转换，以提供ESM源码。</li>
</ul>
<h3 id="开发环境">开发环境<a hidden class="anchor" aria-hidden="true" href="#开发环境">#</a></h3>
<ul>
<li>利用浏览器原生的<code>ES Module</code>编译能力，省略费时的编译环节，直给浏览器开发环境源码，<code>dev server</code>只提供轻量服务。</li>
<li>浏览器执行ESM的<code>import</code>时，会向<code>dev server</code>发起该模块的<code>ajax</code>请求，服务器对源码做简单处理后返回给浏览器。</li>
<li><code>Vite</code>中HMR是在原生 ESM 上执行的。当编辑一个文件时，Vite 只需要精确地使已编辑的模块失活，使得无论应用大小如何，HMR 始终能保持快速更新。</li>
<li>使用<code>esbuild</code>处理项目依赖，<code>esbuild</code>使用go编写，比一般<code>node.js</code>编写的编译器快几个数量级。</li>
</ul>
<h3 id="生产环境">生产环境<a hidden class="anchor" aria-hidden="true" href="#生产环境">#</a></h3>
<ul>
<li>集成<code>Rollup</code>打包生产环境代码，依赖其成熟稳定的生态与更简洁的插件机制。</li>
</ul>
<h3 id="处理流程对比">处理流程对比<a hidden class="anchor" aria-hidden="true" href="#处理流程对比">#</a></h3>
<p><code>Webpack</code>通过先将整个应用打包，再将打包后代码提供给<code>dev server</code>，开发者才能开始开发。</p>
<p><img loading="lazy" src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/181a6bfe5e4d4857bd6bed63a573e2b3~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?" alt=""  />
</p>
<p><code>Vite</code>直接将源码交给浏览器，实现<code>dev server</code>秒开，浏览器显示页面需要相关模块时，再向<code>dev server</code>发起请求，服务器简单处理后，将该模块返回给浏览器，实现真正意义的按需加载。 <img loading="lazy" src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e00801ede5b84abd9bdaadb720d63e53~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?" alt=""  />
</p>
<hr>
<h1 id="基本用法">基本用法<a hidden class="anchor" aria-hidden="true" href="#基本用法">#</a></h1>
<h3 id="创建vite项目">创建vite项目<a hidden class="anchor" aria-hidden="true" href="#创建vite项目">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-0-1"><a class="lnlinks" href="#hl-0-1">1</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ npm create vite@latest
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="选取模板">选取模板<a hidden class="anchor" aria-hidden="true" href="#选取模板">#</a></h3>
<p><code>Vite</code> 内置6种常用模板与对应的TS版本，可满足前端大部分开发场景，可以点击下列表格中模板直接在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fvite.new%2F" title="https://vite.new/">StackBlitz</a> 中在线试用，还有其他更多的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fvitejs%2Fawesome-vite%23templates" title="https://github.com/vitejs/awesome-vite#templates">社区维护模板</a>可以使用。</p>
<p>JavaScript</p>
<p>TypeScript</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fvite.new%2Fvanilla" title="https://vite.new/vanilla">vanilla</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fvite.new%2Fvanilla-ts" title="https://vite.new/vanilla-ts">vanilla-ts</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fvite.new%2Fvue" title="https://vite.new/vue">vue</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fvite.new%2Fvue-ts" title="https://vite.new/vue-ts">vue-ts</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fvite.new%2Freact" title="https://vite.new/react">react</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fvite.new%2Freact-ts" title="https://vite.new/react-ts">react-ts</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fvite.new%2Fpreact" title="https://vite.new/preact">preact</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fvite.new%2Fpreact-ts" title="https://vite.new/preact-ts">preact-ts</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fvite.new%2Flit" title="https://vite.new/lit">lit</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fvite.new%2Flit-ts" title="https://vite.new/lit-ts">lit-ts</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fvite.new%2Fsvelte" title="https://vite.new/svelte">svelte</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fvite.new%2Fsvelte-ts" title="https://vite.new/svelte-ts">svelte-ts</a></p>
<h3 id="启动">启动<a hidden class="anchor" aria-hidden="true" href="#启动">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-1-1"><a class="lnlinks" href="#hl-1-1">  1</a>
</span><span class="lnt" id="hl-1-2"><a class="lnlinks" href="#hl-1-2">  2</a>
</span><span class="lnt" id="hl-1-3"><a class="lnlinks" href="#hl-1-3">  3</a>
</span><span class="lnt" id="hl-1-4"><a class="lnlinks" href="#hl-1-4">  4</a>
</span><span class="lnt" id="hl-1-5"><a class="lnlinks" href="#hl-1-5">  5</a>
</span><span class="lnt" id="hl-1-6"><a class="lnlinks" href="#hl-1-6">  6</a>
</span><span class="lnt" id="hl-1-7"><a class="lnlinks" href="#hl-1-7">  7</a>
</span><span class="lnt" id="hl-1-8"><a class="lnlinks" href="#hl-1-8">  8</a>
</span><span class="lnt" id="hl-1-9"><a class="lnlinks" href="#hl-1-9">  9</a>
</span><span class="lnt" id="hl-1-10"><a class="lnlinks" href="#hl-1-10"> 10</a>
</span><span class="lnt" id="hl-1-11"><a class="lnlinks" href="#hl-1-11"> 11</a>
</span><span class="lnt" id="hl-1-12"><a class="lnlinks" href="#hl-1-12"> 12</a>
</span><span class="lnt" id="hl-1-13"><a class="lnlinks" href="#hl-1-13"> 13</a>
</span><span class="lnt" id="hl-1-14"><a class="lnlinks" href="#hl-1-14"> 14</a>
</span><span class="lnt" id="hl-1-15"><a class="lnlinks" href="#hl-1-15"> 15</a>
</span><span class="lnt" id="hl-1-16"><a class="lnlinks" href="#hl-1-16"> 16</a>
</span><span class="lnt" id="hl-1-17"><a class="lnlinks" href="#hl-1-17"> 17</a>
</span><span class="lnt" id="hl-1-18"><a class="lnlinks" href="#hl-1-18"> 18</a>
</span><span class="lnt" id="hl-1-19"><a class="lnlinks" href="#hl-1-19"> 19</a>
</span><span class="lnt" id="hl-1-20"><a class="lnlinks" href="#hl-1-20"> 20</a>
</span><span class="lnt" id="hl-1-21"><a class="lnlinks" href="#hl-1-21"> 21</a>
</span><span class="lnt" id="hl-1-22"><a class="lnlinks" href="#hl-1-22"> 22</a>
</span><span class="lnt" id="hl-1-23"><a class="lnlinks" href="#hl-1-23"> 23</a>
</span><span class="lnt" id="hl-1-24"><a class="lnlinks" href="#hl-1-24"> 24</a>
</span><span class="lnt" id="hl-1-25"><a class="lnlinks" href="#hl-1-25"> 25</a>
</span><span class="lnt" id="hl-1-26"><a class="lnlinks" href="#hl-1-26"> 26</a>
</span><span class="lnt" id="hl-1-27"><a class="lnlinks" href="#hl-1-27"> 27</a>
</span><span class="lnt" id="hl-1-28"><a class="lnlinks" href="#hl-1-28"> 28</a>
</span><span class="lnt" id="hl-1-29"><a class="lnlinks" href="#hl-1-29"> 29</a>
</span><span class="lnt" id="hl-1-30"><a class="lnlinks" href="#hl-1-30"> 30</a>
</span><span class="lnt" id="hl-1-31"><a class="lnlinks" href="#hl-1-31"> 31</a>
</span><span class="lnt" id="hl-1-32"><a class="lnlinks" href="#hl-1-32"> 32</a>
</span><span class="lnt" id="hl-1-33"><a class="lnlinks" href="#hl-1-33"> 33</a>
</span><span class="lnt" id="hl-1-34"><a class="lnlinks" href="#hl-1-34"> 34</a>
</span><span class="lnt" id="hl-1-35"><a class="lnlinks" href="#hl-1-35"> 35</a>
</span><span class="lnt" id="hl-1-36"><a class="lnlinks" href="#hl-1-36"> 36</a>
</span><span class="lnt" id="hl-1-37"><a class="lnlinks" href="#hl-1-37"> 37</a>
</span><span class="lnt" id="hl-1-38"><a class="lnlinks" href="#hl-1-38"> 38</a>
</span><span class="lnt" id="hl-1-39"><a class="lnlinks" href="#hl-1-39"> 39</a>
</span><span class="lnt" id="hl-1-40"><a class="lnlinks" href="#hl-1-40"> 40</a>
</span><span class="lnt" id="hl-1-41"><a class="lnlinks" href="#hl-1-41"> 41</a>
</span><span class="lnt" id="hl-1-42"><a class="lnlinks" href="#hl-1-42"> 42</a>
</span><span class="lnt" id="hl-1-43"><a class="lnlinks" href="#hl-1-43"> 43</a>
</span><span class="lnt" id="hl-1-44"><a class="lnlinks" href="#hl-1-44"> 44</a>
</span><span class="lnt" id="hl-1-45"><a class="lnlinks" href="#hl-1-45"> 45</a>
</span><span class="lnt" id="hl-1-46"><a class="lnlinks" href="#hl-1-46"> 46</a>
</span><span class="lnt" id="hl-1-47"><a class="lnlinks" href="#hl-1-47"> 47</a>
</span><span class="lnt" id="hl-1-48"><a class="lnlinks" href="#hl-1-48"> 48</a>
</span><span class="lnt" id="hl-1-49"><a class="lnlinks" href="#hl-1-49"> 49</a>
</span><span class="lnt" id="hl-1-50"><a class="lnlinks" href="#hl-1-50"> 50</a>
</span><span class="lnt" id="hl-1-51"><a class="lnlinks" href="#hl-1-51"> 51</a>
</span><span class="lnt" id="hl-1-52"><a class="lnlinks" href="#hl-1-52"> 52</a>
</span><span class="lnt" id="hl-1-53"><a class="lnlinks" href="#hl-1-53"> 53</a>
</span><span class="lnt" id="hl-1-54"><a class="lnlinks" href="#hl-1-54"> 54</a>
</span><span class="lnt" id="hl-1-55"><a class="lnlinks" href="#hl-1-55"> 55</a>
</span><span class="lnt" id="hl-1-56"><a class="lnlinks" href="#hl-1-56"> 56</a>
</span><span class="lnt" id="hl-1-57"><a class="lnlinks" href="#hl-1-57"> 57</a>
</span><span class="lnt" id="hl-1-58"><a class="lnlinks" href="#hl-1-58"> 58</a>
</span><span class="lnt" id="hl-1-59"><a class="lnlinks" href="#hl-1-59"> 59</a>
</span><span class="lnt" id="hl-1-60"><a class="lnlinks" href="#hl-1-60"> 60</a>
</span><span class="lnt" id="hl-1-61"><a class="lnlinks" href="#hl-1-61"> 61</a>
</span><span class="lnt" id="hl-1-62"><a class="lnlinks" href="#hl-1-62"> 62</a>
</span><span class="lnt" id="hl-1-63"><a class="lnlinks" href="#hl-1-63"> 63</a>
</span><span class="lnt" id="hl-1-64"><a class="lnlinks" href="#hl-1-64"> 64</a>
</span><span class="lnt" id="hl-1-65"><a class="lnlinks" href="#hl-1-65"> 65</a>
</span><span class="lnt" id="hl-1-66"><a class="lnlinks" href="#hl-1-66"> 66</a>
</span><span class="lnt" id="hl-1-67"><a class="lnlinks" href="#hl-1-67"> 67</a>
</span><span class="lnt" id="hl-1-68"><a class="lnlinks" href="#hl-1-68"> 68</a>
</span><span class="lnt" id="hl-1-69"><a class="lnlinks" href="#hl-1-69"> 69</a>
</span><span class="lnt" id="hl-1-70"><a class="lnlinks" href="#hl-1-70"> 70</a>
</span><span class="lnt" id="hl-1-71"><a class="lnlinks" href="#hl-1-71"> 71</a>
</span><span class="lnt" id="hl-1-72"><a class="lnlinks" href="#hl-1-72"> 72</a>
</span><span class="lnt" id="hl-1-73"><a class="lnlinks" href="#hl-1-73"> 73</a>
</span><span class="lnt" id="hl-1-74"><a class="lnlinks" href="#hl-1-74"> 74</a>
</span><span class="lnt" id="hl-1-75"><a class="lnlinks" href="#hl-1-75"> 75</a>
</span><span class="lnt" id="hl-1-76"><a class="lnlinks" href="#hl-1-76"> 76</a>
</span><span class="lnt" id="hl-1-77"><a class="lnlinks" href="#hl-1-77"> 77</a>
</span><span class="lnt" id="hl-1-78"><a class="lnlinks" href="#hl-1-78"> 78</a>
</span><span class="lnt" id="hl-1-79"><a class="lnlinks" href="#hl-1-79"> 79</a>
</span><span class="lnt" id="hl-1-80"><a class="lnlinks" href="#hl-1-80"> 80</a>
</span><span class="lnt" id="hl-1-81"><a class="lnlinks" href="#hl-1-81"> 81</a>
</span><span class="lnt" id="hl-1-82"><a class="lnlinks" href="#hl-1-82"> 82</a>
</span><span class="lnt" id="hl-1-83"><a class="lnlinks" href="#hl-1-83"> 83</a>
</span><span class="lnt" id="hl-1-84"><a class="lnlinks" href="#hl-1-84"> 84</a>
</span><span class="lnt" id="hl-1-85"><a class="lnlinks" href="#hl-1-85"> 85</a>
</span><span class="lnt" id="hl-1-86"><a class="lnlinks" href="#hl-1-86"> 86</a>
</span><span class="lnt" id="hl-1-87"><a class="lnlinks" href="#hl-1-87"> 87</a>
</span><span class="lnt" id="hl-1-88"><a class="lnlinks" href="#hl-1-88"> 88</a>
</span><span class="lnt" id="hl-1-89"><a class="lnlinks" href="#hl-1-89"> 89</a>
</span><span class="lnt" id="hl-1-90"><a class="lnlinks" href="#hl-1-90"> 90</a>
</span><span class="lnt" id="hl-1-91"><a class="lnlinks" href="#hl-1-91"> 91</a>
</span><span class="lnt" id="hl-1-92"><a class="lnlinks" href="#hl-1-92"> 92</a>
</span><span class="lnt" id="hl-1-93"><a class="lnlinks" href="#hl-1-93"> 93</a>
</span><span class="lnt" id="hl-1-94"><a class="lnlinks" href="#hl-1-94"> 94</a>
</span><span class="lnt" id="hl-1-95"><a class="lnlinks" href="#hl-1-95"> 95</a>
</span><span class="lnt" id="hl-1-96"><a class="lnlinks" href="#hl-1-96"> 96</a>
</span><span class="lnt" id="hl-1-97"><a class="lnlinks" href="#hl-1-97"> 97</a>
</span><span class="lnt" id="hl-1-98"><a class="lnlinks" href="#hl-1-98"> 98</a>
</span><span class="lnt" id="hl-1-99"><a class="lnlinks" href="#hl-1-99"> 99</a>
</span><span class="lnt" id="hl-1-100"><a class="lnlinks" href="#hl-1-100">100</a>
</span><span class="lnt" id="hl-1-101"><a class="lnlinks" href="#hl-1-101">101</a>
</span><span class="lnt" id="hl-1-102"><a class="lnlinks" href="#hl-1-102">102</a>
</span><span class="lnt" id="hl-1-103"><a class="lnlinks" href="#hl-1-103">103</a>
</span><span class="lnt" id="hl-1-104"><a class="lnlinks" href="#hl-1-104">104</a>
</span><span class="lnt" id="hl-1-105"><a class="lnlinks" href="#hl-1-105">105</a>
</span><span class="lnt" id="hl-1-106"><a class="lnlinks" href="#hl-1-106">106</a>
</span><span class="lnt" id="hl-1-107"><a class="lnlinks" href="#hl-1-107">107</a>
</span><span class="lnt" id="hl-1-108"><a class="lnlinks" href="#hl-1-108">108</a>
</span><span class="lnt" id="hl-1-109"><a class="lnlinks" href="#hl-1-109">109</a>
</span><span class="lnt" id="hl-1-110"><a class="lnlinks" href="#hl-1-110">110</a>
</span><span class="lnt" id="hl-1-111"><a class="lnlinks" href="#hl-1-111">111</a>
</span><span class="lnt" id="hl-1-112"><a class="lnlinks" href="#hl-1-112">112</a>
</span><span class="lnt" id="hl-1-113"><a class="lnlinks" href="#hl-1-113">113</a>
</span><span class="lnt" id="hl-1-114"><a class="lnlinks" href="#hl-1-114">114</a>
</span><span class="lnt" id="hl-1-115"><a class="lnlinks" href="#hl-1-115">115</a>
</span><span class="lnt" id="hl-1-116"><a class="lnlinks" href="#hl-1-116">116</a>
</span><span class="lnt" id="hl-1-117"><a class="lnlinks" href="#hl-1-117">117</a>
</span><span class="lnt" id="hl-1-118"><a class="lnlinks" href="#hl-1-118">118</a>
</span><span class="lnt" id="hl-1-119"><a class="lnlinks" href="#hl-1-119">119</a>
</span><span class="lnt" id="hl-1-120"><a class="lnlinks" href="#hl-1-120">120</a>
</span><span class="lnt" id="hl-1-121"><a class="lnlinks" href="#hl-1-121">121</a>
</span><span class="lnt" id="hl-1-122"><a class="lnlinks" href="#hl-1-122">122</a>
</span><span class="lnt" id="hl-1-123"><a class="lnlinks" href="#hl-1-123">123</a>
</span><span class="lnt" id="hl-1-124"><a class="lnlinks" href="#hl-1-124">124</a>
</span><span class="lnt" id="hl-1-125"><a class="lnlinks" href="#hl-1-125">125</a>
</span><span class="lnt" id="hl-1-126"><a class="lnlinks" href="#hl-1-126">126</a>
</span><span class="lnt" id="hl-1-127"><a class="lnlinks" href="#hl-1-127">127</a>
</span><span class="lnt" id="hl-1-128"><a class="lnlinks" href="#hl-1-128">128</a>
</span><span class="lnt" id="hl-1-129"><a class="lnlinks" href="#hl-1-129">129</a>
</span><span class="lnt" id="hl-1-130"><a class="lnlinks" href="#hl-1-130">130</a>
</span><span class="lnt" id="hl-1-131"><a class="lnlinks" href="#hl-1-131">131</a>
</span><span class="lnt" id="hl-1-132"><a class="lnlinks" href="#hl-1-132">132</a>
</span><span class="lnt" id="hl-1-133"><a class="lnlinks" href="#hl-1-133">133</a>
</span><span class="lnt" id="hl-1-134"><a class="lnlinks" href="#hl-1-134">134</a>
</span><span class="lnt" id="hl-1-135"><a class="lnlinks" href="#hl-1-135">135</a>
</span><span class="lnt" id="hl-1-136"><a class="lnlinks" href="#hl-1-136">136</a>
</span><span class="lnt" id="hl-1-137"><a class="lnlinks" href="#hl-1-137">137</a>
</span><span class="lnt" id="hl-1-138"><a class="lnlinks" href="#hl-1-138">138</a>
</span><span class="lnt" id="hl-1-139"><a class="lnlinks" href="#hl-1-139">139</a>
</span><span class="lnt" id="hl-1-140"><a class="lnlinks" href="#hl-1-140">140</a>
</span><span class="lnt" id="hl-1-141"><a class="lnlinks" href="#hl-1-141">141</a>
</span><span class="lnt" id="hl-1-142"><a class="lnlinks" href="#hl-1-142">142</a>
</span><span class="lnt" id="hl-1-143"><a class="lnlinks" href="#hl-1-143">143</a>
</span><span class="lnt" id="hl-1-144"><a class="lnlinks" href="#hl-1-144">144</a>
</span><span class="lnt" id="hl-1-145"><a class="lnlinks" href="#hl-1-145">145</a>
</span><span class="lnt" id="hl-1-146"><a class="lnlinks" href="#hl-1-146">146</a>
</span><span class="lnt" id="hl-1-147"><a class="lnlinks" href="#hl-1-147">147</a>
</span><span class="lnt" id="hl-1-148"><a class="lnlinks" href="#hl-1-148">148</a>
</span><span class="lnt" id="hl-1-149"><a class="lnlinks" href="#hl-1-149">149</a>
</span><span class="lnt" id="hl-1-150"><a class="lnlinks" href="#hl-1-150">150</a>
</span><span class="lnt" id="hl-1-151"><a class="lnlinks" href="#hl-1-151">151</a>
</span><span class="lnt" id="hl-1-152"><a class="lnlinks" href="#hl-1-152">152</a>
</span><span class="lnt" id="hl-1-153"><a class="lnlinks" href="#hl-1-153">153</a>
</span><span class="lnt" id="hl-1-154"><a class="lnlinks" href="#hl-1-154">154</a>
</span><span class="lnt" id="hl-1-155"><a class="lnlinks" href="#hl-1-155">155</a>
</span><span class="lnt" id="hl-1-156"><a class="lnlinks" href="#hl-1-156">156</a>
</span><span class="lnt" id="hl-1-157"><a class="lnlinks" href="#hl-1-157">157</a>
</span><span class="lnt" id="hl-1-158"><a class="lnlinks" href="#hl-1-158">158</a>
</span><span class="lnt" id="hl-1-159"><a class="lnlinks" href="#hl-1-159">159</a>
</span><span class="lnt" id="hl-1-160"><a class="lnlinks" href="#hl-1-160">160</a>
</span><span class="lnt" id="hl-1-161"><a class="lnlinks" href="#hl-1-161">161</a>
</span><span class="lnt" id="hl-1-162"><a class="lnlinks" href="#hl-1-162">162</a>
</span><span class="lnt" id="hl-1-163"><a class="lnlinks" href="#hl-1-163">163</a>
</span><span class="lnt" id="hl-1-164"><a class="lnlinks" href="#hl-1-164">164</a>
</span><span class="lnt" id="hl-1-165"><a class="lnlinks" href="#hl-1-165">165</a>
</span><span class="lnt" id="hl-1-166"><a class="lnlinks" href="#hl-1-166">166</a>
</span><span class="lnt" id="hl-1-167"><a class="lnlinks" href="#hl-1-167">167</a>
</span><span class="lnt" id="hl-1-168"><a class="lnlinks" href="#hl-1-168">168</a>
</span><span class="lnt" id="hl-1-169"><a class="lnlinks" href="#hl-1-169">169</a>
</span><span class="lnt" id="hl-1-170"><a class="lnlinks" href="#hl-1-170">170</a>
</span><span class="lnt" id="hl-1-171"><a class="lnlinks" href="#hl-1-171">171</a>
</span><span class="lnt" id="hl-1-172"><a class="lnlinks" href="#hl-1-172">172</a>
</span><span class="lnt" id="hl-1-173"><a class="lnlinks" href="#hl-1-173">173</a>
</span><span class="lnt" id="hl-1-174"><a class="lnlinks" href="#hl-1-174">174</a>
</span><span class="lnt" id="hl-1-175"><a class="lnlinks" href="#hl-1-175">175</a>
</span><span class="lnt" id="hl-1-176"><a class="lnlinks" href="#hl-1-176">176</a>
</span><span class="lnt" id="hl-1-177"><a class="lnlinks" href="#hl-1-177">177</a>
</span><span class="lnt" id="hl-1-178"><a class="lnlinks" href="#hl-1-178">178</a>
</span><span class="lnt" id="hl-1-179"><a class="lnlinks" href="#hl-1-179">179</a>
</span><span class="lnt" id="hl-1-180"><a class="lnlinks" href="#hl-1-180">180</a>
</span><span class="lnt" id="hl-1-181"><a class="lnlinks" href="#hl-1-181">181</a>
</span><span class="lnt" id="hl-1-182"><a class="lnlinks" href="#hl-1-182">182</a>
</span><span class="lnt" id="hl-1-183"><a class="lnlinks" href="#hl-1-183">183</a>
</span><span class="lnt" id="hl-1-184"><a class="lnlinks" href="#hl-1-184">184</a>
</span><span class="lnt" id="hl-1-185"><a class="lnlinks" href="#hl-1-185">185</a>
</span><span class="lnt" id="hl-1-186"><a class="lnlinks" href="#hl-1-186">186</a>
</span><span class="lnt" id="hl-1-187"><a class="lnlinks" href="#hl-1-187">187</a>
</span><span class="lnt" id="hl-1-188"><a class="lnlinks" href="#hl-1-188">188</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>   <span class="nt">&#34;scripts&#34;</span><span class="p">:</span> <span class="p">{</span>     <span class="nt">&#34;dev&#34;</span><span class="p">:</span> <span class="s2">&#34;vite&#34;</span><span class="p">,</span> <span class="c1">// 启动开发服务器，别名：
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">```vite</span> <span class="err">dev`，`vite</span> <span class="err">serve`</span>     <span class="nt">&#34;build&#34;</span><span class="p">:</span> <span class="s2">&#34;vite build&#34;</span><span class="p">,</span> <span class="c1">// 为生产环境构建产物     &#34;preview&#34;: &#34;vite preview&#34; // 本地预览生产构建产物   } }``
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="err">*</span> <span class="err">*</span> <span class="err">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">实现原理</span>
</span></span><span class="line"><span class="cl"><span class="err">====</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">###</span> <span class="err">ESbuild</span> <span class="err">编译</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">`esbuild`</span> <span class="err">使用go编写，cpu密集下更具性能优势，编译速度更快，以下摘自官网的构建速度对比：</span>  
</span></span><span class="line"><span class="cl"><span class="err">**浏览器：“开始了吗？”**</span>  
</span></span><span class="line"><span class="cl"><span class="err">**服务器：“已经结束了。”**</span>  
</span></span><span class="line"><span class="cl"><span class="err">**开发者：“好快，好喜欢！！”**</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">![image.png](https:</span><span class="c1">//p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b6ab1cbe74ef49a9a601e0db0265453a~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="err">###</span> <span class="err">依赖预构建</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">*</span>   <span class="err">**模块化兼容：**</span> <span class="err">如开头背景所写，现仍共存多种模块化标准代码，`Vite`在预构建阶段将依赖中各种其他模块化规范(CommonJS、UMD)转换</span> <span class="err">成ESM，以提供给浏览器。</span>
</span></span><span class="line"><span class="cl"><span class="err">*</span>   <span class="err">**性能优化：**</span> <span class="err">npm包中大量的ESM代码，大量的`import`请求，会造成网络拥塞。`Vite`使用`esbuild`，将有大量内部模块的ESM关系转换成单个模块，以减少</span> <span class="err">`import`模块请求次数。</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">###</span> <span class="err">按需加载</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">*</span>   <span class="err">服务器只在接受到import请求的时候，才会编译对应的文件，将ESM源码返回给浏览器，实现真正的按需加载。</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">###</span> <span class="err">缓存</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">*</span>   <span class="err">**HTTP缓存：**</span> <span class="err">充分利用`http`缓存做优化，依赖（不会变动的代码）部分用max-age,immutable</span> <span class="err">**强缓存**，源码部分用304**协商缓存**，提升页面打开速度。</span>
</span></span><span class="line"><span class="cl"><span class="err">*</span>   <span class="err">**文件系统缓存：**</span> <span class="err">`Vite`在预构建阶段，将构建后的依赖缓存到`node_modules/.vite`</span> <span class="err">，相关配置更改时，或手动控制时才会重新构建，以提升预构建速度。</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">###</span> <span class="err">重写模块路径</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">浏览器`import`只能引入相对/绝对路径，而开发代码经常使用`npm`包名直接引入`node_module`中的模块，需要做路径转换后交给浏览器。</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">*</span>   <span class="err">`es-module-lexer`</span> <span class="err">扫描</span> <span class="err">import</span> <span class="err">语法</span>
</span></span><span class="line"><span class="cl"><span class="err">*</span>   <span class="err">`magic-string`</span> <span class="err">重写模块的引入路径</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">js</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="err">代码解读</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">复制代码</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">`</span><span class="c1">// 开发代码 import { createApp } from &#39;vue&#39; // 转换后 import { createApp } from &#39;/node_modules/vue/dist/vue.js&#39;`
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="err">*</span> <span class="err">*</span> <span class="err">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">源码分析</span>
</span></span><span class="line"><span class="cl"><span class="err">====</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">与`Webpack-dev-server`类似`Vite`同样使用`WebSocket`与客户端建立连接，实现热更新，源码实现基本可分为两部分，源码位置在:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">*</span>   <span class="err">`vite/packages/vite/src/client`</span> <span class="err">client（用于客户端）</span>
</span></span><span class="line"><span class="cl"><span class="err">*</span>   <span class="err">`vite/packages/vite/src/node`</span> <span class="err">server（用于开发服务器）</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">client</span> <span class="err">代码会在启动服务时注入到客户端，用于客户端对于`WebSocket`消息的处理（如更新页面某个模块、刷新页面）；server</span> <span class="err">代码是服务端逻辑，用于处理代码的构建与页面模块的请求。</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">简单看了下源码（vite@2.7.2），核心功能主要是以下几个方法（以下为源码截取，部分逻辑做了删减）：</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">1.</span>  <span class="err">命令行启动服务`npm</span> <span class="err">run</span> <span class="err">dev`后，源码执行`cli.ts`，调用`createServer`方法，创建http服务，监听开发服务器端口。</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">js</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="err">代码解读</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">复制代码</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">`</span><span class="c1">// 源码位置 vite/packages/vite/src/node/cli.ts const { createServer } = await import(&#39;./server&#39;) try {     const server = await createServer({         root,         base: options.base,         ...     })     if (!server.httpServer) {         throw new Error(&#39;HTTP server not available&#39;)     }     await server.listen() }`
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="err">2.</span>  <span class="err">`createServer`方法的执行做了很多工作，如整合配置项、创建http服务（早期通过koa创建）、创建`WebSocket`服务、创建源码的文件监听、插件执行、optimize优化等。下面注释中标出。</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">js</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="err">代码解读</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">复制代码</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">`</span><span class="c1">// 源码位置 vite/packages/vite/src/node/server/index.ts export async function createServer(     inlineConfig: InlineConfig = {} ): Promise&lt;ViteDevServer&gt; {     // Vite 配置整合     const config = await resolveConfig(inlineConfig, &#39;serve&#39;, &#39;development&#39;)     const root = config.root     const serverConfig = config.server     // 创建http服务     const httpServer = await resolveHttpServer(serverConfig, middlewares, httpsOptions)     // 创建ws服务     const ws = createWebSocketServer(httpServer, config, httpsOptions)     // 创建watcher，设置代码文件监听     const watcher = chokidar.watch(path.resolve(root), {         ignored: [             &#39;**/node_modules/**&#39;,             &#39;**/.git/**&#39;,             ...(Array.isArray(ignored) ? ignored : [ignored])         ],         ...watchOptions     }) as FSWatcher     // 创建server对象     const server: ViteDevServer = {         config,         middlewares,         httpServer,         watcher,         ws,         moduleGraph,         listen,         ...     }     // 文件监听变动，websocket向前端通信     watcher.on(&#39;change&#39;, async (file) =&gt; {         ...         handleHMRUpdate()     })     // 非常多的 middleware     middlewares.use(...)          // optimize     const runOptimize = async () =&gt; {...}     return server }`
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="err">3.</span>  <span class="err">使用[chokidar](https:</span><span class="c1">//link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fchokidar &#34;https://www.npmjs.com/package/chokidar&#34;)监听文件变化，绑定监听事件。
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="err">js</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="err">代码解读</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">复制代码</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">`</span><span class="c1">// 源码位置 vite/packages/vite/src/node/server/index.ts   const watcher = chokidar.watch(path.resolve(root), {     ignored: [       &#39;**/node_modules/**&#39;,       &#39;**/.git/**&#39;,       ...(Array.isArray(ignored) ? ignored : [ignored])     ],     ignoreInitial: true,     ignorePermissionErrors: true,     disableGlobbing: true,     ...watchOptions   }) as FSWatcher`
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="err">4.</span>  <span class="err">通过</span> <span class="err">[ws](https:</span><span class="c1">//link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fws &#34;https://www.npmjs.com/package/ws&#34;) 来创建`WebSocket`服务，用于监听到文件变化时触发热更新，向客户端发送消息。
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="err">js</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="err">代码解读</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">复制代码</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">`</span><span class="c1">// 源码位置 vite/packages/vite/src/node/server/ws.ts export function createWebSocketServer(...){     let wss: WebSocket     const hmr = isObject(config.server.hmr) &amp;&amp; config.server.hmr     const wsServer = (hmr &amp;&amp; hmr.server) || server     if (wsServer) {         wss = new WebSocket({ noServer: true })         wsServer.on(&#39;upgrade&#39;, (req, socket, head) =&gt; {             // 服务就绪             if (req.headers[&#39;sec-websocket-protocol&#39;] === HMR_HEADER) {                 wss.handleUpgrade(req, socket as Socket, head, (ws) =&gt; {                     wss.emit(&#39;connection&#39;, ws, req)                 })             }         })     } else {         ...     }     // 服务准备就绪，就能在浏览器控制台看到熟悉的打印 [vite] connected.     wss.on(&#39;connection&#39;, (socket) =&gt; {         socket.send(JSON.stringify({ type: &#39;connected&#39; }))         ...     })     // 失败     wss.on(&#39;error&#39;, (e: Error &amp; { code: string }) =&gt; {         ...     })     // 返回ws对象     return {         on: wss.on.bind(wss),         off: wss.off.bind(wss),         // 向客户端发送信息         // 多个客户端同时触发         send(payload: HMRPayload) {             const stringified = JSON.stringify(payload)             wss.clients.forEach((client) =&gt; {                 // readyState 1 means the connection is open                 client.send(stringified)             })         }     } }`
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="err">5.</span>  <span class="err">在服务启动时会向浏览器注入代码，用于处理客户端接收到的`WebSocket`消息，如重新发起模块请求、刷新页面。</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">js</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="err">代码解读</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">复制代码</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">``</span><span class="c1">//源码位置 vite/packages/vite/src/client/client.ts async function handleMessage(payload: HMRPayload) {   switch (payload.type) {     case &#39;connected&#39;:       console.log(`[vite] connected.`)       break     case &#39;update&#39;:       notifyListeners(&#39;vite:beforeUpdate&#39;, payload)       ...       break     case &#39;custom&#39;: {       notifyListeners(payload.event as CustomEventName&lt;any&gt;, payload.data)       ...       break     }     case &#39;full-reload&#39;:       notifyListeners(&#39;vite:beforeFullReload&#39;, payload)       ...       break     case &#39;prune&#39;:       notifyListeners(&#39;vite:beforePrune&#39;, payload)       ...       break     case &#39;error&#39;: {       notifyListeners(&#39;vite:error&#39;, payload)       ...       break     }     default: {       const check: never = payload       return check     }   } }``
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="err">*</span> <span class="err">*</span> <span class="err">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">优势</span>
</span></span><span class="line"><span class="cl"><span class="err">==</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">*</span>   <span class="err">快！快！非常快！！</span>
</span></span><span class="line"><span class="cl"><span class="err">*</span>   <span class="err">高度集成，开箱即用。</span>
</span></span><span class="line"><span class="cl"><span class="err">*</span>   <span class="err">基于ESM急速热更新，无需打包编译。</span>
</span></span><span class="line"><span class="cl"><span class="err">*</span>   <span class="err">基于`esbuild`的依赖预处理，比`Webpack`等node编写的编译器快几个数量级。</span>
</span></span><span class="line"><span class="cl"><span class="err">*</span>   <span class="err">兼容`Rollup`庞大的插件机制，插件开发更简洁。</span>
</span></span><span class="line"><span class="cl"><span class="err">*</span>   <span class="err">不与`Vue`绑定，支持`React`等其他框架，独立的构建工具。</span>
</span></span><span class="line"><span class="cl"><span class="err">*</span>   <span class="err">内置SSR支持。</span>
</span></span><span class="line"><span class="cl"><span class="err">*</span>   <span class="err">天然支持TS。</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">不足</span>
</span></span><span class="line"><span class="cl"><span class="err">==</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">*</span>   <span class="err">`Vue`仍为第一优先支持，量身定做的编译插件，对`React`的支持不如`Vue`强大。</span>
</span></span><span class="line"><span class="cl"><span class="err">*</span>   <span class="err">虽然已经推出2.0正式版，已经可以用于正式线上生产，但目前市场上实践少。</span>
</span></span><span class="line"><span class="cl"><span class="err">*</span>   <span class="err">生产环境集成`Rollup`打包，与开发环境最终执行的代码不一致。</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">*</span> <span class="err">*</span> <span class="err">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">与</span> <span class="err">webpack</span> <span class="err">对比</span>
</span></span><span class="line"><span class="cl"><span class="err">============</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">由于`Vite`主打的是开发环境的极致体验，生产环境集成`Rollup`，这里的对比主要是`Webpack-dev-server`与`Vite-dev-server`的对比：</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">*</span>   <span class="err">到目前很长时间以来`Webpack`在前端工程领域占统治地位，`Vite`推出以来备受关注，社区活跃，GitHub</span> <span class="err">star</span> <span class="err">数量激增，目前达到37.4K</span> <span class="err">![image.png](https:</span><span class="c1">//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a13034f21bfc43499756af2ae85cdbbd~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">*</span>   <span class="err">`Webpack`配置丰富使用极为灵活但上手成本高，`Vite`开箱即用配置高度集成</span>
</span></span><span class="line"><span class="cl"><span class="err">*</span>   <span class="err">`Webpack`启动服务需打包构建，速度慢，`Vite`免编译可秒开</span>
</span></span><span class="line"><span class="cl"><span class="err">*</span>   <span class="err">`Webpack`热更新需打包构建，速度慢，`Vite`毫秒响应</span>
</span></span><span class="line"><span class="cl"><span class="err">*</span>   <span class="err">`Webpack`成熟稳定、资源丰富、大量实践案例，`Vite`实践较少</span>
</span></span><span class="line"><span class="cl"><span class="err">*</span>   <span class="err">`Vite`使用`esbuild`编译，构建速度比`webpack`快几个数量级</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">*</span> <span class="err">*</span> <span class="err">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">兼容性</span>
</span></span><span class="line"><span class="cl"><span class="err">===</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">*</span>   <span class="err">默认目标浏览器是在`script`标签上支持原生</span> <span class="err">ESM</span> <span class="err">和</span> <span class="err">原生</span> <span class="err">ESM</span> <span class="err">动态导入</span>
</span></span><span class="line"><span class="cl"><span class="err">*</span>   <span class="err">可使用官方插件</span> <span class="err">`@vitejs/plugin-legacy`，转义成传统版本和相对应的`polyfill`</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">*</span> <span class="err">*</span> <span class="err">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">未来探索</span>
</span></span><span class="line"><span class="cl"><span class="err">====</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">*</span>   <span class="err">传统构建工具性能已到瓶颈，主打开发体验的`Vite`，可能会受到欢迎。</span>
</span></span><span class="line"><span class="cl"><span class="err">*</span>   <span class="err">主流浏览器基本支持ESM，ESM将成为主流。</span>
</span></span><span class="line"><span class="cl"><span class="err">*</span>   <span class="err">`Vite`在`Vue3.0`代替`vue-cli`，作为官方脚手架，会大大提高使用量。</span>
</span></span><span class="line"><span class="cl"><span class="err">*</span>   <span class="err">`Vite2.0`推出后，已可以在实际项目中使用`Vite`。</span>
</span></span><span class="line"><span class="cl"><span class="err">*</span>   <span class="err">如果觉得直接使用`Vite`太冒险，又确实有`dev</span> <span class="err">server`速度慢的问题需要解决，可以尝试用`Vite`单独搭建一套`dev</span> <span class="err">server`</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">*</span> <span class="err">*</span> <span class="err">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">相关资源</span>
</span></span><span class="line"><span class="cl"><span class="err">====</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">###</span> <span class="err">官方插件</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">除了支持现有的`Rollup`插件系统外，官方提供了四个最关键的插件</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">*</span>   <span class="err">`@vitejs/plugin-vue`</span> <span class="err">提供</span> <span class="err">Vue3</span> <span class="err">单文件组件支持</span>
</span></span><span class="line"><span class="cl"><span class="err">*</span>   <span class="err">`@vitejs/plugin-vue-jsx`</span> <span class="err">提供</span> <span class="err">Vue3</span> <span class="err">JSX</span> <span class="err">支持（专用的</span> <span class="err">Babel</span> <span class="err">转换插件）</span>
</span></span><span class="line"><span class="cl"><span class="err">*</span>   <span class="err">`@vitejs/plugin-react`</span> <span class="err">提供完整的</span> <span class="err">React</span> <span class="err">支持</span>
</span></span><span class="line"><span class="cl"><span class="err">*</span>   <span class="err">`@vitejs/plugin-legacy`</span> <span class="err">为打包后的文件提供传统浏览器兼容性支持</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">###</span> <span class="err">UI组件库</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">*</span>   <span class="err">[Element</span> <span class="err">UI](https:</span><span class="c1">//link.juejin.cn?target=https%3A%2F%2Felement-plus.gitee.io%2Fzh-CN%2Fguide%2Fquickstart.html%23%25E6%258C%2589%25E9%259C%2580%25E5%25AF%25BC%25E5%2585%25A5 &#34;https://element-plus.gitee.io/zh-CN/guide/quickstart.html#%E6%8C%89%E9%9C%80%E5%AF%BC%E5%85%A5&#34;)：支持 vite 引入
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="err">###</span> <span class="err">相关链接</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">*</span>   <span class="err">[Vite官网](https:</span><span class="c1">//link.juejin.cn?target=https%3A%2F%2Fcn.vitejs.dev%2F &#34;https://cn.vitejs.dev/&#34;)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">*</span>   <span class="err">[Vue3</span> <span class="err">生态进展和计划-尤雨溪](https:</span><span class="c1">//link.juejin.cn?target=https%3A%2F%2Fwww.yuque.com%2Fvueconf%2Fmkwv0c%2Fxqyxix &#34;https://www.yuque.com/vueconf/mkwv0c/xqyxix&#34;)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">*</span>   <span class="err">[Vite源码解析](https:</span><span class="c1">//link.juejin.cn?target=http%3A%2F%2Fvite.ssr-fc.com%2F &#34;http://vite.ssr-fc.com/&#34;)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">*</span>   <span class="err">[Develop</span> <span class="err">with</span> <span class="err">Vite</span> <span class="err">|</span> <span class="err">Vite快速入门</span> <span class="err">-</span> <span class="err">Anthony</span> <span class="err">Fu</span> <span class="err">•</span> <span class="err">Vue北京聚会</span> <span class="err">Day</span> <span class="err">13](https:</span><span class="c1">//link.juejin.cn?target=https%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3Dxx8gEHet6n8 &#34;https://www.youtube.com/watch?v=xx8gEHet6n8&#34;)
</span></span></span></code></pre></td></tr></table>
</div>
</div>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/%E5%89%8D%E7%AB%AF/">前端</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://localhost:1313/posts/juejin/sass%E4%B8%AD%E5%A6%82%E4%BD%95%E6%AD%A3%E7%A1%AE%E4%BD%BF%E7%94%A8mixin/">
    <span class="title">« 上一页</span>
    <br>
    <span>Sass中如何正确使用Mixin</span>
  </a>
  <a class="next" href="http://localhost:1313/posts/papermod/%E9%9D%A2%E8%AF%95%E5%AE%98%E4%B8%BA%E4%BB%80%E4%B9%88%E5%BF%98%E8%AE%B0%E5%AF%86%E7%A0%81%E8%A6%81%E9%87%8D%E7%BD%AE%E8%80%8C%E4%B8%8D%E6%98%AF%E5%91%8A%E8%AF%89%E4%BD%A0%E5%8E%9F%E5%AF%86%E7%A0%81/">
    <span class="title">下一页 »</span>
    <br>
    <span>面试官：为什么忘记密码要重置而不是告诉你原密码？</span>
  </a>
</nav>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 下一代前端开发利器——Vite（原理源码解析） on x"
            href="https://x.com/intent/tweet/?text=%e4%b8%8b%e4%b8%80%e4%bb%a3%e5%89%8d%e7%ab%af%e5%bc%80%e5%8f%91%e5%88%a9%e5%99%a8%e2%80%94%e2%80%94Vite%ef%bc%88%e5%8e%9f%e7%90%86%e6%ba%90%e7%a0%81%e8%a7%a3%e6%9e%90%ef%bc%89&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E4%25B8%258B%25E4%25B8%2580%25E4%25BB%25A3%25E5%2589%258D%25E7%25AB%25AF%25E5%25BC%2580%25E5%258F%2591%25E5%2588%25A9%25E5%2599%25A8vite%25E5%258E%259F%25E7%2590%2586%25E6%25BA%2590%25E7%25A0%2581%25E8%25A7%25A3%25E6%259E%2590%2f&amp;hashtags=%e5%89%8d%e7%ab%af">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 下一代前端开发利器——Vite（原理源码解析） on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E4%25B8%258B%25E4%25B8%2580%25E4%25BB%25A3%25E5%2589%258D%25E7%25AB%25AF%25E5%25BC%2580%25E5%258F%2591%25E5%2588%25A9%25E5%2599%25A8vite%25E5%258E%259F%25E7%2590%2586%25E6%25BA%2590%25E7%25A0%2581%25E8%25A7%25A3%25E6%259E%2590%2f&amp;title=%e4%b8%8b%e4%b8%80%e4%bb%a3%e5%89%8d%e7%ab%af%e5%bc%80%e5%8f%91%e5%88%a9%e5%99%a8%e2%80%94%e2%80%94Vite%ef%bc%88%e5%8e%9f%e7%90%86%e6%ba%90%e7%a0%81%e8%a7%a3%e6%9e%90%ef%bc%89&amp;summary=%e4%b8%8b%e4%b8%80%e4%bb%a3%e5%89%8d%e7%ab%af%e5%bc%80%e5%8f%91%e5%88%a9%e5%99%a8%e2%80%94%e2%80%94Vite%ef%bc%88%e5%8e%9f%e7%90%86%e6%ba%90%e7%a0%81%e8%a7%a3%e6%9e%90%ef%bc%89&amp;source=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E4%25B8%258B%25E4%25B8%2580%25E4%25BB%25A3%25E5%2589%258D%25E7%25AB%25AF%25E5%25BC%2580%25E5%258F%2591%25E5%2588%25A9%25E5%2599%25A8vite%25E5%258E%259F%25E7%2590%2586%25E6%25BA%2590%25E7%25A0%2581%25E8%25A7%25A3%25E6%259E%2590%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 下一代前端开发利器——Vite（原理源码解析） on reddit"
            href="https://reddit.com/submit?url=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E4%25B8%258B%25E4%25B8%2580%25E4%25BB%25A3%25E5%2589%258D%25E7%25AB%25AF%25E5%25BC%2580%25E5%258F%2591%25E5%2588%25A9%25E5%2599%25A8vite%25E5%258E%259F%25E7%2590%2586%25E6%25BA%2590%25E7%25A0%2581%25E8%25A7%25A3%25E6%259E%2590%2f&title=%e4%b8%8b%e4%b8%80%e4%bb%a3%e5%89%8d%e7%ab%af%e5%bc%80%e5%8f%91%e5%88%a9%e5%99%a8%e2%80%94%e2%80%94Vite%ef%bc%88%e5%8e%9f%e7%90%86%e6%ba%90%e7%a0%81%e8%a7%a3%e6%9e%90%ef%bc%89">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 下一代前端开发利器——Vite（原理源码解析） on facebook"
            href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E4%25B8%258B%25E4%25B8%2580%25E4%25BB%25A3%25E5%2589%258D%25E7%25AB%25AF%25E5%25BC%2580%25E5%258F%2591%25E5%2588%25A9%25E5%2599%25A8vite%25E5%258E%259F%25E7%2590%2586%25E6%25BA%2590%25E7%25A0%2581%25E8%25A7%25A3%25E6%259E%2590%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 下一代前端开发利器——Vite（原理源码解析） on whatsapp"
            href="https://api.whatsapp.com/send?text=%e4%b8%8b%e4%b8%80%e4%bb%a3%e5%89%8d%e7%ab%af%e5%bc%80%e5%8f%91%e5%88%a9%e5%99%a8%e2%80%94%e2%80%94Vite%ef%bc%88%e5%8e%9f%e7%90%86%e6%ba%90%e7%a0%81%e8%a7%a3%e6%9e%90%ef%bc%89%20-%20http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E4%25B8%258B%25E4%25B8%2580%25E4%25BB%25A3%25E5%2589%258D%25E7%25AB%25AF%25E5%25BC%2580%25E5%258F%2591%25E5%2588%25A9%25E5%2599%25A8vite%25E5%258E%259F%25E7%2590%2586%25E6%25BA%2590%25E7%25A0%2581%25E8%25A7%25A3%25E6%259E%2590%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 下一代前端开发利器——Vite（原理源码解析） on telegram"
            href="https://telegram.me/share/url?text=%e4%b8%8b%e4%b8%80%e4%bb%a3%e5%89%8d%e7%ab%af%e5%bc%80%e5%8f%91%e5%88%a9%e5%99%a8%e2%80%94%e2%80%94Vite%ef%bc%88%e5%8e%9f%e7%90%86%e6%ba%90%e7%a0%81%e8%a7%a3%e6%9e%90%ef%bc%89&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E4%25B8%258B%25E4%25B8%2580%25E4%25BB%25A3%25E5%2589%258D%25E7%25AB%25AF%25E5%25BC%2580%25E5%258F%2591%25E5%2588%25A9%25E5%2599%25A8vite%25E5%258E%259F%25E7%2590%2586%25E6%25BA%2590%25E7%25A0%2581%25E8%25A7%25A3%25E6%259E%2590%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 下一代前端开发利器——Vite（原理源码解析） on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=%e4%b8%8b%e4%b8%80%e4%bb%a3%e5%89%8d%e7%ab%af%e5%bc%80%e5%8f%91%e5%88%a9%e5%99%a8%e2%80%94%e2%80%94Vite%ef%bc%88%e5%8e%9f%e7%90%86%e6%ba%90%e7%a0%81%e8%a7%a3%e6%9e%90%ef%bc%89&u=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E4%25B8%258B%25E4%25B8%2580%25E4%25BB%25A3%25E5%2589%258D%25E7%25AB%25AF%25E5%25BC%2580%25E5%258F%2591%25E5%2588%25A9%25E5%2599%25A8vite%25E5%258E%259F%25E7%2590%2586%25E6%25BA%2590%25E7%25A0%2581%25E8%25A7%25A3%25E6%259E%2590%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span><a href="https://beian.miit.gov.cn/">粤ICP备2023039897号-1</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = '复制';

        function copyingDone() {
            copybutton.innerHTML = '已复制！';
            setTimeout(() => {
                copybutton.innerHTML = '复制';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
