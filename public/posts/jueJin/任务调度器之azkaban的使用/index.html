<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>任务调度器之Azkaban的使用 | PaperMod</title>
<meta name="keywords" content="Hadoop, Java">
<meta name="description" content="Azkaban是一个批量工作流任务调度器。用于在一个工作流内以一个特定的顺序运行一组工作和流程。在大数据领域中，用于运行Hadoop作业。">
<meta name="author" content="CodeDevMaster">
<link rel="canonical" href="http://localhost:1313/posts/juejin/%E4%BB%BB%E5%8A%A1%E8%B0%83%E5%BA%A6%E5%99%A8%E4%B9%8Bazkaban%E7%9A%84%E4%BD%BF%E7%94%A8/">
<meta name="google-site-verification" content="XYZabc">
<link crossorigin="anonymous" href="/assets/css/stylesheet.7b92bf4867c997b58ec50f63451b83777173d5bd5593376852abd85746d09d71.css" integrity="sha256-e5K/SGfJl7WOxQ9jRRuDd3Fz1b1VkzdoUqvYV0bQnXE=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<link rel="apple-touch-icon" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<link rel="mask-icon" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="zh" href="http://localhost:1313/posts/juejin/%E4%BB%BB%E5%8A%A1%E8%B0%83%E5%BA%A6%E5%99%A8%E4%B9%8Bazkaban%E7%9A%84%E4%BD%BF%E7%94%A8/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript><meta property="og:title" content="任务调度器之Azkaban的使用" />
<meta property="og:description" content="Azkaban是一个批量工作流任务调度器。用于在一个工作流内以一个特定的顺序运行一组工作和流程。在大数据领域中，用于运行Hadoop作业。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/posts/juejin/%E4%BB%BB%E5%8A%A1%E8%B0%83%E5%BA%A6%E5%99%A8%E4%B9%8Bazkaban%E7%9A%84%E4%BD%BF%E7%94%A8/" />
<meta property="og:image" content="http://localhost:1313/images/papermod-cover.png" />
<meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-06-28T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-06-28T00:00:00+00:00" />


<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="http://localhost:1313/images/papermod-cover.png" />
<meta name="twitter:title" content="任务调度器之Azkaban的使用"/>
<meta name="twitter:description" content="Azkaban是一个批量工作流任务调度器。用于在一个工作流内以一个特定的顺序运行一组工作和流程。在大数据领域中，用于运行Hadoop作业。"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "任务调度器之Azkaban的使用",
      "item": "http://localhost:1313/posts/juejin/%E4%BB%BB%E5%8A%A1%E8%B0%83%E5%BA%A6%E5%99%A8%E4%B9%8Bazkaban%E7%9A%84%E4%BD%BF%E7%94%A8/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "任务调度器之Azkaban的使用",
  "name": "任务调度器之Azkaban的使用",
  "description": "Azkaban是一个批量工作流任务调度器。用于在一个工作流内以一个特定的顺序运行一组工作和流程。在大数据领域中，用于运行Hadoop作业。",
  "keywords": [
    "Hadoop", "Java"
  ],
  "articleBody": "持续创作，加速成长！这是我参与「掘金日新计划 · 6 月更文挑战」的第33天，点击查看活动详情\nAzkaban概述 Azkaban是由Linkedin开源的一个批量工作流任务调度器。用于在一个工作流内以一个特定的顺序运行一组工作和流程。\nAzkaban定义了一种KV文件(properties)格式来建立任务之间的依赖关系，并提供一个易于使用的web用户界面维护和跟踪你的工作流。\n官网 : https://azkaban.github.io/\n安装Azkaban 下载\nbash\n代码解读\n复制代码\nwget https://github.com/azkaban/azkaban/archive/refs/tags/3.73.0.tar.gz tar -zxvf 3.73.0.tar.gz mv azkaban-3.73.0 azkaban-src\n安装Git\nbash\n代码解读\n复制代码\nyum ‐y install git yum ‐y install gcc‐c++ [root@administrator program]# git version git version 1.8.3.1\n修改azkaban-src目录下的build.gradle文件，修改allprojects节点配置，指定仓库地址为阿里云仓库\nbash\n代码解读\n复制代码\nallprojects { apply plugin: 'jacoco' repositories { maven { url 'https://maven.aliyun.com/repository/public/' } mavenLocal() mavenCentral() } }\n开始编译、安装并跳过测试阶段\nbash\n代码解读\n复制代码\ncd azkaban/ ./gradlew build installDist -x test\n最后编译成功\nbash\n代码解读\n复制代码\nBUILD SUCCESSFUL in 4m 52s 82 actionable tasks: 76 executed, 6 from cache\n编译后得到以下文件\nbash\n代码解读\n复制代码\n# azkaban-web-server页面显示服务 [root@administrator azkaban-src]# ls azkaban-web-server/build/distributions/ azkaban-web-server-0.1.0-SNAPSHOT.tar.gz azkaban-web-server-0.1.0-SNAPSHOT.zip # azkaban-solo-server [root@administrator azkaban-src]# ls azkaban-solo-server/build/distributions/ azkaban-solo-server-0.1.0-SNAPSHOT.tar.gz azkaban-solo-server-0.1.0-SNAPSHOT.zip # azkaban-exec-server任务执行服务 [root@administrator azkaban-src]# ls azkaban-exec-server/build/distributions/ azkaban-exec-server-0.1.0-SNAPSHOT.tar.gz azkaban-exec-server-0.1.0-SNAPSHOT.zip # two server模式需要的C程序 [root@administrator azkaban-src]# ls az-exec-util/src/main/c execute-as-user.c # 数据库脚本 [root@administrator azkaban-src]# ll azkaban-db/build/install/azkaban-db/ 总用量 112 -rw-r--r-- 1 root root 12022 3月 12 13:33 create-all-sql-0.1.0-SNAPSHOT.sql\n单服务模式 Azkaban的单服务模式使用的是一个单节点模式来进行启动服务，只需要启动安装包即可，所有数据保存在H2内存中。\n准备 vbscript\n代码解读\n复制代码\nazkaban-solo-server-0.1.0-SNAPSHOT.tar.gz\n解压 解压azkaban-solo-server-0.1.0-SNAPSHOT.tar.gz\nbash\n代码解读\n复制代码\ntar -zxvf azkaban-solo-server/build/distributions/azkaban-solo-server-0.1.0-SNAPSHOT.tar.gz -C ../azkaban [root@administrator azkaban]# ls azkaban-solo-server-0.1.0-SNAPSHOT\n安装 修改vim azkaban-solo-server-0.1.0-SNAPSHOT/conf/azkaban.properties文件，保证与Linxu服务器时区一致\nbash\n代码解读\n复制代码\n#default.timezone.id=America/Los_Angeles default.timezone.id=Asia/Shanghai\n修改vim azkaban-solo-server-0.1.0-SNAPSHOT/plugins/jobtypes/commonprivate.properties文件\nbash\n代码解读\n复制代码\n# set execute-as-user execute.as.user=false # Azkaban对内存要求高，关闭内存检查 memCheck.enabled=false\n启动solo-server bash\n代码解读\n复制代码\ncd azkaban-solo-server-0.1.0-SNAPSHOT/ bin/start-solo.sh [root@administrator azkaban-solo-server-0.1.0-SNAPSHOT]# jps 22563 AzkabanSingleServer\n访问Web 浏览器访问：IP：8081\r登陆，用户名与密码：azkaban\r使用 创建 Job 描述文件 vim test.job\nbash\n代码解读\n复制代码\ntype=command command=echo \"hello world\"\n创建一个项目 将test.jobjob资源文件打包成test.zipzip文件，并上传 启动执行job 两个服务器模式 准备 sql\n代码解读\n复制代码\nazkaban-web-server-0.1.0-SNAPSHOT.tar.gz azkaban-exec-server-0.1.0-SNAPSHOT.tar.gz create-all-sql-0.1.0-SNAPSHOT.sql execute-as-user.c\n初始化数据库 bash\n代码解读\n复制代码\nCREATE DATABASE azkaban; CREATE USER 'azkaban'@'%' IDENTIFIED BY 'azkaban'; GRANT all privileges ON azkaban.* to 'azkaban'@'%' identified by 'azkaban' WITH GRANT OPTION; flush privileges; use azkaban; source /usr/local/program/azkaban-src/azkaban-db/build/install/azkaban-db/create-all-sql-0.1.0-SNAPSHOT.sql\n解压 bash\n代码解读\n复制代码\ntar -zxvf azkaban-web-server/build/distributions/azkaban-web-server-0.1.0-SNAPSHOT.tar.gz -C ../azkaban tar -zxvf azkaban-exec-server/build/distributions/azkaban-exec-server-0.1.0-SNAPSHOT.tar.gz -C ../azkaban [root@administrator azkaban]# ls azkaban-exec-server-0.1.0-SNAPSHOT azkaban-solo-server-0.1.0-SNAPSHOT azkaban-web-server-0.1.0-SNAPSHOT\n安装SSL安全认证 安装SSL安全认证，允许使用https的方式访问azkaban的web服务\nbash\n代码解读\n复制代码\n[root@administrator azkaban]# keytool -keystore keystore -alias keyalias -genkey -keyalg RSA 输入密钥库口令: 再次输入新口令: 您的名字与姓氏是什么? [Unknown]: 您的组织单位名称是什么? [Unknown]: 您的组织名称是什么? [Unknown]: 您所在的城市或区域名称是什么? [Unknown]: 您所在的省/市/自治区名称是什么? [Unknown]: 该单位的双字母国家/地区代码是什么? [Unknown]: CN=Unknown, OU=Unknown, O=Unknown, L=Unknown, ST=Unknown, C=Unknown是否正确? [否]: y 输入 的密钥口令 (如果和密钥库口令相同, 按回车): Warning: JKS 密钥库使用专用格式。建议使用 \"keytool -importkeystore -srckeystore keystore -destkeystore keystore -deststoretype pkcs12\" 迁移到行业标准格式 PKCS12。 [root@administrator azkaban]# ls azkaban-exec-server-0.1.0-SNAPSHOT azkaban-solo-server-0.1.0-SNAPSHOT azkaban-web-server-0.1.0-SNAPSHOT keystore\n安装Azkaban Web Server 安装azkaban web server，进入cd azkaban-web-server-0.1.0-SNAPSHOT/conf编辑 vim azkaban.properties\nbash\n代码解读\n复制代码\n#default.timezone.id=America/Los_Angeles default.timezone.id=Asia/Shanghai #jetty.use.ssl=false jetty.use.ssl=true # ssl配置 jetty.ssl.port=8443 jetty.keystore=/usr/local/program/azkaban/keystore jetty.password=azkaban jetty.keypassword=azkaban jetty.truststore=/usr/local/program/azkaban/keystore jetty.trustpassword=azkaban # Azkaban mysql settings by default. Users should configure their own username and password. database.type=mysql mysql.port=3306 mysql.host=localhost mysql.database=azkaban mysql.user=azkaban mysql.password=azkaban mysql.numconnections=100 azkaban.executorselector.filters=StaticRemainingFlowSize,MinimumFreeMemory,CpuStatus #azkaban.executorselector.filters=StaticRemainingFlowSize,MinimumFreeMemory,CpuStatus azkaban.activeexecutor.refresh.milisecinterval=10000 azkaban.queueprocessing.enabled=true azkaban.activeexecutor.refresh.flowinterval=10 azkaban.executorinfo.refresh.maxThreads=10\n安装Azkaban Executor Server 安装azkaban executor server，进入cd azkaban-exec-server-0.1.0-SNAPSHOT/conf编辑vim azkaban.properties\nbash\n代码解读\n复制代码\n#default.timezone.id=America/Los_Angeles default.timezone.id=Asia/Shanghai #jetty.use.ssl=false jetty.use.ssl=true # ssl配置 jetty.ssl.port=8443 jetty.keystore=/usr/local/program/azkaban/keystore jetty.password=azkaban jetty.keypassword=azkaban jetty.truststore=/usr/local/program/azkaban/keystore jetty.trustpassword=azkaban # Where the Azkaban web server is located #azkaban.webserver.url=http://localhost:8081 azkaban.webserver.url=http://localhost:8443 # Azkaban mysql settings by default. Users should configure their own username and password. database.type=mysql mysql.port=3306 mysql.host=localhost mysql.database=azkaban mysql.user=azkaban mysql.password=azkaban mysql.numconnections=100\n添加插件\n将编译后的C文件execute-as-user.c拷贝到azkaban-exec-server-0.1.0-SNAPSHOT/plugins/jobtypes目录\nbash\n代码解读\n复制代码\ncp az-exec-util/src/main/c/execute-as-user.c /usr/local/program/azkaban/azkaban-exec-server-0.1.0-SNAPSHOT/plugins/jobtypes\n生成execute-as-user\nbash\n代码解读\n复制代码\ncd azkaban-exec-server-0.1.0-SNAPSHOT/plugins/jobtypes [root@administrator jobtypes]# yum -y install gcc-c++ [root@administrator jobtypes]# gcc execute-as-user.c -o execute-as-user [root@administrator jobtypes]# ls commonprivate.properties execute-as-user execute-as-user.c [root@administrator jobtypes]# chown root execute‐as‐user [root@administrator jobtypes]# chmod 6050 execute-as-user [root@administrator jobtypes]# ll 总用量 24 -rw-rw-r-- 1 root root 44 5月 31 2019 commonprivate.properties ---Sr-s--- 1 root root 13536 3月 12 15:33 execute-as-user -rw-r--r-- 1 root root 3976 3月 12 15:30 execute-as-user.c\n修改配置文件\nbash\n代码解读\n复制代码\nvim commonprivate.properties # set execute-as-user execute.as.user=false # 关闭内存检测 memCheck.enabled=false # 指定插件存放目录 azkaban.native.lib=/usr/local/program/azkaban/azkaban-exec-server-0.1.0-SNAPSHOT/plugins/jobtypes\n启动服务 启动azkaban exec server\nbash\n代码解读\n复制代码\ncd azkaban-exec-server-0.1.0-SNAPSHOT bin/start-exec.sh [root@administrator azkaban-src]# jps 24655 AzkabanExecutorServer # 当azkaban-exec-server-0.1.0-SNAPSHOT目录下出现executor.port文件，说明启动成功 [root@administrator azkaban-exec-server-0.1.0-SNAPSHOT]# ls bin conf currentpid executions executor.port executorServerLog__2022-03-12+15:57:50.out lib logs plugins projects temp\n激活exec-server\nbash\n代码解读\n复制代码\n[root@administrator azkaban-exec-server-0.1.0-SNAPSHOT]# curl -G \"node01:$(\u003c./executor.port)/executor?action=activate\" \u0026\u0026 echo {\"status\":\"success\"}\n启动azkaban-web-server\nbash\n代码解读\n复制代码\ncd azkaban-web-server-0.1.0-SNAPSHOT/ bin/start-web.sh [root@administrator azkaban-src]# jps 11146 AzkabanWebServer\n访问Web 浏览器访问IP:8443 注意：放行端口or关闭防火墙\nbash\n代码解读\n复制代码\nsystemctl stop firewalld.service\n使用测试 将单服务模式下的Job资源上传进行测试 任务提交与执行 Command类型 1.单一Job的使用\npython\n代码解读\n复制代码\n1.创建 Job 描述文件 2.将job资源文件打包成zip文件 3.创建工程并上传zip压缩包 4.启动工作流flow，执行job\n创建 Job 描述文件 vim test.job\nbash\n代码解读\n复制代码\ntype=command command=echo \"hello world\"\n2.多Job的使用\npython\n代码解读\n复制代码\n1.创建有依赖关系的多个job描述 2.将所有job资源文件打到一个zip包中 3.创建工程并上传zip压缩包 4.启动工作流flow，执行job\n创建 Job 描述文件 vim test1.job\nbash\n代码解读\n复制代码\ntype=command command=echo \"test1 hello world\"\n创建 Job 描述文件 vim test2.job\nbash\n代码解读\n复制代码\ntype=command command=echo \"test2 hello world\" dependencies=test1\n上传后执行时显示依赖关系 执行过程与结果 定时任务 Azkaban的scheduler功能可以实现对作业任务进行定时调度功能 HDFS操作任务 python\n代码解读\n复制代码\n1.创建job描述文件 2.将job资源文件打包成zip文件 3.创建project并上传job压缩包 4.启动执行该job\nvim hdfs.job\nbash\n代码解读\n复制代码\ntype=command command=/usr/local/program/hadoop/bin/hdfs dfs -mkdir /azkaban\n执行后查看HDFS\nbash\n代码解读\n复制代码\n[root@administrator hadoop]# hdfs dfs -ls / Found 6 items drwxr-xr-x - root supergroup 0 2022-03-12 18:37 /azkaban\nMapReduce任务 1.下载/usr/local/program/hadoop/share/hadoop/mapreduce/hadoop-mapreduce-examples-3.3.2.jar文件\n2.创建job描述文件 vim mr.job\nbash\n代码解读\n复制代码\ntype=command command=/usr/local/program/hadoop/bin/hadoop jar hadoop-mapreduce-examples-3.3.2.jar pi 3 5\n3.将所有job资源文件( vim mr.job、hadoop-mapreduce-examples-3.3.2.jar)打到一个zip压缩包中\n4.创建工程并上传zip包，启动job Hive 脚本任务 1.准备Hive脚本： hive.sql\nbash\n代码解读\n复制代码\ncreate database if not exists dbazkaban; use dbazkaban; create table if not exists tbazkaban(id string,name string) row format delimited fields terminated by '\\t';\n2.创建job描述文件 hive.job\nbash\n代码解读\n复制代码\ntype=command command=/usr/local/program/hive/bin/hive -f 'hive.sql'\n3.将所有job资源文件打到一个zip包中\n4.创建工程并上传zip包，启动job ",
  "wordCount" : "761",
  "inLanguage": "zh",
  "image": "http://localhost:1313/images/papermod-cover.png","datePublished": "2022-06-28T00:00:00Z",
  "dateModified": "2022-06-28T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "CodeDevMaster"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/posts/juejin/%E4%BB%BB%E5%8A%A1%E8%B0%83%E5%BA%A6%E5%99%A8%E4%B9%8Bazkaban%E7%9A%84%E4%BD%BF%E7%94%A8/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "PaperMod",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/%3Clink%20/%20abs%20url%3E"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Home (Alt + H)">
                        
                    <img src="http://localhost:1313/images/msg_hu15231257772499651944.png" alt="" aria-label="logo"
                        height="20">Home</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/archives" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="https://github.com/adityatelange/hugo-PaperMod/wiki/" title="WiKi">
                    <span>WiKi</span>&nbsp;
                    <svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12">
                        <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path>
                        <path d="M15 3h6v6"></path>
                        <path d="M10 14L21 3"></path>
                    </svg>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/">主页</a>&nbsp;»&nbsp;<a href="http://localhost:1313/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      任务调度器之Azkaban的使用
    </h1>
    <div class="post-description">
      Azkaban是一个批量工作流任务调度器。用于在一个工作流内以一个特定的顺序运行一组工作和流程。在大数据领域中，用于运行Hadoop作业。
    </div>
    <div class="post-meta"><span title='2022-06-28 00:00:00 +0000 UTC'>六月 28, 2022</span>&nbsp;·&nbsp;4 分钟&nbsp;·&nbsp;CodeDevMaster&nbsp;|&nbsp;<a href="https://github.com/WangShaoyu1/myBlogPaperMod/tree/master/content/posts/jueJin/%e4%bb%bb%e5%8a%a1%e8%b0%83%e5%ba%a6%e5%99%a8%e4%b9%8bAzkaban%e7%9a%84%e4%bd%bf%e7%94%a8.md" rel="noopener noreferrer" target="_blank">Suggest Changes</a>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">目录</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#azkaban%e6%a6%82%e8%bf%b0" aria-label="Azkaban概述">Azkaban概述</a></li>
                <li>
                    <a href="#%e5%ae%89%e8%a3%85azkaban" aria-label="安装Azkaban">安装Azkaban</a></li>
                <li>
                    <a href="#%e5%8d%95%e6%9c%8d%e5%8a%a1%e6%a8%a1%e5%bc%8f" aria-label="单服务模式">单服务模式</a><ul>
                        
                <li>
                    <a href="#%e5%87%86%e5%a4%87" aria-label="准备">准备</a></li>
                <li>
                    <a href="#%e8%a7%a3%e5%8e%8b" aria-label="解压">解压</a></li>
                <li>
                    <a href="#%e5%ae%89%e8%a3%85" aria-label="安装">安装</a></li>
                <li>
                    <a href="#%e5%90%af%e5%8a%a8solo-server" aria-label="启动solo-server">启动solo-server</a></li>
                <li>
                    <a href="#%e8%ae%bf%e9%97%aeweb" aria-label="访问Web">访问Web</a></li>
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8" aria-label="使用">使用</a></li></ul>
                </li>
                <li>
                    <a href="#%e4%b8%a4%e4%b8%aa%e6%9c%8d%e5%8a%a1%e5%99%a8%e6%a8%a1%e5%bc%8f" aria-label="两个服务器模式">两个服务器模式</a><ul>
                        
                <li>
                    <a href="#%e5%87%86%e5%a4%87-1" aria-label="准备">准备</a></li>
                <li>
                    <a href="#%e5%88%9d%e5%a7%8b%e5%8c%96%e6%95%b0%e6%8d%ae%e5%ba%93" aria-label="初始化数据库">初始化数据库</a></li>
                <li>
                    <a href="#%e8%a7%a3%e5%8e%8b-1" aria-label="解压">解压</a></li>
                <li>
                    <a href="#%e5%ae%89%e8%a3%85ssl%e5%ae%89%e5%85%a8%e8%ae%a4%e8%af%81" aria-label="安装SSL安全认证">安装SSL安全认证</a></li>
                <li>
                    <a href="#%e5%ae%89%e8%a3%85azkaban-web-server" aria-label="安装Azkaban Web Server">安装Azkaban Web Server</a></li>
                <li>
                    <a href="#%e5%ae%89%e8%a3%85azkaban-executor-server" aria-label="安装Azkaban Executor Server">安装Azkaban Executor Server</a></li>
                <li>
                    <a href="#%e5%90%af%e5%8a%a8%e6%9c%8d%e5%8a%a1" aria-label="启动服务">启动服务</a></li>
                <li>
                    <a href="#%e8%ae%bf%e9%97%aeweb-1" aria-label="访问Web">访问Web</a></li>
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8%e6%b5%8b%e8%af%95" aria-label="使用测试">使用测试</a></li></ul>
                </li>
                <li>
                    <a href="#%e4%bb%bb%e5%8a%a1%e6%8f%90%e4%ba%a4%e4%b8%8e%e6%89%a7%e8%a1%8c" aria-label="任务提交与执行">任务提交与执行</a><ul>
                        
                <li>
                    <a href="#command%e7%b1%bb%e5%9e%8b" aria-label="Command类型">Command类型</a></li>
                <li>
                    <a href="#%e5%ae%9a%e6%97%b6%e4%bb%bb%e5%8a%a1" aria-label="定时任务">定时任务</a></li>
                <li>
                    <a href="#hdfs%e6%93%8d%e4%bd%9c%e4%bb%bb%e5%8a%a1" aria-label="HDFS操作任务">HDFS操作任务</a></li>
                <li>
                    <a href="#mapreduce%e4%bb%bb%e5%8a%a1" aria-label="MapReduce任务">MapReduce任务</a></li>
                <li>
                    <a href="#hive-%e8%84%9a%e6%9c%ac%e4%bb%bb%e5%8a%a1" aria-label="Hive 脚本任务">Hive 脚本任务</a>
                </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p>持续创作，加速成长！这是我参与「掘金日新计划 · 6 月更文挑战」的第33天，<a href="https://juejin.cn/post/7099702781094674468" title="https://juejin.cn/post/7099702781094674468">点击查看活动详情</a></p>
<h1 id="azkaban概述">Azkaban概述<a hidden class="anchor" aria-hidden="true" href="#azkaban概述">#</a></h1>
<blockquote>
<p>Azkaban是由Linkedin开源的一个批量工作流任务调度器。用于在一个工作流内以一个特定的顺序运行一组工作和流程。</p>
</blockquote>
<blockquote>
<p>Azkaban定义了一种KV文件(properties)格式来建立任务之间的依赖关系，并提供一个易于使用的web用户界面维护和跟踪你的工作流。</p>
</blockquote>
<p>官网 : <code>https://azkaban.github.io/</code></p>
<h1 id="安装azkaban">安装Azkaban<a hidden class="anchor" aria-hidden="true" href="#安装azkaban">#</a></h1>
<p>下载</p>
<p>bash</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>wget https://github.com/azkaban/azkaban/archive/refs/tags/3.73.0.tar.gz tar -zxvf 3.73.0.tar.gz  mv azkaban-3.73.0  azkaban-src</code></p>
<p>安装Git</p>
<p>bash</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>yum ‐y install git yum ‐y install gcc‐c++ [root@administrator program]# git version git version 1.8.3.1</code></p>
<p>修改azkaban-src目录下的build.gradle文件，修改allprojects节点配置，指定仓库地址为阿里云仓库</p>
<p>bash</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>allprojects {     apply plugin: 'jacoco'     repositories {        maven {     	  	url 'https://maven.aliyun.com/repository/public/'    	 }     mavenLocal()     mavenCentral()     } }</code></p>
<p>开始编译、安装并跳过测试阶段</p>
<p>bash</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>cd azkaban/   ./gradlew  build installDist -x test</code></p>
<p>最后编译成功</p>
<p>bash</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>BUILD SUCCESSFUL in 4m 52s 82 actionable tasks: 76 executed, 6 from cache</code></p>
<p>编译后得到以下文件</p>
<p>bash</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code># azkaban-web-server页面显示服务 [root@administrator azkaban-src]# ls azkaban-web-server/build/distributions/ azkaban-web-server-0.1.0-SNAPSHOT.tar.gz  azkaban-web-server-0.1.0-SNAPSHOT.zip # azkaban-solo-server [root@administrator azkaban-src]# ls azkaban-solo-server/build/distributions/ azkaban-solo-server-0.1.0-SNAPSHOT.tar.gz  azkaban-solo-server-0.1.0-SNAPSHOT.zip #  azkaban-exec-server任务执行服务 [root@administrator azkaban-src]# ls azkaban-exec-server/build/distributions/ azkaban-exec-server-0.1.0-SNAPSHOT.tar.gz  azkaban-exec-server-0.1.0-SNAPSHOT.zip # two server模式需要的C程序 [root@administrator azkaban-src]# ls az-exec-util/src/main/c execute-as-user.c # 数据库脚本 [root@administrator azkaban-src]# ll azkaban-db/build/install/azkaban-db/ 总用量 112 -rw-r--r-- 1 root root 12022 3月  12 13:33 create-all-sql-0.1.0-SNAPSHOT.sql</code></p>
<h1 id="单服务模式">单服务模式<a hidden class="anchor" aria-hidden="true" href="#单服务模式">#</a></h1>
<blockquote>
<p>Azkaban的单服务模式使用的是一个单节点模式来进行启动服务，只需要启动安装包即可，所有数据保存在H2内存中。</p>
</blockquote>
<h2 id="准备">准备<a hidden class="anchor" aria-hidden="true" href="#准备">#</a></h2>
<p>vbscript</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>azkaban-solo-server-0.1.0-SNAPSHOT.tar.gz</code></p>
<h2 id="解压">解压<a hidden class="anchor" aria-hidden="true" href="#解压">#</a></h2>
<p>解压<code>azkaban-solo-server-0.1.0-SNAPSHOT.tar.gz</code></p>
<p>bash</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>tar -zxvf  azkaban-solo-server/build/distributions/azkaban-solo-server-0.1.0-SNAPSHOT.tar.gz -C ../azkaban [root@administrator azkaban]# ls azkaban-solo-server-0.1.0-SNAPSHOT</code></p>
<h2 id="安装">安装<a hidden class="anchor" aria-hidden="true" href="#安装">#</a></h2>
<p>修改<code>vim azkaban-solo-server-0.1.0-SNAPSHOT/conf/azkaban.properties</code>文件，保证与Linxu服务器时区一致</p>
<p>bash</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>#default.timezone.id=America/Los_Angeles  default.timezone.id=Asia/Shanghai</code></p>
<p>修改<code>vim azkaban-solo-server-0.1.0-SNAPSHOT/plugins/jobtypes/commonprivate.properties</code>文件</p>
<p>bash</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code># set execute-as-user execute.as.user=false # Azkaban对内存要求高，关闭内存检查 memCheck.enabled=false</code></p>
<h2 id="启动solo-server">启动solo-server<a hidden class="anchor" aria-hidden="true" href="#启动solo-server">#</a></h2>
<p>bash</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>cd azkaban-solo-server-0.1.0-SNAPSHOT/    bin/start-solo.sh [root@administrator azkaban-solo-server-0.1.0-SNAPSHOT]# jps 22563 AzkabanSingleServer</code></p>
<h2 id="访问web">访问Web<a hidden class="anchor" aria-hidden="true" href="#访问web">#</a></h2>
<p>浏览器访问：<code>IP：8081</code><img loading="lazy" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/17724b70e712439781a6853fc707012b~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="在这里插入图片描述"  />
 登陆，用户名与密码：azkaban<img loading="lazy" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/863602e24d0c4a62845b3236e789be41~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="在这里插入图片描述"  />
</p>
<h2 id="使用">使用<a hidden class="anchor" aria-hidden="true" href="#使用">#</a></h2>
<p>创建 Job 描述文件 <code>vim test.job</code></p>
<p>bash</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>type=command command=echo &quot;hello world&quot;</code></p>
<p>创建一个项目 <img loading="lazy" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8c2bf3960f07420193cf8ab65a0205a9~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="在这里插入图片描述"  />
 将<code>test.job</code>job资源文件打包成<code>test.zip</code>zip文件，并上传 <img loading="lazy" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2ad31254ca4f4a7187e50da6b6f10a90~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="在这里插入图片描述"  />
 启动执行job <img loading="lazy" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/96414b38bcf24de380273d0f61e58770~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="在这里插入图片描述"  />
 <img loading="lazy" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b1e01da9a28c4d95856b744b25b7aeb0~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="在这里插入图片描述"  />
 <img loading="lazy" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a35214e947d94a5bb4e1f8fcbf9763be~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="在这里插入图片描述"  />
 <img loading="lazy" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b15c7e4be7eb4cb080e127f9f24c9270~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="在这里插入图片描述"  />
</p>
<h1 id="两个服务器模式">两个服务器模式<a hidden class="anchor" aria-hidden="true" href="#两个服务器模式">#</a></h1>
<h2 id="准备-1">准备<a hidden class="anchor" aria-hidden="true" href="#准备-1">#</a></h2>
<p>sql</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>azkaban-web-server-0.1.0-SNAPSHOT.tar.gz azkaban-exec-server-0.1.0-SNAPSHOT.tar.gz create-all-sql-0.1.0-SNAPSHOT.sql execute-as-user.c</code></p>
<h2 id="初始化数据库">初始化数据库<a hidden class="anchor" aria-hidden="true" href="#初始化数据库">#</a></h2>
<p>bash</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>CREATE DATABASE azkaban; CREATE USER 'azkaban'@'%' IDENTIFIED BY 'azkaban'; GRANT all privileges ON azkaban.* to 'azkaban'@'%' identified by 'azkaban' WITH GRANT OPTION; flush privileges; use azkaban; source /usr/local/program/azkaban-src/azkaban-db/build/install/azkaban-db/create-all-sql-0.1.0-SNAPSHOT.sql</code></p>
<h2 id="解压-1">解压<a hidden class="anchor" aria-hidden="true" href="#解压-1">#</a></h2>
<p>bash</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>tar -zxvf  azkaban-web-server/build/distributions/azkaban-web-server-0.1.0-SNAPSHOT.tar.gz   -C ../azkaban tar -zxvf  azkaban-exec-server/build/distributions/azkaban-exec-server-0.1.0-SNAPSHOT.tar.gz  -C ../azkaban [root@administrator azkaban]# ls azkaban-exec-server-0.1.0-SNAPSHOT  azkaban-solo-server-0.1.0-SNAPSHOT  azkaban-web-server-0.1.0-SNAPSHOT</code></p>
<h2 id="安装ssl安全认证">安装SSL安全认证<a hidden class="anchor" aria-hidden="true" href="#安装ssl安全认证">#</a></h2>
<blockquote>
<p>安装SSL安全认证，允许使用https的方式访问azkaban的web服务</p>
</blockquote>
<p>bash</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>[root@administrator azkaban]# keytool -keystore keystore -alias keyalias -genkey -keyalg RSA 输入密钥库口令:   再次输入新口令:  您的名字与姓氏是什么?   [Unknown]:   您的组织单位名称是什么?   [Unknown]:   您的组织名称是什么?   [Unknown]:   您所在的城市或区域名称是什么?   [Unknown]:   您所在的省/市/自治区名称是什么?   [Unknown]:   该单位的双字母国家/地区代码是什么?   [Unknown]:   CN=Unknown, OU=Unknown, O=Unknown, L=Unknown, ST=Unknown, C=Unknown是否正确?   [否]:  y 输入 &lt;keyalias&gt; 的密钥口令         (如果和密钥库口令相同, 按回车):   Warning: JKS 密钥库使用专用格式。建议使用 &quot;keytool -importkeystore -srckeystore keystore -destkeystore keystore -deststoretype pkcs12&quot; 迁移到行业标准格式 PKCS12。 [root@administrator azkaban]# ls azkaban-exec-server-0.1.0-SNAPSHOT  azkaban-solo-server-0.1.0-SNAPSHOT  azkaban-web-server-0.1.0-SNAPSHOT  keystore</code></p>
<h2 id="安装azkaban-web-server">安装Azkaban Web Server<a hidden class="anchor" aria-hidden="true" href="#安装azkaban-web-server">#</a></h2>
<p>安装<code>azkaban web server</code>，进入<code>cd azkaban-web-server-0.1.0-SNAPSHOT/conf</code>编辑 <code>vim azkaban.properties</code></p>
<p>bash</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>#default.timezone.id=America/Los_Angeles  default.timezone.id=Asia/Shanghai #jetty.use.ssl=false jetty.use.ssl=true # ssl配置 jetty.ssl.port=8443 jetty.keystore=/usr/local/program/azkaban/keystore jetty.password=azkaban jetty.keypassword=azkaban jetty.truststore=/usr/local/program/azkaban/keystore jetty.trustpassword=azkaban # Azkaban mysql settings by default. Users should configure their own username and password. database.type=mysql mysql.port=3306 mysql.host=localhost mysql.database=azkaban mysql.user=azkaban mysql.password=azkaban mysql.numconnections=100 azkaban.executorselector.filters=StaticRemainingFlowSize,MinimumFreeMemory,CpuStatus #azkaban.executorselector.filters=StaticRemainingFlowSize,MinimumFreeMemory,CpuStatus azkaban.activeexecutor.refresh.milisecinterval=10000 azkaban.queueprocessing.enabled=true azkaban.activeexecutor.refresh.flowinterval=10 azkaban.executorinfo.refresh.maxThreads=10</code></p>
<h2 id="安装azkaban-executor-server">安装Azkaban Executor Server<a hidden class="anchor" aria-hidden="true" href="#安装azkaban-executor-server">#</a></h2>
<p>安装<code>azkaban executor server</code>，进入<code>cd azkaban-exec-server-0.1.0-SNAPSHOT/conf</code>编辑<code>vim azkaban.properties</code></p>
<p>bash</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>#default.timezone.id=America/Los_Angeles  default.timezone.id=Asia/Shanghai #jetty.use.ssl=false jetty.use.ssl=true # ssl配置 jetty.ssl.port=8443 jetty.keystore=/usr/local/program/azkaban/keystore jetty.password=azkaban jetty.keypassword=azkaban jetty.truststore=/usr/local/program/azkaban/keystore jetty.trustpassword=azkaban # Where the Azkaban web server is located #azkaban.webserver.url=http://localhost:8081 azkaban.webserver.url=http://localhost:8443 # Azkaban mysql settings by default. Users should configure their own username and password. database.type=mysql mysql.port=3306 mysql.host=localhost mysql.database=azkaban mysql.user=azkaban mysql.password=azkaban mysql.numconnections=100</code></p>
<p><strong>添加插件</strong></p>
<blockquote>
<p>将编译后的C文件execute-as-user.c拷贝到azkaban-exec-server-0.1.0-SNAPSHOT/plugins/jobtypes目录</p>
</blockquote>
<p>bash</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>cp az-exec-util/src/main/c/execute-as-user.c /usr/local/program/azkaban/azkaban-exec-server-0.1.0-SNAPSHOT/plugins/jobtypes</code></p>
<p>生成execute-as-user</p>
<p>bash</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>cd azkaban-exec-server-0.1.0-SNAPSHOT/plugins/jobtypes [root@administrator jobtypes]# yum -y install gcc-c++ [root@administrator jobtypes]# gcc execute-as-user.c  -o execute-as-user [root@administrator jobtypes]# ls commonprivate.properties  execute-as-user  execute-as-user.c [root@administrator jobtypes]# chown root execute‐as‐user [root@administrator jobtypes]# chmod 6050 execute-as-user [root@administrator jobtypes]# ll 总用量 24 -rw-rw-r-- 1 root root    44 5月  31 2019 commonprivate.properties ---Sr-s--- 1 root root 13536 3月  12 15:33 execute-as-user -rw-r--r-- 1 root root  3976 3月  12 15:30 execute-as-user.c</code></p>
<p>修改配置文件</p>
<p>bash</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>vim commonprivate.properties  # set execute-as-user execute.as.user=false # 关闭内存检测 memCheck.enabled=false # 指定插件存放目录 azkaban.native.lib=/usr/local/program/azkaban/azkaban-exec-server-0.1.0-SNAPSHOT/plugins/jobtypes</code></p>
<h2 id="启动服务">启动服务<a hidden class="anchor" aria-hidden="true" href="#启动服务">#</a></h2>
<p>启动<code>azkaban exec server</code></p>
<p>bash</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>cd azkaban-exec-server-0.1.0-SNAPSHOT bin/start-exec.sh  [root@administrator azkaban-src]# jps 24655 AzkabanExecutorServer # 当azkaban-exec-server-0.1.0-SNAPSHOT目录下出现executor.port文件，说明启动成功 [root@administrator azkaban-exec-server-0.1.0-SNAPSHOT]# ls bin  conf  currentpid  executions  executor.port  executorServerLog__2022-03-12+15:57:50.out  lib  logs  plugins  projects  temp</code></p>
<p>激活<code>exec-server</code></p>
<p>bash</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>[root@administrator azkaban-exec-server-0.1.0-SNAPSHOT]# curl -G &quot;node01:$(&lt;./executor.port)/executor?action=activate&quot; &amp;&amp; echo {&quot;status&quot;:&quot;success&quot;}</code></p>
<p>启动<code>azkaban-web-server</code></p>
<p>bash</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>cd azkaban-web-server-0.1.0-SNAPSHOT/ bin/start-web.sh  [root@administrator azkaban-src]# jps 11146 AzkabanWebServer</code></p>
<h2 id="访问web-1">访问Web<a hidden class="anchor" aria-hidden="true" href="#访问web-1">#</a></h2>
<p>浏览器访问<code>IP:8443</code> <img loading="lazy" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7162ed73aa224720bd5dc36b7b57d3a8~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="在这里插入图片描述"  />
</p>
<p>注意：<code>放行端口or关闭防火墙</code></p>
<p>bash</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>systemctl stop firewalld.service</code></p>
<h2 id="使用测试">使用测试<a hidden class="anchor" aria-hidden="true" href="#使用测试">#</a></h2>
<p>将<code>单服务模式下的Job资源上传进行测试</code> <img loading="lazy" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7d5faf9264dc457fb3dfb0e0263b0a90~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="在这里插入图片描述"  />
</p>
<h1 id="任务提交与执行">任务提交与执行<a hidden class="anchor" aria-hidden="true" href="#任务提交与执行">#</a></h1>
<h2 id="command类型">Command类型<a hidden class="anchor" aria-hidden="true" href="#command类型">#</a></h2>
<p><strong>1.单一Job的使用</strong></p>
<p>python</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>1.创建 Job 描述文件 2.将job资源文件打包成zip文件 3.创建工程并上传zip压缩包 4.启动工作流flow，执行job</code></p>
<p>创建 Job 描述文件 <code>vim test.job</code></p>
<p>bash</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>type=command command=echo &quot;hello world&quot;</code></p>
<p><strong>2.多Job的使用</strong></p>
<p>python</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>1.创建有依赖关系的多个job描述 2.将所有job资源文件打到一个zip包中 3.创建工程并上传zip压缩包 4.启动工作流flow，执行job</code></p>
<p>创建 Job 描述文件 <code>vim test1.job</code></p>
<p>bash</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>type=command command=echo &quot;test1 hello world&quot;</code></p>
<p>创建 Job 描述文件 <code>vim test2.job</code></p>
<p>bash</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>type=command command=echo &quot;test2 hello world&quot; dependencies=test1</code></p>
<p>上传后执行时显示依赖关系 <img loading="lazy" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c548754726a44c0ba40122d78bfd548c~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="在这里插入图片描述"  />
 执行过程与结果 <img loading="lazy" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2ea04d353e0c40dda9a5ba0e8a7d4d40~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="在这里插入图片描述"  />
</p>
<h2 id="定时任务">定时任务<a hidden class="anchor" aria-hidden="true" href="#定时任务">#</a></h2>
<blockquote>
<p>Azkaban的scheduler功能可以实现对作业任务进行定时调度功能 <img loading="lazy" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b4e9883b84324d75a96fde3d29ec6cd6~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="在这里插入图片描述"  />
 <img loading="lazy" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ed574ba9bf66451ba31ba9316c111104~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="在这里插入图片描述"  />
</p>
</blockquote>
<h2 id="hdfs操作任务">HDFS操作任务<a hidden class="anchor" aria-hidden="true" href="#hdfs操作任务">#</a></h2>
<p>python</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>1.创建job描述文件 2.将job资源文件打包成zip文件 3.创建project并上传job压缩包 4.启动执行该job</code></p>
<p><code>vim hdfs.job</code></p>
<p>bash</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>type=command command=/usr/local/program/hadoop/bin/hdfs dfs -mkdir /azkaban</code></p>
<p><img loading="lazy" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b0b6dc763eba4eb0948f587c1ea87f30~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="在这里插入图片描述"  />
</p>
<p>执行后查看HDFS</p>
<p>bash</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>[root@administrator hadoop]# hdfs dfs -ls / Found 6 items drwxr-xr-x   - root supergroup          0 2022-03-12 18:37 /azkaban</code></p>
<h2 id="mapreduce任务">MapReduce任务<a hidden class="anchor" aria-hidden="true" href="#mapreduce任务">#</a></h2>
<p>1.下载<code>/usr/local/program/hadoop/share/hadoop/mapreduce/hadoop-mapreduce-examples-3.3.2.jar</code>文件</p>
<p>2.创建job描述文件 <code>vim mr.job</code></p>
<p>bash</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>type=command command=/usr/local/program/hadoop/bin/hadoop jar hadoop-mapreduce-examples-3.3.2.jar pi 3 5</code></p>
<p>3.将所有job资源文件( <code>vim mr.job</code>、<code>hadoop-mapreduce-examples-3.3.2.jar</code>)打到一个zip压缩包中</p>
<p>4.创建工程并上传zip包，启动job <img loading="lazy" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d95f12dd97d8430c8df81af9720a018e~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="在这里插入图片描述"  />
</p>
<h2 id="hive-脚本任务">Hive 脚本任务<a hidden class="anchor" aria-hidden="true" href="#hive-脚本任务">#</a></h2>
<p>1.准备Hive脚本： <code>hive.sql</code></p>
<p>bash</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>create database if not exists dbazkaban; use dbazkaban; create table if not exists tbazkaban(id string,name string) row format delimited fields terminated by '\t';</code></p>
<p>2.创建job描述文件 <code>hive.job</code></p>
<p>bash</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>type=command command=/usr/local/program/hive/bin/hive -f 'hive.sql'</code></p>
<p>3.将所有job资源文件打到一个zip包中</p>
<p>4.创建工程并上传zip包，启动job <img loading="lazy" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d6aea6e3f3c34166aa1d7ab8a80bb0de~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="在这里插入图片描述"  />
</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/hadoop/">Hadoop</a></li>
      <li><a href="http://localhost:1313/tags/java/">Java</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://localhost:1313/posts/juejin/9%E5%B9%B4%E8%B0%B7%E6%AD%8Cl6%E8%80%81%E5%91%98%E5%B7%A5%E6%AF%85%E7%84%B6%E7%A6%BB%E8%81%8C%E9%92%B1%E5%A4%9A%E4%BD%86%E6%99%8B%E5%8D%87%E6%97%A0%E6%9C%9B%E5%AF%B9%E6%8A%80%E6%9C%AF%E4%B9%9F%E7%A5%9B%E9%AD%85%E4%BA%86/">
    <span class="title">« 上一页</span>
    <br>
    <span>9年谷歌L6老员工毅然离职：钱多但晋升无望，对技术也祛魅了</span>
  </a>
  <a class="next" href="http://localhost:1313/posts/juejin/%E6%9C%80%E7%AE%80rxjs%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B--%E5%88%AB%E5%86%8D%E8%A2%ABrxjs%E7%9A%84%E6%A6%82%E5%BF%B5%E6%B7%B9%E6%B2%A1%E4%BA%86/">
    <span class="title">下一页 »</span>
    <br>
    <span>最简Rxjs入门教程--别再被Rxjs的概念淹没了</span>
  </a>
</nav>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 任务调度器之Azkaban的使用 on x"
            href="https://x.com/intent/tweet/?text=%e4%bb%bb%e5%8a%a1%e8%b0%83%e5%ba%a6%e5%99%a8%e4%b9%8bAzkaban%e7%9a%84%e4%bd%bf%e7%94%a8&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E4%25BB%25BB%25E5%258A%25A1%25E8%25B0%2583%25E5%25BA%25A6%25E5%2599%25A8%25E4%25B9%258Bazkaban%25E7%259A%2584%25E4%25BD%25BF%25E7%2594%25A8%2f&amp;hashtags=Hadoop%2cJava">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 任务调度器之Azkaban的使用 on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E4%25BB%25BB%25E5%258A%25A1%25E8%25B0%2583%25E5%25BA%25A6%25E5%2599%25A8%25E4%25B9%258Bazkaban%25E7%259A%2584%25E4%25BD%25BF%25E7%2594%25A8%2f&amp;title=%e4%bb%bb%e5%8a%a1%e8%b0%83%e5%ba%a6%e5%99%a8%e4%b9%8bAzkaban%e7%9a%84%e4%bd%bf%e7%94%a8&amp;summary=%e4%bb%bb%e5%8a%a1%e8%b0%83%e5%ba%a6%e5%99%a8%e4%b9%8bAzkaban%e7%9a%84%e4%bd%bf%e7%94%a8&amp;source=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E4%25BB%25BB%25E5%258A%25A1%25E8%25B0%2583%25E5%25BA%25A6%25E5%2599%25A8%25E4%25B9%258Bazkaban%25E7%259A%2584%25E4%25BD%25BF%25E7%2594%25A8%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 任务调度器之Azkaban的使用 on reddit"
            href="https://reddit.com/submit?url=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E4%25BB%25BB%25E5%258A%25A1%25E8%25B0%2583%25E5%25BA%25A6%25E5%2599%25A8%25E4%25B9%258Bazkaban%25E7%259A%2584%25E4%25BD%25BF%25E7%2594%25A8%2f&title=%e4%bb%bb%e5%8a%a1%e8%b0%83%e5%ba%a6%e5%99%a8%e4%b9%8bAzkaban%e7%9a%84%e4%bd%bf%e7%94%a8">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 任务调度器之Azkaban的使用 on facebook"
            href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E4%25BB%25BB%25E5%258A%25A1%25E8%25B0%2583%25E5%25BA%25A6%25E5%2599%25A8%25E4%25B9%258Bazkaban%25E7%259A%2584%25E4%25BD%25BF%25E7%2594%25A8%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 任务调度器之Azkaban的使用 on whatsapp"
            href="https://api.whatsapp.com/send?text=%e4%bb%bb%e5%8a%a1%e8%b0%83%e5%ba%a6%e5%99%a8%e4%b9%8bAzkaban%e7%9a%84%e4%bd%bf%e7%94%a8%20-%20http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E4%25BB%25BB%25E5%258A%25A1%25E8%25B0%2583%25E5%25BA%25A6%25E5%2599%25A8%25E4%25B9%258Bazkaban%25E7%259A%2584%25E4%25BD%25BF%25E7%2594%25A8%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 任务调度器之Azkaban的使用 on telegram"
            href="https://telegram.me/share/url?text=%e4%bb%bb%e5%8a%a1%e8%b0%83%e5%ba%a6%e5%99%a8%e4%b9%8bAzkaban%e7%9a%84%e4%bd%bf%e7%94%a8&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E4%25BB%25BB%25E5%258A%25A1%25E8%25B0%2583%25E5%25BA%25A6%25E5%2599%25A8%25E4%25B9%258Bazkaban%25E7%259A%2584%25E4%25BD%25BF%25E7%2594%25A8%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 任务调度器之Azkaban的使用 on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=%e4%bb%bb%e5%8a%a1%e8%b0%83%e5%ba%a6%e5%99%a8%e4%b9%8bAzkaban%e7%9a%84%e4%bd%bf%e7%94%a8&u=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E4%25BB%25BB%25E5%258A%25A1%25E8%25B0%2583%25E5%25BA%25A6%25E5%2599%25A8%25E4%25B9%258Bazkaban%25E7%259A%2584%25E4%25BD%25BF%25E7%2594%25A8%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span><a href="https://beian.miit.gov.cn/">粤ICP备2023039897号-1</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = '复制';

        function copyingDone() {
            copybutton.innerHTML = '已复制！';
            setTimeout(() => {
                copybutton.innerHTML = '复制';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
