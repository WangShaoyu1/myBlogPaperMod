<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>给你的ReactNative库添加Example | PaperMod</title>
<meta name="keywords" content="ReactNative, Debug">
<meta name="description" content="你为ReactNative制作了一个闪亮的新库，现在该向全世界展示它。但是您需要添加一个示例应用程序，以便人们可以在安装之前进行尝试。有一个示例程序也能让你在开发时测试。这看起来很简单，真的是吗？不幸的是，它不是那么简单，并且可能会非常具有挑战性。我将描述我使用的过程，也许…">
<meta name="author" content="紫升">
<link rel="canonical" href="http://localhost:1313/posts/juejin/%E7%BB%99%E4%BD%A0%E7%9A%84reactnative%E5%BA%93%E6%B7%BB%E5%8A%A0example/">
<meta name="google-site-verification" content="XYZabc">
<link crossorigin="anonymous" href="/assets/css/stylesheet.7b92bf4867c997b58ec50f63451b83777173d5bd5593376852abd85746d09d71.css" integrity="sha256-e5K/SGfJl7WOxQ9jRRuDd3Fz1b1VkzdoUqvYV0bQnXE=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<link rel="apple-touch-icon" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<link rel="mask-icon" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="zh" href="http://localhost:1313/posts/juejin/%E7%BB%99%E4%BD%A0%E7%9A%84reactnative%E5%BA%93%E6%B7%BB%E5%8A%A0example/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript><meta property="og:title" content="给你的ReactNative库添加Example" />
<meta property="og:description" content="你为ReactNative制作了一个闪亮的新库，现在该向全世界展示它。但是您需要添加一个示例应用程序，以便人们可以在安装之前进行尝试。有一个示例程序也能让你在开发时测试。这看起来很简单，真的是吗？不幸的是，它不是那么简单，并且可能会非常具有挑战性。我将描述我使用的过程，也许…" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/posts/juejin/%E7%BB%99%E4%BD%A0%E7%9A%84reactnative%E5%BA%93%E6%B7%BB%E5%8A%A0example/" />
<meta property="og:image" content="http://localhost:1313/images/papermod-cover.png" />
<meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-01-31T00:00:00+00:00" />
<meta property="article:modified_time" content="2021-01-31T00:00:00+00:00" />


<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="http://localhost:1313/images/papermod-cover.png" />
<meta name="twitter:title" content="给你的ReactNative库添加Example"/>
<meta name="twitter:description" content="你为ReactNative制作了一个闪亮的新库，现在该向全世界展示它。但是您需要添加一个示例应用程序，以便人们可以在安装之前进行尝试。有一个示例程序也能让你在开发时测试。这看起来很简单，真的是吗？不幸的是，它不是那么简单，并且可能会非常具有挑战性。我将描述我使用的过程，也许…"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "给你的ReactNative库添加Example",
      "item": "http://localhost:1313/posts/juejin/%E7%BB%99%E4%BD%A0%E7%9A%84reactnative%E5%BA%93%E6%B7%BB%E5%8A%A0example/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "给你的ReactNative库添加Example",
  "name": "给你的ReactNative库添加Example",
  "description": "你为ReactNative制作了一个闪亮的新库，现在该向全世界展示它。但是您需要添加一个示例应用程序，以便人们可以在安装之前进行尝试。有一个示例程序也能让你在开发时测试。这看起来很简单，真的是吗？不幸的是，它不是那么简单，并且可能会非常具有挑战性。我将描述我使用的过程，也许…",
  "keywords": [
    "ReactNative", "Debug"
  ],
  "articleBody": " 本文翻译自 Adding an example app to your React Native library,也夹杂了一些私货，如有帮助，请不吝点赞。\n你为React Native制作了一个闪亮的新库，现在该向全世界展示它。但是您需要添加一个示例应用程序，以便人们可以在安装之前进行尝试。有一个示例程序也能让你在开发时测试。这看起来很简单，真的是吗？\n不幸的是，它不是那么简单，并且可能会非常具有挑战性。我将描述我使用的过程，也许会对您有所帮助。请注意，我将仅介绍JS库。如果你的仓库有原生代码，这篇文章仍旧非常有用，但是你需要额外的步骤——将原生代码桥接到 app。\n为什么很难？ 在探讨解决方案之前，让我们讨论一下为什么如此困难。 React Native使用了一个名为 Metro Bundler 的自定义打包器来捆绑您的JavaScript代码和一个名为 haste 的模块解析机制。\nMetro 速度非常快，非常适合大型代码库。但是现在它有一些让写一个示例 app 有些困难的限制：\n我们不能使用 symlinks，因为 Metro Bundler 使用 watchman 并不支持 symlinks。 我们不能导入当前目录外的模块。 当遇到两个具有相同名称的模块时，Example 就无法运行。这很容易遇到，因为我们将为开发和示例安装相同的模块。 私货：因为 react native 不支持 symlinks，所以 npm link 也是不可用的。在 使用 wml 进行 npm 模块调试真香 中可以对此问题有更深入了解。\n但是你知道吗？实际上，可以配置打包程序，以便我们可以解决示例应用程序的限制。然后配置属性并没有任何文档，而且 Metro Bundler 现在并不是个成熟的工具，除非你足够了解她，否则配置起来十分困难。\n私货：Metro Bundler 先前负责 tree-shaking 的老哥 @rafeca、@mjesun 从 Facebook 离职了，tree-shaking 就成了至今未支持的特性，见 Tree shaking while bundling，可以想见 Facebook 也缺人，如果哪位大佬可以搞定这些问题，可以试试入职 Facebook。\n当下，我们能做什么？ 这里，我们假设你使用 Expo 作为 example。为什么是 Expo？因为这对你来说非常容易开发，而且它的导出示例的方式简单到令人难以置信。但是，我还将为那些不想/不能使用Expo的人提供说明（以防你的代码库包含原生代码）。\n下面是我的项目的目录结构，也是社区常见的：\nsh\n代码解读\n复制代码\n. ├── example ├── package.json └── src └── index.js\n我们的库放在 src 文件夹下，example 应用（一个 Expo 应用或 React Native app）放在 example/ 文件夹下。\n接下来，我们可以使用 exp init example 或者 react-native init example 来初始化项目。（国内的 Expo 服务巨慢，科学上网也慢，不建议使用）。\n配置 Babel 我们需要将我们的库添加为 example 的依赖项。我非常幼稚地添加库作为 file: 依赖，这是有效的。但是当你修改一些东西，你要每次都记得重新安装，这很蠢不是吗？\n此外，npm@5 将 file: 依赖项作为符号链接安装，前面我们提到，React Native Packager 并不支持符号链接。\n如果我们可以像对 Webpack 那样对库起别名该怎么办？答案是 babel-plugin-module-resolver！\n首先安装插件：\nsh\n代码解读\n复制代码\nyarn add -D babel-plugin-module-resolver\n然后配置 babel.config.js：\njs\n代码解读\n复制代码\nmodule.exports = { ... plugins: [ [ \"module-resolver\", { \"alias\": { \"name-of-my-library\": \"..\" } } ] ] }\n这很简单，但是难点是我们还需要接着配置 Metro Bundler\n配置 Metro Bundler Metro Packager 使用特定的配置文件 metro.config.js（老版是 rn-cli.config.js）。让我们创建这个文件并复制下面的内容：\njs\n代码解读\n复制代码\nconst path = require('path'); const root = path.resolve(__dirname, '..'); module.exports = { projectRoot: __dirname, watchFolders: [root], };\n这告诉打包程序将项目根目录设置为当前目录（example 文件夹）并且监听父目录。这让我们可以从父目录引用模块。\n不幸的是，我们无法引入父目录中的 node_modules 模块，因此我们不得不在 example 中重复安装模块。\n假设我们有 lodash 和 prop-types 模块作为库的依赖项，我们现在需要将它们安装在 example 文件夹中。\nsh\n代码解读\n复制代码\nyarn add lodash prop-types\n我们需要配置 extraNodeModules resolver 来识别这些库：\njs\n代码解读\n复制代码\nconst path = require('path'); const root = path.resolve(__dirname, '..'); module.exports = { projectRoot: __dirname, watchFolders: [root], resolver: { extraNodeModules: modules.reduce((acc, name) =\u003e { acc[name] = path.join(__dirname, 'node_modules', name); return acc; }, {}), }, };\n我们还需要将父目录的 node_modules 列入黑名单，否则打包程序将抱怨重复的模块。让我们安装 escape-string-regexp 软件包，然后更新配置。\nsh\n代码解读\n复制代码\nyarn add -D escape-string-regexp\njs\n代码解读\n复制代码\n// metro.config.js const path = require('path'); const blacklist = require('metro-config/src/defaults/blacklist'); const escape = require('escape-string-regexp'); const pkg = require('../package.json'); const root = path.resolve(__dirname, '..'); const modules = [ // 导致重复包的模块可以加在这里 ...Object.keys({ ...pkg.dependencies, ...pkg.peerDependencies, }), ]; module.exports = { projectRoot: __dirname, watchFolders: [root], resolver: { blacklistRE: blacklist([ new RegExp(`^${escape(path.join(root, 'node_modules'))}\\\\/.*$`), ]), extraNodeModules: modules.reduce((acc, name) =\u003e { acc[name] = path.join(__dirname, 'node_modules', name); return acc; }, {}), }, };\n如果你使用旧版的 Metro（比如 React Native 版本小于 0.55），这个配置文件看起来是这样的：\njs\n代码解读\n复制代码\nconst path = require('path'); const blacklist = require('metro/src/blacklist'); const pkg = require('../package.json'); const modules = [ // 导致重复包的模块可以加在这里 ...Object.keys({ ...pkg.dependencies, ...pkg.peerDependencies, }), ]; module.exports = { getProjectRoots() { return [__dirname, path.resolve(__dirname, '..')]; }, getProvidesModuleNodeModules() { return modules; }, getBlacklistRE() { return blacklist([ new RegExp( `^${escape(path.resolve(__dirname, '..', 'node_modules'))}\\/.*$` ), ]); }, };\n注意，如果你的项目里有其他的 node_modules（比如 docs 中的），你可能也要把它填到黑名单中。\n如果你使用了 expo，添加下面的配置到 exp.json：\njson\n代码解读\n复制代码\n\"packagerOpts\": { \"config\": \"./metro.config.js\", // projectRoots 需要设置为空字符串来覆盖 Expo 默认的配置 \"projectRoots\": \"\" }\n你可以参考 react-native-tab-view 和 tuya-panel-kit 的 example 写法。另外 react-native-builder-bob 这个脚手架也是基于相同的原理。感兴趣的可以上手把玩把玩。\n涂鸦智能大量优质 HC，欢迎大家加入，需要内推加我微信 yang_jun_ning，或直接发简历到邮箱 youngjuning@aliyun.com\n",
  "wordCount" : "431",
  "inLanguage": "zh",
  "image": "http://localhost:1313/images/papermod-cover.png","datePublished": "2021-01-31T00:00:00Z",
  "dateModified": "2021-01-31T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "紫升"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/posts/juejin/%E7%BB%99%E4%BD%A0%E7%9A%84reactnative%E5%BA%93%E6%B7%BB%E5%8A%A0example/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "PaperMod",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/%3Clink%20/%20abs%20url%3E"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Home (Alt + H)">
                        
                    <img src="http://localhost:1313/images/msg_hu15231257772499651944.png" alt="" aria-label="logo"
                        height="20">Home</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/archives" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="https://github.com/adityatelange/hugo-PaperMod/wiki/" title="WiKi">
                    <span>WiKi</span>&nbsp;
                    <svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12">
                        <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path>
                        <path d="M15 3h6v6"></path>
                        <path d="M10 14L21 3"></path>
                    </svg>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/">主页</a>&nbsp;»&nbsp;<a href="http://localhost:1313/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      给你的ReactNative库添加Example
    </h1>
    <div class="post-description">
      你为ReactNative制作了一个闪亮的新库，现在该向全世界展示它。但是您需要添加一个示例应用程序，以便人们可以在安装之前进行尝试。有一个示例程序也能让你在开发时测试。这看起来很简单，真的是吗？不幸的是，它不是那么简单，并且可能会非常具有挑战性。我将描述我使用的过程，也许…
    </div>
    <div class="post-meta"><span title='2021-01-31 00:00:00 +0000 UTC'>一月 31, 2021</span>&nbsp;·&nbsp;3 分钟&nbsp;·&nbsp;紫升&nbsp;|&nbsp;<a href="https://github.com/WangShaoyu1/myBlogPaperMod/tree/master/content/posts/jueJin/%e7%bb%99%e4%bd%a0%e7%9a%84ReactNative%e5%ba%93%e6%b7%bb%e5%8a%a0Example.md" rel="noopener noreferrer" target="_blank">Suggest Changes</a>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">目录</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e4%b8%ba%e4%bb%80%e4%b9%88%e5%be%88%e9%9a%be" aria-label="为什么很难？">为什么很难？</a></li>
                <li>
                    <a href="#%e5%bd%93%e4%b8%8b%e6%88%91%e4%bb%ac%e8%83%bd%e5%81%9a%e4%bb%80%e4%b9%88" aria-label="当下，我们能做什么？">当下，我们能做什么？</a></li>
                <li>
                    <a href="#%e9%85%8d%e7%bd%ae-babel" aria-label="配置 Babel">配置 Babel</a></li>
                <li>
                    <a href="#%e9%85%8d%e7%bd%ae-metro-bundler" aria-label="配置 Metro Bundler">配置 Metro Bundler</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><blockquote>
<p>本文翻译自 <a href="https://link.juejin.cn?target=https%3A%2F%2Fcallstack.com%2Fblog%2Fadding-an-example-app-to-your-react-native-library%2F" title="https://callstack.com/blog/adding-an-example-app-to-your-react-native-library/">Adding an example app to your React Native library</a>,也夹杂了一些私货，如有帮助，请不吝点赞。</p>
</blockquote>
<p>你为React Native制作了一个闪亮的新库，现在该向全世界展示它。但是您需要添加一个示例应用程序，以便人们可以在安装之前进行尝试。有一个示例程序也能让你在开发时测试。这看起来很简单，真的是吗？</p>
<p>不幸的是，它不是那么简单，并且可能会非常具有挑战性。我将描述我使用的过程，也许会对您有所帮助。请注意，我将仅介绍JS库。如果你的仓库有原生代码，这篇文章仍旧非常有用，但是你需要额外的步骤——将原生代码桥接到 app。</p>
<p><img loading="lazy" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/922b6f418a354847b390186ca16448f8~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt=""  />
</p>
<h2 id="为什么很难">为什么很难？<a hidden class="anchor" aria-hidden="true" href="#为什么很难">#</a></h2>
<p>在探讨解决方案之前，让我们讨论一下为什么如此困难。 React Native使用了一个名为 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffacebook%2Fmetro-bundler" title="https://github.com/facebook/metro-bundler">Metro Bundler</a> 的自定义打包器来捆绑您的JavaScript代码和一个名为 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fjest-haste-map" title="https://www.npmjs.com/package/jest-haste-map">haste</a> 的模块解析机制。</p>
<p>Metro 速度非常快，非常适合大型代码库。但是现在它有一些让写一个示例 app 有些困难的限制：</p>
<ul>
<li>我们不能使用 symlinks，因为 Metro Bundler 使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Ffacebook.github.io%2Fwatchman%2F" title="https://facebook.github.io/watchman/">watchman</a> 并<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffacebook%2Freact-native%2Fissues%2F637" title="https://github.com/facebook/react-native/issues/637">不支持</a> symlinks。</li>
<li>我们不能导入当前目录外的模块。</li>
<li>当遇到两个具有相同名称的模块时，Example 就无法运行。这很容易遇到，因为我们将为开发和示例安装相同的模块。</li>
</ul>
<blockquote>
<p>私货：因为 react native 不支持 symlinks，所以 <code>npm link</code> 也是不可用的。在 <a href="https://juejin.cn/post/6847902225356980232" title="https://juejin.cn/post/6847902225356980232">使用 wml 进行 npm 模块调试真香</a> 中可以对此问题有更深入了解。</p>
</blockquote>
<p>但是你知道吗？实际上，可以配置打包程序，以便我们可以解决示例应用程序的限制。然后配置属性并没有任何文档，而且 Metro Bundler 现在并不是个成熟的工具，除非你足够了解她，否则配置起来十分困难。</p>
<blockquote>
<p>私货：Metro Bundler 先前负责 tree-shaking 的老哥 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Frafeca" title="https://github.com/rafeca">@rafeca</a>、<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmjesun" title="https://github.com/mjesun">@mjesun</a> 从 Facebook 离职了，tree-shaking 就成了至今未支持的特性，见 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffacebook%2Fmetro%2Fissues%2F227%23issuecomment-583358386" title="https://github.com/facebook/metro/issues/227#issuecomment-583358386">Tree shaking while bundling</a>，可以想见 Facebook 也缺人，如果哪位大佬可以搞定这些问题，可以试试入职 Facebook。</p>
</blockquote>
<h2 id="当下我们能做什么">当下，我们能做什么？<a hidden class="anchor" aria-hidden="true" href="#当下我们能做什么">#</a></h2>
<p>这里，我们假设你使用 Expo 作为 example。为什么是 Expo？因为这对你来说非常容易开发，而且它的导出示例的方式简单到令人难以置信。但是，我还将为那些不想/不能使用Expo的人提供说明（以防你的代码库包含原生代码）。</p>
<p>下面是我的项目的目录结构，也是社区常见的：</p>
<p>sh</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>. ├── example ├── package.json └── src     └── index.js</code></p>
<p>我们的库放在 <code>src</code> 文件夹下，example 应用（一个 Expo 应用或 React Native app）放在 <code>example/</code> 文件夹下。</p>
<p>接下来，我们可以使用 <code>exp init example</code> 或者 <code>react-native init example</code> 来初始化项目。（国内的 Expo 服务巨慢，科学上网也慢，不建议使用）。</p>
<h2 id="配置-babel">配置 Babel<a hidden class="anchor" aria-hidden="true" href="#配置-babel">#</a></h2>
<p>我们需要将我们的库添加为 example 的依赖项。我非常幼稚地添加库作为 <code>file:</code> 依赖，这是有效的。但是当你修改一些东西，你要每次都记得重新安装，这很蠢不是吗？</p>
<p>此外，<code>npm@5</code> 将 <code>file:</code> 依赖项作为符号链接安装，前面我们提到，React Native Packager 并不支持符号链接。</p>
<p>如果我们可以像对 Webpack 那样对库起别名该怎么办？答案是 <code>babel-plugin-module-resolver</code>！</p>
<p>首先安装插件：</p>
<p>sh</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>yarn add -D babel-plugin-module-resolver</code></p>
<p>然后配置 <code>babel.config.js</code>：</p>
<p>js</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>module.exports = {   ...   plugins: [     [       &quot;module-resolver&quot;, {         &quot;alias&quot;: {           &quot;name-of-my-library&quot;: &quot;..&quot;         }       }     ]   ] }</code></p>
<p>这很简单，但是难点是我们还需要接着配置 Metro Bundler</p>
<h2 id="配置-metro-bundler">配置 Metro Bundler<a hidden class="anchor" aria-hidden="true" href="#配置-metro-bundler">#</a></h2>
<p>Metro Packager 使用特定的配置文件 <code>metro.config.js</code>（老版是 <code>rn-cli.config.js</code>）。让我们创建这个文件并复制下面的内容：</p>
<p>js</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>const path = require('path'); const root = path.resolve(__dirname, '..'); module.exports = {   projectRoot: __dirname,   watchFolders: [root], };</code></p>
<p>这告诉打包程序将项目根目录设置为当前目录（example 文件夹）并且监听父目录。这让我们可以从父目录引用模块。</p>
<p>不幸的是，我们无法引入父目录中的 <code>node_modules</code> 模块，因此我们不得不在 example 中重复安装模块。</p>
<p>假设我们有 <code>lodash</code> 和 <code>prop-types</code> 模块作为库的依赖项，我们现在需要将它们安装在 example 文件夹中。</p>
<p>sh</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>yarn add lodash prop-types</code></p>
<p>我们需要配置 <code>extraNodeModules</code> resolver 来识别这些库：</p>
<p>js</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>const path = require('path'); const root = path.resolve(__dirname, '..'); module.exports = {   projectRoot: __dirname,   watchFolders: [root],   resolver: {     extraNodeModules: modules.reduce((acc, name) =&gt; {       acc[name] = path.join(__dirname, 'node_modules', name);       return acc;     }, {}),   }, };</code></p>
<p>我们还需要将父目录的 <code>node_modules</code> 列入黑名单，否则打包程序将抱怨重复的模块。让我们安装 <code>escape-string-regexp</code> 软件包，然后更新配置。</p>
<p>sh</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>yarn add -D escape-string-regexp</code></p>
<p>js</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>// metro.config.js const path = require('path'); const blacklist = require('metro-config/src/defaults/blacklist'); const escape = require('escape-string-regexp'); const pkg = require('../package.json'); const root = path.resolve(__dirname, '..'); const modules = [   // 导致重复包的模块可以加在这里   ...Object.keys({     ...pkg.dependencies,     ...pkg.peerDependencies,   }), ]; module.exports = {   projectRoot: __dirname,   watchFolders: [root],   resolver: {     blacklistRE: blacklist([       new RegExp(`^${escape(path.join(root, 'node_modules'))}\\/.*$`),     ]),     extraNodeModules: modules.reduce((acc, name) =&gt; {       acc[name] = path.join(__dirname, 'node_modules', name);       return acc;     }, {}),   }, };</code></p>
<p>如果你使用旧版的 Metro（比如 React Native 版本小于 0.55），这个配置文件看起来是这样的：</p>
<p>js</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>const path = require('path'); const blacklist = require('metro/src/blacklist'); const pkg = require('../package.json'); const modules = [   // 导致重复包的模块可以加在这里   ...Object.keys({     ...pkg.dependencies,     ...pkg.peerDependencies,   }), ]; module.exports = {   getProjectRoots() {     return [__dirname, path.resolve(__dirname, '..')];   },   getProvidesModuleNodeModules() {     return modules;   },   getBlacklistRE() {     return blacklist([       new RegExp(         `^${escape(path.resolve(__dirname, '..', 'node_modules'))}\/.*$`       ),     ]);   }, };</code></p>
<p>注意，如果你的项目里有其他的 <code>node_modules</code>（比如 <code>docs</code> 中的），你可能也要把它填到黑名单中。</p>
<p>如果你使用了 <code>expo</code>，添加下面的配置到 <code>exp.json</code>：</p>
<p>json</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>&quot;packagerOpts&quot;: {   &quot;config&quot;: &quot;./metro.config.js&quot;,   // projectRoots 需要设置为空字符串来覆盖 Expo 默认的配置   &quot;projectRoots&quot;: &quot;&quot; }</code></p>
<p>你可以参考 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Freact-native-community%2Freact-native-tab-view" title="https://github.com/react-native-community/react-native-tab-view">react-native-tab-view</a> 和 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftuya%2Ftuya-panel-kit" title="https://github.com/tuya/tuya-panel-kit">tuya-panel-kit</a> 的 example 写法。另外 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fcallstack%2Freact-native-builder-bob" title="https://github.com/callstack/react-native-builder-bob">react-native-builder-bob</a> 这个脚手架也是基于相同的原理。感兴趣的可以上手把玩把玩。</p>
<blockquote>
<p>涂鸦智能大量优质 HC，欢迎大家加入，需要内推加我微信 yang_jun_ning，或直接发简历到邮箱 <a href="https://link.juejin.cn?target=mailto%3Ayoungjuning%40aliyun.com" title="mailto:youngjuning@aliyun.com">youngjuning@aliyun.com</a></p>
</blockquote>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/reactnative/">ReactNative</a></li>
      <li><a href="http://localhost:1313/tags/debug/">Debug</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://localhost:1313/posts/juejin/es2019es2020es2021es2022%E7%89%B9%E6%80%A7%E5%A4%A7%E6%B1%87%E6%80%BB2021-12-10%E6%9B%B4%E6%96%B0/">
    <span class="title">« 上一页</span>
    <br>
    <span>ES2019、ES2020、ES2021、ES2022特性大汇总【2021-12-10更新】</span>
  </a>
  <a class="next" href="http://localhost:1313/posts/juejin/%E8%8A%B1%E4%BA%86%E4%B8%80%E5%A4%A9%E6%97%B6%E9%97%B4%E5%B8%AE%E8%B4%A2%E5%8A%A1%E6%9C%8B%E5%8F%8B%E5%BC%80%E5%8F%91%E4%BA%86%E4%B8%80%E4%B8%AA%E5%AE%9E%E7%94%A8%E5%B0%8F%E5%B7%A5%E5%85%B7/">
    <span class="title">下一页 »</span>
    <br>
    <span>花了一天时间帮财务朋友开发了一个实用小工具</span>
  </a>
</nav>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 给你的ReactNative库添加Example on x"
            href="https://x.com/intent/tweet/?text=%e7%bb%99%e4%bd%a0%e7%9a%84ReactNative%e5%ba%93%e6%b7%bb%e5%8a%a0Example&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E7%25BB%2599%25E4%25BD%25A0%25E7%259A%2584reactnative%25E5%25BA%2593%25E6%25B7%25BB%25E5%258A%25A0example%2f&amp;hashtags=ReactNative%2cDebug">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 给你的ReactNative库添加Example on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E7%25BB%2599%25E4%25BD%25A0%25E7%259A%2584reactnative%25E5%25BA%2593%25E6%25B7%25BB%25E5%258A%25A0example%2f&amp;title=%e7%bb%99%e4%bd%a0%e7%9a%84ReactNative%e5%ba%93%e6%b7%bb%e5%8a%a0Example&amp;summary=%e7%bb%99%e4%bd%a0%e7%9a%84ReactNative%e5%ba%93%e6%b7%bb%e5%8a%a0Example&amp;source=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E7%25BB%2599%25E4%25BD%25A0%25E7%259A%2584reactnative%25E5%25BA%2593%25E6%25B7%25BB%25E5%258A%25A0example%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 给你的ReactNative库添加Example on reddit"
            href="https://reddit.com/submit?url=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E7%25BB%2599%25E4%25BD%25A0%25E7%259A%2584reactnative%25E5%25BA%2593%25E6%25B7%25BB%25E5%258A%25A0example%2f&title=%e7%bb%99%e4%bd%a0%e7%9a%84ReactNative%e5%ba%93%e6%b7%bb%e5%8a%a0Example">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 给你的ReactNative库添加Example on facebook"
            href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E7%25BB%2599%25E4%25BD%25A0%25E7%259A%2584reactnative%25E5%25BA%2593%25E6%25B7%25BB%25E5%258A%25A0example%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 给你的ReactNative库添加Example on whatsapp"
            href="https://api.whatsapp.com/send?text=%e7%bb%99%e4%bd%a0%e7%9a%84ReactNative%e5%ba%93%e6%b7%bb%e5%8a%a0Example%20-%20http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E7%25BB%2599%25E4%25BD%25A0%25E7%259A%2584reactnative%25E5%25BA%2593%25E6%25B7%25BB%25E5%258A%25A0example%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 给你的ReactNative库添加Example on telegram"
            href="https://telegram.me/share/url?text=%e7%bb%99%e4%bd%a0%e7%9a%84ReactNative%e5%ba%93%e6%b7%bb%e5%8a%a0Example&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E7%25BB%2599%25E4%25BD%25A0%25E7%259A%2584reactnative%25E5%25BA%2593%25E6%25B7%25BB%25E5%258A%25A0example%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 给你的ReactNative库添加Example on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=%e7%bb%99%e4%bd%a0%e7%9a%84ReactNative%e5%ba%93%e6%b7%bb%e5%8a%a0Example&u=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E7%25BB%2599%25E4%25BD%25A0%25E7%259A%2584reactnative%25E5%25BA%2593%25E6%25B7%25BB%25E5%258A%25A0example%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span><a href="https://beian.miit.gov.cn/">粤ICP备2023039897号-1</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = '复制';

        function copyingDone() {
            copybutton.innerHTML = '已复制！';
            setTimeout(() => {
                copybutton.innerHTML = '复制';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
