<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>用Mobx许久后，常怀念起Redux的美好，而今我遇到了Natur | PaperMod</title>
<meta name="keywords" content="React.js, Redux">
<meta name="description" content="Mobx的简单随性让我着迷，但当用着用着，总在不经意间去怀念Redux，渐渐地理解了ta，我才明白约束不是过分的要求，而我现在只想从混乱中逃走，如今我遇到了Natur，才会越发地觉得合适。">
<meta name="author" content="闲D阿强">
<link rel="canonical" href="http://localhost:1313/posts/juejin/%E7%94%A8mobx%E8%AE%B8%E4%B9%85%E5%90%8E%E5%B8%B8%E6%80%80%E5%BF%B5%E8%B5%B7redux%E7%9A%84%E7%BE%8E%E5%A5%BD%E8%80%8C%E4%BB%8A%E6%88%91%E9%81%87%E5%88%B0%E4%BA%86natur/">
<meta name="google-site-verification" content="XYZabc">
<link crossorigin="anonymous" href="/assets/css/stylesheet.7b92bf4867c997b58ec50f63451b83777173d5bd5593376852abd85746d09d71.css" integrity="sha256-e5K/SGfJl7WOxQ9jRRuDd3Fz1b1VkzdoUqvYV0bQnXE=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<link rel="apple-touch-icon" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<link rel="mask-icon" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="zh" href="http://localhost:1313/posts/juejin/%E7%94%A8mobx%E8%AE%B8%E4%B9%85%E5%90%8E%E5%B8%B8%E6%80%80%E5%BF%B5%E8%B5%B7redux%E7%9A%84%E7%BE%8E%E5%A5%BD%E8%80%8C%E4%BB%8A%E6%88%91%E9%81%87%E5%88%B0%E4%BA%86natur/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript><meta property="og:title" content="用Mobx许久后，常怀念起Redux的美好，而今我遇到了Natur" />
<meta property="og:description" content="Mobx的简单随性让我着迷，但当用着用着，总在不经意间去怀念Redux，渐渐地理解了ta，我才明白约束不是过分的要求，而我现在只想从混乱中逃走，如今我遇到了Natur，才会越发地觉得合适。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/posts/juejin/%E7%94%A8mobx%E8%AE%B8%E4%B9%85%E5%90%8E%E5%B8%B8%E6%80%80%E5%BF%B5%E8%B5%B7redux%E7%9A%84%E7%BE%8E%E5%A5%BD%E8%80%8C%E4%BB%8A%E6%88%91%E9%81%87%E5%88%B0%E4%BA%86natur/" />
<meta property="og:image" content="http://localhost:1313/images/papermod-cover.png" />
<meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-11-01T00:00:00+00:00" />
<meta property="article:modified_time" content="2021-11-01T00:00:00+00:00" />


<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="http://localhost:1313/images/papermod-cover.png" />
<meta name="twitter:title" content="用Mobx许久后，常怀念起Redux的美好，而今我遇到了Natur"/>
<meta name="twitter:description" content="Mobx的简单随性让我着迷，但当用着用着，总在不经意间去怀念Redux，渐渐地理解了ta，我才明白约束不是过分的要求，而我现在只想从混乱中逃走，如今我遇到了Natur，才会越发地觉得合适。"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "用Mobx许久后，常怀念起Redux的美好，而今我遇到了Natur",
      "item": "http://localhost:1313/posts/juejin/%E7%94%A8mobx%E8%AE%B8%E4%B9%85%E5%90%8E%E5%B8%B8%E6%80%80%E5%BF%B5%E8%B5%B7redux%E7%9A%84%E7%BE%8E%E5%A5%BD%E8%80%8C%E4%BB%8A%E6%88%91%E9%81%87%E5%88%B0%E4%BA%86natur/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "用Mobx许久后，常怀念起Redux的美好，而今我遇到了Natur",
  "name": "用Mobx许久后，常怀念起Redux的美好，而今我遇到了Natur",
  "description": "Mobx的简单随性让我着迷，但当用着用着，总在不经意间去怀念Redux，渐渐地理解了ta，我才明白约束不是过分的要求，而我现在只想从混乱中逃走，如今我遇到了Natur，才会越发地觉得合适。",
  "keywords": [
    "React.js", "Redux"
  ],
  "articleBody": "Natur文档\n起初我是通过Umi了解的Redux，当时Dva就是基于Redux的，用起来说不上不好，就是有点烦，烦ta的墨迹，费劲。后来当我用上了Mobx，哇偶，ta的简单，随性让我着迷，不再拘谨，就这样我选择了Mobx，但当用着用着，总在不经意间去怀念Redux，渐渐地理解了ta，我才明白约束不是过分的要求，而我现在只想从混乱中逃走，如今我遇到了Natur，才会越发地觉得合适。\n状态管理库的管中窥 开发中大型项目，往往会使用状态管理库，当下比较主流的就是Redux和Mobx，二者我觉得最大的区别是理念，即状态数据是不是不可变值，众所周知，React和Redux一致遵循了不可变值，Natur也是如此。\n开门见山 先说一下我的观点，我是结合两方面进行判断的，一个是短期看上手，另一个是长远看维护，结果如下：\n上手难度：Redux\u003eNatur\u003eMobx\n维护难度：Mobx\u003eNatur\u003eRedux\n对于我这种经常开发不大不小，中拨溜项目的开发者来讲，Natur更适合。\n那么接下就从这两方面简单地分析一下Natur。\nNatur的上手分析 先贴下完整代码：\njs\n代码解读\n复制代码\n`import { createStore, createInject } from \"natur\"; import { ... } from 'natur/dist/middlewares'; // 引入内置中间件 /*-------------装备-start-------------*/ //创建状态模块-Module（状态切片） const testModule = { // 状态数据 state: { testValue: 0, }, // 计算属性 maps: {...}, // 修改状态的动作 actions: {...}, }; //创建仓库-Store export const naturStore = createStore( // 状态模块，也可以理解为“状态切片” { testModule }, //懒加载模块 {}, //配置 { //中间件，直接按照官网推荐的来 middlewares: [...], } ); /*-------------装备-over-------------*/ /*-------------提供注入-start-------------*/ //对外提供注入其数据的能力 export const injectNaturStore = createInject({ storeGetter: () =\u003e naturStore }); /*-------------提供注入-over-------------*/` 在使用状态管理库之前，我们得先知道怎么创建出来，才能谈页面组件怎么装备使用。\n创建状态仓库-Store 代码如下\njs\n代码解读\n复制代码\n/*-------------装备-start-------------*/ //创建状态模块-Module（状态切片） const testModule = { // 状态数据 state: { testValue: 0, }, // 计算属性 maps: {...}, // 修改状态的动作 actions: {...}, }; //创建仓库-Store export const naturStore = createStore( // 状态模块，也可以理解为“状态切片” { testModule }, //懒加载模块 {}, //配置 { //中间件，直接按照官网推荐的来 middlewares: [...], } ); /*-------------装备-over-------------*/\n通过代码我们看出，创建仓库的api是createStore,参数有三个：\n状态模块，也可以理解为“状态切片”，本文重点介绍 懒加载状态模块 配置，Natur提供了诸多配置项，而针对上手来讲，主要便是**“中间件”** 配置-中间件 这部分直接用官方推荐的方案就完了，本文不做深挖赘述，代码如下。\njs\n代码解读\n复制代码\n{ middlewares: [ thunkMiddleware, // action支持返回函数，并获取最新数据 promiseMiddleware, // action支持异步操作 fillObjectRestDataMiddleware, // 增量更新/覆盖更新 shallowEqualMiddleware, // 新旧state浅层对比优化 filterUndefinedMiddleware, // 过滤无返回值的action devTool, // 开发工具 ], }\n本文所有的对Natur的介绍，都是基于该官方中间件配置进行的。\n懒加载状态模块 异步的实现就是在同步模块基础上使用了import的动态引入，伪代码如下：\njs\n代码解读\n复制代码\nconst module1 = () =\u003e import('同步状态模块');\n状态模块-Module Module就是一个由state，maps，actions组成的对象，代码如下：\njs\n代码解读\n复制代码\n`//创建状态模块-Module（状态切片） const testModule = { // 状态数据 state: { testValue: 0, }, // 计算属性 maps: {...}, // 修改状态的动作 actions: {...}, };` state 就是一个普通的对象。\njs\n代码解读\n复制代码\n`state: { number: 1, value: 2 },` maps 计算属性。\njs\n代码解读\n复制代码\n`maps: { // 数组前面的元素，都是在声明此map对state的依赖项，最后一个函数可以获取前面声明的依赖，你可以在里面实现你想要的东西 sum1: ['number', 'value', (number, value) =\u003e number + value], // 你也可以通过函数的方式声明依赖项，这对于复杂类型的state很有用 sum2: [state =\u003e state.number, s =\u003e s.value, (number, value) =\u003e number + value], // 也可以是个函数，直接依赖整个state，缺点是只要state更新就会重新执行函数，没有缓存 sum3: ({number, value}) =\u003e number + value, // 也可以是个函数，没有依赖，只执行一次 isTrue: () =\u003e true, }` actions 修改状态的途径，无论同步或者异步均在在此选项下进行配置，action是一个函数，代码如下。\njs\n代码解读\n复制代码\n同步： actions: { ... // 这里是异步更新state中的name数据 testAsyncAction: (value: number) =\u003e { return { value: value }; } ... }\njs\n代码解读\n复制代码\n异步-返回promise： actions: { ... // 这里是异步更新state中的name数据 testAsyncAction: (value: number) =\u003e { return Promise.resolve({ value }) } ... }\njs\n代码解读\n复制代码\n异步-返回函数： actions: { ... // 这里是异步更新state中的name数据 testAsyncAction: (myParams) =\u003e{ return ({ setState }) =\u003e { setTimeout(() =\u003e { setState(Date.now()) }, 5000); } } ... }\n页面组件上的使用 创建注入器 js\n代码解读\n复制代码\n`... export const injectNaturStore = createInject({ storeGetter: () =\u003e naturStore }); ...` 使用创建好的仓库来制作一个注入器Hoc，这样就可以向组件的Props中注入状态模块。\n使用注入器 js\n代码解读\n复制代码\n`... //引入并使用注入器 import { injectNaturStore } from \"@DATA_MANAGER/index\"; let injecter = injectNaturStore([\"testModule\"]); type PropsT = { [prop: string]: any; } \u0026 typeof injecter.type; //页面组件 class TestViewUI extends React.Component{ ... } injecter(TestViewUI)` 使用状态Module数据 js\n代码解读\n复制代码\n`this.props.lightHomeStoreN?.state?.testValue` 修改状态Module数据 js\n代码解读\n复制代码\n同步和异步一致 this.props.lightHomeStoreN.actions.testAsyncAction(\"测试异步响应！\"); this.props.lightHomeStoreN.actions.testSyncAction(\"测试同步响应！\");\n设置页面响应状态Module更新的粒度 监听Module的所有 注入的模块一变化，就更新页面组件，即触发render。\njs\n代码解读\n复制代码\n`injectNaturStore([\"testModule\"]) 或 injectNaturStore(\"testModule\")` 监听Module的部分 注入的模块一变化，就更新页面组件，即触发render。\njs\n代码解读\n复制代码\n`let complexInjector = inject( ['testModule',{state: [s =\u003e s.xxx], maps: ['xxx']}], ['other', {state: [s =\u003e s.xxx], maps: ['xxx']}] ); 或 complexInjector = inject('app', 'other') .watch('app', {}) .watch('other', {state: [s =\u003e s.xxx], maps: ['xxx']})` 优化总是在需要的时候做，而Natur提供了一定的优化途径。\n对比 Natur直接就有了模块，很暖心 直接就分成了模块，这也是我喜欢Mobx的原因之一，反观Redux\njs\n代码解读\n复制代码\n`const testReducer = (state = { testValue:0 }, action = {}) =\u003e { const { type, payload } = action; switch (type) { case \"action_1\": return Object.assign({}, state, { testValue: state.testValue+1 }); case \"action_2\": return Object.assign({}, state, { testValue: state.testValue-1 }); case \"action_3\": return Object.assign({}, state, { testValue: payload }); default: return state; } };` 相比Redux这一大块的Reducer，能直接就分模块是真的好，Redux也可以自行地进行拆分从而达到分模块，就像Dva那样拆分，然后用nameSpace进行标注，但”本身就有“和”动手自助“，这不一样啊，怎么形容呢。。。\n就好比说合租，你觉得用隔断做成的插间和一个原本就独立的房间能一样吗？\n我觉得”本身就有“的体验好。\n页面使用上来看，Natur就很原始，但某种意义上讲反而更好 与react结合方式 对于Redux和Mobx在页面上的使用类似，都是借助其他”结合助手“，如reudx-react和mobx-react\n问题：\nMobx和Redux都需要“结合助手”，但为什么Natur不用呢？ 话说这个”结合助手“被单独设立的意义是什么？ 我认为Mobx和Redux应该是考虑到不单对React一方进行结合，所以将“结合”这块抽出来，分别针对不同方来进行制作”结合助手“。\n这么想的话，那么Natur不用，估计是因为只针对React一方进行结合。这对React使用者来说应该说反而简单了。。。\n在页面上使用Natur仓库的方式 直接通过链式调用的方式，这就跟Mobx有点神似了，em~ ~ ~，很原始，很直接，好处很实际，如果是用Ts开发，就会有联想提示，，比如：\n这其实很棒，反观Redux：\njs\n代码解读\n复制代码\n`dispatch({ type: 'settings/changeSetting', payload: config, })` 你可以说Redux的dispatch很高级，简洁，但不可否认，多少有点“迷”。\ndispatch传入的type，需要准确拼写无误，还没有提示，我想知道目的地在哪，我还得查找，甚至全局搜索。。。。难受\n相比一看，原始的方式更简单，思路还清晰，关键还有提示，省的我费劲记住”邮寄地址“了。\n跟Mobx比上手难度，省省吧 这还用比么，Mobx有那么多事？随性的不要不要的，Mobx建议应该永远只对修改状态的函数使用动作，而你不加都行在非严格模式下，状态想改就改，无拘无束，也许你不明白它到底怎么可观察的，调试时看可观察对象还容易醉，但这都不算事，开心最大嘛。\n我的观点 基于以上主观的分析，我得出了我的观点。\n上手难度：Redux\u003enatur\u003eMobx\nNatur的维护分析 维护分析有别于上手分析，后者主要从基础细节出发，循序渐进的的展开，直到完整实现功能，策略就是从下到上，维护分析我觉得就得反着来了，用从上到下的策略，从具体的实际问题触发，顺理成章地推导，直到清晰得出实现方案。\n项目成长的烦恼 一个页面一个状态Module够了 从我这个如此普通的开发者视角来讲，我的项目肯定是要用状态管理库的，我是按照页面来划分状态Module的，也就是一个页面对应一个Module，开始还好，完成一些业务功能后，体量不大。\n随着项目不断地开发，每个页面的状态Module越来越复杂，\n各有甚者，状态Model间还有一些往来，那关系叫一个错综复杂啊。\n一个不够了该怎么办 本来一个页面，子组件还都小，通过父组件获得状态module数据单向地往下传，这日子还算能过，但是当子组件越来越复杂，又有了自己的子组件，那么单向就变得费劲了（怎么有种熟悉之感）,那么子组件就想脱离单向，直接地去访问这个页面状态module，行不行？\n子组件想越矩，不行，没到时候 子组件跳过父组件直接拿数据，这不合规矩，不是绝对不行，而是没到时候，如果子组件都去拿页面状态数据，做了本该父组件做的事情，那么就是促进分裂，组成页面的父组件和子组件应该更好地结合团结，而不是貌合神离，所以这种行为不可取，那么问题还得解决，那就得从这状态module入手了。\n化整为零，有点乱啊 你想要把“整个”页面状态module，拆分给页面中各个够格的子组件，如\n想的是挺好，首先这些拆分后的状态module对应的子组件可是很相关的，那就肯定免不了彼此的通信，关系那可就老铁了，如\n总得有module先站出来 那么关系这么复杂，那就统一的让瘦身成功的页面组件module管吧，毕竟地位还在，为了维护状态模块间的秩序，主要做的就是跨模块的通信以及业务处理这方面\n但是渐渐的页面组件module又胖了，这把不单是胖，还有点不守“本分”了，这可不行啊。\n天降猛男，natur-service很知性 有些coder实现了项目基本功能后，会对品质产生追求，不希望再忍受混乱，希望一切看起来井井有条，但是往往挡住脚本的总是挡住脚本，这颗进步的心就这样倔强的存在，进退两难，而natur-service知道怎么做可以组织好代码，从混乱中解脱，有了ta，局面就变成这样了，如：\n甚至还可以这样\n完全可以进一步根据自己对业务的理解再分堆。\nnatur-service的开发使用 安装 natur-service shell\n代码解读\n复制代码\n`yarn add natur-service` 创建一个natur-service实例 先写一个store当测试例子 testStore.ts\njs\n代码解读\n复制代码\nimport { createStore } from 'natur'; const count = { state: 1, actions: { inc: (state) =\u003e state + 1, dec: (state) =\u003e state - 1, } } const modules = { count, count1: count, }; const lazyModules = {}; export const store = createStore(modules, lazyModules); export type M = typeof modules; export type LM = typeof lazyModules;\n然后在同目录下新建个service.ts\njs\n代码解读\n复制代码\nimport {store, M, LM} from \"./testStore.ts\"; import NaturService from \"natur-service\"; class CountService extends NaturService { constructor() { super(store); ... } } // 实例化，开始监听 const countService = new CountService();\n模块间的通信 js\n代码解读\n复制代码\nimport {store, M, LM} from \"store\"; import NaturService from \"natur-service\"; class CountService extends NaturService { constructor() { super(store); // 执行count模块的inc方法 this.dispatch('count', 'inc', 0).then(() =\u003e { // 如果count是一个还未加载的模块，那么等到count加载完成后才会触发这个action // 如果在未加载完成期间，重复多次的调用同一个action，那么旧的dispatch会抛出一个固定的Promise错误，以清除缓存，防止爆栈 console.log('dispatch完成'); }) } } // 实例化，执行推送 const countService = new CountService();\n监听模块的更新、以及更新的详情信息 js\n代码解读\n复制代码\nimport {store, M, LM} from \"store\"; import NaturService from \"natur-service\"; class CountService extends NaturService { constructor() { super(store); // 观察count模块， ModuleEvent请看文档 this.watch(\"count\", (me: ModuleEvent) =\u003e { // 这是更新详情 console.log(me); // 这是你要执行的业务逻辑 console.log('count module has changed.'); }); } } // 实例化，开始监听 const countService = new CountService();\nModuleEvent\n属性名称\n说明\n类型\nstate\n模块最新的state\nany\nundefined\ntype\n触发模块更新的类型，‘init’ 是模块初始化触发，‘update’ 是模块的state更新时触发，‘remove’是模块卸载时触发\n‘init’\n‘update’\n‘remove’\nactionName\n触发模块更新的action名称，只有在 type为’update’时才会存在\nstring\nundefined\noldModule\n旧模块的数据，当type为’init’时为undefined\nInjectStoreModule\nundefined\nnewModule\n新模块的数据，当type为’remove’是为undefined\nInjectStoreModule\nundefined\n对比 所有的状态都放在仓库里行不行 无论是使用Dva（Redux）还是Mobx，都被这个问题困扰过很久，经过纠结我选择了一个折中方案：\n我先写成组件状态，然后根据需要再讲这个组件状态改成仓库状态。\n不全放在仓库里有几点顾虑：\n都放进去，我就分不清哪些状态是全局，哪些是局部了（可能没啥太大必要）。 都放进去，那么多的状态全混在一起，那这个module就会很臃肿。 拆分模块的话，跨模块通信，互相监听彼此的业务，会不会变得很混乱啊。 有了natur-service，问题就简单了 Redux跨模块通信就有点拉了 Redux也许专注的是全局状态管理，连拆分模块都得自己动手，Dva就很好地完善了Redux，但仍会有一个尴尬的问题，人嘛容易懒，你会发现写来写去，一个model的effect一堆，但是reducer就一个，毕竟这么多effect都用一个reducer看起来也没啥不行的。\n但这么做，跨模块通信触发的reducer不就都用这一个了么，那还咋分清是哪个action触发的啊。\n跨模块通信容易了，模块拆分也就好管了 有了natur-service，在拆分module这块就好了不少，让跨模块通信变得井井有条，同时也没有让模块间有耦合关系， 相比Dva你得用put来触发指定模块的effect或者reducer。\njs\n代码解读\n复制代码\n`*testEffect(_, { call, put, select }) { ... yield put({ type: '其他模块/effect或者reducer', payload: data, }); ... }` Mobx就更过，直接得引入这个模块，从而执行相应的action。\njs\n代码解读\n复制代码\n`@action fetchLightDelete = (params:any) =\u003e { ... otherModule.testAction() ... }` natur根本就不用在模块里写这个写这些，你完全可以通过设立一个flag状态变量和触发它改变的action就行。\njs\n代码解读\n复制代码\n`class CountService extends NaturService { constructor() { this.watch(\"flagAction\", (me: ModuleEvent) =\u003e { this.dispatch('count', 'inc', 0).then(() =\u003e {}); } } }` 虽然加了一个无关紧要的flagState来触发natur-service的监听的方式有些“做作”，但这可以让natur-servic精细掌控跨模块通信。\n一些多个仓库整合调度的业务就不用混在UI层了。 有种业务场景，非常适合natur-service发挥，比如A页面有了个仓库操作，首页和用户页面会有连带的一些仓库状态的操作，一般我是要在UI层搞的，也就是在组件的生命周期的componentDidmount这种函数里进行业务整合。\n但是选哪个页面里写呢？看似应该谁引起的谁写，但一细想，这不耦合了，为啥其他页面的业务要在登录页面写呢？这么一想确实不是很好，而有了natur-service，直接交给它就完了，省的纠结在哪写，写来写去还容易乱。\n和Mobx较量一下维护性。。。 我觉得不用比了，Mobx的可变值这一点，如果不加一套严格的规范和一些必要手段（做个统一修改入口函数啥的），你就很难管理好Mobx，太自由，爱过火。\n我的观点 基于以上主观的分析，我得出了我的观点。\n维护难度：Mobx\u003eNatur\u003eRedux\n比较下来，真的我心里越发的觉得Natur更好维护，不过Redux毕竟大牌子，估计应该更好吧。。。\n总结 通过短期看上手和长远看维护，我比较下来，Natur很适合我，能够很好的满足我组织代码的需求，对于一个常常开发中拨溜项目的我来说，正正好好。\n题外话 作为一个普普通通前端coder，每当看到一个国内开发者的库，尤其是没有光环的，我会格外的关注和尊重，并拿出足够的热情去学习和分享，我认为好的库就好像一个发光体，能用来取暖获取力量，同时更应该将光折射出去，而不是去遮掩，这是可耻的，也是徒劳的，然而一个优秀的光源是不惧怕掩盖的，也是盖不灭的，因为只有自己能让自己发光。\n",
  "wordCount" : "883",
  "inLanguage": "zh",
  "image": "http://localhost:1313/images/papermod-cover.png","datePublished": "2021-11-01T00:00:00Z",
  "dateModified": "2021-11-01T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "闲D阿强"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/posts/juejin/%E7%94%A8mobx%E8%AE%B8%E4%B9%85%E5%90%8E%E5%B8%B8%E6%80%80%E5%BF%B5%E8%B5%B7redux%E7%9A%84%E7%BE%8E%E5%A5%BD%E8%80%8C%E4%BB%8A%E6%88%91%E9%81%87%E5%88%B0%E4%BA%86natur/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "PaperMod",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/%3Clink%20/%20abs%20url%3E"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Home (Alt + H)">
                        
                    <img src="http://localhost:1313/images/msg_hu15231257772499651944.png" alt="" aria-label="logo"
                        height="20">Home</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/archives" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="https://github.com/adityatelange/hugo-PaperMod/wiki/" title="WiKi">
                    <span>WiKi</span>&nbsp;
                    <svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12">
                        <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path>
                        <path d="M15 3h6v6"></path>
                        <path d="M10 14L21 3"></path>
                    </svg>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/">主页</a>&nbsp;»&nbsp;<a href="http://localhost:1313/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      用Mobx许久后，常怀念起Redux的美好，而今我遇到了Natur
    </h1>
    <div class="post-description">
      Mobx的简单随性让我着迷，但当用着用着，总在不经意间去怀念Redux，渐渐地理解了ta，我才明白约束不是过分的要求，而我现在只想从混乱中逃走，如今我遇到了Natur，才会越发地觉得合适。
    </div>
    <div class="post-meta"><span title='2021-11-01 00:00:00 +0000 UTC'>十一月 1, 2021</span>&nbsp;·&nbsp;5 分钟&nbsp;·&nbsp;闲D阿强&nbsp;|&nbsp;<a href="https://github.com/WangShaoyu1/myBlogPaperMod/tree/master/content/posts/jueJin/%e7%94%a8Mobx%e8%ae%b8%e4%b9%85%e5%90%8e%ef%bc%8c%e5%b8%b8%e6%80%80%e5%bf%b5%e8%b5%b7Redux%e7%9a%84%e7%be%8e%e5%a5%bd%ef%bc%8c%e8%80%8c%e4%bb%8a%e6%88%91%e9%81%87%e5%88%b0%e4%ba%86Natur.md" rel="noopener noreferrer" target="_blank">Suggest Changes</a>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">目录</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e7%8a%b6%e6%80%81%e7%ae%a1%e7%90%86%e5%ba%93%e7%9a%84%e7%ae%a1%e4%b8%ad%e7%aa%a5" aria-label="状态管理库的管中窥">状态管理库的管中窥</a></li>
                <li>
                    <a href="#%e5%bc%80%e9%97%a8%e8%a7%81%e5%b1%b1" aria-label="开门见山">开门见山</a></li>
                <li>
                    <a href="#natur%e7%9a%84%e4%b8%8a%e6%89%8b%e5%88%86%e6%9e%90" aria-label="Natur的上手分析">Natur的上手分析</a><ul>
                        
                <li>
                    <a href="#%e5%88%9b%e5%bb%ba%e7%8a%b6%e6%80%81%e4%bb%93%e5%ba%93-store" aria-label="创建状态仓库-Store">创建状态仓库-Store</a><ul>
                        
                <li>
                    <a href="#%e9%85%8d%e7%bd%ae-%e4%b8%ad%e9%97%b4%e4%bb%b6" aria-label="配置-中间件">配置-中间件</a></li>
                <li>
                    <a href="#%e6%87%92%e5%8a%a0%e8%bd%bd%e7%8a%b6%e6%80%81%e6%a8%a1%e5%9d%97" aria-label="懒加载状态模块">懒加载状态模块</a></li>
                <li>
                    <a href="#%e7%8a%b6%e6%80%81%e6%a8%a1%e5%9d%97-module" aria-label="状态模块-Module">状态模块-Module</a><ul>
                        
                <li>
                    <a href="#state" aria-label="state">state</a></li>
                <li>
                    <a href="#maps" aria-label="maps">maps</a></li>
                <li>
                    <a href="#actions" aria-label="actions">actions</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#%e9%a1%b5%e9%9d%a2%e7%bb%84%e4%bb%b6%e4%b8%8a%e7%9a%84%e4%bd%bf%e7%94%a8" aria-label="页面组件上的使用">页面组件上的使用</a><ul>
                        
                <li>
                    <a href="#%e5%88%9b%e5%bb%ba%e6%b3%a8%e5%85%a5%e5%99%a8" aria-label="创建注入器">创建注入器</a></li>
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8%e6%b3%a8%e5%85%a5%e5%99%a8" aria-label="使用注入器">使用注入器</a></li>
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8%e7%8a%b6%e6%80%81module%e6%95%b0%e6%8d%ae" aria-label="使用状态Module数据">使用状态Module数据</a></li>
                <li>
                    <a href="#%e4%bf%ae%e6%94%b9%e7%8a%b6%e6%80%81module%e6%95%b0%e6%8d%ae" aria-label="修改状态Module数据">修改状态Module数据</a></li>
                <li>
                    <a href="#%e8%ae%be%e7%bd%ae%e9%a1%b5%e9%9d%a2%e5%93%8d%e5%ba%94%e7%8a%b6%e6%80%81module%e6%9b%b4%e6%96%b0%e7%9a%84%e7%b2%92%e5%ba%a6" aria-label="设置页面响应状态Module更新的粒度">设置页面响应状态Module更新的粒度</a><ul>
                        
                <li>
                    <a href="#%e7%9b%91%e5%90%acmodule%e7%9a%84%e6%89%80%e6%9c%89" aria-label="监听Module的所有">监听Module的所有</a></li>
                <li>
                    <a href="#%e7%9b%91%e5%90%acmodule%e7%9a%84%e9%83%a8%e5%88%86" aria-label="监听Module的部分">监听Module的部分</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#%e5%af%b9%e6%af%94" aria-label="对比">对比</a><ul>
                        
                <li>
                    <a href="#natur%e7%9b%b4%e6%8e%a5%e5%b0%b1%e6%9c%89%e4%ba%86%e6%a8%a1%e5%9d%97%e5%be%88%e6%9a%96%e5%bf%83" aria-label="Natur直接就有了模块，很暖心">Natur直接就有了模块，很暖心</a></li>
                <li>
                    <a href="#%e9%a1%b5%e9%9d%a2%e4%bd%bf%e7%94%a8%e4%b8%8a%e6%9d%a5%e7%9c%8bnatur%e5%b0%b1%e5%be%88%e5%8e%9f%e5%a7%8b%e4%bd%86%e6%9f%90%e7%a7%8d%e6%84%8f%e4%b9%89%e4%b8%8a%e8%ae%b2%e5%8f%8d%e8%80%8c%e6%9b%b4%e5%a5%bd" aria-label="页面使用上来看，Natur就很原始，但某种意义上讲反而更好">页面使用上来看，Natur就很原始，但某种意义上讲反而更好</a><ul>
                        
                <li>
                    <a href="#%e4%b8%8ereact%e7%bb%93%e5%90%88%e6%96%b9%e5%bc%8f" aria-label="与react结合方式">与react结合方式</a></li>
                <li>
                    <a href="#%e5%9c%a8%e9%a1%b5%e9%9d%a2%e4%b8%8a%e4%bd%bf%e7%94%a8natur%e4%bb%93%e5%ba%93%e7%9a%84%e6%96%b9%e5%bc%8f" aria-label="在页面上使用Natur仓库的方式">在页面上使用Natur仓库的方式</a></li>
                <li>
                    <a href="#%e8%b7%9fmobx%e6%af%94%e4%b8%8a%e6%89%8b%e9%9a%be%e5%ba%a6%e7%9c%81%e7%9c%81%e5%90%a7" aria-label="跟Mobx比上手难度，省省吧">跟Mobx比上手难度，省省吧</a></li></ul>
                </li>
                <li>
                    <a href="#%e6%88%91%e7%9a%84%e8%a7%82%e7%82%b9" aria-label="我的观点">我的观点</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#natur%e7%9a%84%e7%bb%b4%e6%8a%a4%e5%88%86%e6%9e%90" aria-label="Natur的维护分析">Natur的维护分析</a><ul>
                        
                <li>
                    <a href="#%e9%a1%b9%e7%9b%ae%e6%88%90%e9%95%bf%e7%9a%84%e7%83%a6%e6%81%bc" aria-label="项目成长的烦恼">项目成长的烦恼</a><ul>
                        
                <li>
                    <a href="#%e4%b8%80%e4%b8%aa%e9%a1%b5%e9%9d%a2%e4%b8%80%e4%b8%aa%e7%8a%b6%e6%80%81module%e5%a4%9f%e4%ba%86" aria-label="一个页面一个状态Module够了">一个页面一个状态Module够了</a></li>
                <li>
                    <a href="#%e4%b8%80%e4%b8%aa%e4%b8%8d%e5%a4%9f%e4%ba%86%e8%af%a5%e6%80%8e%e4%b9%88%e5%8a%9e" aria-label="一个不够了该怎么办">一个不够了该怎么办</a></li>
                <li>
                    <a href="#%e5%ad%90%e7%bb%84%e4%bb%b6%e6%83%b3%e8%b6%8a%e7%9f%a9%e4%b8%8d%e8%a1%8c%e6%b2%a1%e5%88%b0%e6%97%b6%e5%80%99" aria-label="子组件想越矩，不行，没到时候">子组件想越矩，不行，没到时候</a></li>
                <li>
                    <a href="#%e5%8c%96%e6%95%b4%e4%b8%ba%e9%9b%b6%e6%9c%89%e7%82%b9%e4%b9%b1%e5%95%8a" aria-label="化整为零，有点乱啊">化整为零，有点乱啊</a></li>
                <li>
                    <a href="#%e6%80%bb%e5%be%97%e6%9c%89module%e5%85%88%e7%ab%99%e5%87%ba%e6%9d%a5" aria-label="总得有module先站出来">总得有module先站出来</a></li>
                <li>
                    <a href="#%e5%a4%a9%e9%99%8d%e7%8c%9b%e7%94%b7natur-service%e5%be%88%e7%9f%a5%e6%80%a7" aria-label="天降猛男，natur-service很知性">天降猛男，natur-service很知性</a></li></ul>
                </li>
                <li>
                    <a href="#natur-service%e7%9a%84%e5%bc%80%e5%8f%91%e4%bd%bf%e7%94%a8" aria-label="natur-service的开发使用">natur-service的开发使用</a><ul>
                        
                <li>
                    <a href="#%e5%ae%89%e8%a3%85-natur-service" aria-label="安装 natur-service">安装 natur-service</a></li>
                <li>
                    <a href="#%e5%88%9b%e5%bb%ba%e4%b8%80%e4%b8%aanatur-service%e5%ae%9e%e4%be%8b" aria-label="创建一个natur-service实例">创建一个natur-service实例</a></li>
                <li>
                    <a href="#%e6%a8%a1%e5%9d%97%e9%97%b4%e7%9a%84%e9%80%9a%e4%bf%a1" aria-label="模块间的通信">模块间的通信</a></li>
                <li>
                    <a href="#%e7%9b%91%e5%90%ac%e6%a8%a1%e5%9d%97%e7%9a%84%e6%9b%b4%e6%96%b0%e4%bb%a5%e5%8f%8a%e6%9b%b4%e6%96%b0%e7%9a%84%e8%af%a6%e6%83%85%e4%bf%a1%e6%81%af" aria-label="监听模块的更新、以及更新的详情信息">监听模块的更新、以及更新的详情信息</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%af%b9%e6%af%94-1" aria-label="对比">对比</a><ul>
                        
                <li>
                    <a href="#%e6%89%80%e6%9c%89%e7%9a%84%e7%8a%b6%e6%80%81%e9%83%bd%e6%94%be%e5%9c%a8%e4%bb%93%e5%ba%93%e9%87%8c%e8%a1%8c%e4%b8%8d%e8%a1%8c" aria-label="所有的状态都放在仓库里行不行">所有的状态都放在仓库里行不行</a></li>
                <li>
                    <a href="#%e6%9c%89%e4%ba%86natur-service%e9%97%ae%e9%a2%98%e5%b0%b1%e7%ae%80%e5%8d%95%e4%ba%86" aria-label="有了natur-service，问题就简单了">有了natur-service，问题就简单了</a><ul>
                        
                <li>
                    <a href="#redux%e8%b7%a8%e6%a8%a1%e5%9d%97%e9%80%9a%e4%bf%a1%e5%b0%b1%e6%9c%89%e7%82%b9%e6%8b%89%e4%ba%86" aria-label="Redux跨模块通信就有点拉了">Redux跨模块通信就有点拉了</a></li>
                <li>
                    <a href="#%e8%b7%a8%e6%a8%a1%e5%9d%97%e9%80%9a%e4%bf%a1%e5%ae%b9%e6%98%93%e4%ba%86%e6%a8%a1%e5%9d%97%e6%8b%86%e5%88%86%e4%b9%9f%e5%b0%b1%e5%a5%bd%e7%ae%a1%e4%ba%86" aria-label="跨模块通信容易了，模块拆分也就好管了">跨模块通信容易了，模块拆分也就好管了</a></li>
                <li>
                    <a href="#%e4%b8%80%e4%ba%9b%e5%a4%9a%e4%b8%aa%e4%bb%93%e5%ba%93%e6%95%b4%e5%90%88%e8%b0%83%e5%ba%a6%e7%9a%84%e4%b8%9a%e5%8a%a1%e5%b0%b1%e4%b8%8d%e7%94%a8%e6%b7%b7%e5%9c%a8ui%e5%b1%82%e4%ba%86" aria-label="一些多个仓库整合调度的业务就不用混在UI层了。">一些多个仓库整合调度的业务就不用混在UI层了。</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%92%8cmobx%e8%be%83%e9%87%8f%e4%b8%80%e4%b8%8b%e7%bb%b4%e6%8a%a4%e6%80%a7" aria-label="和Mobx较量一下维护性。。。">和Mobx较量一下维护性。。。</a></li>
                <li>
                    <a href="#%e6%88%91%e7%9a%84%e8%a7%82%e7%82%b9-1" aria-label="我的观点">我的观点</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#%e6%80%bb%e7%bb%93" aria-label="总结">总结</a></li>
                <li>
                    <a href="#%e9%a2%98%e5%a4%96%e8%af%9d" aria-label="题外话">题外话</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.empty916.site%2Fzh%2Fnatur%2F" title="https://www.empty916.site/zh/natur/"><strong>Natur文档</strong></a></p>
<p>起初我是通过Umi了解的Redux，当时Dva就是基于Redux的，用起来说不上不好，就是有点烦，烦ta的墨迹，费劲。后来当我用上了Mobx，哇偶，ta的简单，随性让我着迷，不再拘谨，就这样我选择了Mobx，但当用着用着，总在不经意间去怀念Redux，渐渐地理解了ta，我才明白约束不是过分的要求，而我现在只想从混乱中逃走，如今我遇到了Natur，才会越发地觉得合适。</p>
<h1 id="状态管理库的管中窥">状态管理库的管中窥<a hidden class="anchor" aria-hidden="true" href="#状态管理库的管中窥">#</a></h1>
<p>开发中大型项目，往往会使用状态管理库，当下比较主流的就是Redux和Mobx，二者我觉得最大的区别是理念，即状态数据是不是不可变值，众所周知，React和Redux一致遵循了不可变值，Natur也是如此。</p>
<h1 id="开门见山">开门见山<a hidden class="anchor" aria-hidden="true" href="#开门见山">#</a></h1>
<p>先说一下我的观点，我是结合两方面进行判断的，一个是短期看上手，另一个是长远看维护，结果如下：</p>
<p><strong>上手难度</strong>：Redux&gt;<strong>Natur</strong>&gt;Mobx</p>
<p><strong>维护难度</strong>：Mobx&gt;<strong>Natur</strong>&gt;Redux</p>
<p>对于我这种经常开发不大不小，中拨溜项目的开发者来讲，<strong>Natur更适合</strong>。</p>
<p>那么接下就从这<strong>两方面</strong>简单地<strong>分析一下Natur</strong>。</p>
<h1 id="natur的上手分析">Natur的上手分析<a hidden class="anchor" aria-hidden="true" href="#natur的上手分析">#</a></h1>
<p>先贴下完整代码：</p>
<p>js</p>
<p>代码解读</p>
<p>复制代码</p>
<pre><code>`import { createStore, createInject } from &quot;natur&quot;;  	import { ... } from 'natur/dist/middlewares'; // 引入内置中间件 	/*-------------装备-start-------------*/ 	//创建状态模块-Module（状态切片） 	const testModule = { 	 	// 状态数据 		 state: { 			testValue: 0, 		 }, 		 // 计算属性 		 maps: {...}, 		 // 修改状态的动作 		 actions: {...}, 	}; 	//创建仓库-Store 	export const naturStore = createStore( 		// 状态模块，也可以理解为“状态切片” 		{ testModule }, 		//懒加载模块 		{}, 		//配置 		{ 		 //中间件，直接按照官网推荐的来 		 middlewares: [...], 		} 	); 	/*-------------装备-over-------------*/ 	/*-------------提供注入-start-------------*/ 	//对外提供注入其数据的能力 	export const injectNaturStore = createInject({ storeGetter: () =&gt; naturStore }); 	/*-------------提供注入-over-------------*/`
</code></pre>
<p><em>在使用状态管理库之前，我们得先知道怎么创建出来，才能谈页面组件怎么装备使用。</em></p>
<h2 id="创建状态仓库-store">创建状态仓库-Store<a hidden class="anchor" aria-hidden="true" href="#创建状态仓库-store">#</a></h2>
<p>代码如下</p>
<p>js</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>/*-------------装备-start-------------*/ 	//创建状态模块-Module（状态切片） 	const testModule = { 	 	// 状态数据 		 state: { 			testValue: 0, 		 }, 		 // 计算属性 		 maps: {...}, 		 // 修改状态的动作 		 actions: {...}, 	}; 	//创建仓库-Store 	export const naturStore = createStore( 		// 状态模块，也可以理解为“状态切片” 		{ testModule }, 		//懒加载模块 		{}, 		//配置 		{ 		 //中间件，直接按照官网推荐的来 		 middlewares: [...], 		} 	); 	/*-------------装备-over-------------*/</code></p>
<p>通过代码我们看出，创建仓库的api是<code>createStore</code>,参数有三个：</p>
<ol>
<li><strong>状态模块</strong>，也可以理解为“状态切片”，<strong>本文重点介绍</strong></li>
<li><strong>懒加载状态模块</strong></li>
<li><strong>配置</strong>，Natur提供了诸多配置项，而针对上手来讲，主要便是**“中间件”**</li>
</ol>
<h3 id="配置-中间件">配置-中间件<a hidden class="anchor" aria-hidden="true" href="#配置-中间件">#</a></h3>
<p>这部分直接用官方推荐的方案就完了，本文不做深挖赘述，代码如下。</p>
<p>js</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>{     middlewares: [       thunkMiddleware, // action支持返回函数，并获取最新数据       promiseMiddleware, // action支持异步操作       fillObjectRestDataMiddleware, // 增量更新/覆盖更新       shallowEqualMiddleware, // 新旧state浅层对比优化       filterUndefinedMiddleware, // 过滤无返回值的action       devTool, // 开发工具     ],   }</code></p>
<p><strong>本文所有的对Natur的介绍，都是基于该官方中间件配置进行的。</strong></p>
<h3 id="懒加载状态模块">懒加载状态模块<a hidden class="anchor" aria-hidden="true" href="#懒加载状态模块">#</a></h3>
<p>异步的实现就是在同步模块基础上使用了import的动态引入，伪代码如下：</p>
<p>js</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>const module1 = () =&gt; import('同步状态模块');</code></p>
<h3 id="状态模块-module">状态模块-Module<a hidden class="anchor" aria-hidden="true" href="#状态模块-module">#</a></h3>
<p>Module就是一个由state，maps，actions组成的对象，代码如下：</p>
<p>js</p>
<p>代码解读</p>
<p>复制代码</p>
<pre><code>`//创建状态模块-Module（状态切片） 	const testModule = { 	 	// 状态数据 		 state: { 			testValue: 0, 		 }, 		 // 计算属性 		 maps: {...}, 		 // 修改状态的动作 		 actions: {...}, 	};`
</code></pre>
<h4 id="state">state<a hidden class="anchor" aria-hidden="true" href="#state">#</a></h4>
<p>就是一个普通的对象。</p>
<p>js</p>
<p>代码解读</p>
<p>复制代码</p>
<pre><code>`state: {             number: 1,             value: 2     },`
</code></pre>
<h4 id="maps">maps<a hidden class="anchor" aria-hidden="true" href="#maps">#</a></h4>
<p>计算属性。</p>
<p>js</p>
<p>代码解读</p>
<p>复制代码</p>
<pre><code>`maps: {             // 数组前面的元素，都是在声明此map对state的依赖项，最后一个函数可以获取前面声明的依赖，你可以在里面实现你想要的东西             sum1: ['number', 'value', (number, value) =&gt; number + value],             // 你也可以通过函数的方式声明依赖项，这对于复杂类型的state很有用             sum2: [state =&gt; state.number, s =&gt; s.value, (number, value) =&gt; number + value],             // 也可以是个函数，直接依赖整个state，缺点是只要state更新就会重新执行函数，没有缓存             sum3: ({number, value}) =&gt; number + value,             // 也可以是个函数，没有依赖，只执行一次             isTrue: () =&gt; true,     }`
</code></pre>
<h4 id="actions">actions<a hidden class="anchor" aria-hidden="true" href="#actions">#</a></h4>
<p>修改状态的途径，无论同步或者异步均在在此选项下进行配置，action是一个函数，代码如下。</p>
<p>js</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>同步：     actions: {             ...             // 这里是异步更新state中的name数据             testAsyncAction: (value: number) =&gt; {                     return { value: value };             }             ...     }</code></p>
<p>js</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>异步-返回promise：     actions: {             ...             // 这里是异步更新state中的name数据             testAsyncAction: (value: number) =&gt; {                     return Promise.resolve({ value })             }             ...     }</code></p>
<p>js</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>异步-返回函数：     actions: {             ...             // 这里是异步更新state中的name数据             testAsyncAction: (myParams) =&gt;{                      return ({                             setState                      }) =&gt; {                              setTimeout(() =&gt; {                                     setState(Date.now())                              }, 5000);                      }             }             ...     }</code></p>
<h2 id="页面组件上的使用">页面组件上的使用<a hidden class="anchor" aria-hidden="true" href="#页面组件上的使用">#</a></h2>
<h3 id="创建注入器">创建注入器<a hidden class="anchor" aria-hidden="true" href="#创建注入器">#</a></h3>
<p>js</p>
<p>代码解读</p>
<p>复制代码</p>
<pre><code>`...     export const injectNaturStore = createInject({ storeGetter: () =&gt; naturStore });     ...`
</code></pre>
<p>使用创建好的仓库来制作一个注入器Hoc，这样就可以向组件的Props中注入状态模块。</p>
<h3 id="使用注入器">使用注入器<a hidden class="anchor" aria-hidden="true" href="#使用注入器">#</a></h3>
<p>js</p>
<p>代码解读</p>
<p>复制代码</p>
<pre><code>`...     //引入并使用注入器     import { injectNaturStore } from &quot;@DATA_MANAGER/index&quot;;     let injecter = injectNaturStore([&quot;testModule&quot;]);     type PropsT = {             [prop: string]: any;     } &amp; typeof injecter.type;     //页面组件     class TestViewUI extends React.Component&lt;PropsT&gt;{             ...     }     injecter(TestViewUI)`
</code></pre>
<h3 id="使用状态module数据">使用状态Module数据<a hidden class="anchor" aria-hidden="true" href="#使用状态module数据">#</a></h3>
<p>js</p>
<p>代码解读</p>
<p>复制代码</p>
<pre><code>`this.props.lightHomeStoreN?.state?.testValue`
</code></pre>
<h3 id="修改状态module数据">修改状态Module数据<a hidden class="anchor" aria-hidden="true" href="#修改状态module数据">#</a></h3>
<p>js</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>同步和异步一致     this.props.lightHomeStoreN.actions.testAsyncAction(&quot;测试异步响应！&quot;);     this.props.lightHomeStoreN.actions.testSyncAction(&quot;测试同步响应！&quot;);</code></p>
<h3 id="设置页面响应状态module更新的粒度">设置页面响应状态Module更新的粒度<a hidden class="anchor" aria-hidden="true" href="#设置页面响应状态module更新的粒度">#</a></h3>
<h4 id="监听module的所有">监听Module的所有<a hidden class="anchor" aria-hidden="true" href="#监听module的所有">#</a></h4>
<p>注入的模块一变化，就更新页面组件，即触发render。</p>
<p>js</p>
<p>代码解读</p>
<p>复制代码</p>
<pre><code>`injectNaturStore([&quot;testModule&quot;])     或     injectNaturStore(&quot;testModule&quot;)`
</code></pre>
<h4 id="监听module的部分">监听Module的部分<a hidden class="anchor" aria-hidden="true" href="#监听module的部分">#</a></h4>
<p>注入的模块一变化，就更新页面组件，即触发render。</p>
<p>js</p>
<p>代码解读</p>
<p>复制代码</p>
<pre><code>`let complexInjector = inject(       ['testModule',{state: [s =&gt; s.xxx], maps: ['xxx']}],       ['other', {state: [s =&gt; s.xxx], maps: ['xxx']}]     );     或     complexInjector = inject('app', 'other')       .watch('app', {})       .watch('other', {state: [s =&gt; s.xxx], maps: ['xxx']})`
</code></pre>
<p>优化总是在需要的时候做，而Natur提供了一定的优化途径。</p>
<h2 id="对比">对比<a hidden class="anchor" aria-hidden="true" href="#对比">#</a></h2>
<h3 id="natur直接就有了模块很暖心">Natur直接就有了模块，很暖心<a hidden class="anchor" aria-hidden="true" href="#natur直接就有了模块很暖心">#</a></h3>
<p>直接就分成了模块，这也是我喜欢Mobx的原因之一，反观Redux</p>
<p>js</p>
<p>代码解读</p>
<p>复制代码</p>
<pre><code>`const testReducer = (state = { testValue:0 }, action = {}) =&gt; {        const { type, payload } = action;        switch (type) {              case &quot;action_1&quot;:                      return Object.assign({}, state, {                      testValue: state.testValue+1                      });              case &quot;action_2&quot;:                      return Object.assign({}, state, {                      testValue: state.testValue-1                      });              case &quot;action_3&quot;:                      return Object.assign({}, state, {                      testValue: payload                      });              default: return state;        }     };`
</code></pre>
<p>相比Redux这一大块的Reducer，能直接就分模块是真的好，Redux也可以自行地进行拆分从而达到分模块，就像Dva那样拆分，然后用nameSpace进行标注，但”本身就有“和”动手自助“，这不一样啊，怎么形容呢。。。</p>
<blockquote>
<p>就好比说合租，你觉得用隔断做成的插间和一个原本就独立的房间能一样吗？</p>
</blockquote>
<p>我觉得”本身就有“的体验好。</p>
<h3 id="页面使用上来看natur就很原始但某种意义上讲反而更好">页面使用上来看，Natur就很原始，但某种意义上讲反而更好<a hidden class="anchor" aria-hidden="true" href="#页面使用上来看natur就很原始但某种意义上讲反而更好">#</a></h3>
<h4 id="与react结合方式">与react结合方式<a hidden class="anchor" aria-hidden="true" href="#与react结合方式">#</a></h4>
<p>对于Redux和Mobx在页面上的使用类似，都是借助其他”结合助手“，如reudx-react和mobx-react</p>
<p><em>问题：</em></p>
<ol>
<li>Mobx和Redux都需要“结合助手”，但为什么Natur不用呢？</li>
<li>话说这个”结合助手“被单独设立的意义是什么？</li>
</ol>
<p>我认为Mobx和Redux应该是考虑到不单对React一方进行结合，所以将“结合”这块抽出来，分别针对不同方来进行制作”结合助手“。</p>
<p>这么想的话，那么Natur不用，估计是因为只针对React一方进行结合。这对React使用者来说应该说反而简单了。。。</p>
<h4 id="在页面上使用natur仓库的方式">在页面上使用Natur仓库的方式<a hidden class="anchor" aria-hidden="true" href="#在页面上使用natur仓库的方式">#</a></h4>
<p>直接通过链式调用的方式，这就跟Mobx有点神似了，em~ ~ ~，很原始，很直接，好处很实际，如果是用Ts开发，就会有联想提示，，比如：</p>
<p><img loading="lazy" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1fd3193b26fe43009d81d6ed64890364~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt=""  />
</p>
<p>这其实很棒，反观Redux：</p>
<p>js</p>
<p>代码解读</p>
<p>复制代码</p>
<pre><code>`dispatch({             type: 'settings/changeSetting',             payload: config,     })`
</code></pre>
<p>你可以说Redux的dispatch很高级，简洁，但不可否认，多少有点“迷”。</p>
<p>dispatch传入的type，需要准确拼写无误，还没有提示，我想知道目的地在哪，我还得查找，甚至全局搜索。。。。难受</p>
<p>相比一看，原始的方式更简单，思路还清晰，关键还有提示，省的我费劲记住”邮寄地址“了。</p>
<h4 id="跟mobx比上手难度省省吧">跟Mobx比上手难度，省省吧<a hidden class="anchor" aria-hidden="true" href="#跟mobx比上手难度省省吧">#</a></h4>
<p>这还用比么，Mobx有那么多事？随性的不要不要的，Mobx建议应该永远只对<strong>修改</strong>状态的函数使用动作，而你不加都行在非严格模式下，状态想改就改，无拘无束，也许你不明白它到底怎么可观察的，调试时看可观察对象还容易醉，但这都不算事，开心最大嘛。</p>
<h3 id="我的观点">我的观点<a hidden class="anchor" aria-hidden="true" href="#我的观点">#</a></h3>
<p>基于以上主观的分析，我得出了我的观点。</p>
<p><strong>上手难度</strong>：Redux&gt;<strong>natur</strong>&gt;Mobx</p>
<h1 id="natur的维护分析">Natur的维护分析<a hidden class="anchor" aria-hidden="true" href="#natur的维护分析">#</a></h1>
<p>维护分析有别于上手分析，后者主要从基础细节出发，循序渐进的的展开，直到完整实现功能，策略就是从下到上，维护分析我觉得就得反着来了，用从上到下的策略，从具体的实际问题触发，顺理成章地推导，直到清晰得出实现方案。</p>
<h2 id="项目成长的烦恼">项目成长的烦恼<a hidden class="anchor" aria-hidden="true" href="#项目成长的烦恼">#</a></h2>
<h3 id="一个页面一个状态module够了">一个页面一个状态Module够了<a hidden class="anchor" aria-hidden="true" href="#一个页面一个状态module够了">#</a></h3>
<p>从我这个如此普通的开发者视角来讲，我的项目肯定是要用状态管理库的，我是按照页面来划分状态Module的，也就是一个页面对应一个Module，开始还好，完成一些业务功能后，体量不大。</p>
<p><img loading="lazy" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/313e032a92a343a3ad81f49d102c9e87~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt=""  />
</p>
<p>随着项目不断地开发，每个页面的状态Module越来越复杂，</p>
<p><img loading="lazy" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2af7863fe06c4d749d9c8312bb1d6e94~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt=""  />
</p>
<p>各有甚者，状态Model间还有一些往来，那关系叫一个错综复杂啊。</p>
<h3 id="一个不够了该怎么办">一个不够了该怎么办<a hidden class="anchor" aria-hidden="true" href="#一个不够了该怎么办">#</a></h3>
<p>本来一个页面，子组件还都小，通过父组件获得状态module数据单向地往下传，这日子还算能过，但是当子组件越来越复杂，又有了自己的子组件，那么单向就变得费劲了（怎么有种熟悉之感）,那么子组件就想脱离单向，直接地去访问这个页面状态module，行不行？</p>
<h3 id="子组件想越矩不行没到时候">子组件想越矩，不行，没到时候<a hidden class="anchor" aria-hidden="true" href="#子组件想越矩不行没到时候">#</a></h3>
<p>子组件跳过父组件直接拿数据，这不合规矩，不是绝对不行，而是没到时候，如果子组件都去拿页面状态数据，做了本该父组件做的事情，那么就是促进分裂，组成页面的父组件和子组件应该更好地结合团结，而不是貌合神离，所以这种行为不可取，那么问题还得解决，那就得从这状态module入手了。</p>
<h3 id="化整为零有点乱啊">化整为零，有点乱啊<a hidden class="anchor" aria-hidden="true" href="#化整为零有点乱啊">#</a></h3>
<p>你想要把“整个”页面状态module，拆分给页面中各个够格的子组件，如</p>
<p><img loading="lazy" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1251226eb40f463b81e75ae06fe3814d~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt=""  />
</p>
<p>想的是挺好，首先这些拆分后的状态module对应的子组件可是很相关的，那就肯定免不了彼此的通信，关系那可就老铁了，如</p>
<p><img loading="lazy" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/62b5adabdb9042d4ba7a50d1a0cf0bc1~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt=""  />
</p>
<h3 id="总得有module先站出来">总得有module先站出来<a hidden class="anchor" aria-hidden="true" href="#总得有module先站出来">#</a></h3>
<p>那么关系这么复杂，那就统一的让瘦身成功的页面组件module管吧，毕竟地位还在，为了维护状态模块间的秩序，主要做的就是<strong>跨模块的通信以及业务处理</strong>这方面</p>
<p><img loading="lazy" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e168abe834b94144bb956e9c7d0b4f45~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt=""  />
</p>
<p>但是渐渐的页面组件module又胖了，这把不单是胖，还有点不守“本分”了，这可不行啊。</p>
<h3 id="天降猛男natur-service很知性">天降猛男，natur-service很知性<a hidden class="anchor" aria-hidden="true" href="#天降猛男natur-service很知性">#</a></h3>
<p>有些coder实现了项目基本功能后，会对品质产生追求，不希望再忍受混乱，希望一切看起来井井有条，但是往往挡住脚本的总是挡住脚本，这颗进步的心就这样倔强的存在，进退两难，而natur-service知道怎么做可以组织好代码，从混乱中解脱，有了ta，局面就变成这样了，如：</p>
<p><img loading="lazy" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/292125412c4e4447b2d3cd384aff6165~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt=""  />
</p>
<p>甚至还可以这样</p>
<p><img loading="lazy" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/85296983ffcc43d2a7db2de6f029d04f~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt=""  />
</p>
<p>完全可以进一步根据自己对业务的理解再分堆。</p>
<h2 id="natur-service的开发使用">natur-service的开发使用<a hidden class="anchor" aria-hidden="true" href="#natur-service的开发使用">#</a></h2>
<h3 id="安装-natur-service">安装 natur-service<a hidden class="anchor" aria-hidden="true" href="#安装-natur-service">#</a></h3>
<p>shell</p>
<p>代码解读</p>
<p>复制代码</p>
<pre><code>`yarn add natur-service`
</code></pre>
<h3 id="创建一个natur-service实例">创建一个natur-service实例<a hidden class="anchor" aria-hidden="true" href="#创建一个natur-service实例">#</a></h3>
<p>先写一个store当测试例子 <code>testStore.ts</code></p>
<p>js</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>import { createStore } from 'natur'; const count = {   state: 1,   actions: {     inc: (state) =&gt; state + 1,     dec: (state) =&gt; state - 1,   } } const modules = {   count,   count1: count, }; const lazyModules = {}; export const store = createStore(modules, lazyModules); export type M = typeof modules; export type LM = typeof lazyModules;</code></p>
<p>然后在同目录下新建个<code>service.ts</code></p>
<p>js</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>import {store, M, LM} from &quot;./testStore.ts&quot;; import NaturService from &quot;natur-service&quot;; class CountService extends NaturService&lt;M, LM&gt; {   constructor() {     super(store);     ...   } } // 实例化，开始监听 const countService = new CountService();</code></p>
<h3 id="模块间的通信">模块间的通信<a hidden class="anchor" aria-hidden="true" href="#模块间的通信">#</a></h3>
<p>js</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>import {store, M, LM} from &quot;store&quot;; import NaturService from &quot;natur-service&quot;; class CountService extends NaturService&lt;M, LM&gt; {   constructor() {     super(store);     // 执行count模块的inc方法     this.dispatch('count', 'inc', 0).then(() =&gt; {       // 如果count是一个还未加载的模块，那么等到count加载完成后才会触发这个action       // 如果在未加载完成期间，重复多次的调用同一个action，那么旧的dispatch会抛出一个固定的Promise错误，以清除缓存，防止爆栈       console.log('dispatch完成');     })   } } // 实例化，执行推送 const countService = new CountService();</code></p>
<h3 id="监听模块的更新以及更新的详情信息">监听模块的更新、以及更新的详情信息<a hidden class="anchor" aria-hidden="true" href="#监听模块的更新以及更新的详情信息">#</a></h3>
<p>js</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>import {store, M, LM} from &quot;store&quot;; import NaturService from &quot;natur-service&quot;; class CountService extends NaturService&lt;M, LM&gt; {   constructor() {     super(store);     // 观察count模块， ModuleEvent请看文档     this.watch(&quot;count&quot;, (me: ModuleEvent) =&gt; {       // 这是更新详情       console.log(me);       // 这是你要执行的业务逻辑       console.log('count module has changed.');     });   } } // 实例化，开始监听 const countService = new CountService();</code></p>
<p><strong>ModuleEvent</strong></p>
<p>属性名称</p>
<p>说明</p>
<p>类型</p>
<p>state</p>
<p>模块最新的state</p>
<p>any</p>
<p>undefined</p>
<p>type</p>
<p>触发模块更新的类型，&lsquo;init&rsquo; 是模块初始化触发，&lsquo;update&rsquo; 是模块的state更新时触发，&lsquo;remove&rsquo;是模块卸载时触发</p>
<p>&lsquo;init&rsquo;</p>
<p>&lsquo;update&rsquo;</p>
<p>&lsquo;remove&rsquo;</p>
<p>actionName</p>
<p>触发模块更新的action名称，只有在 type为&rsquo;update&rsquo;时才会存在</p>
<p>string</p>
<p>undefined</p>
<p>oldModule</p>
<p>旧模块的数据，当type为&rsquo;init&rsquo;时为undefined</p>
<p>InjectStoreModule</p>
<p>undefined</p>
<p>newModule</p>
<p>新模块的数据，当type为&rsquo;remove&rsquo;是为undefined</p>
<p>InjectStoreModule</p>
<p>undefined</p>
<h2 id="对比-1">对比<a hidden class="anchor" aria-hidden="true" href="#对比-1">#</a></h2>
<h3 id="所有的状态都放在仓库里行不行">所有的状态都放在仓库里行不行<a hidden class="anchor" aria-hidden="true" href="#所有的状态都放在仓库里行不行">#</a></h3>
<p>无论是使用Dva（Redux）还是Mobx，都被这个问题困扰过很久，经过纠结我选择了一个折中方案：</p>
<blockquote>
<p>我先写成组件状态，然后根据需要再讲这个组件状态改成仓库状态。</p>
</blockquote>
<p>不全放在仓库里有几点顾虑：</p>
<ol>
<li>都放进去，我就分不清哪些状态是全局，哪些是局部了（可能没啥太大必要）。</li>
<li>都放进去，那么多的状态全混在一起，那这个module就会很臃肿。</li>
<li>拆分模块的话，跨模块通信，互相监听彼此的业务，会不会变得很混乱啊。</li>
</ol>
<h3 id="有了natur-service问题就简单了">有了natur-service，问题就简单了<a hidden class="anchor" aria-hidden="true" href="#有了natur-service问题就简单了">#</a></h3>
<h4 id="redux跨模块通信就有点拉了">Redux跨模块通信就有点拉了<a hidden class="anchor" aria-hidden="true" href="#redux跨模块通信就有点拉了">#</a></h4>
<p>Redux也许专注的是全局状态管理，连拆分模块都得自己动手，Dva就很好地完善了Redux，但仍会有一个尴尬的问题，人嘛容易懒，你会发现写来写去，一个<code>model</code>的<code>effect</code>一堆，但是<code>reducer</code>就一个，毕竟这么多<code>effect</code>都用一个<code>reducer</code>看起来也没啥不行的。</p>
<p>但这么做，跨模块通信触发的<code>reducer</code>不就都用这一个了么，那还咋分清是哪个action触发的啊。</p>
<h4 id="跨模块通信容易了模块拆分也就好管了">跨模块通信容易了，模块拆分也就好管了<a hidden class="anchor" aria-hidden="true" href="#跨模块通信容易了模块拆分也就好管了">#</a></h4>
<p>有了natur-service，在拆分module这块就好了不少，让跨模块通信变得井井有条，同时也没有让模块间有耦合关系， 相比Dva你得用<code>put</code>来触发指定模块的<code>effect</code>或者<code>reducer</code>。</p>
<p>js</p>
<p>代码解读</p>
<p>复制代码</p>
<pre><code>`*testEffect(_, { call, put, select }) {             ...             yield put({                     type: '其他模块/effect或者reducer',                     payload: data,             });             ...     }`
</code></pre>
<p>Mobx就更过，直接得引入这个模块，从而执行相应的<code>action</code>。</p>
<p>js</p>
<p>代码解读</p>
<p>复制代码</p>
<pre><code>`@action 	fetchLightDelete = (params:any) =&gt; {             ...             otherModule.testAction()             ... 	}`
</code></pre>
<p>natur根本就不用在模块里写这个写这些，你完全可以通过设立一个flag状态变量和触发它改变的action就行。</p>
<p>js</p>
<p>代码解读</p>
<p>复制代码</p>
<pre><code>`class CountService extends NaturService&lt;M, LM&gt; {         constructor() {             this.watch(&quot;flagAction&quot;, (me: ModuleEvent) =&gt; {                     this.dispatch('count', 'inc', 0).then(() =&gt; {});             }         }     }`
</code></pre>
<p>虽然加了一个无关紧要的flagState来触发natur-service的监听的方式有些“做作”，但这可以让natur-servic精细掌控跨模块通信。</p>
<h4 id="一些多个仓库整合调度的业务就不用混在ui层了">一些多个仓库整合调度的业务就不用混在UI层了。<a hidden class="anchor" aria-hidden="true" href="#一些多个仓库整合调度的业务就不用混在ui层了">#</a></h4>
<p>有种业务场景，非常适合natur-service发挥，比如A页面有了个仓库操作，首页和用户页面会有连带的一些仓库状态的操作，一般我是要在UI层搞的，也就是在组件的生命周期的<code>componentDidmount</code>这种函数里进行业务整合。</p>
<p>但是选哪个页面里写呢？看似应该谁引起的谁写，但一细想，这不耦合了，为啥其他页面的业务要在登录页面写呢？这么一想确实不是很好，而有了natur-service，直接交给它就完了，省的纠结在哪写，写来写去还容易乱。</p>
<h3 id="和mobx较量一下维护性">和Mobx较量一下维护性。。。<a hidden class="anchor" aria-hidden="true" href="#和mobx较量一下维护性">#</a></h3>
<p>我觉得不用比了，Mobx的可变值这一点，如果不加一套严格的规范和一些必要手段（做个统一修改入口函数啥的），你就很难管理好Mobx，太自由，爱过火。</p>
<h3 id="我的观点-1">我的观点<a hidden class="anchor" aria-hidden="true" href="#我的观点-1">#</a></h3>
<p>基于以上主观的分析，我得出了我的观点。</p>
<p><strong>维护难度</strong>：Mobx&gt;<strong>Natur</strong>&gt;Redux</p>
<p>比较下来，真的我心里越发的觉得<strong>Natur</strong>更好维护，不过Redux毕竟大牌子，估计应该更好吧。。。</p>
<h1 id="总结">总结<a hidden class="anchor" aria-hidden="true" href="#总结">#</a></h1>
<p>通过短期看上手和长远看维护，我比较下来，Natur很适合我，能够很好的满足我组织代码的需求，对于一个常常开发中拨溜项目的我来说，正正好好。</p>
<h1 id="题外话">题外话<a hidden class="anchor" aria-hidden="true" href="#题外话">#</a></h1>
<p>作为一个普普通通前端coder，每当看到一个国内开发者的库，尤其是没有光环的，我会格外的关注和尊重，并拿出足够的热情去学习和分享，我认为好的库就好像一个发光体，能用来取暖获取力量，同时更应该将光折射出去，而不是去遮掩，这是可耻的，也是徒劳的，然而一个优秀的光源是不惧怕掩盖的，也是盖不灭的，因为只有自己能让自己发光。</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/react.js/">React.js</a></li>
      <li><a href="http://localhost:1313/tags/redux/">Redux</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://localhost:1313/posts/juejin/%E5%A6%82%E4%BD%95%E5%9C%A8vite5reactts%E9%A1%B9%E7%9B%AE%E4%B8%AD%E4%BC%98%E9%9B%85%E7%9A%84%E4%BD%BF%E7%94%A8mock%E6%95%B0%E6%8D%AE/">
    <span class="title">« 上一页</span>
    <br>
    <span>如何在Vite5➕React➕Ts项目中优雅的使用Mock数据？🔥</span>
  </a>
  <a class="next" href="http://localhost:1313/posts/juejin/%E5%BC%BA%E8%AF%9D%E4%B8%80%E6%B3%A2%E5%8E%9F%E5%9E%8B%E5%90%A7%E6%85%A2%E4%B8%8B%E6%9D%A5%E5%AD%A6%E6%98%8E%E7%99%BD%E5%8F%AF%E8%83%BD%E6%98%AF%E5%8F%8D%E5%8D%B7%E7%9A%84%E5%94%AF%E4%B8%80%E6%96%B9%E6%B3%95/">
    <span class="title">下一页 »</span>
    <br>
    <span>强话一波原型吧，慢下来学明白，可能是反卷的唯一方法</span>
  </a>
</nav>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 用Mobx许久后，常怀念起Redux的美好，而今我遇到了Natur on x"
            href="https://x.com/intent/tweet/?text=%e7%94%a8Mobx%e8%ae%b8%e4%b9%85%e5%90%8e%ef%bc%8c%e5%b8%b8%e6%80%80%e5%bf%b5%e8%b5%b7Redux%e7%9a%84%e7%be%8e%e5%a5%bd%ef%bc%8c%e8%80%8c%e4%bb%8a%e6%88%91%e9%81%87%e5%88%b0%e4%ba%86Natur&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E7%2594%25A8mobx%25E8%25AE%25B8%25E4%25B9%2585%25E5%2590%258E%25E5%25B8%25B8%25E6%2580%2580%25E5%25BF%25B5%25E8%25B5%25B7redux%25E7%259A%2584%25E7%25BE%258E%25E5%25A5%25BD%25E8%2580%258C%25E4%25BB%258A%25E6%2588%2591%25E9%2581%2587%25E5%2588%25B0%25E4%25BA%2586natur%2f&amp;hashtags=React.js%2cRedux">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 用Mobx许久后，常怀念起Redux的美好，而今我遇到了Natur on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E7%2594%25A8mobx%25E8%25AE%25B8%25E4%25B9%2585%25E5%2590%258E%25E5%25B8%25B8%25E6%2580%2580%25E5%25BF%25B5%25E8%25B5%25B7redux%25E7%259A%2584%25E7%25BE%258E%25E5%25A5%25BD%25E8%2580%258C%25E4%25BB%258A%25E6%2588%2591%25E9%2581%2587%25E5%2588%25B0%25E4%25BA%2586natur%2f&amp;title=%e7%94%a8Mobx%e8%ae%b8%e4%b9%85%e5%90%8e%ef%bc%8c%e5%b8%b8%e6%80%80%e5%bf%b5%e8%b5%b7Redux%e7%9a%84%e7%be%8e%e5%a5%bd%ef%bc%8c%e8%80%8c%e4%bb%8a%e6%88%91%e9%81%87%e5%88%b0%e4%ba%86Natur&amp;summary=%e7%94%a8Mobx%e8%ae%b8%e4%b9%85%e5%90%8e%ef%bc%8c%e5%b8%b8%e6%80%80%e5%bf%b5%e8%b5%b7Redux%e7%9a%84%e7%be%8e%e5%a5%bd%ef%bc%8c%e8%80%8c%e4%bb%8a%e6%88%91%e9%81%87%e5%88%b0%e4%ba%86Natur&amp;source=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E7%2594%25A8mobx%25E8%25AE%25B8%25E4%25B9%2585%25E5%2590%258E%25E5%25B8%25B8%25E6%2580%2580%25E5%25BF%25B5%25E8%25B5%25B7redux%25E7%259A%2584%25E7%25BE%258E%25E5%25A5%25BD%25E8%2580%258C%25E4%25BB%258A%25E6%2588%2591%25E9%2581%2587%25E5%2588%25B0%25E4%25BA%2586natur%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 用Mobx许久后，常怀念起Redux的美好，而今我遇到了Natur on reddit"
            href="https://reddit.com/submit?url=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E7%2594%25A8mobx%25E8%25AE%25B8%25E4%25B9%2585%25E5%2590%258E%25E5%25B8%25B8%25E6%2580%2580%25E5%25BF%25B5%25E8%25B5%25B7redux%25E7%259A%2584%25E7%25BE%258E%25E5%25A5%25BD%25E8%2580%258C%25E4%25BB%258A%25E6%2588%2591%25E9%2581%2587%25E5%2588%25B0%25E4%25BA%2586natur%2f&title=%e7%94%a8Mobx%e8%ae%b8%e4%b9%85%e5%90%8e%ef%bc%8c%e5%b8%b8%e6%80%80%e5%bf%b5%e8%b5%b7Redux%e7%9a%84%e7%be%8e%e5%a5%bd%ef%bc%8c%e8%80%8c%e4%bb%8a%e6%88%91%e9%81%87%e5%88%b0%e4%ba%86Natur">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 用Mobx许久后，常怀念起Redux的美好，而今我遇到了Natur on facebook"
            href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E7%2594%25A8mobx%25E8%25AE%25B8%25E4%25B9%2585%25E5%2590%258E%25E5%25B8%25B8%25E6%2580%2580%25E5%25BF%25B5%25E8%25B5%25B7redux%25E7%259A%2584%25E7%25BE%258E%25E5%25A5%25BD%25E8%2580%258C%25E4%25BB%258A%25E6%2588%2591%25E9%2581%2587%25E5%2588%25B0%25E4%25BA%2586natur%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 用Mobx许久后，常怀念起Redux的美好，而今我遇到了Natur on whatsapp"
            href="https://api.whatsapp.com/send?text=%e7%94%a8Mobx%e8%ae%b8%e4%b9%85%e5%90%8e%ef%bc%8c%e5%b8%b8%e6%80%80%e5%bf%b5%e8%b5%b7Redux%e7%9a%84%e7%be%8e%e5%a5%bd%ef%bc%8c%e8%80%8c%e4%bb%8a%e6%88%91%e9%81%87%e5%88%b0%e4%ba%86Natur%20-%20http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E7%2594%25A8mobx%25E8%25AE%25B8%25E4%25B9%2585%25E5%2590%258E%25E5%25B8%25B8%25E6%2580%2580%25E5%25BF%25B5%25E8%25B5%25B7redux%25E7%259A%2584%25E7%25BE%258E%25E5%25A5%25BD%25E8%2580%258C%25E4%25BB%258A%25E6%2588%2591%25E9%2581%2587%25E5%2588%25B0%25E4%25BA%2586natur%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 用Mobx许久后，常怀念起Redux的美好，而今我遇到了Natur on telegram"
            href="https://telegram.me/share/url?text=%e7%94%a8Mobx%e8%ae%b8%e4%b9%85%e5%90%8e%ef%bc%8c%e5%b8%b8%e6%80%80%e5%bf%b5%e8%b5%b7Redux%e7%9a%84%e7%be%8e%e5%a5%bd%ef%bc%8c%e8%80%8c%e4%bb%8a%e6%88%91%e9%81%87%e5%88%b0%e4%ba%86Natur&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E7%2594%25A8mobx%25E8%25AE%25B8%25E4%25B9%2585%25E5%2590%258E%25E5%25B8%25B8%25E6%2580%2580%25E5%25BF%25B5%25E8%25B5%25B7redux%25E7%259A%2584%25E7%25BE%258E%25E5%25A5%25BD%25E8%2580%258C%25E4%25BB%258A%25E6%2588%2591%25E9%2581%2587%25E5%2588%25B0%25E4%25BA%2586natur%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 用Mobx许久后，常怀念起Redux的美好，而今我遇到了Natur on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=%e7%94%a8Mobx%e8%ae%b8%e4%b9%85%e5%90%8e%ef%bc%8c%e5%b8%b8%e6%80%80%e5%bf%b5%e8%b5%b7Redux%e7%9a%84%e7%be%8e%e5%a5%bd%ef%bc%8c%e8%80%8c%e4%bb%8a%e6%88%91%e9%81%87%e5%88%b0%e4%ba%86Natur&u=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E7%2594%25A8mobx%25E8%25AE%25B8%25E4%25B9%2585%25E5%2590%258E%25E5%25B8%25B8%25E6%2580%2580%25E5%25BF%25B5%25E8%25B5%25B7redux%25E7%259A%2584%25E7%25BE%258E%25E5%25A5%25BD%25E8%2580%258C%25E4%25BB%258A%25E6%2588%2591%25E9%2581%2587%25E5%2588%25B0%25E4%25BA%2586natur%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span><a href="https://beian.miit.gov.cn/">粤ICP备2023039897号-1</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = '复制';

        function copyingDone() {
            copybutton.innerHTML = '已复制！';
            setTimeout(() => {
                copybutton.innerHTML = '复制';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
