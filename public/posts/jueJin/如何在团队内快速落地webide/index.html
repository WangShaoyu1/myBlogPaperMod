<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>如何在团队内快速落地WebIDE | PaperMod</title>
<meta name="keywords" content="VisualStudioCode">
<meta name="description" content="在云音乐团队内部的WebIDE终于落地了。目前功能上覆盖前端正常的业务开发已无问题，期间也踩了不少坑，故写此篇文章，给想要在团队落地WebIDE做一份参考。">
<meta name="author" content="程序员芋仔">
<link rel="canonical" href="http://localhost:1313/posts/juejin/%E5%A6%82%E4%BD%95%E5%9C%A8%E5%9B%A2%E9%98%9F%E5%86%85%E5%BF%AB%E9%80%9F%E8%90%BD%E5%9C%B0webide/">
<meta name="google-site-verification" content="XYZabc">
<link crossorigin="anonymous" href="/assets/css/stylesheet.7b92bf4867c997b58ec50f63451b83777173d5bd5593376852abd85746d09d71.css" integrity="sha256-e5K/SGfJl7WOxQ9jRRuDd3Fz1b1VkzdoUqvYV0bQnXE=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<link rel="apple-touch-icon" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<link rel="mask-icon" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="zh" href="http://localhost:1313/posts/juejin/%E5%A6%82%E4%BD%95%E5%9C%A8%E5%9B%A2%E9%98%9F%E5%86%85%E5%BF%AB%E9%80%9F%E8%90%BD%E5%9C%B0webide/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript><meta property="og:title" content="如何在团队内快速落地WebIDE" />
<meta property="og:description" content="在云音乐团队内部的WebIDE终于落地了。目前功能上覆盖前端正常的业务开发已无问题，期间也踩了不少坑，故写此篇文章，给想要在团队落地WebIDE做一份参考。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/posts/juejin/%E5%A6%82%E4%BD%95%E5%9C%A8%E5%9B%A2%E9%98%9F%E5%86%85%E5%BF%AB%E9%80%9F%E8%90%BD%E5%9C%B0webide/" />
<meta property="og:image" content="http://localhost:1313/images/papermod-cover.png" />
<meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-09-16T00:00:00+00:00" />
<meta property="article:modified_time" content="2021-09-16T00:00:00+00:00" />


<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="http://localhost:1313/images/papermod-cover.png" />
<meta name="twitter:title" content="如何在团队内快速落地WebIDE"/>
<meta name="twitter:description" content="在云音乐团队内部的WebIDE终于落地了。目前功能上覆盖前端正常的业务开发已无问题，期间也踩了不少坑，故写此篇文章，给想要在团队落地WebIDE做一份参考。"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "如何在团队内快速落地WebIDE",
      "item": "http://localhost:1313/posts/juejin/%E5%A6%82%E4%BD%95%E5%9C%A8%E5%9B%A2%E9%98%9F%E5%86%85%E5%BF%AB%E9%80%9F%E8%90%BD%E5%9C%B0webide/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "如何在团队内快速落地WebIDE",
  "name": "如何在团队内快速落地WebIDE",
  "description": "在云音乐团队内部的WebIDE终于落地了。目前功能上覆盖前端正常的业务开发已无问题，期间也踩了不少坑，故写此篇文章，给想要在团队落地WebIDE做一份参考。",
  "keywords": [
    "VisualStudioCode"
  ],
  "articleBody": "在云音乐团队内部的WebIDE终于落地了。目前功能上覆盖前端正常的业务开发已无问题，期间也踩了不少坑，故写此篇文章，给想要在团队落地WebIDE做一份参考。当然，一些很细节的问题的处理，一篇文章是不好涵盖的，本文更多的是设计的方案及落地的方向的参考。\nWebIDE的意义 其实在发起WebIDE这个项目之初，很多人，上级、同事、部门领导，都会对项目发起质疑：意义在哪？能带来什么业务价值？\n说实话这个问题，最初包括现在我也觉得很难回答，新人上手更方便？远程办公？代码更安全？统计开发人员的写代码时长？私有插件域？\n但是这些，似乎并不是业务开发中的一个特别痛的点。当然，在小程序，faas或者云服务的业务确实能带来一些业务价值，毕竟，这些服务本身有一部分就是靠WebIDE吃饭的。但是排除了这几个业务场景，对于大部分普通的业务团队，其实WebIDE的意义，业务上的价值说实话并不大。\n但是衡量一个项目的价值，并不能仅从业务的角度去思考。WebIDE的其他价值，我个人从团队、研发效率、公司层面梳理了几个点（都是做的差不多之后才凑出来的）：\n激发团队活力，提升新人留存率。本身作为一项不太普及的技术，其实或多或少能够激发团队的思考，增加团队活力。而作为一项未来可能成为前端基建的技术，对于新人的留存是有帮助的。基建不完善，那么新人招来了，内心必定会吐槽，流失也就理所当然。 切换项目更方便。对于multirepo的前端团队，相信不少同学经常会在3-4个项目间切换，项目启动关闭一次较麻烦不说，对电脑的电量，内存都是不小的负荷。而webide将这一部分负荷转移到远程容器，省去了本地的负荷和每次启动打开的不便(finder -\u003e terminal -\u003e run dev -\u003e open vscode)，说实话，个人感觉开发起来更方便。毕竟启动项目就是打开一个网页，而关闭项目也无需担心进度未保存。 团队配置化的统一。统一化插件、ide配置，代码移交更顺畅 远程办公。疫情之下，不多说，不必合适的设备即可写代码，便利性极大提升 代码更加安全。稍加限制，即可防止代码被拷贝，同时从公司层面，衡量程序员的工作时间会更加方便（ps：我是不会把这个功能做进去的，程序员使用IDE的市场对衡量程序员的价值没有多少参考意义） demo编写方便。开源的公开的工具很多，但是往往需要私有包，这一点外部开源项目基本无能为力 研发平台的整合，闭合研发链路。团队大了，各个平台层出不穷，开发过程中往往会伴随多个平台的切换，将IDE嵌入网页，同时整合各个研发平台，避免反复切换平台带来的繁琐与不便 私有插件。当然避免团队插件发布共有域的方案也有，但是直接搭建私有插件市场，更加方便直观。 个人认为，讨论一项还未落地的技术的意义，不见得是一个有意义的讨论。WebIDE的意义有多大，更多的取决于团队能把，或者说想把这个事做的多大。所以本文不在此赘述，对IDE感兴趣？干就完事了。\n业内主流产品、技术方案对比 虽然WebIDE本身还未流行，但是在各大云厂商，各大国内大厂均已有落地产品，谈不上一个比较新的技术，而其实现方案，也基本明确并且成熟，此处挑几个进行简单介绍。\nvscode流派 比较流行的方案，代表有coder, code-server，vsonline。\n这一类IDE产品，基于vscode进行web端的一些修改，同时贴合github，实现个人项目的webide开发。\n但是缺点很统一：收费且团队难以接入使用（团队登陆检验，gitlab接入），代码安全也难以保证\nTheia theia比较流行的方案。一部分功能复用vscode，但是设计初衷便是为了扩展，所以私有化部署，定制化功能极其方便。\n目前有的产品有：\ngitpod，阿里系ide（自研kaitian不是基于theia），华为云ide，google云ide。\n在扩展能力上，远超vscode，同时具备全开源，社区活跃度较高，接入改造成本低，不收费的优点\n本人在团队内落地的IDE也是基于该框架。\nstackblitz stackblitz相信大家都不陌生，非常方便的一款写demo的IDE，本来个人认为他是与codesandbox一个流派的，但是他推出了web container的概念，提供了非容器化方案的纯前端node环境，可以说非常有价值。\n目前该方案不开源，目前猜测较多的是serverice worker实现请求拦截，webassembly提供了node的环境，从而实现不需要远程机器，全部都跑在浏览器的一个IDE。\n整体来讲，其技术方案的优点在于不消耗远程资源，但是缺点，一个是不开源，一个是毕竟是模拟的node环境，在各个系统的一些层面可能会有所缺失（猜测）。\n其他 还有一些其他的方案：\n基于前端构建的codesandbox，这个网上分析的文章比较多，此处不赘述，其缺点在于没有完整的命令行，跑跑基于webpack的前端页面还行，node代码不能跑起来的，更多的是拿来写ui demo的一个工具。 阿里的kaitian，纯自研的一款IDE，尝试取代THEIA的一款纯自研的IDE，目前未开源 coding团队的webide，coding，曾经开过源，目前不明 整体对比 vscode流派：付费，接入不便，扩展不易 theia流派：业内流行的开源方案，成熟落地产品多，扩展非常容易 Stackblitz: 技术方案独特，纯前端的WebIDE，但是目前看除了写demo快，团队接入和扩展都没有提供方案 codesandbox: 前端构建的，更多用来写demo kaitian, codeing等自研，不开源，具体不太清楚 接入方案选择 对于团队需要的WebIDE，个人认为满足日常的开发是必须的。所以易扩展，一定是排在第一位的，这一点非theia莫属。而开源、不收费、稳定性好、社区活跃也是theia的长处。长期来看，theia的接入成本低、扩展性好，社区活跃方便后期维护，是一个非常棒的方案。本人在云音乐团队落地的也是最终采取的这一方案。\n如何在团队内快速落地 说了这么多，其实到这一章才算正式开始落地。\nWebIDE作为一项成熟的技术，这几年才逐渐的出现在较多的场合，这里面也是有技术方面的一些原因。目前各大WebIDE的方案，基本都是基于容器的方案，这一方案，需要团队有比较完善的容器化的管理及动态部署的能力。\n所以在落地前，容器化部署的能力是需要团队所必须具备的，当然，使用外部商业化的也可。\n除此之外，一些基本的基础设施也需要比较完善，比如gitlab、成员管理、前后端项目部署等基建产品。\n具备上述能力后，才可以满足快速落地的要求。\n整体结构 笔者认为，WebIDE的落地可以充分发挥互联网小步迭代，快速上线的迭代方式。先搭小汽车，再做摩托车，最后再到小汽车。一步一步对功能进行完善。\n在笔者看来，一个自行车版WebIDE所需要具备的基础能力有：\n团队成员管理系统 or oa接入 团队gitlab接入 私有包安装的能力 IDE管理，新建，关闭，删除等基本功能 支持前端项目运行 出于满足上述能力的需求，笔者最初（后来也只是新增了一些独立的工程）将项目划分为4个工程：\nIde-studio: 前端管理后台，负责IDE的新建，关闭，后期可拓展出插件市场等功能 Ide-studio-backend: 纯nodejs后台，一方面负责管理后台的接口，另一方面接入团队成员管理系统，后期可用来拓展私有插件以及共有插件等功能，同时处理和容器化部署平台的协作。 Ide-extension: 用于开发theia扩展，定制团队特有功能，比如接入团队成员管理系统，记录活跃时间，集成团队内部研发平台等 Ide-docker: 用于存放ide的docker相关文件。由于theia本身是为拓展而生，只需要一个package.json即可生成ide相关，所以单独将docker镜像的构建伶出来 落地方案 theia容器构建 theia本身已有容器启动方案，已经提供了dockerfile文件，可以直接使用该docker进行部署，笔者团队使用的是基于theia-docker进行的修改。\n官方dockerfile如下，笔者直接在上面增加了自己的注释：\ndockerfile\n代码解读\n复制代码\n# 选择容器底层node依赖 ARG NODE_VERSION=12.18.3 FROM node:${NODE_VERSION}-alpine # 增加theia install时需要的必要系统依赖 RUN apk add --no-cache make pkgconfig gcc g++ python libx11-dev libxkbfile-dev libsecret-dev ARG version=latest WORKDIR /home/theia ADD $version.package.json ./package.json # 这个GITHUB_TOKEN，需要在容器构建时指定(由于部分npm包安装需要从github拉取，使用github_token才可以顺利安装) ARG GITHUB_TOKEN # 安装，同时清理掉全局缓存 RUN yarn --pure-lockfile \u0026\u0026 \\ NODE_OPTIONS=\"--max_old_space_size=4096\" yarn theia build \u0026\u0026 \\ yarn theia download:plugins \u0026\u0026 \\ yarn --production \u0026\u0026 \\ yarn autoclean --init \u0026\u0026 \\ echo *.ts \u003e\u003e .yarnclean \u0026\u0026 \\ echo *.ts.map \u003e\u003e .yarnclean \u0026\u0026 \\ echo *.spec.* \u003e\u003e .yarnclean \u0026\u0026 \\ yarn autoclean --force \u0026\u0026 \\ yarn cache clean # 重新选择底层系统依赖，目的是保留容器系统极简，去掉了theia安装过程中需要的系统依赖，从而减小镜像提及 FROM node:${NODE_VERSION}-alpine # See : https://github.com/theia-ide/theia-apps/issues/34 RUN addgroup theia \u0026\u0026 \\ adduser -G theia -s /bin/sh -D theia; RUN chmod g+rw /home \u0026\u0026 \\ mkdir -p /home/project \u0026\u0026 \\ chown -R theia:theia /home/theia \u0026\u0026 \\ chown -R theia:theia /home/project; # 增加git bash等基础系统依赖 RUN apk add --no-cache git openssh bash libsecret ENV HOME /home/theia WORKDIR /home/theia COPY --from=0 --chown=theia:theia /home/theia /home/theia EXPOSE 3000 ENV SHELL=/bin/bash \\ THEIA_DEFAULT_PLUGINS=local-dir:/home/theia/plugins ENV USE_LOCAL_GIT true USER theia # run theia服务，默认运行在3000端口 ENTRYPOINT [ \"node\", \"/home/theia/src-gen/backend/main.js\", \"/home/project\", \"--hostname=0.0.0.0\" ]\n整体来讲，这是一个比较标准的前端工程运行文件，对docker没有基础的搜一搜看懂也不难。\n不过，其中几个实际踩的坑需要注意一下：\ngithub_token需要指定，否则会出现部分npm包无法下载的问题。使用自己的github_token即可，生成方法见官方文档 构建镜像的时候注意关闭自己电脑的代理(比如charles等)，也会造成npm包安装问题 当然，这是theia官方的镜像，实际实现自行车版本的WebIDE的时候，还需要执行如下操作：\n注入git公私钥，此处建议使用单个仓库的私钥，使权限最小化 自动clone目标代码 注入npm 私有域，从而使用者无需再进行配置 执行用户自定义的自动化脚本 这些操作可以自己写一个node脚本，在最后同theia服务的启动一起执行一遍即可。\n而在实际的落地及使用过程中，还遇到一些实际的问题：\ngit公私钥如何获取，此处在IDE容器内确实不好获取，存在鉴权等问题，故笔者是在容器创建时(此时是有用户身份信息的)，将相关变量注入到容器的环境变量中，容器内直接拿环境变量的数据构建公私钥即可 root权限，如dockerfile中所示，theia出于容器的安全考虑，创建了一个工作区，用户的身份都是theia，而系统内的一些依赖其实是不够的，比如gcc, g++等部分npm包安装所需要的系统依赖都没有，另外也没有一些必要的系统依赖比如，curl。所以可以给用户开放root权限 命令行问题，默认使用的是linux的bash，是没有git、高亮等支持，体验非常差，所以可以把oh-my-zsh集成进去 为了解决上述问题，笔者在原有的dockerfile中增加了如下命令\ndockerfile\n代码解读\n复制代码\n# 增加系统依赖，以便npm安装可以顺利进行 RUN apk add --no-cache make pkgconfig gcc g++ python curl # 安装zsh，美化命令行 RUN apk add --no-cache git openssh bash zsh libsecret-dev # 增加root身份，以便用户可以自行增加全局系统依赖 RUN chmod 4755 /bin/busybox RUN echo 'root:danger' | chpasswd # 修改最终的启动命令 ENTRYPOINT [\"/bin/sh\", \"/home/cloud-theia/start.sh\"] # 在start.sh中，执行git,npm全局配置的脚本，并且启动theia自身的服务\n至此，容器的功能基本完善。可以直接本地构建一个跑起来看看。\nIDE管理页面搭建 这一部分是比较常规的前端页面，此处大家应该耳熟能详，使用一些中后台模版搭建即可。\n主要具备的功能有：\nIDE的管理：增删查改 插件的管理：私有/公有插件，插件的上传及管理 基本的团队成员登陆/注销 其中，插件管理可以使用theia本身推荐的openvsx，本身全开源，也推荐私有化部署后使用。\n笔者当时由于IDE管理系统想和插件管理系统直接无缝切换（懒），只是对接口通过node后台直接转发到openvsx，从而获取其数据，简单快捷的实现了公有插件的获取/下载。\nIDE后台服务搭建 笔者基于egg.js搭建了IDE的后台，主要承载的能力有：\nIDE管理，比较常规的后台接口\n插件管理，私有插件的自存储，公有插件进行转发到openvsx\n处理网易轻舟云容器部署、域名转发等服务的交互（网易轻舟，个性化等用下来体验还不错）\n处理IDE容器内，插件安装/搜索时需要的一些服务处理\n基本的成员登陆/注销\n整体来讲，代码基本跟平时的node服务无差。不再赘述\ntheia扩展 这一部分，应该是大部分没有接触过theia的同学比较难以处理的地方。虽然说theia本身提供了非常方便的扩展能力，但是该方便，还是建立在你对theia的构建有一定的了解之上。\n官网介绍的不多，可以看这篇文章，跑起来问题不大，剩下的用到了查看源码即可。\n但是接入自己的团队，其实需要扩展的地方不多，笔者目前也仅仅改动了以下几条：\n团队成员登陆/注销（纯前端扩展） 团队logo、成员信息展示、相关帮助链接的跳转 这一部分都还没有涉及到theia的jsonrpc，后端扩展能力。但是自行车版足以。\n上个图吧，其实在扩展能力上，只是用到了一些皮毛：\n笔者在实际使用过程中，还有以下几个环境变量的改动：\nVSX_REGISTRY_URL，这是插件市场的插件源改动，默认是指向openvsx，要实现私有插件，直接改变其到自己的私有市场并实现相关接口即可 THEIA_WEBVIEW_EXTERNAL_ENDPOINT，webview的web版方案，默认是指向了uuid.minibrowser.{uuid}.minibrowser.uuid.minibrowser.{hostname}，由于在实际落地场景中，这样修改域名的写法，https泛域名证书也无法使用，必须一个ide申请一个，而webview借助了 service worker，如果不使用https就无法工作，所以笔者这边直接改成了hostname，其利害及缘由可以参考此文章 THEIA_MINI_BROWSER_HOST_PATTERN，同上，也是改成了hostname，来完成图片文件的预览 其他 文档站建设，模版建设等一些常规的操作，不再赘述\n总结 整体来讲，上述都搭建好之后，一个团队可用的webide就做好了。\n目前笔者团队的webide，已经能够满足日常的开发使用，后续会进一步增加扩展，作为各个研发平台的承载点，解决目前开发过程中的不同平台反复切换的问题。\n当然，实际落地中，还会有很多琐碎的细节问题，大家可以一起交流哈。\n最后 webide作为一项成熟的技术，团队落地整个流程下来，笔者认为回头去看，其实没有什么特别大的坑点以及技术上的难点。\n原本题目准备起：前端小白如何在团队内落地webide，但是后来想想，这就有点误人子弟了，虽然前端相关的代码确实没写几行，但是对其他的一些知识需要一定的储备，比如容器化、node、运维等知识。\n最后，笔者在建立了完备的webide之后，自己的业务都已经在webide上进行开发，但是团队的大部分成员还是持保守态度。后续会继续提升开发体验，让越来越多的成员接纳这个套了老技术的新IDE。\n",
  "wordCount" : "361",
  "inLanguage": "zh",
  "image": "http://localhost:1313/images/papermod-cover.png","datePublished": "2021-09-16T00:00:00Z",
  "dateModified": "2021-09-16T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "程序员芋仔"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/posts/juejin/%E5%A6%82%E4%BD%95%E5%9C%A8%E5%9B%A2%E9%98%9F%E5%86%85%E5%BF%AB%E9%80%9F%E8%90%BD%E5%9C%B0webide/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "PaperMod",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/%3Clink%20/%20abs%20url%3E"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Home (Alt + H)">
                        
                    <img src="http://localhost:1313/images/msg_hu15231257772499651944.png" alt="" aria-label="logo"
                        height="20">Home</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/archives" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="https://github.com/adityatelange/hugo-PaperMod/wiki/" title="WiKi">
                    <span>WiKi</span>&nbsp;
                    <svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12">
                        <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path>
                        <path d="M15 3h6v6"></path>
                        <path d="M10 14L21 3"></path>
                    </svg>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/">主页</a>&nbsp;»&nbsp;<a href="http://localhost:1313/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      如何在团队内快速落地WebIDE
    </h1>
    <div class="post-description">
      在云音乐团队内部的WebIDE终于落地了。目前功能上覆盖前端正常的业务开发已无问题，期间也踩了不少坑，故写此篇文章，给想要在团队落地WebIDE做一份参考。
    </div>
    <div class="post-meta"><span title='2021-09-16 00:00:00 +0000 UTC'>九月 16, 2021</span>&nbsp;·&nbsp;2 分钟&nbsp;·&nbsp;程序员芋仔&nbsp;|&nbsp;<a href="https://github.com/WangShaoyu1/myBlogPaperMod/tree/master/content/posts/jueJin/%e5%a6%82%e4%bd%95%e5%9c%a8%e5%9b%a2%e9%98%9f%e5%86%85%e5%bf%ab%e9%80%9f%e8%90%bd%e5%9c%b0WebIDE.md" rel="noopener noreferrer" target="_blank">Suggest Changes</a>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">目录</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#webide%e7%9a%84%e6%84%8f%e4%b9%89" aria-label="WebIDE的意义">WebIDE的意义</a></li>
                <li>
                    <a href="#%e4%b8%9a%e5%86%85%e4%b8%bb%e6%b5%81%e4%ba%a7%e5%93%81%e6%8a%80%e6%9c%af%e6%96%b9%e6%a1%88%e5%af%b9%e6%af%94" aria-label="业内主流产品、技术方案对比">业内主流产品、技术方案对比</a><ul>
                        
                <li>
                    <a href="#vscode%e6%b5%81%e6%b4%be" aria-label="vscode流派">vscode流派</a></li>
                <li>
                    <a href="#theia" aria-label="Theia">Theia</a></li>
                <li>
                    <a href="#stackblitz" aria-label="stackblitz">stackblitz</a></li>
                <li>
                    <a href="#%e5%85%b6%e4%bb%96" aria-label="其他">其他</a></li>
                <li>
                    <a href="#%e6%95%b4%e4%bd%93%e5%af%b9%e6%af%94" aria-label="整体对比">整体对比</a></li>
                <li>
                    <a href="#%e6%8e%a5%e5%85%a5%e6%96%b9%e6%a1%88%e9%80%89%e6%8b%a9" aria-label="接入方案选择">接入方案选择</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%a6%82%e4%bd%95%e5%9c%a8%e5%9b%a2%e9%98%9f%e5%86%85%e5%bf%ab%e9%80%9f%e8%90%bd%e5%9c%b0" aria-label="如何在团队内快速落地">如何在团队内快速落地</a><ul>
                        
                <li>
                    <a href="#%e6%95%b4%e4%bd%93%e7%bb%93%e6%9e%84" aria-label="整体结构">整体结构</a></li>
                <li>
                    <a href="#%e8%90%bd%e5%9c%b0%e6%96%b9%e6%a1%88" aria-label="落地方案">落地方案</a><ul>
                        
                <li>
                    <a href="#theia%e5%ae%b9%e5%99%a8%e6%9e%84%e5%bb%ba" aria-label="theia容器构建">theia容器构建</a></li>
                <li>
                    <a href="#ide%e7%ae%a1%e7%90%86%e9%a1%b5%e9%9d%a2%e6%90%ad%e5%bb%ba" aria-label="IDE管理页面搭建">IDE管理页面搭建</a></li>
                <li>
                    <a href="#ide%e5%90%8e%e5%8f%b0%e6%9c%8d%e5%8a%a1%e6%90%ad%e5%bb%ba" aria-label="IDE后台服务搭建">IDE后台服务搭建</a></li>
                <li>
                    <a href="#theia%e6%89%a9%e5%b1%95" aria-label="theia扩展">theia扩展</a></li>
                <li>
                    <a href="#%e5%85%b6%e4%bb%96-1" aria-label="其他">其他</a></li></ul>
                </li>
                <li>
                    <a href="#%e6%80%bb%e7%bb%93" aria-label="总结">总结</a></li></ul>
                </li>
                <li>
                    <a href="#%e6%9c%80%e5%90%8e" aria-label="最后">最后</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p>在云音乐团队内部的WebIDE终于落地了。目前功能上覆盖前端正常的业务开发已无问题，期间也踩了不少坑，故写此篇文章，给想要在团队落地WebIDE做一份参考。当然，一些很细节的问题的处理，一篇文章是不好涵盖的，本文更多的是设计的方案及落地的方向的参考。</p>
<h2 id="webide的意义">WebIDE的意义<a hidden class="anchor" aria-hidden="true" href="#webide的意义">#</a></h2>
<p>其实在发起WebIDE这个项目之初，很多人，上级、同事、部门领导，都会对项目发起质疑：意义在哪？能带来什么业务价值？</p>
<p>说实话这个问题，最初包括现在我也觉得很难回答，新人上手更方便？远程办公？代码更安全？统计开发人员的写代码时长？私有插件域？</p>
<p>但是这些，似乎并不是业务开发中的一个特别痛的点。当然，在小程序，faas或者云服务的业务确实能带来一些业务价值，毕竟，这些服务本身有一部分就是靠WebIDE吃饭的。但是排除了这几个业务场景，对于大部分普通的业务团队，其实WebIDE的意义，业务上的价值说实话并不大。</p>
<p>但是衡量一个项目的价值，并不能仅从业务的角度去思考。WebIDE的其他价值，我个人从团队、研发效率、公司层面梳理了几个点（都是做的差不多之后才凑出来的）：</p>
<ol>
<li>激发团队活力，提升新人留存率。本身作为一项不太普及的技术，其实或多或少能够激发团队的思考，增加团队活力。而作为一项未来可能成为前端基建的技术，对于新人的留存是有帮助的。基建不完善，那么新人招来了，内心必定会吐槽，流失也就理所当然。</li>
<li>切换项目更方便。对于multirepo的前端团队，相信不少同学经常会在3-4个项目间切换，项目启动关闭一次较麻烦不说，对电脑的电量，内存都是不小的负荷。而webide将这一部分负荷转移到远程容器，省去了本地的负荷和每次启动打开的不便(finder -&gt; terminal -&gt; run dev -&gt; open vscode)，说实话，个人感觉开发起来更方便。毕竟启动项目就是打开一个网页，而关闭项目也无需担心进度未保存。</li>
<li>团队配置化的统一。统一化插件、ide配置，代码移交更顺畅</li>
<li>远程办公。疫情之下，不多说，不必合适的设备即可写代码，便利性极大提升</li>
<li>代码更加安全。稍加限制，即可防止代码被拷贝，同时从公司层面，衡量程序员的工作时间会更加方便（ps：我是不会把这个功能做进去的，程序员使用IDE的市场对衡量程序员的价值没有多少参考意义）</li>
<li>demo编写方便。开源的公开的工具很多，但是往往需要私有包，这一点外部开源项目基本无能为力</li>
<li>研发平台的整合，闭合研发链路。团队大了，各个平台层出不穷，开发过程中往往会伴随多个平台的切换，将IDE嵌入网页，同时整合各个研发平台，避免反复切换平台带来的繁琐与不便</li>
<li>私有插件。当然避免团队插件发布共有域的方案也有，但是直接搭建私有插件市场，更加方便直观。</li>
</ol>
<p>个人认为，讨论一项还未落地的技术的意义，不见得是一个有意义的讨论。WebIDE的意义有多大，更多的取决于团队能把，或者说想把这个事做的多大。所以本文不在此赘述，对IDE感兴趣？干就完事了。</p>
<h2 id="业内主流产品技术方案对比">业内主流产品、技术方案对比<a hidden class="anchor" aria-hidden="true" href="#业内主流产品技术方案对比">#</a></h2>
<p>虽然WebIDE本身还未流行，但是在各大云厂商，各大国内大厂均已有落地产品，谈不上一个比较新的技术，而其实现方案，也基本明确并且成熟，此处挑几个进行简单介绍。</p>
<h3 id="vscode流派">vscode流派<a hidden class="anchor" aria-hidden="true" href="#vscode流派">#</a></h3>
<p>比较流行的方案，代表有<a href="https://link.juejin.cn?target=https%3A%2F%2Fcoder.com%2F" title="https://coder.com/">coder</a>, <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fcdr%2Fcode-server" title="https://github.com/cdr/code-server">code-server</a>，<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffeatures%2Fcodespaces" title="https://github.com/features/codespaces">vsonline</a>。</p>
<p>这一类IDE产品，基于vscode进行web端的一些修改，同时贴合github，实现个人项目的webide开发。</p>
<p>但是缺点很统一：收费且团队难以接入使用（团队登陆检验，gitlab接入），代码安全也难以保证</p>
<h3 id="theia">Theia<a hidden class="anchor" aria-hidden="true" href="#theia">#</a></h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Ftheia-ide.org%2F" title="https://theia-ide.org/">theia</a>比较流行的方案。一部分功能复用vscode，但是设计初衷便是为了扩展，所以私有化部署，定制化功能极其方便。</p>
<p>目前有的产品有：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgitpod.io%2F" title="https://gitpod.io/">gitpod</a>，阿里系ide（自研kaitian不是基于theia），华为云ide，google云ide。</p>
<p>在扩展能力上，远超vscode，同时具备全开源，社区活跃度较高，接入改造成本低，不收费的优点</p>
<p>本人在团队内落地的IDE也是基于该框架。</p>
<h3 id="stackblitz">stackblitz<a hidden class="anchor" aria-hidden="true" href="#stackblitz">#</a></h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fstackblitz.com%2F" title="https://stackblitz.com/">stackblitz</a>相信大家都不陌生，非常方便的一款写demo的IDE，本来个人认为他是与<a href="https://link.juejin.cn?target=https%3A%2F%2Fcodesandbox.io%2F" title="https://codesandbox.io/">codesandbox</a>一个流派的，但是他推出了<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.stackblitz.com%2Fposts%2Fintroducing-webcontainers%2F" title="https://blog.stackblitz.com/posts/introducing-webcontainers/">web container</a>的概念，提供了非容器化方案的纯前端node环境，可以说非常有价值。</p>
<p>目前该方案不开源，目前猜测较多的是serverice worker实现请求拦截，webassembly提供了node的环境，从而实现不需要远程机器，全部都跑在浏览器的一个IDE。</p>
<p>整体来讲，其技术方案的优点在于不消耗远程资源，但是缺点，一个是不开源，一个是毕竟是模拟的node环境，在各个系统的一些层面可能会有所缺失（猜测）。</p>
<h3 id="其他">其他<a hidden class="anchor" aria-hidden="true" href="#其他">#</a></h3>
<p>还有一些其他的方案：</p>
<ol>
<li>基于前端构建的<a href="https://link.juejin.cn?target=https%3A%2F%2Fcodesandbox.io%2F" title="https://codesandbox.io/">codesandbox</a>，这个网上分析的文章比较多，此处不赘述，其缺点在于没有完整的命令行，跑跑基于webpack的前端页面还行，node代码不能跑起来的，更多的是拿来写ui demo的一个工具。</li>
<li>阿里的kaitian，纯自研的一款IDE，尝试取代THEIA的一款纯自研的IDE，目前未开源</li>
<li>coding团队的webide，<a href="https://link.juejin.cn?target=https%3A%2F%2Fcoding.net%2F" title="https://coding.net/">coding</a>，曾经开过源，目前不明</li>
</ol>
<h3 id="整体对比">整体对比<a hidden class="anchor" aria-hidden="true" href="#整体对比">#</a></h3>
<ol>
<li>vscode流派：付费，接入不便，扩展不易</li>
<li>theia流派：业内流行的开源方案，成熟落地产品多，扩展非常容易</li>
<li>Stackblitz: 技术方案独特，纯前端的WebIDE，但是目前看除了写demo快，团队接入和扩展都没有提供方案</li>
<li>codesandbox: 前端构建的，更多用来写demo</li>
<li>kaitian, codeing等自研，不开源，具体不太清楚</li>
</ol>
<h3 id="接入方案选择">接入方案选择<a hidden class="anchor" aria-hidden="true" href="#接入方案选择">#</a></h3>
<p>对于团队需要的WebIDE，个人认为满足日常的开发是必须的。所以易扩展，一定是排在第一位的，这一点非theia莫属。而开源、不收费、稳定性好、社区活跃也是theia的长处。长期来看，theia的接入成本低、扩展性好，社区活跃方便后期维护，是一个非常棒的方案。本人在云音乐团队落地的也是最终采取的这一方案。</p>
<h2 id="如何在团队内快速落地">如何在团队内快速落地<a hidden class="anchor" aria-hidden="true" href="#如何在团队内快速落地">#</a></h2>
<p>说了这么多，其实到这一章才算正式开始落地。</p>
<p>WebIDE作为一项成熟的技术，这几年才逐渐的出现在较多的场合，这里面也是有技术方面的一些原因。目前各大WebIDE的方案，基本都是基于容器的方案，这一方案，需要团队有比较完善的容器化的管理及动态部署的能力。</p>
<p>所以在落地前，容器化部署的能力是需要团队所必须具备的，当然，使用外部商业化的也可。</p>
<p>除此之外，一些基本的基础设施也需要比较完善，比如gitlab、成员管理、前后端项目部署等基建产品。</p>
<p>具备上述能力后，才可以满足快速落地的要求。</p>
<h3 id="整体结构">整体结构<a hidden class="anchor" aria-hidden="true" href="#整体结构">#</a></h3>
<p>笔者认为，WebIDE的落地可以充分发挥互联网小步迭代，快速上线的迭代方式。先搭小汽车，再做摩托车，最后再到小汽车。一步一步对功能进行完善。</p>
<p>在笔者看来，一个自行车版WebIDE所需要具备的基础能力有：</p>
<ol start="2">
<li>团队成员管理系统 or oa接入</li>
<li>团队gitlab接入</li>
<li>私有包安装的能力</li>
<li>IDE管理，新建，关闭，删除等基本功能</li>
<li>支持前端项目运行</li>
</ol>
<p>出于满足上述能力的需求，笔者最初（后来也只是新增了一些独立的工程）将项目划分为4个工程：</p>
<ol>
<li>Ide-studio: 前端管理后台，负责IDE的新建，关闭，后期可拓展出插件市场等功能</li>
<li>Ide-studio-backend: 纯nodejs后台，一方面负责管理后台的接口，另一方面接入团队成员管理系统，后期可用来拓展私有插件以及共有插件等功能，同时处理和容器化部署平台的协作。</li>
<li>Ide-extension: 用于开发theia扩展，定制团队特有功能，比如接入团队成员管理系统，记录活跃时间，集成团队内部研发平台等</li>
<li>Ide-docker: 用于存放ide的docker相关文件。由于theia本身是为拓展而生，只需要一个package.json即可生成ide相关，所以单独将docker镜像的构建伶出来</li>
</ol>
<h3 id="落地方案">落地方案<a hidden class="anchor" aria-hidden="true" href="#落地方案">#</a></h3>
<h4 id="theia容器构建">theia容器构建<a hidden class="anchor" aria-hidden="true" href="#theia容器构建">#</a></h4>
<p>theia本身已有容器<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftheia-ide%2Ftheia-apps%23theia-docker" title="https://github.com/theia-ide/theia-apps#theia-docker">启动方案</a>，已经提供了dockerfile文件，可以直接使用该docker进行部署，笔者团队使用的是基于<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftheia-ide%2Ftheia-apps%2Ftree%2Fmaster%2Ftheia-docker" title="https://github.com/theia-ide/theia-apps/tree/master/theia-docker">theia-docker</a>进行的修改。</p>
<p>官方dockerfile如下，笔者直接在上面增加了自己的注释：</p>
<p>dockerfile</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code># 选择容器底层node依赖 ARG NODE_VERSION=12.18.3 FROM node:${NODE_VERSION}-alpine # 增加theia install时需要的必要系统依赖 RUN apk add --no-cache make pkgconfig gcc g++ python libx11-dev libxkbfile-dev libsecret-dev ARG version=latest WORKDIR /home/theia ADD $version.package.json ./package.json # 这个GITHUB_TOKEN，需要在容器构建时指定(由于部分npm包安装需要从github拉取，使用github_token才可以顺利安装) ARG GITHUB_TOKEN # 安装，同时清理掉全局缓存 RUN yarn --pure-lockfile &amp;&amp; \     NODE_OPTIONS=&quot;--max_old_space_size=4096&quot; yarn theia build &amp;&amp; \     yarn theia download:plugins &amp;&amp; \     yarn --production &amp;&amp; \     yarn autoclean --init &amp;&amp; \     echo *.ts &gt;&gt; .yarnclean &amp;&amp; \     echo *.ts.map &gt;&gt; .yarnclean &amp;&amp; \     echo *.spec.* &gt;&gt; .yarnclean &amp;&amp; \     yarn autoclean --force &amp;&amp; \     yarn cache clean # 重新选择底层系统依赖，目的是保留容器系统极简，去掉了theia安装过程中需要的系统依赖，从而减小镜像提及 FROM node:${NODE_VERSION}-alpine # See : https://github.com/theia-ide/theia-apps/issues/34 RUN addgroup theia &amp;&amp; \     adduser -G theia -s /bin/sh -D theia; RUN chmod g+rw /home &amp;&amp; \     mkdir -p /home/project &amp;&amp; \     chown -R theia:theia /home/theia &amp;&amp; \     chown -R theia:theia /home/project; # 增加git bash等基础系统依赖 RUN apk add --no-cache git openssh bash libsecret ENV HOME /home/theia WORKDIR /home/theia COPY --from=0 --chown=theia:theia /home/theia /home/theia EXPOSE 3000 ENV SHELL=/bin/bash \     THEIA_DEFAULT_PLUGINS=local-dir:/home/theia/plugins ENV USE_LOCAL_GIT true USER theia # run theia服务，默认运行在3000端口 ENTRYPOINT [ &quot;node&quot;, &quot;/home/theia/src-gen/backend/main.js&quot;, &quot;/home/project&quot;, &quot;--hostname=0.0.0.0&quot; ]</code></p>
<p>整体来讲，这是一个比较标准的前端工程运行文件，对docker没有基础的搜一搜看懂也不难。</p>
<p>不过，其中几个实际踩的坑需要注意一下：</p>
<ol>
<li>github_token需要指定，否则会出现部分npm包无法下载的问题。使用自己的github_token即可，生成方法见<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.github.com%2Fcn%2Fgithub%2Fauthenticating-to-github%2Fkeeping-your-account-and-data-secure%2Fcreating-a-personal-access-token" title="https://docs.github.com/cn/github/authenticating-to-github/keeping-your-account-and-data-secure/creating-a-personal-access-token">官方文档</a></li>
<li>构建镜像的时候注意关闭自己电脑的代理(比如charles等)，也会造成npm包安装问题</li>
</ol>
<p>当然，这是theia官方的镜像，实际实现自行车版本的WebIDE的时候，还需要执行如下操作：</p>
<ol>
<li>注入git公私钥，此处建议使用单个仓库的私钥，使权限最小化</li>
<li>自动clone目标代码</li>
<li>注入npm 私有域，从而使用者无需再进行配置</li>
<li>执行用户自定义的自动化脚本</li>
</ol>
<p>这些操作可以自己写一个node脚本，在最后同theia服务的启动一起执行一遍即可。</p>
<p>而在实际的落地及使用过程中，还遇到一些实际的问题：</p>
<ol>
<li>git公私钥如何获取，此处在IDE容器内确实不好获取，存在鉴权等问题，故笔者是在容器创建时(此时是有用户身份信息的)，将相关变量注入到容器的环境变量中，容器内直接拿环境变量的数据构建公私钥即可</li>
<li>root权限，如dockerfile中所示，theia出于容器的安全考虑，创建了一个工作区，用户的身份都是theia，而系统内的一些依赖其实是不够的，比如gcc, g++等部分npm包安装所需要的系统依赖都没有，另外也没有一些必要的系统依赖比如，curl。所以可以给用户开放root权限</li>
<li>命令行问题，默认使用的是linux的bash，是没有git、高亮等支持，体验非常差，所以可以把oh-my-zsh集成进去</li>
</ol>
<p>为了解决上述问题，笔者在原有的dockerfile中增加了如下命令</p>
<p>dockerfile</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code># 增加系统依赖，以便npm安装可以顺利进行 RUN apk add --no-cache make pkgconfig gcc g++ python curl # 安装zsh，美化命令行 RUN apk add --no-cache git openssh bash zsh libsecret-dev # 增加root身份，以便用户可以自行增加全局系统依赖 RUN chmod 4755 /bin/busybox RUN echo 'root:danger' | chpasswd # 修改最终的启动命令 ENTRYPOINT [&quot;/bin/sh&quot;, &quot;/home/cloud-theia/start.sh&quot;] # 在start.sh中，执行git,npm全局配置的脚本，并且启动theia自身的服务</code></p>
<p>至此，容器的功能基本完善。可以直接本地构建一个跑起来看看。</p>
<h4 id="ide管理页面搭建">IDE管理页面搭建<a hidden class="anchor" aria-hidden="true" href="#ide管理页面搭建">#</a></h4>
<p>这一部分是比较常规的前端页面，此处大家应该耳熟能详，使用一些中后台模版搭建即可。</p>
<p>主要具备的功能有：</p>
<ol>
<li>IDE的管理：增删查改</li>
<li>插件的管理：私有/公有插件，插件的上传及管理</li>
<li>基本的团队成员登陆/注销</li>
</ol>
<p>其中，插件管理可以使用theia本身推荐的<a href="https://link.juejin.cn?target=https%3A%2F%2Fopen-vsx.org%2F" title="https://open-vsx.org/">openvsx</a>，本身全开源，也推荐私有化部署后使用。</p>
<p>笔者当时由于IDE管理系统想和插件管理系统直接无缝切换（懒），只是对接口通过node后台直接转发到openvsx，从而获取其数据，简单快捷的实现了公有插件的获取/下载。</p>
<h4 id="ide后台服务搭建">IDE后台服务搭建<a hidden class="anchor" aria-hidden="true" href="#ide后台服务搭建">#</a></h4>
<p>笔者基于egg.js搭建了IDE的后台，主要承载的能力有：</p>
<ol>
<li>
<p>IDE管理，比较常规的后台接口</p>
</li>
<li>
<p>插件管理，私有插件的自存储，公有插件进行转发到openvsx</p>
</li>
<li>
<p>处理网易轻舟云容器部署、域名转发等服务的交互（网易轻舟，个性化等用下来体验还不错）</p>
</li>
<li>
<p>处理IDE容器内，插件安装/搜索时需要的一些服务处理</p>
</li>
<li>
<p>基本的成员登陆/注销</p>
</li>
</ol>
<p>整体来讲，代码基本跟平时的node服务无差。不再赘述</p>
<h4 id="theia扩展">theia扩展<a hidden class="anchor" aria-hidden="true" href="#theia扩展">#</a></h4>
<p>这一部分，应该是大部分没有接触过theia的同学比较难以处理的地方。虽然说theia本身提供了非常方便的扩展能力，但是该方便，还是建立在你对theia的构建有一定的了解之上。</p>
<p>官网介绍的不多，可以看<a href="https://link.juejin.cn?target=https%3A%2F%2Ftheia-ide.org%2Fdocs%2Fauthoring_extensions%2F" title="https://theia-ide.org/docs/authoring_extensions/">这篇文章</a>，跑起来问题不大，剩下的用到了查看源码即可。</p>
<p>但是接入自己的团队，其实需要扩展的地方不多，笔者目前也仅仅改动了以下几条：</p>
<ol>
<li>团队成员登陆/注销（纯前端扩展）</li>
<li>团队logo、成员信息展示、相关帮助链接的跳转</li>
</ol>
<p>这一部分都还没有涉及到theia的jsonrpc，后端扩展能力。但是自行车版足以。</p>
<p>上个图吧，其实在扩展能力上，只是用到了一些皮毛：</p>
<p><img loading="lazy" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/19ce086b3fb44f74bd7d695208756142~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210916151858921"  />
</p>
<p>笔者在实际使用过程中，还有以下几个环境变量的改动：</p>
<ol>
<li>VSX_REGISTRY_URL，这是插件市场的插件源改动，默认是指向openvsx，要实现私有插件，直接改变其到自己的私有市场并实现相关接口即可</li>
<li>THEIA_WEBVIEW_EXTERNAL_ENDPOINT，webview的web版方案，默认是指向了uuid.minibrowser.{uuid}.minibrowser.uuid.minibrowser.{hostname}，由于在实际落地场景中，这样修改域名的写法，https泛域名证书也无法使用，必须一个ide申请一个，而webview借助了 service worker，如果不使用https就无法工作，所以笔者这边直接改成了hostname，其利害及缘由可以参考<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.mattbierner.com%2Fvscode-webview-web-learnings%2F" title="https://blog.mattbierner.com/vscode-webview-web-learnings/">此文章</a></li>
<li>THEIA_MINI_BROWSER_HOST_PATTERN，同上，也是改成了hostname，来完成图片文件的预览</li>
</ol>
<h4 id="其他-1">其他<a hidden class="anchor" aria-hidden="true" href="#其他-1">#</a></h4>
<p>文档站建设，模版建设等一些常规的操作，不再赘述</p>
<h3 id="总结">总结<a hidden class="anchor" aria-hidden="true" href="#总结">#</a></h3>
<p>整体来讲，上述都搭建好之后，一个团队可用的webide就做好了。</p>
<p>目前笔者团队的webide，已经能够满足日常的开发使用，后续会进一步增加扩展，作为各个研发平台的承载点，解决目前开发过程中的不同平台反复切换的问题。</p>
<p>当然，实际落地中，还会有很多琐碎的细节问题，大家可以一起交流哈。</p>
<h2 id="最后">最后<a hidden class="anchor" aria-hidden="true" href="#最后">#</a></h2>
<p>webide作为一项成熟的技术，团队落地整个流程下来，笔者认为回头去看，其实没有什么特别大的坑点以及技术上的难点。</p>
<p>原本题目准备起：前端小白如何在团队内落地webide，但是后来想想，这就有点误人子弟了，虽然前端相关的代码确实没写几行，但是对其他的一些知识需要一定的储备，比如容器化、node、运维等知识。</p>
<p>最后，笔者在建立了完备的webide之后，自己的业务都已经在webide上进行开发，但是团队的大部分成员还是持保守态度。后续会继续提升开发体验，让越来越多的成员接纳这个套了老技术的新IDE。</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/visualstudiocode/">VisualStudioCode</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://localhost:1313/posts/wiki/%E5%9F%BA%E4%BA%8E%E4%B8%87%E5%BE%97%E5%8E%A8%E7%83%B9%E9%A5%AA%E7%A8%8B%E5%BA%8F%E9%AA%8C%E8%AF%81%E6%B5%81%E7%A8%8B%E7%9A%84%E9%97%AE%E7%AD%94%E5%BA%93%E5%86%85%E5%AE%B9%E9%9C%80%E6%B1%82%E6%8A%A5%E5%91%8A/">
    <span class="title">« 上一页</span>
    <br>
    <span>基于万得厨烹饪程序验证流程的问答库内容需求报告</span>
  </a>
  <a class="next" href="http://localhost:1313/posts/wiki/2023.3.22%E4%BC%9A%E8%AE%AE~3%E6%9C%88%E6%96%B0%E5%A2%9E%E6%A0%87%E5%87%86%E9%97%AE%E7%AD%94%E8%AF%84%E5%AE%A1/">
    <span class="title">下一页 »</span>
    <br>
    <span>2023.3.22会议~3月新增标准问答评审</span>
  </a>
</nav>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 如何在团队内快速落地WebIDE on x"
            href="https://x.com/intent/tweet/?text=%e5%a6%82%e4%bd%95%e5%9c%a8%e5%9b%a2%e9%98%9f%e5%86%85%e5%bf%ab%e9%80%9f%e8%90%bd%e5%9c%b0WebIDE&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E5%25A6%2582%25E4%25BD%2595%25E5%259C%25A8%25E5%259B%25A2%25E9%2598%259F%25E5%2586%2585%25E5%25BF%25AB%25E9%2580%259F%25E8%2590%25BD%25E5%259C%25B0webide%2f&amp;hashtags=VisualStudioCode">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 如何在团队内快速落地WebIDE on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E5%25A6%2582%25E4%25BD%2595%25E5%259C%25A8%25E5%259B%25A2%25E9%2598%259F%25E5%2586%2585%25E5%25BF%25AB%25E9%2580%259F%25E8%2590%25BD%25E5%259C%25B0webide%2f&amp;title=%e5%a6%82%e4%bd%95%e5%9c%a8%e5%9b%a2%e9%98%9f%e5%86%85%e5%bf%ab%e9%80%9f%e8%90%bd%e5%9c%b0WebIDE&amp;summary=%e5%a6%82%e4%bd%95%e5%9c%a8%e5%9b%a2%e9%98%9f%e5%86%85%e5%bf%ab%e9%80%9f%e8%90%bd%e5%9c%b0WebIDE&amp;source=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E5%25A6%2582%25E4%25BD%2595%25E5%259C%25A8%25E5%259B%25A2%25E9%2598%259F%25E5%2586%2585%25E5%25BF%25AB%25E9%2580%259F%25E8%2590%25BD%25E5%259C%25B0webide%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 如何在团队内快速落地WebIDE on reddit"
            href="https://reddit.com/submit?url=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E5%25A6%2582%25E4%25BD%2595%25E5%259C%25A8%25E5%259B%25A2%25E9%2598%259F%25E5%2586%2585%25E5%25BF%25AB%25E9%2580%259F%25E8%2590%25BD%25E5%259C%25B0webide%2f&title=%e5%a6%82%e4%bd%95%e5%9c%a8%e5%9b%a2%e9%98%9f%e5%86%85%e5%bf%ab%e9%80%9f%e8%90%bd%e5%9c%b0WebIDE">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 如何在团队内快速落地WebIDE on facebook"
            href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E5%25A6%2582%25E4%25BD%2595%25E5%259C%25A8%25E5%259B%25A2%25E9%2598%259F%25E5%2586%2585%25E5%25BF%25AB%25E9%2580%259F%25E8%2590%25BD%25E5%259C%25B0webide%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 如何在团队内快速落地WebIDE on whatsapp"
            href="https://api.whatsapp.com/send?text=%e5%a6%82%e4%bd%95%e5%9c%a8%e5%9b%a2%e9%98%9f%e5%86%85%e5%bf%ab%e9%80%9f%e8%90%bd%e5%9c%b0WebIDE%20-%20http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E5%25A6%2582%25E4%25BD%2595%25E5%259C%25A8%25E5%259B%25A2%25E9%2598%259F%25E5%2586%2585%25E5%25BF%25AB%25E9%2580%259F%25E8%2590%25BD%25E5%259C%25B0webide%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 如何在团队内快速落地WebIDE on telegram"
            href="https://telegram.me/share/url?text=%e5%a6%82%e4%bd%95%e5%9c%a8%e5%9b%a2%e9%98%9f%e5%86%85%e5%bf%ab%e9%80%9f%e8%90%bd%e5%9c%b0WebIDE&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E5%25A6%2582%25E4%25BD%2595%25E5%259C%25A8%25E5%259B%25A2%25E9%2598%259F%25E5%2586%2585%25E5%25BF%25AB%25E9%2580%259F%25E8%2590%25BD%25E5%259C%25B0webide%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 如何在团队内快速落地WebIDE on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=%e5%a6%82%e4%bd%95%e5%9c%a8%e5%9b%a2%e9%98%9f%e5%86%85%e5%bf%ab%e9%80%9f%e8%90%bd%e5%9c%b0WebIDE&u=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E5%25A6%2582%25E4%25BD%2595%25E5%259C%25A8%25E5%259B%25A2%25E9%2598%259F%25E5%2586%2585%25E5%25BF%25AB%25E9%2580%259F%25E8%2590%25BD%25E5%259C%25B0webide%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span><a href="https://beian.miit.gov.cn/">粤ICP备2023039897号-1</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = '复制';

        function copyingDone() {
            copybutton.innerHTML = '已复制！';
            setTimeout(() => {
                copybutton.innerHTML = '复制';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
