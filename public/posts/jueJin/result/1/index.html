<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>PaperMod</title>
<meta name="keywords" content="">
<meta name="description" content=".markdown-body { word-break: break-word; line-height: 1.75; font-weight: 400; font-size: 16px; overflow-x: hidden; color: #252933 } .markdown-body h1, .markdown-body h2, .markdown-body h3, .markdown-body h4, .markdown-body h5, .markdown-body h6 { line-height: 1.5; margin-top: 35px; margin-bottom: 10px; padding-bottom: 5px } .markdown-body h1 { font-size: 24px; line-height: 38px; margin-bottom: 5px } .markdown-body h2 { font-size: 22px; line-height: 34px; padding-bottom: 12px; border-bottom: 1px solid #ececec } .markdown-body h3 { font-size: 20px; line-height: 28px } .markdown-body h4 { font-size: 18px; line-height: 26px } .markdown-body h5 { font-size: 17px; line-height: 24px } .markdown-body h6 { font-size: 16px; line-height: 24px } .markdown-body p { line-height: inherit; margin-top: 22px; margin-bottom: 22px } .markdown-body img { max-width: 100% } .markdown-body hr { border: none; border-top: 1px solid #ddd; margin-top: 32px; margin-bottom: 32px } .markdown-body code { word-break: break-word; border-radius: 2px; overflow-x: auto; background-color: #fff5f5; color: #ff502c; font-size: .87em; padding: .065em .4em } .markdown-body code, .markdown-body pre { font-family: Menlo, Monaco, Consolas, Courier New, monospace } .markdown-body pre { overflow: auto; position: relative; line-height: 1.75 } .markdown-body pre &gt; code { font-size: 12px; padding: 15px 12px; margin: 0; word-break: normal; display: block; overflow-x: auto; color: #333; background: #f8f8f8 } .markdown-body a { text-decoration: none; color: #0269c8; border-bottom: 1px solid #d1e9ff } .markdown-body a:active, .markdown-body a:hover { color: #275b8c } .markdown-body table { display: inline-block !important; font-size: 12px; width: auto; max-width: 100%; overflow: auto; border: 1px solid #f6f6f6 } .markdown-body thead { background: #f6f6f6; color: #000; text-align: left } .markdown-body tr:nth-child(2n) { background-color: #fcfcfc } .markdown-body td, .markdown-body th { padding: 12px 7px; line-height: 24px } .markdown-body td { min-width: 120px } .markdown-body blockquote { color: #666; padding: 1px 23px; margin: 22px 0; border-left: 4px solid #cbcbcb; background-color: #f8f8f8 } .markdown-body blockquote:after { display: block; content: &quot;&quot; } .markdown-body blockquote &gt; p { margin: 10px 0 } .markdown-body ol, .markdown-body ul { padding-left: 28px } .markdown-body ol li, .markdown-body ul li { margin-bottom: 0; list-style: inherit } .markdown-body ol li .task-list-item, .markdown-body ul li .task-list-item { list-style: none } .markdown-body ol li .task-list-item ol, .markdown-body ol li .task-list-item ul, .markdown-body ul li .task-list-item ol, .markdown-body ul li .task-list-item ul { margin-top: 0 } .markdown-body ol ol, .markdown-body ol ul, .markdown-body ul ol, .markdown-body ul ul { margin-top: 3px } .markdown-body ol li { padding-left: 6px } .markdown-body .contains-task-list { padding-left: 0 } .markdown-body .task-list-item { list-style: none } @media (max-width: 720px) { .markdown-body h1 { font-size: 24px } .markdown-body h2 { font-size: 20px } .markdown-body h3 { font-size: 18px } } .markdown-body pre, .markdown-body pre &gt; code.hljs { color: #333; background: #f8f8f8 } .hljs-comment, .hljs-quote { color: #998; font-style: italic } .hljs-keyword, .hljs-selector-tag, .hljs-subst { color: #333; font-weight: 700 } .hljs-literal, .hljs-number, .hljs-tag .hljs-attr, .hljs-template-variable, .hljs-variable { color: teal } .hljs-doctag, .hljs-string { color: #d14 } .hljs-section, .hljs-selector-id, .hljs-title { color: #900; font-weight: 700 } .hljs-subst { font-weight: 400 } .hljs-class .hljs-title, .hljs-type { color: #458; font-weight: 700 } .hljs-attribute, .hljs-name, .hljs-tag { color: navy; font-weight: 400 } .hljs-link, .hljs-regexp { color: #009926 } .hljs-bullet, .hljs-symbol { color: #990073 } .hljs-built_in, .hljs-builtin-name { color: #0086b3 } .hljs-meta { color: #999; font-weight: 700 } .hljs-deletion { background: #fdd } .hljs-addition { background: #dfd } .hljs-emphasis { font-style: italic } .hljs-strong { font-weight: 700 }">
<meta name="author" content="Theme PaperMod">
<link rel="canonical" href="http://localhost:1313/posts/juejin/result/1/">
<meta name="google-site-verification" content="XYZabc">
<link crossorigin="anonymous" href="/assets/css/stylesheet.7b92bf4867c997b58ec50f63451b83777173d5bd5593376852abd85746d09d71.css" integrity="sha256-e5K/SGfJl7WOxQ9jRRuDd3Fz1b1VkzdoUqvYV0bQnXE=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<link rel="apple-touch-icon" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<link rel="mask-icon" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="zh" href="http://localhost:1313/posts/juejin/result/1/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript><meta property="og:title" content="" />
<meta property="og:description" content=".markdown-body { word-break: break-word; line-height: 1.75; font-weight: 400; font-size: 16px; overflow-x: hidden; color: #252933 } .markdown-body h1, .markdown-body h2, .markdown-body h3, .markdown-body h4, .markdown-body h5, .markdown-body h6 { line-height: 1.5; margin-top: 35px; margin-bottom: 10px; padding-bottom: 5px } .markdown-body h1 { font-size: 24px; line-height: 38px; margin-bottom: 5px } .markdown-body h2 { font-size: 22px; line-height: 34px; padding-bottom: 12px; border-bottom: 1px solid #ececec } .markdown-body h3 { font-size: 20px; line-height: 28px } .markdown-body h4 { font-size: 18px; line-height: 26px } .markdown-body h5 { font-size: 17px; line-height: 24px } .markdown-body h6 { font-size: 16px; line-height: 24px } .markdown-body p { line-height: inherit; margin-top: 22px; margin-bottom: 22px } .markdown-body img { max-width: 100% } .markdown-body hr { border: none; border-top: 1px solid #ddd; margin-top: 32px; margin-bottom: 32px } .markdown-body code { word-break: break-word; border-radius: 2px; overflow-x: auto; background-color: #fff5f5; color: #ff502c; font-size: .87em; padding: .065em .4em } .markdown-body code, .markdown-body pre { font-family: Menlo, Monaco, Consolas, Courier New, monospace } .markdown-body pre { overflow: auto; position: relative; line-height: 1.75 } .markdown-body pre &gt; code { font-size: 12px; padding: 15px 12px; margin: 0; word-break: normal; display: block; overflow-x: auto; color: #333; background: #f8f8f8 } .markdown-body a { text-decoration: none; color: #0269c8; border-bottom: 1px solid #d1e9ff } .markdown-body a:active, .markdown-body a:hover { color: #275b8c } .markdown-body table { display: inline-block !important; font-size: 12px; width: auto; max-width: 100%; overflow: auto; border: 1px solid #f6f6f6 } .markdown-body thead { background: #f6f6f6; color: #000; text-align: left } .markdown-body tr:nth-child(2n) { background-color: #fcfcfc } .markdown-body td, .markdown-body th { padding: 12px 7px; line-height: 24px } .markdown-body td { min-width: 120px } .markdown-body blockquote { color: #666; padding: 1px 23px; margin: 22px 0; border-left: 4px solid #cbcbcb; background-color: #f8f8f8 } .markdown-body blockquote:after { display: block; content: &quot;&quot; } .markdown-body blockquote &gt; p { margin: 10px 0 } .markdown-body ol, .markdown-body ul { padding-left: 28px } .markdown-body ol li, .markdown-body ul li { margin-bottom: 0; list-style: inherit } .markdown-body ol li .task-list-item, .markdown-body ul li .task-list-item { list-style: none } .markdown-body ol li .task-list-item ol, .markdown-body ol li .task-list-item ul, .markdown-body ul li .task-list-item ol, .markdown-body ul li .task-list-item ul { margin-top: 0 } .markdown-body ol ol, .markdown-body ol ul, .markdown-body ul ol, .markdown-body ul ul { margin-top: 3px } .markdown-body ol li { padding-left: 6px } .markdown-body .contains-task-list { padding-left: 0 } .markdown-body .task-list-item { list-style: none } @media (max-width: 720px) { .markdown-body h1 { font-size: 24px } .markdown-body h2 { font-size: 20px } .markdown-body h3 { font-size: 18px } } .markdown-body pre, .markdown-body pre &gt; code.hljs { color: #333; background: #f8f8f8 } .hljs-comment, .hljs-quote { color: #998; font-style: italic } .hljs-keyword, .hljs-selector-tag, .hljs-subst { color: #333; font-weight: 700 } .hljs-literal, .hljs-number, .hljs-tag .hljs-attr, .hljs-template-variable, .hljs-variable { color: teal } .hljs-doctag, .hljs-string { color: #d14 } .hljs-section, .hljs-selector-id, .hljs-title { color: #900; font-weight: 700 } .hljs-subst { font-weight: 400 } .hljs-class .hljs-title, .hljs-type { color: #458; font-weight: 700 } .hljs-attribute, .hljs-name, .hljs-tag { color: navy; font-weight: 400 } .hljs-link, .hljs-regexp { color: #009926 } .hljs-bullet, .hljs-symbol { color: #990073 } .hljs-built_in, .hljs-builtin-name { color: #0086b3 } .hljs-meta { color: #999; font-weight: 700 } .hljs-deletion { background: #fdd } .hljs-addition { background: #dfd } .hljs-emphasis { font-style: italic } .hljs-strong { font-weight: 700 }" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/posts/juejin/result/1/" />
<meta property="og:image" content="http://localhost:1313/images/papermod-cover.png" />
<meta property="article:section" content="posts" />




<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="http://localhost:1313/images/papermod-cover.png" />
<meta name="twitter:title" content=""/>
<meta name="twitter:description" content=".markdown-body { word-break: break-word; line-height: 1.75; font-weight: 400; font-size: 16px; overflow-x: hidden; color: #252933 } .markdown-body h1, .markdown-body h2, .markdown-body h3, .markdown-body h4, .markdown-body h5, .markdown-body h6 { line-height: 1.5; margin-top: 35px; margin-bottom: 10px; padding-bottom: 5px } .markdown-body h1 { font-size: 24px; line-height: 38px; margin-bottom: 5px } .markdown-body h2 { font-size: 22px; line-height: 34px; padding-bottom: 12px; border-bottom: 1px solid #ececec } .markdown-body h3 { font-size: 20px; line-height: 28px } .markdown-body h4 { font-size: 18px; line-height: 26px } .markdown-body h5 { font-size: 17px; line-height: 24px } .markdown-body h6 { font-size: 16px; line-height: 24px } .markdown-body p { line-height: inherit; margin-top: 22px; margin-bottom: 22px } .markdown-body img { max-width: 100% } .markdown-body hr { border: none; border-top: 1px solid #ddd; margin-top: 32px; margin-bottom: 32px } .markdown-body code { word-break: break-word; border-radius: 2px; overflow-x: auto; background-color: #fff5f5; color: #ff502c; font-size: .87em; padding: .065em .4em } .markdown-body code, .markdown-body pre { font-family: Menlo, Monaco, Consolas, Courier New, monospace } .markdown-body pre { overflow: auto; position: relative; line-height: 1.75 } .markdown-body pre &gt; code { font-size: 12px; padding: 15px 12px; margin: 0; word-break: normal; display: block; overflow-x: auto; color: #333; background: #f8f8f8 } .markdown-body a { text-decoration: none; color: #0269c8; border-bottom: 1px solid #d1e9ff } .markdown-body a:active, .markdown-body a:hover { color: #275b8c } .markdown-body table { display: inline-block !important; font-size: 12px; width: auto; max-width: 100%; overflow: auto; border: 1px solid #f6f6f6 } .markdown-body thead { background: #f6f6f6; color: #000; text-align: left } .markdown-body tr:nth-child(2n) { background-color: #fcfcfc } .markdown-body td, .markdown-body th { padding: 12px 7px; line-height: 24px } .markdown-body td { min-width: 120px } .markdown-body blockquote { color: #666; padding: 1px 23px; margin: 22px 0; border-left: 4px solid #cbcbcb; background-color: #f8f8f8 } .markdown-body blockquote:after { display: block; content: &quot;&quot; } .markdown-body blockquote &gt; p { margin: 10px 0 } .markdown-body ol, .markdown-body ul { padding-left: 28px } .markdown-body ol li, .markdown-body ul li { margin-bottom: 0; list-style: inherit } .markdown-body ol li .task-list-item, .markdown-body ul li .task-list-item { list-style: none } .markdown-body ol li .task-list-item ol, .markdown-body ol li .task-list-item ul, .markdown-body ul li .task-list-item ol, .markdown-body ul li .task-list-item ul { margin-top: 0 } .markdown-body ol ol, .markdown-body ol ul, .markdown-body ul ol, .markdown-body ul ul { margin-top: 3px } .markdown-body ol li { padding-left: 6px } .markdown-body .contains-task-list { padding-left: 0 } .markdown-body .task-list-item { list-style: none } @media (max-width: 720px) { .markdown-body h1 { font-size: 24px } .markdown-body h2 { font-size: 20px } .markdown-body h3 { font-size: 18px } } .markdown-body pre, .markdown-body pre &gt; code.hljs { color: #333; background: #f8f8f8 } .hljs-comment, .hljs-quote { color: #998; font-style: italic } .hljs-keyword, .hljs-selector-tag, .hljs-subst { color: #333; font-weight: 700 } .hljs-literal, .hljs-number, .hljs-tag .hljs-attr, .hljs-template-variable, .hljs-variable { color: teal } .hljs-doctag, .hljs-string { color: #d14 } .hljs-section, .hljs-selector-id, .hljs-title { color: #900; font-weight: 700 } .hljs-subst { font-weight: 400 } .hljs-class .hljs-title, .hljs-type { color: #458; font-weight: 700 } .hljs-attribute, .hljs-name, .hljs-tag { color: navy; font-weight: 400 } .hljs-link, .hljs-regexp { color: #009926 } .hljs-bullet, .hljs-symbol { color: #990073 } .hljs-built_in, .hljs-builtin-name { color: #0086b3 } .hljs-meta { color: #999; font-weight: 700 } .hljs-deletion { background: #fdd } .hljs-addition { background: #dfd } .hljs-emphasis { font-style: italic } .hljs-strong { font-weight: 700 }"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "",
      "item": "http://localhost:1313/posts/juejin/result/1/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "",
  "name": "",
  "description": ".markdown-body { word-break: break-word; line-height: 1.75; font-weight: 400; font-size: 16px; overflow-x: hidden; color: #252933 } .markdown-body h1, .markdown-body h2, .markdown-body h3, .markdown-body h4, .markdown-body h5, .markdown-body h6 { line-height: 1.5; margin-top: 35px; margin-bottom: 10px; padding-bottom: 5px } .markdown-body h1 { font-size: 24px; line-height: 38px; margin-bottom: 5px } .markdown-body h2 { font-size: 22px; line-height: 34px; padding-bottom: 12px; border-bottom: 1px solid #ececec } .markdown-body h3 { font-size: 20px; line-height: 28px } .markdown-body h4 { font-size: 18px; line-height: 26px } .markdown-body h5 { font-size: 17px; line-height: 24px } .markdown-body h6 { font-size: 16px; line-height: 24px } .markdown-body p { line-height: inherit; margin-top: 22px; margin-bottom: 22px } .markdown-body img { max-width: 100% } .markdown-body hr { border: none; border-top: 1px solid #ddd; margin-top: 32px; margin-bottom: 32px } .markdown-body code { word-break: break-word; border-radius: 2px; overflow-x: auto; background-color: #fff5f5; color: #ff502c; font-size: .87em; padding: .065em .4em } .markdown-body code, .markdown-body pre { font-family: Menlo, Monaco, Consolas, Courier New, monospace } .markdown-body pre { overflow: auto; position: relative; line-height: 1.75 } .markdown-body pre \u0026gt; code { font-size: 12px; padding: 15px 12px; margin: 0; word-break: normal; display: block; overflow-x: auto; color: #333; background: #f8f8f8 } .markdown-body a { text-decoration: none; color: #0269c8; border-bottom: 1px solid #d1e9ff } .markdown-body a:active, .markdown-body a:hover { color: #275b8c } .markdown-body table { display: inline-block !important; font-size: 12px; width: auto; max-width: 100%; overflow: auto; border: 1px solid #f6f6f6 } .markdown-body thead { background: #f6f6f6; color: #000; text-align: left } .markdown-body tr:nth-child(2n) { background-color: #fcfcfc } .markdown-body td, .markdown-body th { padding: 12px 7px; line-height: 24px } .markdown-body td { min-width: 120px } .markdown-body blockquote { color: #666; padding: 1px 23px; margin: 22px 0; border-left: 4px solid #cbcbcb; background-color: #f8f8f8 } .markdown-body blockquote:after { display: block; content: \u0026quot;\u0026quot; } .markdown-body blockquote \u0026gt; p { margin: 10px 0 } .markdown-body ol, .markdown-body ul { padding-left: 28px } .markdown-body ol li, .markdown-body ul li { margin-bottom: 0; list-style: inherit } .markdown-body ol li .task-list-item, .markdown-body ul li .task-list-item { list-style: none } .markdown-body ol li .task-list-item ol, .markdown-body ol li .task-list-item ul, .markdown-body ul li .task-list-item ol, .markdown-body ul li .task-list-item ul { margin-top: 0 } .markdown-body ol ol, .markdown-body ol ul, .markdown-body ul ol, .markdown-body ul ul { margin-top: 3px } .markdown-body ol li { padding-left: 6px } .markdown-body .contains-task-list { padding-left: 0 } .markdown-body .task-list-item { list-style: none } @media (max-width: 720px) { .markdown-body h1 { font-size: 24px } .markdown-body h2 { font-size: 20px } .markdown-body h3 { font-size: 18px } } .markdown-body pre, .markdown-body pre \u0026gt; code.hljs { color: #333; background: #f8f8f8 } .hljs-comment, .hljs-quote { color: #998; font-style: italic } .hljs-keyword, .hljs-selector-tag, .hljs-subst { color: #333; font-weight: 700 } .hljs-literal, .hljs-number, .hljs-tag .hljs-attr, .hljs-template-variable, .hljs-variable { color: teal } .hljs-doctag, .hljs-string { color: #d14 } .hljs-section, .hljs-selector-id, .hljs-title { color: #900; font-weight: 700 } .hljs-subst { font-weight: 400 } .hljs-class .hljs-title, .hljs-type { color: #458; font-weight: 700 } .hljs-attribute, .hljs-name, .hljs-tag { color: navy; font-weight: 400 } .hljs-link, .hljs-regexp { color: #009926 } .hljs-bullet, .hljs-symbol { color: #990073 } .hljs-built_in, .hljs-builtin-name { color: #0086b3 } .hljs-meta { color: #999; font-weight: 700 } .hljs-deletion { background: #fdd } .hljs-addition { background: #dfd } .hljs-emphasis { font-style: italic } .hljs-strong { font-weight: 700 }\n",
  "keywords": [
    
  ],
  "articleBody": ".markdown-body { word-break: break-word; line-height: 1.75; font-weight: 400; font-size: 16px; overflow-x: hidden; color: #252933 } .markdown-body h1, .markdown-body h2, .markdown-body h3, .markdown-body h4, .markdown-body h5, .markdown-body h6 { line-height: 1.5; margin-top: 35px; margin-bottom: 10px; padding-bottom: 5px } .markdown-body h1 { font-size: 24px; line-height: 38px; margin-bottom: 5px } .markdown-body h2 { font-size: 22px; line-height: 34px; padding-bottom: 12px; border-bottom: 1px solid #ececec } .markdown-body h3 { font-size: 20px; line-height: 28px } .markdown-body h4 { font-size: 18px; line-height: 26px } .markdown-body h5 { font-size: 17px; line-height: 24px } .markdown-body h6 { font-size: 16px; line-height: 24px } .markdown-body p { line-height: inherit; margin-top: 22px; margin-bottom: 22px } .markdown-body img { max-width: 100% } .markdown-body hr { border: none; border-top: 1px solid #ddd; margin-top: 32px; margin-bottom: 32px } .markdown-body code { word-break: break-word; border-radius: 2px; overflow-x: auto; background-color: #fff5f5; color: #ff502c; font-size: .87em; padding: .065em .4em } .markdown-body code, .markdown-body pre { font-family: Menlo, Monaco, Consolas, Courier New, monospace } .markdown-body pre { overflow: auto; position: relative; line-height: 1.75 } .markdown-body pre \u003e code { font-size: 12px; padding: 15px 12px; margin: 0; word-break: normal; display: block; overflow-x: auto; color: #333; background: #f8f8f8 } .markdown-body a { text-decoration: none; color: #0269c8; border-bottom: 1px solid #d1e9ff } .markdown-body a:active, .markdown-body a:hover { color: #275b8c } .markdown-body table { display: inline-block !important; font-size: 12px; width: auto; max-width: 100%; overflow: auto; border: 1px solid #f6f6f6 } .markdown-body thead { background: #f6f6f6; color: #000; text-align: left } .markdown-body tr:nth-child(2n) { background-color: #fcfcfc } .markdown-body td, .markdown-body th { padding: 12px 7px; line-height: 24px } .markdown-body td { min-width: 120px } .markdown-body blockquote { color: #666; padding: 1px 23px; margin: 22px 0; border-left: 4px solid #cbcbcb; background-color: #f8f8f8 } .markdown-body blockquote:after { display: block; content: \"\" } .markdown-body blockquote \u003e p { margin: 10px 0 } .markdown-body ol, .markdown-body ul { padding-left: 28px } .markdown-body ol li, .markdown-body ul li { margin-bottom: 0; list-style: inherit } .markdown-body ol li .task-list-item, .markdown-body ul li .task-list-item { list-style: none } .markdown-body ol li .task-list-item ol, .markdown-body ol li .task-list-item ul, .markdown-body ul li .task-list-item ol, .markdown-body ul li .task-list-item ul { margin-top: 0 } .markdown-body ol ol, .markdown-body ol ul, .markdown-body ul ol, .markdown-body ul ul { margin-top: 3px } .markdown-body ol li { padding-left: 6px } .markdown-body .contains-task-list { padding-left: 0 } .markdown-body .task-list-item { list-style: none } @media (max-width: 720px) { .markdown-body h1 { font-size: 24px } .markdown-body h2 { font-size: 20px } .markdown-body h3 { font-size: 18px } } .markdown-body pre, .markdown-body pre \u003e code.hljs { color: #333; background: #f8f8f8 } .hljs-comment, .hljs-quote { color: #998; font-style: italic } .hljs-keyword, .hljs-selector-tag, .hljs-subst { color: #333; font-weight: 700 } .hljs-literal, .hljs-number, .hljs-tag .hljs-attr, .hljs-template-variable, .hljs-variable { color: teal } .hljs-doctag, .hljs-string { color: #d14 } .hljs-section, .hljs-selector-id, .hljs-title { color: #900; font-weight: 700 } .hljs-subst { font-weight: 400 } .hljs-class .hljs-title, .hljs-type { color: #458; font-weight: 700 } .hljs-attribute, .hljs-name, .hljs-tag { color: navy; font-weight: 400 } .hljs-link, .hljs-regexp { color: #009926 } .hljs-bullet, .hljs-symbol { color: #990073 } .hljs-built_in, .hljs-builtin-name { color: #0086b3 } .hljs-meta { color: #999; font-weight: 700 } .hljs-deletion { background: #fdd } .hljs-addition { background: #dfd } .hljs-emphasis { font-style: italic } .hljs-strong { font-weight: 700 }\n本文作者是360奇舞团前端开发工程师 王文健\n前言 Hi，大家好！\n前段时间用Vue3搭建项目时看到同时推出的Vite，只当它是一个新打包工具或者vue-cli的升级版，仍然选择了用Webpack构建项目。最近看了尤雨溪在VueConf上的演讲视频：《Vue3 生态进展和计划》，感觉它确实解决了现阶段前端工程化的一些痛点，也能体会到尤雨溪对Vite的重视和大力推广的决心，再加上Vue本身的庞大用户基数，Vite确实有可能成为下一代前端构建工具的突破口。\n本文将讨论下Vite出现的背景，解决的痛点，核心功能的实现，存在的意义和预期的未来。Vite本身并不复杂。中文官方文档非常清晰简洁，建议大家使用前仔细读下文档。\n大纲 背景 什么是Vite？ 基本用法 实现原理 源码分析 优势与不足 与传统构建工具对比 兼容性 未来 背景 这里的背景介绍会从与Vite紧密相关的两个概念的发展史说起，一个是JavaScript的模块化标准，另一个是前端构建工具。\n共存的模块化标准 为什么JavaScript会有多种共存的模块化标准？因为js在设计之初并没有模块化的概念，随着前端业务复杂度不断提高，模块化越来越受到开发者的重视，社区开始涌现多种模块化解决方案，它们相互借鉴，也争议不断，形成多个派系，从CommonJS开始，到ES6正式推出ES Modules规范结束，所有争论，终成历史，ES Modules也成为前端重要的基础设施。\nCommonJS：现主要用于Node.js（Node@13.2.0开始支持直接使用ES Module） AMD：require.js 依赖前置，市场存量不建议使用 CMD：sea.js 就近执行，市场存量不建议使用 ES Module：ES语言规范，标准，趋势，未来 对模块化发展史感兴趣的可以看下《前端模块化开发那点历史》@玉伯，而Vite的核心正是依靠浏览器对ES Module规范的实现。\n发展中的构建工具 近些年前端工程化发展迅速，各种构建工具层出不穷，目前Webpack仍然占据统治地位，npm 每周下载量达到两千多万次。下面是我按 npm 发版时间线列出的开发者比较熟知的一些构建工具。\n当前工程化痛点 现在常用的构建工具如Webpack，主要是通过抓取-编译-构建整个应用的代码（也就是常说的打包过程），生成一份编译、优化后能良好兼容各个浏览器的的生产环境代码。在开发环境流程也基本相同，需要先将整个应用构建打包后，再把打包后的代码交给dev server（开发服务器）。\nWebpack等构建工具的诞生给前端开发带来了极大的便利，但随着前端业务的复杂化，js代码量呈指数增长，打包构建时间越来越久，dev server（开发服务器）性能遇到瓶颈：\n缓慢的服务启动： 大型项目中dev server启动时间达到几十秒甚至几分钟。\n缓慢的HMR热更新： 即使采用了 HMR 模式，其热更新速度也会随着应用规模的增长而显著下降，已达到性能瓶颈，无多少优化空间。\n缓慢的开发环境，大大降低了开发者的幸福感，在以上背景下Vite应运而生。\n什么是Vite？ 基于esbuild与Rollup，依靠浏览器自身ESM编译功能， 实现极致开发体验的新一代构建工具！\n概念 先介绍以下文中会经常提到的一些基础概念：\n依赖： 指开发不会变动的部分(npm包、UI组件库)，esbuild进行预构建。 源码： 浏览器不能直接执行的非js代码(.jsx、.css、.vue等)，vite只在浏览器请求相关源码的时候进行转换，以提供ESM源码。 开发环境 利用浏览器原生的ES Module编译能力，省略费时的编译环节，直给浏览器开发环境源码，dev server只提供轻量服务。 浏览器执行ESM的import时，会向dev server发起该模块的ajax请求，服务器对源码做简单处理后返回给浏览器。 Vite中HMR是在原生 ESM 上执行的。当编辑一个文件时，Vite 只需要精确地使已编辑的模块失活，使得无论应用大小如何，HMR 始终能保持快速更新。 使用esbuild处理项目依赖，esbuild使用go编写，比一般node.js编写的编译器快几个数量级。 生产环境 集成Rollup打包生产环境代码，依赖其成熟稳定的生态与更简洁的插件机制。 处理流程对比 Webpack通过先将整个应用打包，再将打包后代码提供给dev server，开发者才能开始开发。\nVite直接将源码交给浏览器，实现dev server秒开，浏览器显示页面需要相关模块时，再向dev server发起请求，服务器简单处理后，将该模块返回给浏览器，实现真正意义的按需加载。 基本用法 创建vite项目 1 $ npm create vite@latest 选取模板 Vite 内置6种常用模板与对应的TS版本，可满足前端大部分开发场景，可以点击下列表格中模板直接在 StackBlitz 中在线试用，还有其他更多的 社区维护模板可以使用。\nJavaScript\nTypeScript\nvanilla\nvanilla-ts\nvue\nvue-ts\nreact\nreact-ts\npreact\npreact-ts\nlit\nlit-ts\nsvelte\nsvelte-ts\n启动 1 2 3 4 5 6 7 { \"scripts\": { \"dev\": \"vite\", // 启动开发服务器，别名：`vite dev`，`vite serve` \"build\": \"vite build\", // 为生产环境构建产物 \"preview\": \"vite preview\" // 本地预览生产构建产物 } } 实现原理 ESbuild 编译 esbuild 使用go编写，cpu密集下更具性能优势，编译速度更快，以下摘自官网的构建速度对比：\n浏览器：“开始了吗？”\n服务器：“已经结束了。”\n开发者：“好快，好喜欢！！”\n依赖预构建 模块化兼容： 如开头背景所写，现仍共存多种模块化标准代码，Vite在预构建阶段将依赖中各种其他模块化规范(CommonJS、UMD)转换 成ESM，以提供给浏览器。 性能优化： npm包中大量的ESM代码，大量的import请求，会造成网络拥塞。Vite使用esbuild，将有大量内部模块的ESM关系转换成单个模块，以减少 import模块请求次数。 按需加载 服务器只在接受到import请求的时候，才会编译对应的文件，将ESM源码返回给浏览器，实现真正的按需加载。 缓存 HTTP缓存： 充分利用http缓存做优化，依赖（不会变动的代码）部分用max-age,immutable 强缓存，源码部分用304协商缓存，提升页面打开速度。 文件系统缓存： Vite在预构建阶段，将构建后的依赖缓存到node_modules/.vite ，相关配置更改时，或手动控制时才会重新构建，以提升预构建速度。 重写模块路径 浏览器import只能引入相对/绝对路径，而开发代码经常使用npm包名直接引入node_module中的模块，需要做路径转换后交给浏览器。\nes-module-lexer 扫描 import 语法 magic-string 重写模块的引入路径 1 2 3 4 5 // 开发代码 import { createApp } from 'vue' // 转换后 import { createApp } from '/node_modules/vue/dist/vue.js' 源码分析 与Webpack-dev-server类似Vite同样使用WebSocket与客户端建立连接，实现热更新，源码实现基本可分为两部分，源码位置在:\nvite/packages/vite/src/client client（用于客户端） vite/packages/vite/src/node server（用于开发服务器） client 代码会在启动服务时注入到客户端，用于客户端对于WebSocket消息的处理（如更新页面某个模块、刷新页面）；server 代码是服务端逻辑，用于处理代码的构建与页面模块的请求。\n简单看了下源码（vite@2.7.2），核心功能主要是以下几个方法（以下为源码截取，部分逻辑做了删减）：\n命令行启动服务npm run dev后，源码执行cli.ts，调用createServer方法，创建http服务，监听开发服务器端口。 1 2 3 4 5 6 7 8 9 10 11 12 13 // 源码位置 vite/packages/vite/src/node/cli.ts const { createServer } = await import('./server') try { const server = await createServer({ root, base: options.base, ... }) if (!server.httpServer) { throw new Error('HTTP server not available') } await server.listen() } createServer方法的执行做了很多工作，如整合配置项、创建http服务（早期通过koa创建）、创建WebSocket服务、创建源码的文件监听、插件执行、optimize优化等。下面注释中标出。 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 // 源码位置 vite/packages/vite/src/node/server/index.ts export async function createServer( inlineConfig: InlineConfig = {} ): Promise\u003cViteDevServer\u003e { // Vite 配置整合 const config = await resolveConfig(inlineConfig, 'serve', 'development') const root = config.root const serverConfig = config.server // 创建http服务 const httpServer = await resolveHttpServer(serverConfig, middlewares, httpsOptions) // 创建ws服务 const ws = createWebSocketServer(httpServer, config, httpsOptions) // 创建watcher，设置代码文件监听 const watcher = chokidar.watch(path.resolve(root), { ignored: [ '**/node_modules/**', '**/.git/**', ...(Array.isArray(ignored) ? ignored : [ignored]) ], ...watchOptions }) as FSWatcher // 创建server对象 const server: ViteDevServer = { config, middlewares, httpServer, watcher, ws, moduleGraph, listen, ... } // 文件监听变动，websocket向前端通信 watcher.on('change', async (file) =\u003e { ... handleHMRUpdate() }) // 非常多的 middleware middlewares.use(...) // optimize const runOptimize = async () =\u003e {...} return server } 使用chokidar监听文件变化，绑定监听事件。 1 2 3 4 5 6 7 8 9 10 11 12 // 源码位置 vite/packages/vite/src/node/server/index.ts const watcher = chokidar.watch(path.resolve(root), { ignored: [ '**/node_modules/**', '**/.git/**', ...(Array.isArray(ignored) ? ignored : [ignored]) ], ignoreInitial: true, ignorePermissionErrors: true, disableGlobbing: true, ...watchOptions }) as FSWatcher 通过 ws 来创建WebSocket服务，用于监听到文件变化时触发热更新，向客户端发送消息。 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 // 源码位置 vite/packages/vite/src/node/server/ws.ts export function createWebSocketServer(...){ let wss: WebSocket const hmr = isObject(config.server.hmr) \u0026\u0026 config.server.hmr const wsServer = (hmr \u0026\u0026 hmr.server) || server if (wsServer) { wss = new WebSocket({ noServer: true }) wsServer.on('upgrade', (req, socket, head) =\u003e { // 服务就绪 if (req.headers['sec-websocket-protocol'] === HMR_HEADER) { wss.handleUpgrade(req, socket as Socket, head, (ws) =\u003e { wss.emit('connection', ws, req) }) } }) } else { ... } // 服务准备就绪，就能在浏览器控制台看到熟悉的打印 [vite] connected. wss.on('connection', (socket) =\u003e { socket.send(JSON.stringify({ type: 'connected' })) ... }) // 失败 wss.on('error', (e: Error \u0026 { code: string }) =\u003e { ... }) // 返回ws对象 return { on: wss.on.bind(wss), off: wss.off.bind(wss), // 向客户端发送信息 // 多个客户端同时触发 send(payload: HMRPayload) { const stringified = JSON.stringify(payload) wss.clients.forEach((client) =\u003e { // readyState 1 means the connection is open client.send(stringified) }) } } } 在服务启动时会向浏览器注入代码，用于处理客户端接收到的WebSocket消息，如重新发起模块请求、刷新页面。 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 //源码位置 vite/packages/vite/src/client/client.ts async function handleMessage(payload: HMRPayload) { switch (payload.type) { case 'connected': console.log(`[vite] connected.`) break case 'update': notifyListeners('vite:beforeUpdate', payload) ... break case 'custom': { notifyListeners(payload.event as CustomEventName\u003cany\u003e, payload.data) ... break } case 'full-reload': notifyListeners('vite:beforeFullReload', payload) ... break case 'prune': notifyListeners('vite:beforePrune', payload) ... break case 'error': { notifyListeners('vite:error', payload) ... break } default: { const check: never = payload return check } } } 优势 快！快！非常快！！ 高度集成，开箱即用。 基于ESM急速热更新，无需打包编译。 基于esbuild的依赖预处理，比Webpack等node编写的编译器快几个数量级。 兼容Rollup庞大的插件机制，插件开发更简洁。 不与Vue绑定，支持React等其他框架，独立的构建工具。 内置SSR支持。 天然支持TS。 不足 Vue仍为第一优先支持，量身定做的编译插件，对React的支持不如Vue强大。 虽然已经推出2.0正式版，已经可以用于正式线上生产，但目前市场上实践少。 生产环境集成Rollup打包，与开发环境最终执行的代码不一致。 与 webpack 对比 由于Vite主打的是开发环境的极致体验，生产环境集成Rollup，这里的对比主要是Webpack-dev-server与Vite-dev-server的对比：\n到目前很长时间以来Webpack在前端工程领域占统治地位，Vite推出以来备受关注，社区活跃，GitHub star 数量激增，目前达到37.4K Webpack配置丰富使用极为灵活但上手成本高，Vite开箱即用配置高度集成 Webpack启动服务需打包构建，速度慢，Vite免编译可秒开 Webpack热更新需打包构建，速度慢，Vite毫秒响应 Webpack成熟稳定、资源丰富、大量实践案例，Vite实践较少 Vite使用esbuild编译，构建速度比webpack快几个数量级 兼容性 默认目标浏览器是在script标签上支持原生 ESM 和 原生 ESM 动态导入 可使用官方插件 @vitejs/plugin-legacy，转义成传统版本和相对应的polyfill 未来探索 传统构建工具性能已到瓶颈，主打开发体验的Vite，可能会受到欢迎。 主流浏览器基本支持ESM，ESM将成为主流。 Vite在Vue3.0代替vue-cli，作为官方脚手架，会大大提高使用量。 Vite2.0推出后，已可以在实际项目中使用Vite。 如果觉得直接使用Vite太冒险，又确实有dev server速度慢的问题需要解决，可以尝试用Vite单独搭建一套dev server 相关资源 官方插件 除了支持现有的Rollup插件系统外，官方提供了四个最关键的插件\n@vitejs/plugin-vue 提供 Vue3 单文件组件支持 @vitejs/plugin-vue-jsx 提供 Vue3 JSX 支持（专用的 Babel 转换插件） @vitejs/plugin-react 提供完整的 React 支持 @vitejs/plugin-legacy 为打包后的文件提供传统浏览器兼容性支持 UI组件库 Element UI：支持 vite 引入 相关链接 Vite官网 Vue3 生态进展和计划-尤雨溪 Vite源码解析 Develop with Vite | Vite快速入门 - Anthony Fu • Vue北京聚会 Day 13 ",
  "wordCount" : "1342",
  "inLanguage": "zh",
  "image": "http://localhost:1313/images/papermod-cover.png","datePublished": "0001-01-01T00:00:00Z",
  "dateModified": "0001-01-01T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Theme PaperMod"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/posts/juejin/result/1/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "PaperMod",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/%3Clink%20/%20abs%20url%3E"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Home (Alt + H)">
                        
                    <img src="http://localhost:1313/images/msg_hu15231257772499651944.png" alt="" aria-label="logo"
                        height="20">Home</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/archives" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="https://github.com/adityatelange/hugo-PaperMod/wiki/" title="WiKi">
                    <span>WiKi</span>&nbsp;
                    <svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12">
                        <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path>
                        <path d="M15 3h6v6"></path>
                        <path d="M10 14L21 3"></path>
                    </svg>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/">主页</a>&nbsp;»&nbsp;<a href="http://localhost:1313/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      
    </h1>
    <div class="post-meta">7 分钟&nbsp;·&nbsp;Theme PaperMod&nbsp;|&nbsp;<a href="https://github.com/WangShaoyu1/myBlogPaperMod/tree/master/content/posts/jueJin/result/1.md" rel="noopener noreferrer" target="_blank">Suggest Changes</a>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">目录</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e5%89%8d%e8%a8%80" aria-label="前言">前言</a></li>
                <li>
                    <a href="#%e5%a4%a7%e7%ba%b2" aria-label="大纲">大纲</a></li>
                <li>
                    <a href="#%e8%83%8c%e6%99%af" aria-label="背景">背景</a><ul>
                        <ul>
                        
                <li>
                    <a href="#%e5%85%b1%e5%ad%98%e7%9a%84%e6%a8%a1%e5%9d%97%e5%8c%96%e6%a0%87%e5%87%86" aria-label="共存的模块化标准">共存的模块化标准</a></li>
                <li>
                    <a href="#%e5%8f%91%e5%b1%95%e4%b8%ad%e7%9a%84%e6%9e%84%e5%bb%ba%e5%b7%a5%e5%85%b7" aria-label="发展中的构建工具">发展中的构建工具</a></li>
                <li>
                    <a href="#%e5%bd%93%e5%89%8d%e5%b7%a5%e7%a8%8b%e5%8c%96%e7%97%9b%e7%82%b9" aria-label="当前工程化痛点">当前工程化痛点</a></li></ul>
                    </ul>
                </li>
                <li>
                    <a href="#%e4%bb%80%e4%b9%88%e6%98%afvite" aria-label="什么是Vite？">什么是Vite？</a><ul>
                        <ul>
                        
                <li>
                    <a href="#%e6%a6%82%e5%bf%b5" aria-label="概念">概念</a></li>
                <li>
                    <a href="#%e5%bc%80%e5%8f%91%e7%8e%af%e5%a2%83" aria-label="开发环境">开发环境</a></li>
                <li>
                    <a href="#%e7%94%9f%e4%ba%a7%e7%8e%af%e5%a2%83" aria-label="生产环境">生产环境</a></li>
                <li>
                    <a href="#%e5%a4%84%e7%90%86%e6%b5%81%e7%a8%8b%e5%af%b9%e6%af%94" aria-label="处理流程对比">处理流程对比</a></li></ul>
                    </ul>
                </li>
                <li>
                    <a href="#%e5%9f%ba%e6%9c%ac%e7%94%a8%e6%b3%95" aria-label="基本用法">基本用法</a><ul>
                        <ul>
                        
                <li>
                    <a href="#%e5%88%9b%e5%bb%bavite%e9%a1%b9%e7%9b%ae" aria-label="创建vite项目">创建vite项目</a></li>
                <li>
                    <a href="#%e9%80%89%e5%8f%96%e6%a8%a1%e6%9d%bf" aria-label="选取模板">选取模板</a></li>
                <li>
                    <a href="#%e5%90%af%e5%8a%a8" aria-label="启动">启动</a></li></ul>
                    </ul>
                </li>
                <li>
                    <a href="#%e5%ae%9e%e7%8e%b0%e5%8e%9f%e7%90%86" aria-label="实现原理">实现原理</a><ul>
                        <ul>
                        
                <li>
                    <a href="#esbuild-%e7%bc%96%e8%af%91" aria-label="ESbuild 编译">ESbuild 编译</a></li>
                <li>
                    <a href="#%e4%be%9d%e8%b5%96%e9%a2%84%e6%9e%84%e5%bb%ba" aria-label="依赖预构建">依赖预构建</a></li>
                <li>
                    <a href="#%e6%8c%89%e9%9c%80%e5%8a%a0%e8%bd%bd" aria-label="按需加载">按需加载</a></li>
                <li>
                    <a href="#%e7%bc%93%e5%ad%98" aria-label="缓存">缓存</a></li>
                <li>
                    <a href="#%e9%87%8d%e5%86%99%e6%a8%a1%e5%9d%97%e8%b7%af%e5%be%84" aria-label="重写模块路径">重写模块路径</a></li></ul>
                    </ul>
                </li>
                <li>
                    <a href="#%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90" aria-label="源码分析">源码分析</a></li>
                <li>
                    <a href="#%e4%bc%98%e5%8a%bf" aria-label="优势">优势</a></li>
                <li>
                    <a href="#%e4%b8%8d%e8%b6%b3" aria-label="不足">不足</a></li>
                <li>
                    <a href="#%e4%b8%8e-webpack-%e5%af%b9%e6%af%94" aria-label="与 webpack 对比">与 webpack 对比</a></li>
                <li>
                    <a href="#%e5%85%bc%e5%ae%b9%e6%80%a7" aria-label="兼容性">兼容性</a></li>
                <li>
                    <a href="#%e6%9c%aa%e6%9d%a5%e6%8e%a2%e7%b4%a2" aria-label="未来探索">未来探索</a></li>
                <li>
                    <a href="#%e7%9b%b8%e5%85%b3%e8%b5%84%e6%ba%90" aria-label="相关资源">相关资源</a><ul>
                        <ul>
                        
                <li>
                    <a href="#%e5%ae%98%e6%96%b9%e6%8f%92%e4%bb%b6" aria-label="官方插件">官方插件</a></li>
                <li>
                    <a href="#ui%e7%bb%84%e4%bb%b6%e5%ba%93" aria-label="UI组件库">UI组件库</a></li>
                <li>
                    <a href="#%e7%9b%b8%e5%85%b3%e9%93%be%e6%8e%a5" aria-label="相关链接">相关链接</a>
                </li>
            </ul>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p>.markdown-body { word-break: break-word; line-height: 1.75; font-weight: 400; font-size: 16px; overflow-x: hidden; color: #252933 } .markdown-body h1, .markdown-body h2, .markdown-body h3, .markdown-body h4, .markdown-body h5, .markdown-body h6 { line-height: 1.5; margin-top: 35px; margin-bottom: 10px; padding-bottom: 5px } .markdown-body h1 { font-size: 24px; line-height: 38px; margin-bottom: 5px } .markdown-body h2 { font-size: 22px; line-height: 34px; padding-bottom: 12px; border-bottom: 1px solid #ececec } .markdown-body h3 { font-size: 20px; line-height: 28px } .markdown-body h4 { font-size: 18px; line-height: 26px } .markdown-body h5 { font-size: 17px; line-height: 24px } .markdown-body h6 { font-size: 16px; line-height: 24px } .markdown-body p { line-height: inherit; margin-top: 22px; margin-bottom: 22px } .markdown-body img { max-width: 100% } .markdown-body hr { border: none; border-top: 1px solid #ddd; margin-top: 32px; margin-bottom: 32px } .markdown-body code { word-break: break-word; border-radius: 2px; overflow-x: auto; background-color: #fff5f5; color: #ff502c; font-size: .87em; padding: .065em .4em } .markdown-body code, .markdown-body pre { font-family: Menlo, Monaco, Consolas, Courier New, monospace } .markdown-body pre { overflow: auto; position: relative; line-height: 1.75 } .markdown-body pre &gt; code { font-size: 12px; padding: 15px 12px; margin: 0; word-break: normal; display: block; overflow-x: auto; color: #333; background: #f8f8f8 } .markdown-body a { text-decoration: none; color: #0269c8; border-bottom: 1px solid #d1e9ff } .markdown-body a:active, .markdown-body a:hover { color: #275b8c } .markdown-body table { display: inline-block !important; font-size: 12px; width: auto; max-width: 100%; overflow: auto; border: 1px solid #f6f6f6 } .markdown-body thead { background: #f6f6f6; color: #000; text-align: left } .markdown-body tr:nth-child(2n) { background-color: #fcfcfc } .markdown-body td, .markdown-body th { padding: 12px 7px; line-height: 24px } .markdown-body td { min-width: 120px } .markdown-body blockquote { color: #666; padding: 1px 23px; margin: 22px 0; border-left: 4px solid #cbcbcb; background-color: #f8f8f8 } .markdown-body blockquote:after { display: block; content: &quot;&quot; } .markdown-body blockquote &gt; p { margin: 10px 0 } .markdown-body ol, .markdown-body ul { padding-left: 28px } .markdown-body ol li, .markdown-body ul li { margin-bottom: 0; list-style: inherit } .markdown-body ol li .task-list-item, .markdown-body ul li .task-list-item { list-style: none } .markdown-body ol li .task-list-item ol, .markdown-body ol li .task-list-item ul, .markdown-body ul li .task-list-item ol, .markdown-body ul li .task-list-item ul { margin-top: 0 } .markdown-body ol ol, .markdown-body ol ul, .markdown-body ul ol, .markdown-body ul ul { margin-top: 3px } .markdown-body ol li { padding-left: 6px } .markdown-body .contains-task-list { padding-left: 0 } .markdown-body .task-list-item { list-style: none } @media (max-width: 720px) { .markdown-body h1 { font-size: 24px } .markdown-body h2 { font-size: 20px } .markdown-body h3 { font-size: 18px } } .markdown-body pre, .markdown-body pre &gt; code.hljs { color: #333; background: #f8f8f8 } .hljs-comment, .hljs-quote { color: #998; font-style: italic } .hljs-keyword, .hljs-selector-tag, .hljs-subst { color: #333; font-weight: 700 } .hljs-literal, .hljs-number, .hljs-tag .hljs-attr, .hljs-template-variable, .hljs-variable { color: teal } .hljs-doctag, .hljs-string { color: #d14 } .hljs-section, .hljs-selector-id, .hljs-title { color: #900; font-weight: 700 } .hljs-subst { font-weight: 400 } .hljs-class .hljs-title, .hljs-type { color: #458; font-weight: 700 } .hljs-attribute, .hljs-name, .hljs-tag { color: navy; font-weight: 400 } .hljs-link, .hljs-regexp { color: #009926 } .hljs-bullet, .hljs-symbol { color: #990073 } .hljs-built_in, .hljs-builtin-name { color: #0086b3 } .hljs-meta { color: #999; font-weight: 700 } .hljs-deletion { background: #fdd } .hljs-addition { background: #dfd } .hljs-emphasis { font-style: italic } .hljs-strong { font-weight: 700 }</p>
<blockquote>
<p>本文作者是360奇舞团前端开发工程师 王文健</p>
</blockquote>
<h1 id="前言">前言<a hidden class="anchor" aria-hidden="true" href="#前言">#</a></h1>
<p>Hi，大家好！</p>
<p>前段时间用<code>Vue3</code>搭建项目时看到同时推出的<code>Vite</code>，只当它是一个新打包工具或者<code>vue-cli</code>的升级版，仍然选择了用<code>Webpack</code>构建项目。最近看了尤雨溪在VueConf上的演讲视频：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.yuque.com%2Fvueconf%2Fmkwv0c%2Fxqyxix" title="https://www.yuque.com/vueconf/mkwv0c/xqyxix">《Vue3 生态进展和计划》</a>，感觉它确实解决了现阶段前端工程化的一些痛点，也能体会到尤雨溪对<code>Vite</code>的重视和大力推广的决心，再加上<code>Vue</code>本身的庞大用户基数，<code>Vite</code>确实有可能成为下一代前端构建工具的突破口。</p>
<p>本文将讨论下<code>Vite</code>出现的背景，解决的痛点，核心功能的实现，存在的意义和预期的未来。<code>Vite</code>本身并不复杂。中文官方文档非常清晰简洁，建议大家使用前仔细读下文档。</p>
<hr>
<h1 id="大纲">大纲<a hidden class="anchor" aria-hidden="true" href="#大纲">#</a></h1>
<ul>
<li>背景</li>
<li>什么是Vite？</li>
<li>基本用法</li>
<li>实现原理</li>
<li>源码分析</li>
<li>优势与不足</li>
<li>与传统构建工具对比</li>
<li>兼容性</li>
<li>未来</li>
</ul>
<hr>
<h1 id="背景">背景<a hidden class="anchor" aria-hidden="true" href="#背景">#</a></h1>
<p>这里的背景介绍会从与<code>Vite</code>紧密相关的两个概念的发展史说起，一个是<code>JavaScript</code>的模块化标准，另一个是前端构建工具。</p>
<h3 id="共存的模块化标准">共存的模块化标准<a hidden class="anchor" aria-hidden="true" href="#共存的模块化标准">#</a></h3>
<p>为什么<code>JavaScript</code>会有多种共存的模块化标准？因为js在设计之初并没有模块化的概念，随着前端业务复杂度不断提高，模块化越来越受到开发者的重视，社区开始涌现多种模块化解决方案，它们相互借鉴，也争议不断，形成多个派系，从<code>CommonJS</code>开始，到<code>ES6</code>正式推出<code>ES Modules</code>规范结束，所有争论，终成历史，<code>ES Modules</code>也成为前端重要的基础设施。</p>
<ul>
<li><strong>CommonJS</strong>：现主要用于Node.js（Node@13.2.0开始支持直接使用ES Module）</li>
<li><strong>AMD</strong>：<code>require.js</code> 依赖前置，市场存量不建议使用</li>
<li><strong>CMD</strong>：<code>sea.js</code> 就近执行，市场存量不建议使用</li>
<li><strong>ES Module</strong>：ES语言规范，标准，趋势，未来</li>
</ul>
<p>对模块化发展史感兴趣的可以看下<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fseajs%2Fseajs%2Fissues%2F588" title="https://github.com/seajs/seajs/issues/588">《前端模块化开发那点历史》@玉伯</a>，而<code>Vite</code>的核心正是依靠浏览器对ES Module规范的实现。</p>
<h3 id="发展中的构建工具">发展中的构建工具<a hidden class="anchor" aria-hidden="true" href="#发展中的构建工具">#</a></h3>
<p>近些年前端工程化发展迅速，各种构建工具层出不穷，目前<code>Webpack</code>仍然占据统治地位，npm 每周下载量达到两千多万次。下面是我按 npm 发版时间线列出的开发者比较熟知的一些构建工具。</p>
<p><img loading="lazy" src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4401a88bf0e04c668e6623d2134c60d7~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?" alt=""  />
</p>
<h3 id="当前工程化痛点">当前工程化痛点<a hidden class="anchor" aria-hidden="true" href="#当前工程化痛点">#</a></h3>
<p>现在常用的构建工具如<code>Webpack</code>，主要是通过抓取-编译-构建整个应用的代码（也就是常说的打包过程），生成一份编译、优化后能良好兼容各个浏览器的的生产环境代码。在开发环境流程也基本相同，需要先将整个应用构建打包后，再把打包后的代码交给<code>dev server</code>（开发服务器）。</p>
<p><code>Webpack</code>等构建工具的诞生给前端开发带来了极大的便利，但随着前端业务的复杂化，js代码量呈指数增长，打包构建时间越来越久，<code>dev server</code>（开发服务器）性能遇到瓶颈：</p>
<ul>
<li>
<p><strong>缓慢的服务启动：</strong> 大型项目中<code>dev server</code>启动时间达到几十秒甚至几分钟。</p>
</li>
<li>
<p><strong>缓慢的HMR热更新：</strong> 即使采用了 HMR 模式，其热更新速度也会随着应用规模的增长而显著下降，已达到性能瓶颈，无多少优化空间。</p>
</li>
</ul>
<p><strong>缓慢的开发环境，大大降低了开发者的幸福感，在以上背景下<code>Vite</code>应运而生。</strong></p>
<hr>
<h1 id="什么是vite">什么是Vite？<a hidden class="anchor" aria-hidden="true" href="#什么是vite">#</a></h1>
<p><strong>基于esbuild与Rollup，依靠浏览器自身ESM编译功能， 实现极致开发体验的新一代构建工具！</strong></p>
<h3 id="概念">概念<a hidden class="anchor" aria-hidden="true" href="#概念">#</a></h3>
<p>先介绍以下文中会经常提到的一些基础概念：</p>
<ul>
<li><strong>依赖：</strong> 指开发不会变动的部分(npm包、UI组件库)，esbuild进行预构建。</li>
<li><strong>源码：</strong> 浏览器不能直接执行的非js代码(.jsx、.css、.vue等)，vite只在浏览器请求相关源码的时候进行转换，以提供ESM源码。</li>
</ul>
<h3 id="开发环境">开发环境<a hidden class="anchor" aria-hidden="true" href="#开发环境">#</a></h3>
<ul>
<li>利用浏览器原生的<code>ES Module</code>编译能力，省略费时的编译环节，直给浏览器开发环境源码，<code>dev server</code>只提供轻量服务。</li>
<li>浏览器执行ESM的<code>import</code>时，会向<code>dev server</code>发起该模块的<code>ajax</code>请求，服务器对源码做简单处理后返回给浏览器。</li>
<li><code>Vite</code>中HMR是在原生 ESM 上执行的。当编辑一个文件时，Vite 只需要精确地使已编辑的模块失活，使得无论应用大小如何，HMR 始终能保持快速更新。</li>
<li>使用<code>esbuild</code>处理项目依赖，<code>esbuild</code>使用go编写，比一般<code>node.js</code>编写的编译器快几个数量级。</li>
</ul>
<h3 id="生产环境">生产环境<a hidden class="anchor" aria-hidden="true" href="#生产环境">#</a></h3>
<ul>
<li>集成<code>Rollup</code>打包生产环境代码，依赖其成熟稳定的生态与更简洁的插件机制。</li>
</ul>
<h3 id="处理流程对比">处理流程对比<a hidden class="anchor" aria-hidden="true" href="#处理流程对比">#</a></h3>
<p><code>Webpack</code>通过先将整个应用打包，再将打包后代码提供给<code>dev server</code>，开发者才能开始开发。</p>
<p><img loading="lazy" src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/181a6bfe5e4d4857bd6bed63a573e2b3~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?" alt=""  />
</p>
<p><code>Vite</code>直接将源码交给浏览器，实现<code>dev server</code>秒开，浏览器显示页面需要相关模块时，再向<code>dev server</code>发起请求，服务器简单处理后，将该模块返回给浏览器，实现真正意义的按需加载。 <img loading="lazy" src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e00801ede5b84abd9bdaadb720d63e53~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?" alt=""  />
</p>
<hr>
<h1 id="基本用法">基本用法<a hidden class="anchor" aria-hidden="true" href="#基本用法">#</a></h1>
<h3 id="创建vite项目">创建vite项目<a hidden class="anchor" aria-hidden="true" href="#创建vite项目">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-0-1"><a class="lnlinks" href="#hl-0-1">1</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ npm create vite@latest
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="选取模板">选取模板<a hidden class="anchor" aria-hidden="true" href="#选取模板">#</a></h3>
<p><code>Vite</code> 内置6种常用模板与对应的TS版本，可满足前端大部分开发场景，可以点击下列表格中模板直接在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fvite.new%2F" title="https://vite.new/">StackBlitz</a> 中在线试用，还有其他更多的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fvitejs%2Fawesome-vite%23templates" title="https://github.com/vitejs/awesome-vite#templates">社区维护模板</a>可以使用。</p>
<p>JavaScript</p>
<p>TypeScript</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fvite.new%2Fvanilla" title="https://vite.new/vanilla">vanilla</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fvite.new%2Fvanilla-ts" title="https://vite.new/vanilla-ts">vanilla-ts</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fvite.new%2Fvue" title="https://vite.new/vue">vue</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fvite.new%2Fvue-ts" title="https://vite.new/vue-ts">vue-ts</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fvite.new%2Freact" title="https://vite.new/react">react</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fvite.new%2Freact-ts" title="https://vite.new/react-ts">react-ts</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fvite.new%2Fpreact" title="https://vite.new/preact">preact</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fvite.new%2Fpreact-ts" title="https://vite.new/preact-ts">preact-ts</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fvite.new%2Flit" title="https://vite.new/lit">lit</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fvite.new%2Flit-ts" title="https://vite.new/lit-ts">lit-ts</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fvite.new%2Fsvelte" title="https://vite.new/svelte">svelte</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fvite.new%2Fsvelte-ts" title="https://vite.new/svelte-ts">svelte-ts</a></p>
<h3 id="启动">启动<a hidden class="anchor" aria-hidden="true" href="#启动">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-1-1"><a class="lnlinks" href="#hl-1-1">1</a>
</span><span class="lnt" id="hl-1-2"><a class="lnlinks" href="#hl-1-2">2</a>
</span><span class="lnt" id="hl-1-3"><a class="lnlinks" href="#hl-1-3">3</a>
</span><span class="lnt" id="hl-1-4"><a class="lnlinks" href="#hl-1-4">4</a>
</span><span class="lnt" id="hl-1-5"><a class="lnlinks" href="#hl-1-5">5</a>
</span><span class="lnt" id="hl-1-6"><a class="lnlinks" href="#hl-1-6">6</a>
</span><span class="lnt" id="hl-1-7"><a class="lnlinks" href="#hl-1-7">7</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;scripts&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;dev&#34;</span><span class="p">:</span> <span class="s2">&#34;vite&#34;</span><span class="p">,</span> <span class="c1">// 启动开发服务器，别名：`vite dev`，`vite serve`
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nt">&#34;build&#34;</span><span class="p">:</span> <span class="s2">&#34;vite build&#34;</span><span class="p">,</span> <span class="c1">// 为生产环境构建产物
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nt">&#34;preview&#34;</span><span class="p">:</span> <span class="s2">&#34;vite preview&#34;</span> <span class="c1">// 本地预览生产构建产物
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
<h1 id="实现原理">实现原理<a hidden class="anchor" aria-hidden="true" href="#实现原理">#</a></h1>
<h3 id="esbuild-编译">ESbuild 编译<a hidden class="anchor" aria-hidden="true" href="#esbuild-编译">#</a></h3>
<p><code>esbuild</code> 使用go编写，cpu密集下更具性能优势，编译速度更快，以下摘自官网的构建速度对比：<br>
<strong>浏览器：“开始了吗？”</strong><br>
<strong>服务器：“已经结束了。”</strong><br>
<strong>开发者：“好快，好喜欢！！”</strong></p>
<p><img loading="lazy" src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b6ab1cbe74ef49a9a601e0db0265453a~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?" alt="image.png"  />
</p>
<h3 id="依赖预构建">依赖预构建<a hidden class="anchor" aria-hidden="true" href="#依赖预构建">#</a></h3>
<ul>
<li><strong>模块化兼容：</strong> 如开头背景所写，现仍共存多种模块化标准代码，<code>Vite</code>在预构建阶段将依赖中各种其他模块化规范(CommonJS、UMD)转换 成ESM，以提供给浏览器。</li>
<li><strong>性能优化：</strong> npm包中大量的ESM代码，大量的<code>import</code>请求，会造成网络拥塞。<code>Vite</code>使用<code>esbuild</code>，将有大量内部模块的ESM关系转换成单个模块，以减少 <code>import</code>模块请求次数。</li>
</ul>
<h3 id="按需加载">按需加载<a hidden class="anchor" aria-hidden="true" href="#按需加载">#</a></h3>
<ul>
<li>服务器只在接受到import请求的时候，才会编译对应的文件，将ESM源码返回给浏览器，实现真正的按需加载。</li>
</ul>
<h3 id="缓存">缓存<a hidden class="anchor" aria-hidden="true" href="#缓存">#</a></h3>
<ul>
<li><strong>HTTP缓存：</strong> 充分利用<code>http</code>缓存做优化，依赖（不会变动的代码）部分用max-age,immutable <strong>强缓存</strong>，源码部分用304<strong>协商缓存</strong>，提升页面打开速度。</li>
<li><strong>文件系统缓存：</strong> <code>Vite</code>在预构建阶段，将构建后的依赖缓存到<code>node_modules/.vite</code> ，相关配置更改时，或手动控制时才会重新构建，以提升预构建速度。</li>
</ul>
<h3 id="重写模块路径">重写模块路径<a hidden class="anchor" aria-hidden="true" href="#重写模块路径">#</a></h3>
<p>浏览器<code>import</code>只能引入相对/绝对路径，而开发代码经常使用<code>npm</code>包名直接引入<code>node_module</code>中的模块，需要做路径转换后交给浏览器。</p>
<ul>
<li><code>es-module-lexer</code> 扫描 import 语法</li>
<li><code>magic-string</code> 重写模块的引入路径</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-2-1"><a class="lnlinks" href="#hl-2-1">1</a>
</span><span class="lnt" id="hl-2-2"><a class="lnlinks" href="#hl-2-2">2</a>
</span><span class="lnt" id="hl-2-3"><a class="lnlinks" href="#hl-2-3">3</a>
</span><span class="lnt" id="hl-2-4"><a class="lnlinks" href="#hl-2-4">4</a>
</span><span class="lnt" id="hl-2-5"><a class="lnlinks" href="#hl-2-5">5</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// 开发代码
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">createApp</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;vue&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 转换后
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">createApp</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;/node_modules/vue/dist/vue.js&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
<h1 id="源码分析">源码分析<a hidden class="anchor" aria-hidden="true" href="#源码分析">#</a></h1>
<p>与<code>Webpack-dev-server</code>类似<code>Vite</code>同样使用<code>WebSocket</code>与客户端建立连接，实现热更新，源码实现基本可分为两部分，源码位置在:</p>
<ul>
<li><code>vite/packages/vite/src/client</code> client（用于客户端）</li>
<li><code>vite/packages/vite/src/node</code> server（用于开发服务器）</li>
</ul>
<p>client 代码会在启动服务时注入到客户端，用于客户端对于<code>WebSocket</code>消息的处理（如更新页面某个模块、刷新页面）；server 代码是服务端逻辑，用于处理代码的构建与页面模块的请求。</p>
<p>简单看了下源码（vite@2.7.2），核心功能主要是以下几个方法（以下为源码截取，部分逻辑做了删减）：</p>
<ol>
<li>命令行启动服务<code>npm run dev</code>后，源码执行<code>cli.ts</code>，调用<code>createServer</code>方法，创建http服务，监听开发服务器端口。</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-3-1"><a class="lnlinks" href="#hl-3-1"> 1</a>
</span><span class="lnt" id="hl-3-2"><a class="lnlinks" href="#hl-3-2"> 2</a>
</span><span class="lnt" id="hl-3-3"><a class="lnlinks" href="#hl-3-3"> 3</a>
</span><span class="lnt" id="hl-3-4"><a class="lnlinks" href="#hl-3-4"> 4</a>
</span><span class="lnt" id="hl-3-5"><a class="lnlinks" href="#hl-3-5"> 5</a>
</span><span class="lnt" id="hl-3-6"><a class="lnlinks" href="#hl-3-6"> 6</a>
</span><span class="lnt" id="hl-3-7"><a class="lnlinks" href="#hl-3-7"> 7</a>
</span><span class="lnt" id="hl-3-8"><a class="lnlinks" href="#hl-3-8"> 8</a>
</span><span class="lnt" id="hl-3-9"><a class="lnlinks" href="#hl-3-9"> 9</a>
</span><span class="lnt" id="hl-3-10"><a class="lnlinks" href="#hl-3-10">10</a>
</span><span class="lnt" id="hl-3-11"><a class="lnlinks" href="#hl-3-11">11</a>
</span><span class="lnt" id="hl-3-12"><a class="lnlinks" href="#hl-3-12">12</a>
</span><span class="lnt" id="hl-3-13"><a class="lnlinks" href="#hl-3-13">13</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// 源码位置 vite/packages/vite/src/node/cli.ts
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="p">{</span> <span class="nx">createServer</span> <span class="p">}</span> <span class="o">=</span> <span class="kr">await</span> <span class="kr">import</span><span class="p">(</span><span class="s1">&#39;./server&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kr">const</span> <span class="nx">server</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">createServer</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="nx">root</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">base</span><span class="o">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">base</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">...</span>
</span></span><span class="line"><span class="cl">        <span class="p">})</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">server</span><span class="p">.</span><span class="nx">httpServer</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;HTTP server not available&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="kr">await</span> <span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li><code>createServer</code>方法的执行做了很多工作，如整合配置项、创建http服务（早期通过koa创建）、创建<code>WebSocket</code>服务、创建源码的文件监听、插件执行、optimize优化等。下面注释中标出。</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-4-1"><a class="lnlinks" href="#hl-4-1"> 1</a>
</span><span class="lnt" id="hl-4-2"><a class="lnlinks" href="#hl-4-2"> 2</a>
</span><span class="lnt" id="hl-4-3"><a class="lnlinks" href="#hl-4-3"> 3</a>
</span><span class="lnt" id="hl-4-4"><a class="lnlinks" href="#hl-4-4"> 4</a>
</span><span class="lnt" id="hl-4-5"><a class="lnlinks" href="#hl-4-5"> 5</a>
</span><span class="lnt" id="hl-4-6"><a class="lnlinks" href="#hl-4-6"> 6</a>
</span><span class="lnt" id="hl-4-7"><a class="lnlinks" href="#hl-4-7"> 7</a>
</span><span class="lnt" id="hl-4-8"><a class="lnlinks" href="#hl-4-8"> 8</a>
</span><span class="lnt" id="hl-4-9"><a class="lnlinks" href="#hl-4-9"> 9</a>
</span><span class="lnt" id="hl-4-10"><a class="lnlinks" href="#hl-4-10">10</a>
</span><span class="lnt" id="hl-4-11"><a class="lnlinks" href="#hl-4-11">11</a>
</span><span class="lnt" id="hl-4-12"><a class="lnlinks" href="#hl-4-12">12</a>
</span><span class="lnt" id="hl-4-13"><a class="lnlinks" href="#hl-4-13">13</a>
</span><span class="lnt" id="hl-4-14"><a class="lnlinks" href="#hl-4-14">14</a>
</span><span class="lnt" id="hl-4-15"><a class="lnlinks" href="#hl-4-15">15</a>
</span><span class="lnt" id="hl-4-16"><a class="lnlinks" href="#hl-4-16">16</a>
</span><span class="lnt" id="hl-4-17"><a class="lnlinks" href="#hl-4-17">17</a>
</span><span class="lnt" id="hl-4-18"><a class="lnlinks" href="#hl-4-18">18</a>
</span><span class="lnt" id="hl-4-19"><a class="lnlinks" href="#hl-4-19">19</a>
</span><span class="lnt" id="hl-4-20"><a class="lnlinks" href="#hl-4-20">20</a>
</span><span class="lnt" id="hl-4-21"><a class="lnlinks" href="#hl-4-21">21</a>
</span><span class="lnt" id="hl-4-22"><a class="lnlinks" href="#hl-4-22">22</a>
</span><span class="lnt" id="hl-4-23"><a class="lnlinks" href="#hl-4-23">23</a>
</span><span class="lnt" id="hl-4-24"><a class="lnlinks" href="#hl-4-24">24</a>
</span><span class="lnt" id="hl-4-25"><a class="lnlinks" href="#hl-4-25">25</a>
</span><span class="lnt" id="hl-4-26"><a class="lnlinks" href="#hl-4-26">26</a>
</span><span class="lnt" id="hl-4-27"><a class="lnlinks" href="#hl-4-27">27</a>
</span><span class="lnt" id="hl-4-28"><a class="lnlinks" href="#hl-4-28">28</a>
</span><span class="lnt" id="hl-4-29"><a class="lnlinks" href="#hl-4-29">29</a>
</span><span class="lnt" id="hl-4-30"><a class="lnlinks" href="#hl-4-30">30</a>
</span><span class="lnt" id="hl-4-31"><a class="lnlinks" href="#hl-4-31">31</a>
</span><span class="lnt" id="hl-4-32"><a class="lnlinks" href="#hl-4-32">32</a>
</span><span class="lnt" id="hl-4-33"><a class="lnlinks" href="#hl-4-33">33</a>
</span><span class="lnt" id="hl-4-34"><a class="lnlinks" href="#hl-4-34">34</a>
</span><span class="lnt" id="hl-4-35"><a class="lnlinks" href="#hl-4-35">35</a>
</span><span class="lnt" id="hl-4-36"><a class="lnlinks" href="#hl-4-36">36</a>
</span><span class="lnt" id="hl-4-37"><a class="lnlinks" href="#hl-4-37">37</a>
</span><span class="lnt" id="hl-4-38"><a class="lnlinks" href="#hl-4-38">38</a>
</span><span class="lnt" id="hl-4-39"><a class="lnlinks" href="#hl-4-39">39</a>
</span><span class="lnt" id="hl-4-40"><a class="lnlinks" href="#hl-4-40">40</a>
</span><span class="lnt" id="hl-4-41"><a class="lnlinks" href="#hl-4-41">41</a>
</span><span class="lnt" id="hl-4-42"><a class="lnlinks" href="#hl-4-42">42</a>
</span><span class="lnt" id="hl-4-43"><a class="lnlinks" href="#hl-4-43">43</a>
</span><span class="lnt" id="hl-4-44"><a class="lnlinks" href="#hl-4-44">44</a>
</span><span class="lnt" id="hl-4-45"><a class="lnlinks" href="#hl-4-45">45</a>
</span><span class="lnt" id="hl-4-46"><a class="lnlinks" href="#hl-4-46">46</a>
</span><span class="lnt" id="hl-4-47"><a class="lnlinks" href="#hl-4-47">47</a>
</span><span class="lnt" id="hl-4-48"><a class="lnlinks" href="#hl-4-48">48</a>
</span><span class="lnt" id="hl-4-49"><a class="lnlinks" href="#hl-4-49">49</a>
</span><span class="lnt" id="hl-4-50"><a class="lnlinks" href="#hl-4-50">50</a>
</span><span class="lnt" id="hl-4-51"><a class="lnlinks" href="#hl-4-51">51</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// 源码位置 vite/packages/vite/src/node/server/index.ts
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">export</span> <span class="kr">async</span> <span class="kd">function</span> <span class="nx">createServer</span><span class="p">(</span>
</span></span><span class="line"><span class="cl"><span class="nx">inlineConfig</span><span class="o">:</span> <span class="nx">InlineConfig</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span><span class="o">:</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">ViteDevServer</span><span class="o">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Vite 配置整合
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">resolveConfig</span><span class="p">(</span><span class="nx">inlineConfig</span><span class="p">,</span> <span class="s1">&#39;serve&#39;</span><span class="p">,</span> <span class="s1">&#39;development&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">root</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">root</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">serverConfig</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">server</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">// 创建http服务
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">const</span> <span class="nx">httpServer</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">resolveHttpServer</span><span class="p">(</span><span class="nx">serverConfig</span><span class="p">,</span> <span class="nx">middlewares</span><span class="p">,</span> <span class="nx">httpsOptions</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">// 创建ws服务
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">const</span> <span class="nx">ws</span> <span class="o">=</span> <span class="nx">createWebSocketServer</span><span class="p">(</span><span class="nx">httpServer</span><span class="p">,</span> <span class="nx">config</span><span class="p">,</span> <span class="nx">httpsOptions</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">// 创建watcher，设置代码文件监听
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kr">const</span> <span class="nx">watcher</span> <span class="o">=</span> <span class="nx">chokidar</span><span class="p">.</span><span class="nx">watch</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">root</span><span class="p">),</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">ignored</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;**/node_modules/**&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;**/.git/**&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="p">...(</span><span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">ignored</span><span class="p">)</span> <span class="o">?</span> <span class="nx">ignored</span> <span class="o">:</span> <span class="p">[</span><span class="nx">ignored</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">            <span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="p">...</span><span class="nx">watchOptions</span>
</span></span><span class="line"><span class="cl">            <span class="p">})</span> <span class="nx">as</span> <span class="nx">FSWatcher</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="c1">// 创建server对象
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="kr">const</span> <span class="nx">server</span><span class="o">:</span> <span class="nx">ViteDevServer</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nx">config</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="nx">middlewares</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="nx">httpServer</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="nx">watcher</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="nx">ws</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="nx">moduleGraph</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="nx">listen</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="p">...</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="c1">// 文件监听变动，websocket向前端通信
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="nx">watcher</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="kr">async</span> <span class="p">(</span><span class="nx">file</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="p">...</span>
</span></span><span class="line"><span class="cl">                <span class="nx">handleHMRUpdate</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="p">})</span>
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">                <span class="c1">// 非常多的 middleware
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="nx">middlewares</span><span class="p">.</span><span class="nx">use</span><span class="p">(...)</span>
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">                <span class="c1">// optimize
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="kr">const</span> <span class="nx">runOptimize</span> <span class="o">=</span> <span class="kr">async</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{...}</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nx">server</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>使用<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fchokidar" title="https://www.npmjs.com/package/chokidar">chokidar</a>监听文件变化，绑定监听事件。</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-5-1"><a class="lnlinks" href="#hl-5-1"> 1</a>
</span><span class="lnt" id="hl-5-2"><a class="lnlinks" href="#hl-5-2"> 2</a>
</span><span class="lnt" id="hl-5-3"><a class="lnlinks" href="#hl-5-3"> 3</a>
</span><span class="lnt" id="hl-5-4"><a class="lnlinks" href="#hl-5-4"> 4</a>
</span><span class="lnt" id="hl-5-5"><a class="lnlinks" href="#hl-5-5"> 5</a>
</span><span class="lnt" id="hl-5-6"><a class="lnlinks" href="#hl-5-6"> 6</a>
</span><span class="lnt" id="hl-5-7"><a class="lnlinks" href="#hl-5-7"> 7</a>
</span><span class="lnt" id="hl-5-8"><a class="lnlinks" href="#hl-5-8"> 8</a>
</span><span class="lnt" id="hl-5-9"><a class="lnlinks" href="#hl-5-9"> 9</a>
</span><span class="lnt" id="hl-5-10"><a class="lnlinks" href="#hl-5-10">10</a>
</span><span class="lnt" id="hl-5-11"><a class="lnlinks" href="#hl-5-11">11</a>
</span><span class="lnt" id="hl-5-12"><a class="lnlinks" href="#hl-5-12">12</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// 源码位置 vite/packages/vite/src/node/server/index.ts
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">const</span> <span class="nx">watcher</span> <span class="o">=</span> <span class="nx">chokidar</span><span class="p">.</span><span class="nx">watch</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">root</span><span class="p">),</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">ignored</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;**/node_modules/**&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;**/.git/**&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">...(</span><span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">ignored</span><span class="p">)</span> <span class="o">?</span> <span class="nx">ignored</span> <span class="o">:</span> <span class="p">[</span><span class="nx">ignored</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="nx">ignoreInitial</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">ignorePermissionErrors</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">disableGlobbing</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">...</span><span class="nx">watchOptions</span>
</span></span><span class="line"><span class="cl">        <span class="p">})</span> <span class="nx">as</span> <span class="nx">FSWatcher</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="4">
<li>通过 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fws" title="https://www.npmjs.com/package/ws">ws</a> 来创建<code>WebSocket</code>服务，用于监听到文件变化时触发热更新，向客户端发送消息。</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-6-1"><a class="lnlinks" href="#hl-6-1"> 1</a>
</span><span class="lnt" id="hl-6-2"><a class="lnlinks" href="#hl-6-2"> 2</a>
</span><span class="lnt" id="hl-6-3"><a class="lnlinks" href="#hl-6-3"> 3</a>
</span><span class="lnt" id="hl-6-4"><a class="lnlinks" href="#hl-6-4"> 4</a>
</span><span class="lnt" id="hl-6-5"><a class="lnlinks" href="#hl-6-5"> 5</a>
</span><span class="lnt" id="hl-6-6"><a class="lnlinks" href="#hl-6-6"> 6</a>
</span><span class="lnt" id="hl-6-7"><a class="lnlinks" href="#hl-6-7"> 7</a>
</span><span class="lnt" id="hl-6-8"><a class="lnlinks" href="#hl-6-8"> 8</a>
</span><span class="lnt" id="hl-6-9"><a class="lnlinks" href="#hl-6-9"> 9</a>
</span><span class="lnt" id="hl-6-10"><a class="lnlinks" href="#hl-6-10">10</a>
</span><span class="lnt" id="hl-6-11"><a class="lnlinks" href="#hl-6-11">11</a>
</span><span class="lnt" id="hl-6-12"><a class="lnlinks" href="#hl-6-12">12</a>
</span><span class="lnt" id="hl-6-13"><a class="lnlinks" href="#hl-6-13">13</a>
</span><span class="lnt" id="hl-6-14"><a class="lnlinks" href="#hl-6-14">14</a>
</span><span class="lnt" id="hl-6-15"><a class="lnlinks" href="#hl-6-15">15</a>
</span><span class="lnt" id="hl-6-16"><a class="lnlinks" href="#hl-6-16">16</a>
</span><span class="lnt" id="hl-6-17"><a class="lnlinks" href="#hl-6-17">17</a>
</span><span class="lnt" id="hl-6-18"><a class="lnlinks" href="#hl-6-18">18</a>
</span><span class="lnt" id="hl-6-19"><a class="lnlinks" href="#hl-6-19">19</a>
</span><span class="lnt" id="hl-6-20"><a class="lnlinks" href="#hl-6-20">20</a>
</span><span class="lnt" id="hl-6-21"><a class="lnlinks" href="#hl-6-21">21</a>
</span><span class="lnt" id="hl-6-22"><a class="lnlinks" href="#hl-6-22">22</a>
</span><span class="lnt" id="hl-6-23"><a class="lnlinks" href="#hl-6-23">23</a>
</span><span class="lnt" id="hl-6-24"><a class="lnlinks" href="#hl-6-24">24</a>
</span><span class="lnt" id="hl-6-25"><a class="lnlinks" href="#hl-6-25">25</a>
</span><span class="lnt" id="hl-6-26"><a class="lnlinks" href="#hl-6-26">26</a>
</span><span class="lnt" id="hl-6-27"><a class="lnlinks" href="#hl-6-27">27</a>
</span><span class="lnt" id="hl-6-28"><a class="lnlinks" href="#hl-6-28">28</a>
</span><span class="lnt" id="hl-6-29"><a class="lnlinks" href="#hl-6-29">29</a>
</span><span class="lnt" id="hl-6-30"><a class="lnlinks" href="#hl-6-30">30</a>
</span><span class="lnt" id="hl-6-31"><a class="lnlinks" href="#hl-6-31">31</a>
</span><span class="lnt" id="hl-6-32"><a class="lnlinks" href="#hl-6-32">32</a>
</span><span class="lnt" id="hl-6-33"><a class="lnlinks" href="#hl-6-33">33</a>
</span><span class="lnt" id="hl-6-34"><a class="lnlinks" href="#hl-6-34">34</a>
</span><span class="lnt" id="hl-6-35"><a class="lnlinks" href="#hl-6-35">35</a>
</span><span class="lnt" id="hl-6-36"><a class="lnlinks" href="#hl-6-36">36</a>
</span><span class="lnt" id="hl-6-37"><a class="lnlinks" href="#hl-6-37">37</a>
</span><span class="lnt" id="hl-6-38"><a class="lnlinks" href="#hl-6-38">38</a>
</span><span class="lnt" id="hl-6-39"><a class="lnlinks" href="#hl-6-39">39</a>
</span><span class="lnt" id="hl-6-40"><a class="lnlinks" href="#hl-6-40">40</a>
</span><span class="lnt" id="hl-6-41"><a class="lnlinks" href="#hl-6-41">41</a>
</span><span class="lnt" id="hl-6-42"><a class="lnlinks" href="#hl-6-42">42</a>
</span><span class="lnt" id="hl-6-43"><a class="lnlinks" href="#hl-6-43">43</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// 源码位置 vite/packages/vite/src/node/server/ws.ts
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">export</span> <span class="kd">function</span> <span class="nx">createWebSocketServer</span><span class="p">(...){</span>
</span></span><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nx">wss</span><span class="o">:</span> <span class="nx">WebSocket</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">hmr</span> <span class="o">=</span> <span class="nx">isObject</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">hmr</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">config</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">hmr</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">wsServer</span> <span class="o">=</span> <span class="p">(</span><span class="nx">hmr</span> <span class="o">&amp;&amp;</span> <span class="nx">hmr</span><span class="p">.</span><span class="nx">server</span><span class="p">)</span> <span class="o">||</span> <span class="nx">server</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">wsServer</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">wss</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WebSocket</span><span class="p">({</span> <span class="nx">noServer</span><span class="o">:</span> <span class="kc">true</span> <span class="p">})</span>
</span></span><span class="line"><span class="cl">            <span class="nx">wsServer</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;upgrade&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">socket</span><span class="p">,</span> <span class="nx">head</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// 服务就绪
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="s1">&#39;sec-websocket-protocol&#39;</span><span class="p">]</span> <span class="o">===</span> <span class="nx">HMR_HEADER</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nx">wss</span><span class="p">.</span><span class="nx">handleUpgrade</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">socket</span> <span class="nx">as</span> <span class="nx">Socket</span><span class="p">,</span> <span class="nx">head</span><span class="p">,</span> <span class="p">(</span><span class="nx">ws</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nx">wss</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;connection&#39;</span><span class="p">,</span> <span class="nx">ws</span><span class="p">,</span> <span class="nx">req</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="p">})</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="p">})</span>
</span></span><span class="line"><span class="cl">                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="p">...</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// 服务准备就绪，就能在浏览器控制台看到熟悉的打印 [vite] connected.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                    <span class="nx">wss</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connection&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">socket</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nx">socket</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;connected&#39;</span> <span class="p">}))</span>
</span></span><span class="line"><span class="cl">                    <span class="p">...</span>
</span></span><span class="line"><span class="cl">                    <span class="p">})</span>
</span></span><span class="line"><span class="cl">                    <span class="c1">// 失败
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                        <span class="nx">wss</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="o">:</span> <span class="nb">Error</span> <span class="o">&amp;</span> <span class="p">{</span> <span class="nx">code</span><span class="o">:</span> <span class="nx">string</span> <span class="p">})</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="p">...</span>
</span></span><span class="line"><span class="cl">                        <span class="p">})</span>
</span></span><span class="line"><span class="cl">                        <span class="c1">// 返回ws对象
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                            <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                            <span class="nx">on</span><span class="o">:</span> <span class="nx">wss</span><span class="p">.</span><span class="nx">on</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">wss</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                            <span class="nx">off</span><span class="o">:</span> <span class="nx">wss</span><span class="p">.</span><span class="nx">off</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">wss</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                            <span class="c1">// 向客户端发送信息
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                            <span class="c1">// 多个客户端同时触发
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                                <span class="nx">send</span><span class="p">(</span><span class="nx">payload</span><span class="o">:</span> <span class="nx">HMRPayload</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                                <span class="kr">const</span> <span class="nx">stringified</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                                    <span class="nx">wss</span><span class="p">.</span><span class="nx">clients</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">client</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                                    <span class="c1">// readyState 1 means the connection is open
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                                    <span class="nx">client</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">stringified</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                                    <span class="p">})</span>
</span></span><span class="line"><span class="cl">                                <span class="p">}</span>
</span></span><span class="line"><span class="cl">                            <span class="p">}</span>
</span></span><span class="line"><span class="cl">                        <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="5">
<li>在服务启动时会向浏览器注入代码，用于处理客户端接收到的<code>WebSocket</code>消息，如重新发起模块请求、刷新页面。</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-7-1"><a class="lnlinks" href="#hl-7-1"> 1</a>
</span><span class="lnt" id="hl-7-2"><a class="lnlinks" href="#hl-7-2"> 2</a>
</span><span class="lnt" id="hl-7-3"><a class="lnlinks" href="#hl-7-3"> 3</a>
</span><span class="lnt" id="hl-7-4"><a class="lnlinks" href="#hl-7-4"> 4</a>
</span><span class="lnt" id="hl-7-5"><a class="lnlinks" href="#hl-7-5"> 5</a>
</span><span class="lnt" id="hl-7-6"><a class="lnlinks" href="#hl-7-6"> 6</a>
</span><span class="lnt" id="hl-7-7"><a class="lnlinks" href="#hl-7-7"> 7</a>
</span><span class="lnt" id="hl-7-8"><a class="lnlinks" href="#hl-7-8"> 8</a>
</span><span class="lnt" id="hl-7-9"><a class="lnlinks" href="#hl-7-9"> 9</a>
</span><span class="lnt" id="hl-7-10"><a class="lnlinks" href="#hl-7-10">10</a>
</span><span class="lnt" id="hl-7-11"><a class="lnlinks" href="#hl-7-11">11</a>
</span><span class="lnt" id="hl-7-12"><a class="lnlinks" href="#hl-7-12">12</a>
</span><span class="lnt" id="hl-7-13"><a class="lnlinks" href="#hl-7-13">13</a>
</span><span class="lnt" id="hl-7-14"><a class="lnlinks" href="#hl-7-14">14</a>
</span><span class="lnt" id="hl-7-15"><a class="lnlinks" href="#hl-7-15">15</a>
</span><span class="lnt" id="hl-7-16"><a class="lnlinks" href="#hl-7-16">16</a>
</span><span class="lnt" id="hl-7-17"><a class="lnlinks" href="#hl-7-17">17</a>
</span><span class="lnt" id="hl-7-18"><a class="lnlinks" href="#hl-7-18">18</a>
</span><span class="lnt" id="hl-7-19"><a class="lnlinks" href="#hl-7-19">19</a>
</span><span class="lnt" id="hl-7-20"><a class="lnlinks" href="#hl-7-20">20</a>
</span><span class="lnt" id="hl-7-21"><a class="lnlinks" href="#hl-7-21">21</a>
</span><span class="lnt" id="hl-7-22"><a class="lnlinks" href="#hl-7-22">22</a>
</span><span class="lnt" id="hl-7-23"><a class="lnlinks" href="#hl-7-23">23</a>
</span><span class="lnt" id="hl-7-24"><a class="lnlinks" href="#hl-7-24">24</a>
</span><span class="lnt" id="hl-7-25"><a class="lnlinks" href="#hl-7-25">25</a>
</span><span class="lnt" id="hl-7-26"><a class="lnlinks" href="#hl-7-26">26</a>
</span><span class="lnt" id="hl-7-27"><a class="lnlinks" href="#hl-7-27">27</a>
</span><span class="lnt" id="hl-7-28"><a class="lnlinks" href="#hl-7-28">28</a>
</span><span class="lnt" id="hl-7-29"><a class="lnlinks" href="#hl-7-29">29</a>
</span><span class="lnt" id="hl-7-30"><a class="lnlinks" href="#hl-7-30">30</a>
</span><span class="lnt" id="hl-7-31"><a class="lnlinks" href="#hl-7-31">31</a>
</span><span class="lnt" id="hl-7-32"><a class="lnlinks" href="#hl-7-32">32</a>
</span><span class="lnt" id="hl-7-33"><a class="lnlinks" href="#hl-7-33">33</a>
</span><span class="lnt" id="hl-7-34"><a class="lnlinks" href="#hl-7-34">34</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">//源码位置 vite/packages/vite/src/client/client.ts
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">async</span> <span class="kd">function</span> <span class="nx">handleMessage</span><span class="p">(</span><span class="nx">payload</span><span class="o">:</span> <span class="nx">HMRPayload</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">switch</span> <span class="p">(</span><span class="nx">payload</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="s1">&#39;connected&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`[vite] connected.`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">break</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="s1">&#39;update&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">        <span class="nx">notifyListeners</span><span class="p">(</span><span class="s1">&#39;vite:beforeUpdate&#39;</span><span class="p">,</span> <span class="nx">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">...</span>
</span></span><span class="line"><span class="cl">        <span class="k">break</span>
</span></span><span class="line"><span class="cl">            <span class="k">case</span> <span class="s1">&#39;custom&#39;</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">notifyListeners</span><span class="p">(</span><span class="nx">payload</span><span class="p">.</span><span class="nx">event</span> <span class="nx">as</span> <span class="nx">CustomEventName</span><span class="o">&lt;</span><span class="nx">any</span><span class="o">&gt;</span><span class="p">,</span> <span class="nx">payload</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">...</span>
</span></span><span class="line"><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="s1">&#39;full-reload&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">        <span class="nx">notifyListeners</span><span class="p">(</span><span class="s1">&#39;vite:beforeFullReload&#39;</span><span class="p">,</span> <span class="nx">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">...</span>
</span></span><span class="line"><span class="cl">        <span class="k">break</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="s1">&#39;prune&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">        <span class="nx">notifyListeners</span><span class="p">(</span><span class="s1">&#39;vite:beforePrune&#39;</span><span class="p">,</span> <span class="nx">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">...</span>
</span></span><span class="line"><span class="cl">        <span class="k">break</span>
</span></span><span class="line"><span class="cl">            <span class="k">case</span> <span class="s1">&#39;error&#39;</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">notifyListeners</span><span class="p">(</span><span class="s1">&#39;vite:error&#39;</span><span class="p">,</span> <span class="nx">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">...</span>
</span></span><span class="line"><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="k">default</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kr">const</span> <span class="nx">check</span><span class="o">:</span> <span class="nx">never</span> <span class="o">=</span> <span class="nx">payload</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nx">check</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
<h1 id="优势">优势<a hidden class="anchor" aria-hidden="true" href="#优势">#</a></h1>
<ul>
<li>快！快！非常快！！</li>
<li>高度集成，开箱即用。</li>
<li>基于ESM急速热更新，无需打包编译。</li>
<li>基于<code>esbuild</code>的依赖预处理，比<code>Webpack</code>等node编写的编译器快几个数量级。</li>
<li>兼容<code>Rollup</code>庞大的插件机制，插件开发更简洁。</li>
<li>不与<code>Vue</code>绑定，支持<code>React</code>等其他框架，独立的构建工具。</li>
<li>内置SSR支持。</li>
<li>天然支持TS。</li>
</ul>
<h1 id="不足">不足<a hidden class="anchor" aria-hidden="true" href="#不足">#</a></h1>
<ul>
<li><code>Vue</code>仍为第一优先支持，量身定做的编译插件，对<code>React</code>的支持不如<code>Vue</code>强大。</li>
<li>虽然已经推出2.0正式版，已经可以用于正式线上生产，但目前市场上实践少。</li>
<li>生产环境集成<code>Rollup</code>打包，与开发环境最终执行的代码不一致。</li>
</ul>
<hr>
<h1 id="与-webpack-对比">与 webpack 对比<a hidden class="anchor" aria-hidden="true" href="#与-webpack-对比">#</a></h1>
<p>由于<code>Vite</code>主打的是开发环境的极致体验，生产环境集成<code>Rollup</code>，这里的对比主要是<code>Webpack-dev-server</code>与<code>Vite-dev-server</code>的对比：</p>
<ul>
<li>到目前很长时间以来<code>Webpack</code>在前端工程领域占统治地位，<code>Vite</code>推出以来备受关注，社区活跃，GitHub star 数量激增，目前达到37.4K <img loading="lazy" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a13034f21bfc43499756af2ae85cdbbd~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image.png"  />
</li>
<li><code>Webpack</code>配置丰富使用极为灵活但上手成本高，<code>Vite</code>开箱即用配置高度集成</li>
<li><code>Webpack</code>启动服务需打包构建，速度慢，<code>Vite</code>免编译可秒开</li>
<li><code>Webpack</code>热更新需打包构建，速度慢，<code>Vite</code>毫秒响应</li>
<li><code>Webpack</code>成熟稳定、资源丰富、大量实践案例，<code>Vite</code>实践较少</li>
<li><code>Vite</code>使用<code>esbuild</code>编译，构建速度比<code>webpack</code>快几个数量级</li>
</ul>
<hr>
<h1 id="兼容性">兼容性<a hidden class="anchor" aria-hidden="true" href="#兼容性">#</a></h1>
<ul>
<li>默认目标浏览器是在<code>script</code>标签上支持原生 ESM 和 原生 ESM 动态导入</li>
<li>可使用官方插件 <code>@vitejs/plugin-legacy</code>，转义成传统版本和相对应的<code>polyfill</code></li>
</ul>
<hr>
<h1 id="未来探索">未来探索<a hidden class="anchor" aria-hidden="true" href="#未来探索">#</a></h1>
<ul>
<li>传统构建工具性能已到瓶颈，主打开发体验的<code>Vite</code>，可能会受到欢迎。</li>
<li>主流浏览器基本支持ESM，ESM将成为主流。</li>
<li><code>Vite</code>在<code>Vue3.0</code>代替<code>vue-cli</code>，作为官方脚手架，会大大提高使用量。</li>
<li><code>Vite2.0</code>推出后，已可以在实际项目中使用<code>Vite</code>。</li>
<li>如果觉得直接使用<code>Vite</code>太冒险，又确实有<code>dev server</code>速度慢的问题需要解决，可以尝试用<code>Vite</code>单独搭建一套<code>dev server</code></li>
</ul>
<hr>
<h1 id="相关资源">相关资源<a hidden class="anchor" aria-hidden="true" href="#相关资源">#</a></h1>
<h3 id="官方插件">官方插件<a hidden class="anchor" aria-hidden="true" href="#官方插件">#</a></h3>
<p>除了支持现有的<code>Rollup</code>插件系统外，官方提供了四个最关键的插件</p>
<ul>
<li><code>@vitejs/plugin-vue</code> 提供 Vue3 单文件组件支持</li>
<li><code>@vitejs/plugin-vue-jsx</code> 提供 Vue3 JSX 支持（专用的 Babel 转换插件）</li>
<li><code>@vitejs/plugin-react</code> 提供完整的 React 支持</li>
<li><code>@vitejs/plugin-legacy</code> 为打包后的文件提供传统浏览器兼容性支持</li>
</ul>
<h3 id="ui组件库">UI组件库<a hidden class="anchor" aria-hidden="true" href="#ui组件库">#</a></h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Felement-plus.gitee.io%2Fzh-CN%2Fguide%2Fquickstart.html%23%25E6%258C%2589%25E9%259C%2580%25E5%25AF%25BC%25E5%2585%25A5" title="https://element-plus.gitee.io/zh-CN/guide/quickstart.html#%E6%8C%89%E9%9C%80%E5%AF%BC%E5%85%A5">Element UI</a>：支持 vite 引入</li>
</ul>
<h3 id="相关链接">相关链接<a hidden class="anchor" aria-hidden="true" href="#相关链接">#</a></h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcn.vitejs.dev%2F" title="https://cn.vitejs.dev/">Vite官网</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.yuque.com%2Fvueconf%2Fmkwv0c%2Fxqyxix" title="https://www.yuque.com/vueconf/mkwv0c/xqyxix">Vue3 生态进展和计划-尤雨溪</a></li>
<li><a href="https://link.juejin.cn?target=http%3A%2F%2Fvite.ssr-fc.com%2F" title="http://vite.ssr-fc.com/">Vite源码解析</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3Dxx8gEHet6n8" title="https://www.youtube.com/watch?v=xx8gEHet6n8">Develop with Vite | Vite快速入门 - Anthony Fu • Vue北京聚会 Day 13</a></li>
</ul>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
<nav class="paginav">
  <a class="prev" href="http://localhost:1313/posts/juejin/compare/">
    <span class="title">« 上一页</span>
    <br>
    <span></span>
  </a>
  <a class="next" href="http://localhost:1313/posts/juejin/result/md_it_2/">
    <span class="title">下一页 »</span>
    <br>
    <span></span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span><a href="https://beian.miit.gov.cn/">粤ICP备2023039897号-1</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = '复制';

        function copyingDone() {
            copybutton.innerHTML = '已复制！';
            setTimeout(() => {
                copybutton.innerHTML = '复制';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
