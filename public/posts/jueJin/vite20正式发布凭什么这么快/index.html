<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Vite20正式发布，凭什么这么快？ | PaperMod</title>
<meta name="keywords" content="Vite">
<meta name="description" content="相信随着尤雨溪卖力的吆呼，不少前端的小伙伴已经对vite有所耳熟了，这是一个伴随着着Vue30发布的下一代构建工具，其名字就是出自法语单fast。可以看到尤雨溪近期的主要工作全部是在vite上，足以说明其重要之处在这篇文章中，我们就来看看vite到底有何独…">
<meta name="author" content="AtomG">
<link rel="canonical" href="http://localhost:1313/posts/juejin/vite20%E6%AD%A3%E5%BC%8F%E5%8F%91%E5%B8%83%E5%87%AD%E4%BB%80%E4%B9%88%E8%BF%99%E4%B9%88%E5%BF%AB/">
<meta name="google-site-verification" content="XYZabc">
<link crossorigin="anonymous" href="/assets/css/stylesheet.7b92bf4867c997b58ec50f63451b83777173d5bd5593376852abd85746d09d71.css" integrity="sha256-e5K/SGfJl7WOxQ9jRRuDd3Fz1b1VkzdoUqvYV0bQnXE=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<link rel="apple-touch-icon" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<link rel="mask-icon" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="zh" href="http://localhost:1313/posts/juejin/vite20%E6%AD%A3%E5%BC%8F%E5%8F%91%E5%B8%83%E5%87%AD%E4%BB%80%E4%B9%88%E8%BF%99%E4%B9%88%E5%BF%AB/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript><meta property="og:title" content="Vite20正式发布，凭什么这么快？" />
<meta property="og:description" content="相信随着尤雨溪卖力的吆呼，不少前端的小伙伴已经对vite有所耳熟了，这是一个伴随着着Vue30发布的下一代构建工具，其名字就是出自法语单fast。可以看到尤雨溪近期的主要工作全部是在vite上，足以说明其重要之处在这篇文章中，我们就来看看vite到底有何独…" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/posts/juejin/vite20%E6%AD%A3%E5%BC%8F%E5%8F%91%E5%B8%83%E5%87%AD%E4%BB%80%E4%B9%88%E8%BF%99%E4%B9%88%E5%BF%AB/" />
<meta property="og:image" content="http://localhost:1313/images/papermod-cover.png" />
<meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-02-21T00:00:00+00:00" />
<meta property="article:modified_time" content="2021-02-21T00:00:00+00:00" />


<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="http://localhost:1313/images/papermod-cover.png" />
<meta name="twitter:title" content="Vite20正式发布，凭什么这么快？"/>
<meta name="twitter:description" content="相信随着尤雨溪卖力的吆呼，不少前端的小伙伴已经对vite有所耳熟了，这是一个伴随着着Vue30发布的下一代构建工具，其名字就是出自法语单fast。可以看到尤雨溪近期的主要工作全部是在vite上，足以说明其重要之处在这篇文章中，我们就来看看vite到底有何独…"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Vite20正式发布，凭什么这么快？",
      "item": "http://localhost:1313/posts/juejin/vite20%E6%AD%A3%E5%BC%8F%E5%8F%91%E5%B8%83%E5%87%AD%E4%BB%80%E4%B9%88%E8%BF%99%E4%B9%88%E5%BF%AB/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Vite20正式发布，凭什么这么快？",
  "name": "Vite20正式发布，凭什么这么快？",
  "description": "相信随着尤雨溪卖力的吆呼，不少前端的小伙伴已经对vite有所耳熟了，这是一个伴随着着Vue30发布的下一代构建工具，其名字就是出自法语单fast。可以看到尤雨溪近期的主要工作全部是在vite上，足以说明其重要之处在这篇文章中，我们就来看看vite到底有何独…",
  "keywords": [
    "Vite"
  ],
  "articleBody": "相信随着尤雨溪卖力的吆呼，不少前端的小伙伴已经对 vite 有所耳熟了，这是一个伴随着着 Vue3.0 发布的下一代构建工具，其名字就是出自法语单 fast。可以看到尤雨溪近期的主要工作全部是在 vite 上，足以说明其重要之处 在这篇文章中，我们就来看看 vite 到底有何独到之处。\n天下苦 webpack 久矣 在前端这块混，肯定不能没有听说过 webpack，现代的大型前端应用一般都是用这玩意构建的，但是随着项目的增大，大家发现了 webpack 几个「难言之隐」\n随着项目大小增长，项目冷启动时间指数增长 热更新时间也会随着项目大小增大而增长 所以才有了我们常戏称的：npm run dev ，然后去上个厕所，喝杯咖啡，回来可能还没跑完，极大的影响了开发效率。虽然 webpack 提供了很多方法去做构建优化，在日益庞大的前端项目中仍然不太够用，能不能有一种方式一劳永逸的解决这个问题呢？答案就是 Vite ！\nVite 横空出世 vite 是如何解决这个世纪难题的呢，答案是 native ES modules。在浏览器没有原生模块化支持的时代，我们往往需要通过 webpack 等构建工具将整个项目打包成一个 js 文件，方便浏览器进行调用。但是随着浏览器厂商的不断努力，现代浏览器基本已经全部支持了 import/ export 语法，下图可以看到具体的浏览器兼容情况。 大部分浏览器都已经可以解析 js 文件中的 import 语句，webpack 的打包过程是不是有点脱了裤子放屁的感觉了。 ​\n如果要一个字概括 vite 的话，那就是快，这是尤大在 vite PPT 中列出来的数据 ​\n服务启动时间 \u003c 300ms 模块热替换时间(HMR) \u003c 100ms ​\n从数据上来看确实是吊打 Webpack，我们来看看它是如何做的\n为什么 Webpack 这么慢 前文也提到，在之前的浏览器中没有模块化的设计，所以期望把所有源代码编译进一个 js 文件中提供给浏览器使用，所以在开发中当我们运行启动命令的时候，webpack 总是需要从入口文件去索引整个项目的文件，编译成一个或多个单独的 js 文件，即使采用了代码拆分，也需要一次生成所有路由下的编译后文件（这也是为什么代码拆分对开发模式性能没有帮助）。这也导致了服务启动时间随着项目复杂度而指数增长 Vite 是如何解决问题的 vite 是如何通过使用 native ES modules 优化服务启动时间的呢，使用 Vite 启动开发服务器的时候并不需要提前编译文件（其实是有一个类似过程的，下文详述），而是在浏览器请求对应 URL 的时候，再提供对应的文件，这就实现了在使用了路由懒加载的项目中，仅提供对应路由下的模块的编译文件，而没有索引全部代码的这一过程，项目启动时间始终为常量级。并不会随着项目复杂度变高而一直增长，我们来看看具体是怎么做的 Vite 是如何实现的 依赖预构建 对 native ES modules 了解的同学可能会想到，它是不支持如下的裸模块导入的，那咋办？\njavascript\n代码解读\n复制代码\nimport { someMethod } from 'my-dep'\n我们来看看 Vite 是如何实现的，可以直接打开使用 yarn create @vitejs/app 创建的基于 react+ts 的项目这是src/main.tsx 的代码\njavascript\n代码解读\n复制代码\nimport React from 'react' import ReactDOM from 'react-dom' import './index.css' import App from './App' ReactDOM.render( , document.getElementById('root') )\n然后把项目跑起来，这是经过Vite 编译后的 src/main.tsx 文件\n可以看到之前的 from 'react' 被重写为了 from \"/node_modules/.vite/react.js?v=432aac16\"\n看起来 Vite 会将预构建的依赖缓存到 node_modules/.vite 路径下，可以看到文件名后跟着一串随机字符串，很容易就可以想到是用来控制浏览器缓存相关的，让我们打开 react.js?v=432aac16 这个文件的请求头看一看：\n果不其然，Cache-Control 属性被写为了： max-age=31536000,immutable ，将这个文件设置为了永久的强制缓存，也就是永远从本地取文件，然后通过向文件名中添加 hash 值控制版本更新。这样一来将依赖文件的缓存判断交给了浏览器老大哥，减少了 Vite 端的工作量，实在是妙啊。\n你以为这就完了吗，其实并没有，打开 react.js?v=432aac16 文件一看 ​\n​\n这是什么玩意？ 为什么不是熟悉的 react 好兄弟，Vite 还偷偷的干了什么？ 没错，在这一步 Vite 并不是只是简单的重写了一下路径。在服务启动的时候，vite 将会在所有源代码中检查类似 import { someMethod } from ‘my-dep’ 的裸模块导入语句，并执行以下操作\n预构建 重写为合法的 URL 其中「预构建」就是上文提到过的「提前编译文件」，在项目启动之初，Vite 会使用 esbuild 进行「依赖预构建」，有两个目的\n1.CommonJS 和 UMD 兼容性 在开发阶段中， Vite 的开发服务器将所有的代码都视为原生 ES 模块，所以需要在预构建阶段先将作为 CommonJS 或 UMD 发布的依赖项转换为 ESM。\n2.优化加载性能 Vite将带有许多内部模块的ESM依赖转换为单个模块，以提高后续页面加载性能（降低请求数量），比如 lodash-es 有超过 600 个内置模块，一次性发送 600 多个 http 请求，就算是采用了 HTTP2 也是不可接受的，大量的网络请求在浏览器端会造成网络拥塞，导致页面的加载速度相当慢，通过预构建 lodash-es 成为一个模块，就只需要一个 HTTP 请求了！ ​\n关于「依赖预构建」更多详细信息可以参考官方文档。\n预构建完依赖项之后，再使用 es-module-lexer + magic-string 进行轻量级裸模块导入语句的重写。因为并没有进行完整的 AST 遍历，所以速度非常快，对于大多数文件来说这个时间都小于 1ms ！\n文件编译 解决完裸模块导入的问题，就能愉快的开发了吗，其实并没有。注意到我们的项目是使用的 TypeScript+React 构建的，浏览器是没办法直接解析 tsx 的，老办法，直接看看编译后的文件 没错看到了熟悉的 React.createElement，熟悉 webpack 的同学应该已经马上想到了，这不是 babel-loader 的工作吗，在 Vite 中是并没有 loader 功能，是如何实现的呢，答案就是 esbuild，Vite 使用 esbuild 作为部分文件类型的解析器（如 TSX \u0026 TypeScript），Vite 并不会与 webpack 一样，提前将所有文件编译为浏览器可以接受的类型，而是在接收到浏览器发起的 http 请求之后再去编译对应文件，提供给浏览器。这样会有一个非常合理的疑问，速度够么？\n每一次页面加载都需要编译一次文件，看起来会对加载速度有影响啊？这就不得不再次提到 Vite 所使用的构建工具 esbuild，是一个使用 Go 编写的构建工具，按照官网描述，速度比现有的构建工具（webpack 不是在说你）快了10-100倍。其官网有更多详细性能测试数据 为什么 esbuild 这么快？ 为什么同样是构建工具，esbuild 这么优秀？具体有以下几点（来自esbuild 官网）\n1. 使用 Go 编写，并且编译成了机器码 现在的构建工具一般都是用 JavaScript 进行编写的，对于这种解释型语言（动态语言）来说，在命令行下的性能非常糟糕。因为每次运行编译的时候 V8 引擎都是第一次遇见代码，无法进行任何优化措施。而 esbuild 使用 Go 这种编译型语言（静态语言）编写而成，已经编译成了机器可以直接执行的机器码。当 esbuild 在编译你的 javaScript 代码的时候，可能 Node 还在忙着解析你的构建工具的代码。\n除此之外，Go 语言是为并发而设计的语言，而 JavaScript 明显不是（老单线程了）。\nGo 在线程之间共享使用内存空间，而 JS 想要在线程间传递数据还需要把数据序列化之后再传送。 Go 和 JS 的并发都有相应的垃圾回收机制，Go 会在所有线程之间共享堆，对于 JS 而言，每一个线程都有一个独立的堆。 根据 esbuild 的作者的测试，这似乎将 JavaScript 的工作线程的并行处理能力减少了一半，可能是因为你的一半 CPU 核心忙于为另一半收集垃圾\n2. 大量使用并行算法 除了 Go 语言天生对于并发的优势，使得其处理并发任务性能远远优于 JavaScript， Esbuild 的内部算法也是经过精心设计的，尽可能的压榨所有的 CPU 核心。\n3. esbuild 的所有内容都是从零编写的 自己编写一切而不是使用第三方库有很多性能上的好处。可以从一开始就考虑到性能，可以确保所有的东西都使用一致的数据结构以避免昂贵的转换，当然，缺点就是这工作量非常大。\n4. 更有效利用内存 ​\nesbuild 通过减少 AST 遍历次数（三次），来减小内存访问速度对于打包速度的影响 Go 语言还有一个好处就是可以把数据更加紧凑的储存在内存中，从而使得高速 CPU 缓存可以存下更多的内容 ​\nVite2.0 刚刚发布稳定版，其中就把预构建的工具从 Rollup 换成了 esbuild，性能加快了几十倍。\nVite 功能 了解完一些原理，来看看 Vite 到底能干啥？\n模块热重载 Vite 支持 Vue 和 React 的模块热重载，可以准确的更新页面而无需重新加载页面或者删除应用程序状态\nTypeScript Vite 支持开箱即用的引入 .ts 文件，但是值得注意的是 Vite 仅执行 ts 文件的翻译工作，并不执行任何类型检查，这是因为 Vite 使用 esbuild 进行转译工作，而并不含类型信息，所以不支持 TypeScript 的特定功能如「常量枚举」「隐式 type-only 导入」。你必须在你的 tsconfig.json 中的 compilerOptions 里设置 \"isolatedModules\": true，这样 TS 才会警告你哪些功能无法与独立编译模式一同工作。 ​\nVue 作为亲兄弟，Vite 自然会为 Vue 提供第一优先级的支持\nVue 3 单文件组件支持：@vitejs/plugin-vue Vue 3 JSX 支持：@vitejs/plugin-vue-jsx Vue 2 支持：underfin/vite-plugin-vue2 JSX 前端另一巨头 React 同样不用担心，.jsx 与 .tsx 也是开箱即用。其翻译是通过 ESBuild 进行的，默认为 React16 形式，React17 形式的 JSX 在 esbuild 中的支持请看这里\nCSS 导入 .css 文件会把内容插入到 标签中，同样支持热重载。也能够以字符串的形式检索处理后的、作为其模块默认导出的 CSS。 也支持 「@import 内联」「PostCSS」「CSS Modules」「CSS 预处理器」，详细内容可以看文档\n限于篇幅只是简单的列举了几种常用的文件类型的支持，其实 Vite 还支持很多文件类型如「JSON」「Web Assembly」「Web Worker」，可以去官方文档查看更多\n写在最后 关于 Vite 其实还有很多想写的，比如 生产环境下的优化，服务端渲染等，但是限于时间与篇幅与能力，只能遗憾的留给下一篇文章了。不会鸽太久的！\n参考资料 Vite 文档 Why is esbuild fast? React 17 全新的 JSX 转换 Vite \u0026 VitePress @ Vue Toronto 2020 PPT ",
  "wordCount" : "454",
  "inLanguage": "zh",
  "image": "http://localhost:1313/images/papermod-cover.png","datePublished": "2021-02-21T00:00:00Z",
  "dateModified": "2021-02-21T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "AtomG"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/posts/juejin/vite20%E6%AD%A3%E5%BC%8F%E5%8F%91%E5%B8%83%E5%87%AD%E4%BB%80%E4%B9%88%E8%BF%99%E4%B9%88%E5%BF%AB/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "PaperMod",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/%3Clink%20/%20abs%20url%3E"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Home (Alt + H)">
                        
                    <img src="http://localhost:1313/images/msg_hu15231257772499651944.png" alt="" aria-label="logo"
                        height="20">Home</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/archives" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="https://github.com/adityatelange/hugo-PaperMod/wiki/" title="WiKi">
                    <span>WiKi</span>&nbsp;
                    <svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12">
                        <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path>
                        <path d="M15 3h6v6"></path>
                        <path d="M10 14L21 3"></path>
                    </svg>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/">主页</a>&nbsp;»&nbsp;<a href="http://localhost:1313/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      Vite20正式发布，凭什么这么快？
    </h1>
    <div class="post-description">
      相信随着尤雨溪卖力的吆呼，不少前端的小伙伴已经对vite有所耳熟了，这是一个伴随着着Vue30发布的下一代构建工具，其名字就是出自法语单fast。可以看到尤雨溪近期的主要工作全部是在vite上，足以说明其重要之处在这篇文章中，我们就来看看vite到底有何独…
    </div>
    <div class="post-meta"><span title='2021-02-21 00:00:00 +0000 UTC'>二月 21, 2021</span>&nbsp;·&nbsp;3 分钟&nbsp;·&nbsp;AtomG&nbsp;|&nbsp;<a href="https://github.com/WangShaoyu1/myBlogPaperMod/tree/master/content/posts/jueJin/Vite20%e6%ad%a3%e5%bc%8f%e5%8f%91%e5%b8%83%ef%bc%8c%e5%87%ad%e4%bb%80%e4%b9%88%e8%bf%99%e4%b9%88%e5%bf%ab%ef%bc%9f.md" rel="noopener noreferrer" target="_blank">Suggest Changes</a>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">目录</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e5%a4%a9%e4%b8%8b%e8%8b%a6-webpack-%e4%b9%85%e7%9f%a3" aria-label="天下苦 webpack 久矣">天下苦 webpack 久矣</a></li>
                <li>
                    <a href="#vite-%e6%a8%aa%e7%a9%ba%e5%87%ba%e4%b8%96" aria-label="Vite 横空出世">Vite 横空出世</a></li>
                <li>
                    <a href="#%e4%b8%ba%e4%bb%80%e4%b9%88-webpack-%e8%bf%99%e4%b9%88%e6%85%a2" aria-label="为什么 Webpack 这么慢">为什么 Webpack 这么慢</a></li>
                <li>
                    <a href="#vite-%e6%98%af%e5%a6%82%e4%bd%95%e8%a7%a3%e5%86%b3%e9%97%ae%e9%a2%98%e7%9a%84" aria-label="Vite 是如何解决问题的">Vite 是如何解决问题的</a></li>
                <li>
                    <a href="#vite-%e6%98%af%e5%a6%82%e4%bd%95%e5%ae%9e%e7%8e%b0%e7%9a%84" aria-label="Vite 是如何实现的">Vite 是如何实现的</a><ul>
                        
                <li>
                    <a href="#%e4%be%9d%e8%b5%96%e9%a2%84%e6%9e%84%e5%bb%ba" aria-label="依赖预构建">依赖预构建</a></li>
                <li>
                    <a href="#%e6%96%87%e4%bb%b6%e7%bc%96%e8%af%91" aria-label="文件编译">文件编译</a></li>
                <li>
                    <a href="#%e4%b8%ba%e4%bb%80%e4%b9%88-esbuild-%e8%bf%99%e4%b9%88%e5%bf%ab" aria-label="为什么 esbuild 这么快？">为什么 esbuild 这么快？</a><ul>
                        
                <li>
                    <a href="#1-%e4%bd%bf%e7%94%a8-go-%e7%bc%96%e5%86%99%e5%b9%b6%e4%b8%94%e7%bc%96%e8%af%91%e6%88%90%e4%ba%86%e6%9c%ba%e5%99%a8%e7%a0%81" aria-label="1. 使用 Go 编写，并且编译成了机器码">1. 使用 Go 编写，并且编译成了机器码</a></li>
                <li>
                    <a href="#2-%e5%a4%a7%e9%87%8f%e4%bd%bf%e7%94%a8%e5%b9%b6%e8%a1%8c%e7%ae%97%e6%b3%95" aria-label="2. 大量使用并行算法">2. 大量使用并行算法</a></li>
                <li>
                    <a href="#3-esbuild-%e7%9a%84%e6%89%80%e6%9c%89%e5%86%85%e5%ae%b9%e9%83%bd%e6%98%af%e4%bb%8e%e9%9b%b6%e7%bc%96%e5%86%99%e7%9a%84" aria-label="3. esbuild 的所有内容都是从零编写的">3. esbuild 的所有内容都是从零编写的</a></li>
                <li>
                    <a href="#4-%e6%9b%b4%e6%9c%89%e6%95%88%e5%88%a9%e7%94%a8%e5%86%85%e5%ad%98" aria-label="4. 更有效利用内存">4. 更有效利用内存</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#vite-%e5%8a%9f%e8%83%bd" aria-label="Vite 功能">Vite 功能</a><ul>
                        
                <li>
                    <a href="#%e6%a8%a1%e5%9d%97%e7%83%ad%e9%87%8d%e8%bd%bd" aria-label="模块热重载">模块热重载</a></li>
                <li>
                    <a href="#typescript" aria-label="TypeScript">TypeScript</a></li>
                <li>
                    <a href="#vue" aria-label="Vue">Vue</a></li>
                <li>
                    <a href="#jsx" aria-label="JSX">JSX</a></li>
                <li>
                    <a href="#css" aria-label="CSS">CSS</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%86%99%e5%9c%a8%e6%9c%80%e5%90%8e" aria-label="写在最后">写在最后</a></li>
                <li>
                    <a href="#%e5%8f%82%e8%80%83%e8%b5%84%e6%96%99" aria-label="参考资料">参考资料</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p>相信随着尤雨溪卖力的吆呼，不少前端的小伙伴已经对 vite 有所耳熟了，这是一个伴随着着 Vue3.0 发布的下一代构建工具，其名字就是出自法语单 fast。可以看到尤雨溪近期的主要工作全部是在 vite 上，足以说明其重要之处 <img loading="lazy" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/642f1e2237854374bd1926f98afbef2a~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image.png"  />
</p>
<p>在这篇文章中，我们就来看看 vite 到底有何独到之处。</p>
<h2 id="天下苦-webpack-久矣">天下苦 webpack 久矣<a hidden class="anchor" aria-hidden="true" href="#天下苦-webpack-久矣">#</a></h2>
<p>在前端这块混，肯定不能没有听说过 webpack，现代的大型前端应用一般都是用这玩意构建的，但是随着项目的增大，大家发现了 webpack 几个「难言之隐」</p>
<ul>
<li>随着项目大小增长，项目冷启动时间指数增长</li>
<li>热更新时间也会随着项目大小增大而增长</li>
</ul>
<p>所以才有了我们常戏称的：<code>npm run dev</code> ，然后去上个厕所，喝杯咖啡，回来可能还没跑完，极大的影响了开发效率。虽然 webpack 提供了很多方法去做构建优化，在日益庞大的前端项目中仍然不太够用，能不能有一种方式一劳永逸的解决这个问题呢？答案就是 Vite ！</p>
<h2 id="vite-横空出世">Vite 横空出世<a hidden class="anchor" aria-hidden="true" href="#vite-横空出世">#</a></h2>
<p>vite 是如何解决这个世纪难题的呢，答案是  <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FGuide%2FModules" title="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Modules">native ES modules</a>。在浏览器没有原生模块化支持的时代，我们往往需要通过 webpack 等构建工具将整个项目打包成一个 js 文件，方便浏览器进行调用。但是随着浏览器厂商的不断努力，现代浏览器基本已经全部支持了 import/ export 语法，下图可以看到具体的浏览器兼容情况。 <img loading="lazy" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/869ed9b9d97a4ad18d54b5ae74fd1d9b~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image.png"  />
</p>
<p>大部分浏览器都已经可以解析 js 文件中的 import 语句，webpack 的打包过程是不是有点脱了裤子放屁的感觉了。 ​</p>
<p>如果要一个字概括 vite 的话，那就是快，这是尤大在 vite PPT 中列出来的数据 ​</p>
<ul>
<li>服务启动时间 &lt; 300ms</li>
<li>模块热替换时间(HMR) &lt; 100ms</li>
</ul>
<p>​</p>
<p>从数据上来看确实是吊打 Webpack，我们来看看它是如何做的</p>
<h2 id="为什么-webpack-这么慢">为什么 Webpack 这么慢<a hidden class="anchor" aria-hidden="true" href="#为什么-webpack-这么慢">#</a></h2>
<p>前文也提到，在之前的浏览器中没有模块化的设计，所以期望把所有源代码编译进一个 js 文件中提供给浏览器使用，所以在开发中当我们运行启动命令的时候，webpack 总是需要从入口文件去索引整个项目的文件，编译成一个或多个单独的 js 文件，即使采用了代码拆分，也需要一次生成所有路由下的编译后文件（这也是为什么代码拆分对开发模式性能没有帮助）。这也导致了服务启动时间随着项目复杂度而指数增长 <img loading="lazy" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d97a6d6222e645efaa4a8d9da9eda35a~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image.png"  />
</p>
<h2 id="vite-是如何解决问题的">Vite 是如何解决问题的<a hidden class="anchor" aria-hidden="true" href="#vite-是如何解决问题的">#</a></h2>
<p>vite 是如何通过使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FGuide%2FModules" title="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Modules">native ES modules</a> 优化服务启动时间的呢，使用 Vite 启动开发服务器的时候并不需要提前编译文件（其实是有一个类似过程的，下文详述），而是在浏览器请求对应 URL 的时候，再提供对应的文件，这就实现了在使用了路由懒加载的项目中，仅提供对应路由下的模块的编译文件，而没有索引全部代码的这一过程，项目启动时间始终为常量级。并不会随着项目复杂度变高而一直增长，我们来看看具体是怎么做的 <img loading="lazy" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e6fb7904e6a6413cb3100b0fbf7189a6~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image.png"  />
</p>
<h2 id="vite-是如何实现的">Vite 是如何实现的<a hidden class="anchor" aria-hidden="true" href="#vite-是如何实现的">#</a></h2>
<h3 id="依赖预构建">依赖预构建<a hidden class="anchor" aria-hidden="true" href="#依赖预构建">#</a></h3>
<p>对 native ES modules 了解的同学可能会想到，它是不支持如下的裸模块导入的，那咋办？</p>
<p>javascript</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>import { someMethod } from 'my-dep'</code></p>
<p>我们来看看 Vite 是如何实现的，可以直接打开使用 <code>yarn create @vitejs/app</code> 创建的基于 react+ts 的项目这是src/main.tsx 的代码</p>
<p>javascript</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>import React from 'react' import ReactDOM from 'react-dom' import './index.css' import App from './App' ReactDOM.render(   &lt;React.StrictMode&gt;     &lt;App /&gt;   &lt;/React.StrictMode&gt;,   document.getElementById('root') )</code></p>
<p>然后把项目跑起来，这是经过Vite 编译后的 src/main.tsx 文件</p>
<p><img loading="lazy" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/796123c1413f409da4e095d45e54ccb2~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image.png"  />
</p>
<p>可以看到之前的 <code>from 'react'</code> 被重写为了 <code>from &quot;/node_modules/.vite/react.js?v=432aac16&quot;</code></p>
<p>看起来 Vite 会将预构建的依赖缓存到 <code>node_modules/.vite</code> 路径下，可以看到文件名后跟着一串随机字符串，很容易就可以想到是用来控制浏览器缓存相关的，让我们打开 <code>react.js?v=432aac16</code> 这个文件的请求头看一看：</p>
<p><img loading="lazy" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e7d81fd404a54bd3b95ffc3b2cdf12d0~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image.png"  />
</p>
<p>果不其然，Cache-Control 属性被写为了： <code>max-age=31536000,immutable</code> ，将这个文件设置为了永久的强制缓存，也就是永远从本地取文件，然后通过向文件名中添加 hash 值控制版本更新。这样一来将依赖文件的缓存判断交给了浏览器老大哥，减少了 Vite 端的工作量，实在是妙啊。</p>
<p>你以为这就完了吗，其实并没有，打开 <code>react.js?v=432aac16</code> 文件一看 ​</p>
<p><img loading="lazy" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/94a0dade2e8d4ecbbb2644f144338357~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image.png"  />
 ​</p>
<p>这是什么玩意？ 为什么不是熟悉的 react 好兄弟，Vite 还偷偷的干了什么？ 没错，在这一步 Vite 并不是只是简单的重写了一下路径。在服务启动的时候，vite 将会在所有源代码中检查类似 import { someMethod } from &lsquo;my-dep&rsquo; 的裸模块导入语句，并执行以下操作</p>
<ul>
<li><strong>预构建</strong></li>
<li><strong>重写为合法的 URL</strong></li>
</ul>
<p>其中「预构建」就是上文提到过的「提前编译文件」，在项目启动之初，Vite 会使用 esbuild 进行「依赖预构建」，有两个目的</p>
<p><strong>1.CommonJS 和 UMD 兼容性</strong> 在开发阶段中， Vite 的开发服务器将所有的代码都视为原生 ES 模块，所以需要在预构建阶段先将作为 CommonJS 或 UMD 发布的依赖项转换为 ESM。</p>
<p><strong>2.优化加载性能</strong> Vite将带有许多内部模块的ESM依赖转换为单个模块，以提高后续页面加载性能（降低请求数量），比如 lodash-es 有超过 600 个内置模块，一次性发送 600 多个 http 请求，就算是采用了 HTTP2 也是不可接受的，大量的网络请求在浏览器端会造成网络拥塞，导致页面的加载速度相当慢，通过预构建 lodash-es 成为一个模块，就只需要一个 HTTP 请求了！ ​</p>
<blockquote>
<p>关于「依赖预构建」更多详细信息可以参考<a href="https://link.juejin.cn?target=https%3A%2F%2Fcn.vitejs.dev%2Fguide%2Fdep-pre-bundling.html" title="https://cn.vitejs.dev/guide/dep-pre-bundling.html">官方文档</a>。</p>
</blockquote>
<p>预构建完依赖项之后，再使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fguybedford%2Fes-module-lexer" title="https://github.com/guybedford/es-module-lexer">es-module-lexer</a> + <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FRich-Harris%2Fmagic-string" title="https://github.com/Rich-Harris/magic-string">magic-string</a> 进行轻量级裸模块导入语句的重写。因为并没有进行完整的 AST 遍历，所以速度非常快，对于大多数文件来说这个时间都小于 1ms ！</p>
<h3 id="文件编译">文件编译<a hidden class="anchor" aria-hidden="true" href="#文件编译">#</a></h3>
<p>解决完裸模块导入的问题，就能愉快的开发了吗，其实并没有。注意到我们的项目是使用的 TypeScript+React 构建的，浏览器是没办法直接解析 tsx 的，老办法，直接看看编译后的文件 <img loading="lazy" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/01489c11a5ea49f4a8bfcb44963d60cd~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image.png"  />
 没错看到了熟悉的 React.createElement，熟悉 webpack 的同学应该已经马上想到了，这不是 babel-loader 的工作吗，在 Vite 中是并没有 loader 功能，是如何实现的呢，答案就是 <a href="https://link.juejin.cn?target=https%3A%2F%2Fesbuild.github.io%2F" title="https://esbuild.github.io/">esbuild</a>，Vite 使用 esbuild 作为部分文件类型的解析器（如 TSX &amp; TypeScript），Vite 并不会与 webpack 一样，提前将所有文件编译为浏览器可以接受的类型，而是在接收到浏览器发起的 http 请求之后再去编译对应文件，提供给浏览器。这样会有一个非常合理的疑问，速度够么？</p>
<p>每一次页面加载都需要编译一次文件，看起来会对加载速度有影响啊？这就不得不再次提到 Vite 所使用的构建工具 esbuild，是一个使用 Go 编写的构建工具，按照官网描述，速度比现有的构建工具（webpack 不是在说你）快了10-100倍。其<a href="https://link.juejin.cn?target=https%3A%2F%2Fesbuild.github.io%2Ffaq%2F%23benchmark-details" title="https://esbuild.github.io/faq/#benchmark-details">官网</a>有更多详细性能测试数据 <img loading="lazy" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/aad4e211b14347d8bac76cc41616d25f~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image.png"  />
</p>
<h3 id="为什么-esbuild-这么快">为什么 esbuild 这么快？<a hidden class="anchor" aria-hidden="true" href="#为什么-esbuild-这么快">#</a></h3>
<p>为什么同样是构建工具，esbuild 这么优秀？具体有以下几点（来自<a href="https://link.juejin.cn?target=https%3A%2F%2Fesbuild.github.io%2Ffaq%2F%23why-is-esbuild-fast" title="https://esbuild.github.io/faq/#why-is-esbuild-fast">esbuild 官网</a>）</p>
<h4 id="1-使用-go-编写并且编译成了机器码">1. 使用 Go 编写，并且编译成了机器码<a hidden class="anchor" aria-hidden="true" href="#1-使用-go-编写并且编译成了机器码">#</a></h4>
<p>现在的构建工具一般都是用 JavaScript 进行编写的，对于这种解释型语言（动态语言）来说，在命令行下的性能非常糟糕。因为每次运行编译的时候 V8 引擎都是第一次遇见代码，无法进行任何优化措施。而 esbuild 使用 Go 这种编译型语言（静态语言）编写而成，已经编译成了机器可以直接执行的机器码。当 esbuild 在编译你的 javaScript 代码的时候，可能 Node 还在忙着解析你的构建工具的代码。</p>
<p>除此之外，Go 语言是为并发而设计的语言，而 JavaScript 明显不是（老单线程了）。</p>
<ul>
<li>Go 在线程之间共享使用内存空间，而 JS 想要在线程间传递数据还需要把数据序列化之后再传送。</li>
<li>Go 和 JS 的并发都有相应的垃圾回收机制，Go 会在所有线程之间共享堆，对于 JS 而言，每一个线程都有一个独立的堆。</li>
</ul>
<p>根据 esbuild 的作者的测试，这似乎将 JavaScript 的工作线程的并行处理能力减少了一半，可能是因为你的一半 CPU 核心忙于为另一半收集垃圾</p>
<h4 id="2-大量使用并行算法">2. 大量使用并行算法<a hidden class="anchor" aria-hidden="true" href="#2-大量使用并行算法">#</a></h4>
<p>除了 Go 语言天生对于并发的优势，使得其处理并发任务性能远远优于 JavaScript， Esbuild 的内部算法也是经过精心设计的，尽可能的压榨所有的 CPU 核心。</p>
<h4 id="3-esbuild-的所有内容都是从零编写的">3. esbuild 的所有内容都是从零编写的<a hidden class="anchor" aria-hidden="true" href="#3-esbuild-的所有内容都是从零编写的">#</a></h4>
<p>自己编写一切而不是使用第三方库有很多性能上的好处。可以从一开始就考虑到性能，可以确保所有的东西都使用一致的数据结构以避免昂贵的转换，当然，缺点就是这工作量非常大。</p>
<h4 id="4-更有效利用内存">4. 更有效利用内存<a hidden class="anchor" aria-hidden="true" href="#4-更有效利用内存">#</a></h4>
<p>​</p>
<ul>
<li>esbuild 通过减少 AST 遍历次数（三次），来减小内存访问速度对于打包速度的影响</li>
<li>Go 语言还有一个好处就是可以把数据更加紧凑的储存在内存中，从而使得高速 CPU 缓存可以存下更多的内容</li>
</ul>
<p>​</p>
<blockquote>
<p>Vite2.0 刚刚发布稳定版，其中就把预构建的工具从 Rollup 换成了 esbuild，性能加快了几十倍。</p>
</blockquote>
<h2 id="vite-功能">Vite 功能<a hidden class="anchor" aria-hidden="true" href="#vite-功能">#</a></h2>
<p>了解完一些原理，来看看 Vite 到底能干啥？</p>
<h3 id="模块热重载">模块热重载<a hidden class="anchor" aria-hidden="true" href="#模块热重载">#</a></h3>
<p>Vite 支持 Vue 和 React 的模块热重载，可以准确的更新页面而无需重新加载页面或者删除应用程序状态</p>
<h3 id="typescript">TypeScript<a hidden class="anchor" aria-hidden="true" href="#typescript">#</a></h3>
<p>Vite 支持开箱即用的引入 .ts 文件，但是值得注意的是 Vite 仅执行 ts 文件的翻译工作，并不执行任何类型检查，这是因为 Vite 使用 esbuild 进行转译工作，而并不含类型信息，所以不支持 TypeScript 的特定功能如「常量枚举」「隐式 type-only 导入」。你必须在你的 <code>tsconfig.json</code> 中的 <code>compilerOptions</code> 里设置 <code>&quot;isolatedModules&quot;: true</code>，这样 TS 才会警告你哪些功能无法与独立编译模式一同工作。 ​</p>
<h3 id="vue">Vue<a hidden class="anchor" aria-hidden="true" href="#vue">#</a></h3>
<p>作为亲兄弟，Vite 自然会为 Vue 提供第一优先级的支持</p>
<ul>
<li>Vue 3 单文件组件支持：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fvitejs%2Fvite%2Ftree%2Fmain%2Fpackages%2Fplugin-vue" title="https://github.com/vitejs/vite/tree/main/packages/plugin-vue">@vitejs/plugin-vue</a></li>
<li>Vue 3 JSX 支持：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fvitejs%2Fvite%2Ftree%2Fmain%2Fpackages%2Fplugin-vue-jsx" title="https://github.com/vitejs/vite/tree/main/packages/plugin-vue-jsx">@vitejs/plugin-vue-jsx</a></li>
<li>Vue 2 支持：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Funderfin%2Fvite-plugin-vue2" title="https://github.com/underfin/vite-plugin-vue2">underfin/vite-plugin-vue2</a></li>
</ul>
<h3 id="jsx">JSX<a hidden class="anchor" aria-hidden="true" href="#jsx">#</a></h3>
<p>前端另一巨头 React 同样不用担心，.jsx 与 .tsx 也是开箱即用。其翻译是通过 ESBuild 进行的，默认为 React16 形式，React17 形式的 JSX 在 esbuild 中的支持请看<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fevanw%2Fesbuild%2Fissues%2F334" title="https://github.com/evanw/esbuild/issues/334">这里</a></p>
<h3 id="css">CSS<a hidden class="anchor" aria-hidden="true" href="#css">#</a></h3>
<p>导入 .css 文件会把内容插入到 标签中，同样支持热重载。也能够以字符串的形式检索处理后的、作为其模块默认导出的 CSS。 也支持 「@import 内联」「PostCSS」「CSS Modules」「CSS 预处理器」，详细内容可以看文档</p>
<p>限于篇幅只是简单的列举了几种常用的文件类型的支持，其实 Vite 还支持很多文件类型如「JSON」「Web Assembly」「Web Worker」，可以去<a href="https://link.juejin.cn?target=https%3A%2F%2Fcn.vitejs.dev%2Fguide%2Ffeatures.html" title="https://cn.vitejs.dev/guide/features.html">官方文档</a>查看更多</p>
<h2 id="写在最后">写在最后<a hidden class="anchor" aria-hidden="true" href="#写在最后">#</a></h2>
<p>关于 Vite 其实还有很多想写的，比如 生产环境下的优化，服务端渲染等，但是限于时间与篇幅与能力，只能遗憾的留给下一篇文章了。不会鸽太久的！</p>
<h2 id="参考资料">参考资料<a hidden class="anchor" aria-hidden="true" href="#参考资料">#</a></h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fvitejs.dev%2Fguide%2F" title="https://vitejs.dev/guide/">Vite 文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fesbuild.github.io%2Fgetting-started%2F" title="https://esbuild.github.io/getting-started/">Why is esbuild fast?</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fzh-hans.reactjs.org%2Fblog%2F2020%2F09%2F22%2Fintroducing-the-new-jsx-transform.html" title="https://zh-hans.reactjs.org/blog/2020/09/22/introducing-the-new-jsx-transform.html">React 17 全新的 JSX 转换</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.google.com%2Fpresentation%2Fd%2F1X1hrFw18v67bEniTPpaI_DBulLdkKNFEc_3nVEm95mM%2Fedit%23slide%3Did.p" title="https://docs.google.com/presentation/d/1X1hrFw18v67bEniTPpaI_DBulLdkKNFEc_3nVEm95mM/edit#slide=id.p">Vite &amp; VitePress @ Vue Toronto 2020 PPT</a></li>
</ul>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/vite/">Vite</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://localhost:1313/posts/juejin/htmx%E5%90%8E%E7%AB%AF%E4%B8%BB%E5%AF%BC%E7%9A%84%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6%E6%98%AF%E5%95%A5%E6%A0%B7%E7%9A%84/">
    <span class="title">« 上一页</span>
    <br>
    <span>htmx：后端主导的前端框架是啥样的？</span>
  </a>
  <a class="next" href="http://localhost:1313/posts/juejin/%E4%BD%A0%E4%B8%8D%E7%9F%A5%E9%81%93%E7%9A%84vue/">
    <span class="title">下一页 »</span>
    <br>
    <span>你不知道的Vue</span>
  </a>
</nav>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Vite20正式发布，凭什么这么快？ on x"
            href="https://x.com/intent/tweet/?text=Vite20%e6%ad%a3%e5%bc%8f%e5%8f%91%e5%b8%83%ef%bc%8c%e5%87%ad%e4%bb%80%e4%b9%88%e8%bf%99%e4%b9%88%e5%bf%ab%ef%bc%9f&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2fvite20%25E6%25AD%25A3%25E5%25BC%258F%25E5%258F%2591%25E5%25B8%2583%25E5%2587%25AD%25E4%25BB%2580%25E4%25B9%2588%25E8%25BF%2599%25E4%25B9%2588%25E5%25BF%25AB%2f&amp;hashtags=Vite">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Vite20正式发布，凭什么这么快？ on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2fvite20%25E6%25AD%25A3%25E5%25BC%258F%25E5%258F%2591%25E5%25B8%2583%25E5%2587%25AD%25E4%25BB%2580%25E4%25B9%2588%25E8%25BF%2599%25E4%25B9%2588%25E5%25BF%25AB%2f&amp;title=Vite20%e6%ad%a3%e5%bc%8f%e5%8f%91%e5%b8%83%ef%bc%8c%e5%87%ad%e4%bb%80%e4%b9%88%e8%bf%99%e4%b9%88%e5%bf%ab%ef%bc%9f&amp;summary=Vite20%e6%ad%a3%e5%bc%8f%e5%8f%91%e5%b8%83%ef%bc%8c%e5%87%ad%e4%bb%80%e4%b9%88%e8%bf%99%e4%b9%88%e5%bf%ab%ef%bc%9f&amp;source=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2fvite20%25E6%25AD%25A3%25E5%25BC%258F%25E5%258F%2591%25E5%25B8%2583%25E5%2587%25AD%25E4%25BB%2580%25E4%25B9%2588%25E8%25BF%2599%25E4%25B9%2588%25E5%25BF%25AB%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Vite20正式发布，凭什么这么快？ on reddit"
            href="https://reddit.com/submit?url=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2fvite20%25E6%25AD%25A3%25E5%25BC%258F%25E5%258F%2591%25E5%25B8%2583%25E5%2587%25AD%25E4%25BB%2580%25E4%25B9%2588%25E8%25BF%2599%25E4%25B9%2588%25E5%25BF%25AB%2f&title=Vite20%e6%ad%a3%e5%bc%8f%e5%8f%91%e5%b8%83%ef%bc%8c%e5%87%ad%e4%bb%80%e4%b9%88%e8%bf%99%e4%b9%88%e5%bf%ab%ef%bc%9f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Vite20正式发布，凭什么这么快？ on facebook"
            href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2fvite20%25E6%25AD%25A3%25E5%25BC%258F%25E5%258F%2591%25E5%25B8%2583%25E5%2587%25AD%25E4%25BB%2580%25E4%25B9%2588%25E8%25BF%2599%25E4%25B9%2588%25E5%25BF%25AB%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Vite20正式发布，凭什么这么快？ on whatsapp"
            href="https://api.whatsapp.com/send?text=Vite20%e6%ad%a3%e5%bc%8f%e5%8f%91%e5%b8%83%ef%bc%8c%e5%87%ad%e4%bb%80%e4%b9%88%e8%bf%99%e4%b9%88%e5%bf%ab%ef%bc%9f%20-%20http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2fvite20%25E6%25AD%25A3%25E5%25BC%258F%25E5%258F%2591%25E5%25B8%2583%25E5%2587%25AD%25E4%25BB%2580%25E4%25B9%2588%25E8%25BF%2599%25E4%25B9%2588%25E5%25BF%25AB%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Vite20正式发布，凭什么这么快？ on telegram"
            href="https://telegram.me/share/url?text=Vite20%e6%ad%a3%e5%bc%8f%e5%8f%91%e5%b8%83%ef%bc%8c%e5%87%ad%e4%bb%80%e4%b9%88%e8%bf%99%e4%b9%88%e5%bf%ab%ef%bc%9f&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2fvite20%25E6%25AD%25A3%25E5%25BC%258F%25E5%258F%2591%25E5%25B8%2583%25E5%2587%25AD%25E4%25BB%2580%25E4%25B9%2588%25E8%25BF%2599%25E4%25B9%2588%25E5%25BF%25AB%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Vite20正式发布，凭什么这么快？ on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=Vite20%e6%ad%a3%e5%bc%8f%e5%8f%91%e5%b8%83%ef%bc%8c%e5%87%ad%e4%bb%80%e4%b9%88%e8%bf%99%e4%b9%88%e5%bf%ab%ef%bc%9f&u=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2fvite20%25E6%25AD%25A3%25E5%25BC%258F%25E5%258F%2591%25E5%25B8%2583%25E5%2587%25AD%25E4%25BB%2580%25E4%25B9%2588%25E8%25BF%2599%25E4%25B9%2588%25E5%25BF%25AB%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span><a href="https://beian.miit.gov.cn/">粤ICP备2023039897号-1</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = '复制';

        function copyingDone() {
            copybutton.innerHTML = '已复制！';
            setTimeout(() => {
                copybutton.innerHTML = '复制';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
