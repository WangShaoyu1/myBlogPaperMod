<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>面试官：代码里console.log比较多，该怎么办？ | PaperMod</title>
<meta name="keywords" content="前端, 面试, Webpack">
<meta name="description" content="解决标题中的问题的方法有多少种，你能想到几种，你又能动手真正地实现几种呢？本篇文章针对标题中的问题，进行了一场头脑风暴，感兴趣的话，一起来聊一聊吧~">
<meta name="author" content="海石">
<link rel="canonical" href="http://localhost:1313/posts/juejin/%E9%9D%A2%E8%AF%95%E5%AE%98%E4%BB%A3%E7%A0%81%E9%87%8Cconsole.log%E6%AF%94%E8%BE%83%E5%A4%9A%E8%AF%A5%E6%80%8E%E4%B9%88%E5%8A%9E/">
<meta name="google-site-verification" content="XYZabc">
<link crossorigin="anonymous" href="/assets/css/stylesheet.7b92bf4867c997b58ec50f63451b83777173d5bd5593376852abd85746d09d71.css" integrity="sha256-e5K/SGfJl7WOxQ9jRRuDd3Fz1b1VkzdoUqvYV0bQnXE=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<link rel="apple-touch-icon" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<link rel="mask-icon" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="zh" href="http://localhost:1313/posts/juejin/%E9%9D%A2%E8%AF%95%E5%AE%98%E4%BB%A3%E7%A0%81%E9%87%8Cconsole.log%E6%AF%94%E8%BE%83%E5%A4%9A%E8%AF%A5%E6%80%8E%E4%B9%88%E5%8A%9E/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript><meta property="og:title" content="面试官：代码里console.log比较多，该怎么办？" />
<meta property="og:description" content="解决标题中的问题的方法有多少种，你能想到几种，你又能动手真正地实现几种呢？本篇文章针对标题中的问题，进行了一场头脑风暴，感兴趣的话，一起来聊一聊吧~" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/posts/juejin/%E9%9D%A2%E8%AF%95%E5%AE%98%E4%BB%A3%E7%A0%81%E9%87%8Cconsole.log%E6%AF%94%E8%BE%83%E5%A4%9A%E8%AF%A5%E6%80%8E%E4%B9%88%E5%8A%9E/" />
<meta property="og:image" content="http://localhost:1313/images/papermod-cover.png" />
<meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-09-24T00:00:00+00:00" />
<meta property="article:modified_time" content="2024-09-24T00:00:00+00:00" />


<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="http://localhost:1313/images/papermod-cover.png" />
<meta name="twitter:title" content="面试官：代码里console.log比较多，该怎么办？"/>
<meta name="twitter:description" content="解决标题中的问题的方法有多少种，你能想到几种，你又能动手真正地实现几种呢？本篇文章针对标题中的问题，进行了一场头脑风暴，感兴趣的话，一起来聊一聊吧~"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "面试官：代码里console.log比较多，该怎么办？",
      "item": "http://localhost:1313/posts/juejin/%E9%9D%A2%E8%AF%95%E5%AE%98%E4%BB%A3%E7%A0%81%E9%87%8Cconsole.log%E6%AF%94%E8%BE%83%E5%A4%9A%E8%AF%A5%E6%80%8E%E4%B9%88%E5%8A%9E/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "面试官：代码里console.log比较多，该怎么办？",
  "name": "面试官：代码里console.log比较多，该怎么办？",
  "description": "解决标题中的问题的方法有多少种，你能想到几种，你又能动手真正地实现几种呢？本篇文章针对标题中的问题，进行了一场头脑风暴，感兴趣的话，一起来聊一聊吧~",
  "keywords": [
    "前端", "面试", "Webpack"
  ],
  "articleBody": "前言 删呗，还能咋办。我来删我来删！🫡\nCtrl + Shift + F ，全局搜索启动！😠\nAlt + R，使用正则表达式！😠\n哼哼，正则表达式 console\\.log\\(.*?\\) 输入！😠\n狠狠按下 Enter！😡\n然后全局替换，启动！😡\n我就问你我删得快不快吧😋\n我就问你我删得干净不干净吧😋\n面试官：精彩👏，真是一场酣畅淋漓的我问你答呀，回去等通知吧😊\n我：？过奖了捏😳\n面试官：我就问你我感谢信发得快不快吧😋\n我：我就问你…我一面挂得快不快吧😭😭😭\n咳咳，本博主表示上面的全都是节目效果，绝对不是根据真实面试事件改编的🫠。\n（如有雷同，浙A 陪1根）\n好了，整活到此为止，让我们来看看面对这样的问题，我们该如何拿出能够让面试官满意的解决方案吧~\n（博主的水平有限，掘金上藏龙卧虎，如果大佬们有更多的奇思妙想，欢迎评论区留言！）\n从 ESLint 入手 ESLint 是一个插件化的 JavaScript 代码检查工具，它能够帮助我们识别代码中的问题，并提供修复建议。\n我们可以配置.eslintrc.json文件，通过添加相应的规则，来软性地禁止console的使用。\njson\n代码解读\n复制代码\n{ \"rules\": { \"no-console\": \"warn\" } }\n当我们这样配置后，代码中使用了console的地方会划上黄色波浪色，进行警示。\n这样虽然不能实现删除 console.log ，但是能一定程度上削减代码中会出现的 console.log 的数量。\n毕竟都画黄线提示你了，总不能写完之后无视掉直接提交代码吧，那就有点小过分了。\n但是毕竟这也仅仅只是起到提示的作用，真要提交了，也没办法。\nGit：┑(￣Д ￣)┍ 摆了~\n我：不准摆！🤯\n从 git commit 入手 ESLint 的能力有限，无法真正的拦截用户的代码提交。\n那么我们就双管齐下，既在代码编写的时候 提醒同事记得删除 console.log ，也在代码提交的时候 不允许 没删干净 console.log 的代码提交。\n那么问题来了，怎么去写 git commit 相关的规则呢？\n我们需要找到项目中的 .git/hooks 文件夹，这个文件夹是隐藏的，因此我们在资源管理器找它的时候，记得勾选【显示隐藏的项目】：\n然后我们找到 pre-commit.sample 文件。\n（文件路径：.git/hooks/pre-commit.sample ）\n当我们每次提交代码时，Git 都会运行 pre-commit 这个hook，因此我们就可以在这个hook内写一些处理逻辑。\n若提交的代码中包含 console.log ，则报错，提交失败。 bash\n代码解读\n复制代码\n# 检查当前暂存区的文件是否包含 console.log if git diff --cached --name-only | xargs grep -E 'console\\.log'; then echo \"Error: console.log is not allowed in commits.\" exit 1 fi exit 0\ngit diff --cached: 这个命令用于列出暂存区（即将被提交的文件）与最后一次提交之间的差异。 --name-only: 这个选项告诉Git只输出有差异的文件名，而不输出差异内容。 |: 这是管道操作符，它将 前一个命令的输出 作为 下一个命令的输入 ，这样我们就能拿到这次提交的全部代码了。 xargs: 这个命令从 标准输入 （也就是上一个命令的输出）中读取数据，并将其作为参数传递给后面的命令。 grep -E 'console.log': grep是用于搜索文本的工具，-E选项启用扩展的正则表达式。在我们的这种业务场景下，它就是负责搜索包含console.log的字符串。注意，.在正则表达式中是一个特殊字符，表示任意字符，因此需要用反斜杠\\进行转义。 if语句：如果grep命令找到了匹配的文件，则它的退出状态为0（表示成功），if语句的条件为真。 exit 1: 这将终止脚本，并返回退出状态1，通常表示_一个错误_或_非正常退出_。 fi: 表示if语句结束。 exit 0: 以退出状态0结束，表示_成功_。 要注意，如果期望pre-commit.sample内部的逻辑能够生效，需要重命名文件，将其改为pre-commit：\nbash\n代码解读\n复制代码\n# To enable this hook, rename this file to \"pre-commit\".\n写好后，我们试试看是否能够校验成功：\n我们往代码里加点 console.log ，然后提交试试：\n芜湖，提交 失败，舒服了。😊\n但是，俗话说的好：“道高一尺，魔高一丈。”\n我们所新增的这条规则实际上可以被轻易地绕开，那就是给指令后面加上\n--no-verify\n只要加上了这个，我们在 pre-commit 写的东西就统统无效了。😶\n还是同样的文件，我们再写一些 console.log：\n然后尝试提交：\n没有加上 --no-verify 自然提交失败。\n现在我们给它加上，再看看：\n提交 成功 啦，难受。😫\n从 plugin 入手 除了上述两种方法之外，我们还能从插件入手。\n插件可以是 VSCODE 的插件，\n也可以是 Webpack 的插件。\nVSCODE 我们可以在插件商店中搜索 remove-console\n然后安装一个，找到我们有 console.log 的文件，然后使用插件即可。\n效果演示如下：\n有一说一，靠这个还不如哥们在【前言】章节整的活呢。😑😑😑\nWebpack 其实本文包了那么多饺子，就是为了这口醋！\n前端工程化在现在的环境下，几乎是面试必问了。\n因此咱们就借着这个机会，一起来手写一个 plugin，帮助我们实现在打包的时候，干掉任何的console.log 漏网之鱼。\n造轮子前，先看看现成轮子 且慢走，且慢走~\n在造轮子前，我们先看看现成的轮子。\n我们可以使用'terser-webpack-plugin'这个插件，它能够帮助我们压缩 JavaScript 代码。\n如果我们的项目是基于 create-react-app 这个脚手架创建的，那么我们可以直接搜到它。\n然后在使用它的地方进行相应的配置即可：\n将 drop_console 的值设置为 true，这也就能在打包后去除全部的 console.log 了\n举个例子，我在文件里添加了很多 console.log：\n此时我先不设置 drop_console 的值设置为 true：\n然后我运行npm run build，去打包，得到打包后的js文件，我们在此文件里进行搜索：\n然后，我设置 drop_console 的值设置为 true，再重新打包：\n👆可以看到👆，这时候打包后的文件里就没有 console.log 了。\n哇，太爽了，谁没事闲着造轮子啊，用现成的加个字段设置一下就OK了。\n摆了摆了，本文到此结束。😆😆😆\n.\n.\n.\n.\n.\n.\n唉，不行捏，必须学，咱们今天还真就得造个轮子了！\n总之造了再说吧，是值得的 想要亲自动手写一个 Webpack 的插件，那么我们不得不聊一下 Webpack 的构建过程。看看 plugin 是在什么阶段生效的，或者说 plugin 能生效的阶段都有哪些。\nWebpack 的构建过程 Webpack 的构建过程可以分为以下几个主要步骤：\n（下方的内容我会结合 create-react-app 这个脚手架去聊）\n初始化阶段（Initialization）\n启动：webpack 通过 CLI 或 API 启动，并读取配置文件（例如 webpack.config.js）。\n我们会发现，在CRA中，配置文件不止一个，还存在另一个webpackDevServer.config.js文件，这是为什么？ 这其实就和 webpack 的优化有关了。通过区分环境（开发环境、生产环境），来实现优化。 很多时候开发环境中一些配置的设置，比如：热模块替换（HMR）、代理设置、静态文件服务等等，是生产环境不需要的。因此根据环境区分配置，可以使项目结构更清晰、便于管理和维护。 热模块替换: webpack-dev-server 支持 hot 模式，在试图重新加载整个页面之前，hot 模式会尝试使用 HMR 来更新。 从性能优化的角度来看的话，在开发环境中，也不需要生产环境所需要的一些插件，比如代码压缩、Tree Shaking等等。根据环境区分配置，可以使得在开发过程中能够避免运行一些耗时的插件。 根据环境区分配置还能提升灵活性，可以在启动开发服务器时使用不同的命令行参数或环境变量。 创建 Compiler 对象：webpack 初始化一个 Compiler 对象，该对象负责控制整个构建过程。\n加载插件：webpack 读取配置中的插件，并调用插件的 apply 方法，让插件可以注册钩子函数。\n这里简单的贴一下一个 plugin 的基本结构： js\n代码解读\n复制代码\nclass DemoPlugin { // options: 接收 plugin 的配置项 constructor(options) { // 获取配置项，初始化插件 } // apply 是与 webpack 通信的桥梁 apply(compiler) { // 获取 compiler，可以通过 compiler 对象 // 访问 compilation 对象 // do something ... } }\napply 内部可以包含任何自定义逻辑，这些逻辑将在 Webpack 的特定生命周期钩子被触发时执行。插件可以利用这些钩子来修改构建结果、添加新的资产、或者执行其他任何必要的操作。 比如： js\n代码解读\n复制代码\napply(compiler) { compiler.hooks.compile.tap('DemoPlugin', (compilationParams) =\u003e { // 在编译器开始读取 Records 之前执行的操作 }); compiler.hooks.compilation.tap('DemoPlugin', (compilation) =\u003e { // 在创建新的 compilation 之前执行的操作 }); }\n编译阶段（Compilation）\n确定入口：webpack 根据配置中的 entry 找到所有入口文件。\n创建 Compilation 对象：每当检测到文件变化时，webpack 都会创建一个新的 Compilation 对象，该对象包含了当前的模块资源、编译生成资源、变化的文件等。\n编译模块：\n递归编译：从入口文件开始，webpack 会递归地解析每个模块所依赖的其他模块，形成一个依赖关系图。\nloader（加载器）处理：在解析模块时，webpack 会使用配置中的 loader 对模块进行转换，例如通过 ts-loader 将 TypeScript 转换为 JavaScript。\n构建模块：webpack 会将模块转换后的内容封装成一个个的模块对象。\n生成资源阶段（Make）\n完成模块编译：在编译完所有模块后，webpack 会得到一个模块对象组成的列表。 优化模块：webpack 可能会根据配置对模块进行优化，例如合并模块、摇树优化（Tree Shaking）等。 确定 chunks：webpack 根据模块之间的依赖关系，将模块组合成多个 chunks，每个 chunk 对应一个输出文件。 优化阶段（Seal）\n优化 chunks：webpack 会进一步优化 chunks，比如合并相同的模块、删除无用的代码等。 生成 chunks：webpack 根据优化后的 chunks 生成最终输出的资源。 发射阶段（Emit）\n资源输出：webpack 将编译和优化后的资源发射到输出目录，通常是 dist 文件夹。\n在CRA中如果不明确指定的话，那就是 'build' 文件夹。\n文件写入：webpack 将生成的文件写入到文件系统中。\n完成阶段（After）\n完成通知：在所有文件写入完成后，webpack 通知插件构建过程结束。\n清理工作：插件可以进行清理工作，例如删除临时文件、日志记录等。\n完成阶段也可以让 plugin 介入，我们只要在 apply 中注册hook即可：\njs\n代码解读\n复制代码\napply(compiler) { // 注册完成阶段的钩子 compiler.hooks.done.tap('AfterBuildPlugin', (stats) =\u003e { // 完成通知 console.log('Webpack build is finished!'); // 清理工作 this.cleanup(); }); }\nOK，我们简单地回顾了一下 webpack 的构建过程。\n（如有任何错误之处，还请大佬们评论区赐教）\n接下来，咱们就开始正式去写一个 plugin 了。\n开始造轮子： 创建自定义 Webpack 插件：\n在我们的项目中创建一个新的 JavaScript 文件，比如 RemoveConsolePlugin.js。\n编写插件代码：\n在 RemoveConsolePlugin.js 文件中，编写一个继承自 webpack.Plugin 的类，并在 apply 方法中使用 compiler.hooks 来注入自定义的编译步骤。\njs\n代码解读\n复制代码\n// RemoveConsolePlugin.js class RemoveConsolePlugin { // 由于我们不需要从外部传入 options // 因此这里就不显示地定义 constructor 了 // constructor (){...} apply(compiler) { compiler.hooks.emit.tapAsync( \"RemoveConsolePlugin\", (compilation, callback) =\u003e { Object.keys(compilation.assets).forEach((filename) =\u003e { // 仅处理 .js 文件 if (filename.endsWith(\".js\")) { const asset = compilation.assets[filename]; let content = asset.source(); // 使用正则表达式移除整个 console.log 语句 // 匹配 console.log( 之后的任意字符，直到遇到闭合的括号 const consoleLogRegex = new RegExp( \"console\\\\.log\\\\(.*?\\\\)\", \"g\" ); const withoutConsole = content.replace(consoleLogRegex, \"\"); // 更新资源 compilation.assets[filename] = { source: () =\u003e withoutConsole, size: () =\u003e Buffer.byteLength(withoutConsole, \"utf8\"), }; } }); callback(); } ); } } module.exports = RemoveConsolePlugin;\n我们来解释下上面代码的写法：\ncompiler.hooks.emit：在上一章节【Webpack的构建过程】里我们提到了我们可以通过 compiler 去获取一些hook，在这里，我们选择 emit 这个hook。\n在 asset 被输出到 output 之前，我们去完成对 console.log 语句的删除。\ncompilation：compilation 实例能够访问所有的模块和它们的依赖（大部分是循环依赖）。 它会对应用程序的依赖图中所有模块， 进行字面上的编译(literal compilation)。\n在这里，我们通过 compilation 实例获取到 assets，这里面就存着所有被处理的文件了。考虑到插件的运行会影响打包的速度，因此我们这里仅对.js文件做删除 console.log 语句的处理，所以加了一个 if 判断。\n我们通过调用 asset.source() 来获取文件的源代码。\n之后就是大家很熟悉的字符串的正则匹配和替换了。注意给 . 和 ( 加上 \\\\ 来进行转义。\n在 Webpack 配置中使用插件：\n接下来我们回到 webpack.config.js 文件中，引入 RemoveConsolePlugin 并添加到插件数组中。\njs\n代码解读\n复制代码\n// webpack.config.js const RemoveConsolePlugin = require(\"../src/RemoveConsolePlugin\"); module.exports = { // ...其他配置... plugins: [ new RemoveConsolePlugin(), // ...其他插件... ], };\n运行 Webpack 构建：\n大功告成，接下来只要自信输入 npm run build 即可。\n然后发现g了。\n怎么cjs、js全都没了？然后我们去ouput里看下：\nconsole.log语句确实是被删除了，但是留下了_一堆逗号_，因为这一堆逗号，导致打包后的文件异常了，通过\"webpack-bundle-analyzer\" 展示的依赖图也异常，这是怎么回事？\n现在我们先取消使用自定义插件，再打包一次看看：\n由上图可以看到，输出的文件里，每一行console.log语句后面都跟着一个逗号。这也告诉了我们，如果使用正则的方式去删除console.log语句，还得给正则表达式加上一个是否以逗号结尾的匹配规则：(,|$)。\n我们修改一下 RemoveConsolePlugin.js 的代码：\njs\n代码解读\n复制代码\n// RemoveConsolePlugin.js class RemoveConsolePlugin { // 由于我们不需要从外部传入 options // 因此这里就不显示地定义 constructor 了 // constructor (){...} apply(compiler) { compiler.hooks.emit.tapAsync( \"RemoveConsolePlugin\", (compilation, callback) =\u003e { Object.keys(compilation.assets).forEach((filename) =\u003e { // 仅处理 .js 文件 if (filename.endsWith(\".js\")) { const asset = compilation.assets[filename]; let content = asset.source(); // 使用正则表达式移除整个 console.log 语句 // 匹配 console.log( 之后的任意字符，直到遇到闭合的括号 const consoleLogRegex = new RegExp( \"console\\\\.log\\\\(.*?\\\\)(,|$)\", \"g\" ); const withoutConsole = content.replace(consoleLogRegex, \"\"); // 更新资源 compilation.assets[filename] = { source: () =\u003e withoutConsole, size: () =\u003e Buffer.byteLength(withoutConsole, \"utf8\"), }; } }); callback(); } ); } } module.exports = RemoveConsolePlugin;\n然后再执行一次打包：\n依赖图很正常，我们再看看输出后的文件：\n不仅把 console.log 语句删除干净了，并且成功解决了之前的报错。\n扩展思考 动手能力强的掘友可以试试：\n我们实现的自定义插件只是删除了console语句中的log而已，console语句还有很多种类型呢，比如 warn、debug 、info 等等。由于我们的 plugin 不支持options的配置，在功能的全面性上较差，该如何改进？ 除了正则去删除console语句之外，还有其他方式吗？能结合ast去做这件事情不？ 结语 多的不谈了，祝大家之后面试顺利~😉\n当然，也祝我自己之后面试顺利~😋\n",
  "wordCount" : "765",
  "inLanguage": "zh",
  "image": "http://localhost:1313/images/papermod-cover.png","datePublished": "2024-09-24T00:00:00Z",
  "dateModified": "2024-09-24T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "海石"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/posts/juejin/%E9%9D%A2%E8%AF%95%E5%AE%98%E4%BB%A3%E7%A0%81%E9%87%8Cconsole.log%E6%AF%94%E8%BE%83%E5%A4%9A%E8%AF%A5%E6%80%8E%E4%B9%88%E5%8A%9E/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "PaperMod",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/%3Clink%20/%20abs%20url%3E"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Home (Alt + H)">
                        
                    <img src="http://localhost:1313/images/msg_hu15231257772499651944.png" alt="" aria-label="logo"
                        height="20">Home</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/archives" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="https://github.com/adityatelange/hugo-PaperMod/wiki/" title="WiKi">
                    <span>WiKi</span>&nbsp;
                    <svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12">
                        <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path>
                        <path d="M15 3h6v6"></path>
                        <path d="M10 14L21 3"></path>
                    </svg>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/">主页</a>&nbsp;»&nbsp;<a href="http://localhost:1313/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      面试官：代码里console.log比较多，该怎么办？
    </h1>
    <div class="post-description">
      解决标题中的问题的方法有多少种，你能想到几种，你又能动手真正地实现几种呢？本篇文章针对标题中的问题，进行了一场头脑风暴，感兴趣的话，一起来聊一聊吧~
    </div>
    <div class="post-meta"><span title='2024-09-24 00:00:00 +0000 UTC'>九月 24, 2024</span>&nbsp;·&nbsp;4 分钟&nbsp;·&nbsp;海石&nbsp;|&nbsp;<a href="https://github.com/WangShaoyu1/myBlogPaperMod/tree/master/content/posts/jueJin/%e9%9d%a2%e8%af%95%e5%ae%98%ef%bc%9a%e4%bb%a3%e7%a0%81%e9%87%8cconsole.log%e6%af%94%e8%be%83%e5%a4%9a%ef%bc%8c%e8%af%a5%e6%80%8e%e4%b9%88%e5%8a%9e%ef%bc%9f.md" rel="noopener noreferrer" target="_blank">Suggest Changes</a>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">目录</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e5%89%8d%e8%a8%80" aria-label="前言">前言</a></li>
                <li>
                    <a href="#%e4%bb%8e-eslint-%e5%85%a5%e6%89%8b" aria-label="从 ESLint 入手">从 ESLint 入手</a></li>
                <li>
                    <a href="#%e4%bb%8e-git-commit-%e5%85%a5%e6%89%8b" aria-label="从 git commit 入手">从 git commit 入手</a><ul>
                        
                <li>
                    <a href="#%e8%8b%a5%e6%8f%90%e4%ba%a4%e7%9a%84%e4%bb%a3%e7%a0%81%e4%b8%ad%e5%8c%85%e5%90%ab-consolelog-%e5%88%99%e6%8a%a5%e9%94%99%e6%8f%90%e4%ba%a4%e5%a4%b1%e8%b4%a5" aria-label="若提交的代码中包含 console.log ，则报错，提交失败。">若提交的代码中包含 console.log ，则报错，提交失败。</a></li></ul>
                </li>
                <li>
                    <a href="#%e4%bb%8e-plugin-%e5%85%a5%e6%89%8b" aria-label="从 plugin 入手">从 plugin 入手</a><ul>
                        
                <li>
                    <a href="#vscode" aria-label="VSCODE">VSCODE</a></li>
                <li>
                    <a href="#webpack" aria-label="Webpack">Webpack</a><ul>
                        
                <li>
                    <a href="#%e9%80%a0%e8%bd%ae%e5%ad%90%e5%89%8d%e5%85%88%e7%9c%8b%e7%9c%8b%e7%8e%b0%e6%88%90%e8%bd%ae%e5%ad%90" aria-label="造轮子前，先看看现成轮子">造轮子前，先看看现成轮子</a></li>
                <li>
                    <a href="#%e6%80%bb%e4%b9%8b%e9%80%a0%e4%ba%86%e5%86%8d%e8%af%b4%e5%90%a7%e6%98%af%e5%80%bc%e5%be%97%e7%9a%84" aria-label="总之造了再说吧，是值得的">总之造了再说吧，是值得的</a><ul>
                        
                <li>
                    <a href="#webpack-%e7%9a%84%e6%9e%84%e5%bb%ba%e8%bf%87%e7%a8%8b" aria-label="Webpack 的构建过程">Webpack 的构建过程</a></li>
                <li>
                    <a href="#%e5%bc%80%e5%a7%8b%e9%80%a0%e8%bd%ae%e5%ad%90" aria-label="开始造轮子：">开始造轮子：</a></li></ul>
                </li>
                <li>
                    <a href="#%e6%89%a9%e5%b1%95%e6%80%9d%e8%80%83" aria-label="扩展思考">扩展思考</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#%e7%bb%93%e8%af%ad" aria-label="结语">结语</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="前言">前言<a hidden class="anchor" aria-hidden="true" href="#前言">#</a></h2>
<p>删呗，还能咋办。我来删我来删！🫡</p>
<p>Ctrl + Shift + F ，全局搜索启动！😠</p>
<p><img loading="lazy" src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/baa99741840746ffad7f1e2bcae3cf63~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW355-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1727762039&amp;x-signature=K1EH55iYqNmTwZMwvS%2BguEPCwmk%3D" alt="image.png"  />
</p>
<p>Alt + R，使用正则表达式！😠</p>
<p><img loading="lazy" src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5c6ef6f733b948aeadc34f26a0a8b561~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW355-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1727762039&amp;x-signature=pIwZ%2BwoHkbMBjVXuy83k6QV%2BXHA%3D" alt="image.png"  />
</p>
<p>哼哼，正则表达式 <code>console\.log\(.*?\)</code> 输入！😠</p>
<p><img loading="lazy" src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1212cfb1a24a48839d8aff210f7c07f9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW355-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1727762039&amp;x-signature=LoaeJVOV1nMGKSPXI4ArYB3v1qE%3D" alt="image.png"  />
</p>
<p>狠狠按下 Enter！😡</p>
<p><img loading="lazy" src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b324acabecac419e80346d9aab4490fc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW355-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1727762039&amp;x-signature=mwZUmNodzZ1CDGOy07xggQkpg%2F4%3D" alt="image.png"  />
</p>
<p>然后全局替换，启动！😡</p>
<p><img loading="lazy" src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ece3887ed6eb4ee9a602aed281d2f16a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW355-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1727762039&amp;x-signature=y8XVFyDwJT%2B2csWL3MMPUPStNsI%3D" alt="image.png"  />
</p>
<p><img loading="lazy" src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c486c6c7b1564e7ca29da0db5e99a651~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW355-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1727762039&amp;x-signature=fykPTUkaSzaaNGIaglqim1%2FEKIY%3D" alt="image.png"  />
</p>
<p>我就问你我删得快不快吧😋</p>
<p>我就问你我删得干净不干净吧😋</p>
<blockquote>
<p>面试官：精彩👏，真是一场酣畅淋漓的我问你答呀，回去等通知吧😊</p>
<p>我：？过奖了捏😳</p>
</blockquote>
<p><img loading="lazy" src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c842ab16c9ee4438b718666e638f0585~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW355-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1727762039&amp;x-signature=Zsv8UiTcPS7ougAxtWUcVfESKoY%3D" alt="image.png"  />
</p>
<p><img loading="lazy" src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/30276f0f0d5f47cfa8c014fda026dd67~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW355-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1727762039&amp;x-signature=RZfttkE2S0nqyK29y%2BjNa1yPgg0%3D" alt="image.png"  />
</p>
<blockquote>
<p>面试官：我就问你我感谢信发得快不快吧😋</p>
<p>我：我就问你&hellip;我一面挂得快不快吧😭😭😭</p>
</blockquote>
<p>咳咳，本博主表示上面的全都是节目效果，绝对不是根据真实面试事件改编的🫠。</p>
<p>（如有雷同，浙A 陪1根）</p>
<p>好了，整活到此为止，让我们来看看面对这样的问题，我们该如何拿出能够让面试官满意的解决方案吧~</p>
<p><img loading="lazy" src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fdfae833900845a9b0d02a311cc462a8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW355-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1727762039&amp;x-signature=9oJybWsH4RZDFufjcriwBFy71AQ%3D" alt="chufa.jpg"  />
</p>
<p>（博主的水平有限，掘金上藏龙卧虎，如果大佬们有更多的奇思妙想，欢迎评论区留言！）</p>
<h2 id="从-eslint-入手">从 <code>ESLint</code> 入手<a hidden class="anchor" aria-hidden="true" href="#从-eslint-入手">#</a></h2>
<p><code>ESLint</code> 是一个插件化的 <code>JavaScript</code> 代码检查工具，它能够帮助我们识别代码中的问题，并提供修复建议。</p>
<p>我们可以配置<code>.eslintrc.json</code>文件，通过添加相应的规则，来软性地禁止<code>console</code>的使用。</p>
<p>json</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>{   &quot;rules&quot;: {     &quot;no-console&quot;: &quot;warn&quot;   } }</code></p>
<p>当我们这样配置后，代码中使用了<code>console</code>的地方会划上黄色波浪色，进行警示。</p>
<p><img loading="lazy" src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0f7a72b8e2e94ec18658b76e465ac57e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW355-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1727762039&amp;x-signature=poBCzmebOTpsSq7gJHP%2FS7adYO8%3D" alt="image.png"  />
</p>
<p><img loading="lazy" src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ae7b1f0ef3d04f388e261369a9e6410b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW355-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1727762039&amp;x-signature=%2BR2dR2q0BJeQ4iOBZT5k2CYtJ0Y%3D" alt="image.png"  />
</p>
<p>这样虽然不能实现删除 <code>console.log</code> ，但是能一定程度上削减代码中会出现的 <code>console.log</code> 的数量。</p>
<p>毕竟都画黄线提示你了，总不能写完之后无视掉直接提交代码吧，那就有点小过分了。</p>
<p>但是毕竟这也仅仅只是起到提示的作用，真要提交了，也没办法。</p>
<p><img loading="lazy" src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b8cb2e3e464f45649f37f36d06b77c30~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW355-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1727762039&amp;x-signature=%2FD7k5ffLEtb7KiX%2FfjZaaQakb3I%3D" alt="image.png"  />
</p>
<blockquote>
<p>Git：┑(￣Д ￣)┍ 摆了~</p>
<p>我：不准摆！🤯</p>
</blockquote>
<h2 id="从-git-commit-入手">从 <code>git commit</code> 入手<a hidden class="anchor" aria-hidden="true" href="#从-git-commit-入手">#</a></h2>
<p><code>ESLint</code> 的能力有限，无法真正的拦截用户的代码提交。</p>
<p>那么我们就双管齐下，既在<strong>代码编写</strong>的时候 <em>提醒同事记得删除</em> <code>console.log</code> ，也在<strong>代码提交</strong>的时候 <em>不允许</em> 没删干净 <code>console.log</code> 的代码提交。</p>
<p>那么问题来了，怎么去写 <code>git commit</code> 相关的规则呢？</p>
<p>我们需要找到项目中的 <code>.git/hooks</code> 文件夹，这个文件夹是隐藏的，因此我们在资源管理器找它的时候，记得勾选【显示隐藏的项目】：</p>
<p><img loading="lazy" src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc9bf062758044c4b4789d2652d2567f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW355-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1727762039&amp;x-signature=9B0lVtOzEhgbvLdHCyRgh9sKspE%3D" alt="image.png"  />
</p>
<p>然后我们找到 <code>pre-commit.sample</code> 文件。</p>
<p>（文件路径：<code>.git/hooks/pre-commit.sample</code> ）</p>
<p><img loading="lazy" src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d95e108a36714cab857bda6c8b655e32~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW355-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1727762039&amp;x-signature=8NzDVqWzDYiH04bmW0gAlswQykA%3D" alt="image.png"  />
</p>
<p>当我们每次提交代码时，<code>Git</code> 都会运行 <code>pre-commit</code> 这个hook，因此我们就可以在这个hook内写一些处理逻辑。</p>
<h3 id="若提交的代码中包含-consolelog-则报错提交失败">若提交的代码中包含 <code>console.log</code> ，则报错，提交失败。<a hidden class="anchor" aria-hidden="true" href="#若提交的代码中包含-consolelog-则报错提交失败">#</a></h3>
<p>bash</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code># 检查当前暂存区的文件是否包含 console.log if git diff --cached --name-only | xargs grep -E 'console\.log';  then   echo &quot;Error: console.log is not allowed in commits.&quot;   exit 1 fi exit 0</code></p>
<ul>
<li><code>git diff --cached</code>: 这个命令用于列出暂存区（即将被提交的文件）与最后一次提交之间的差异。</li>
<li><code>--name-only</code>: 这个选项告诉Git只输出有差异的文件名，而不输出差异内容。</li>
<li><code>|</code>: 这是管道操作符，它将 <em>前一个命令的输出</em> 作为 <em>下一个命令的输入</em> ，这样我们就能拿到这次提交的全部代码了。</li>
<li><code>xargs</code>: 这个命令从 <em>标准输入</em> （也就是上一个命令的输出）中读取数据，并将其作为参数传递给后面的命令。</li>
<li><code>grep -E 'console.log'</code>: <code>grep</code>是用于搜索文本的工具，<code>-E</code>选项启用扩展的正则表达式。在我们的这种业务场景下，它就是负责搜索包含<code>console.log</code>的字符串。注意，<code>.</code>在正则表达式中是一个特殊字符，表示任意字符，因此需要用反斜杠<code>\</code>进行转义。</li>
<li><code>if</code>语句：如果<code>grep</code>命令找到了匹配的文件，则它的退出状态为0（表示成功），<code>if</code>语句的条件为真。</li>
<li><code>exit 1</code>: 这将终止脚本，并返回退出状态1，通常表示_一个错误_或_非正常退出_。</li>
<li><code>fi</code>: 表示<code>if</code>语句结束。</li>
<li><code>exit 0</code>: 以退出状态0结束，表示_成功_。</li>
</ul>
<p>要注意，如果期望<code>pre-commit.sample</code>内部的逻辑能够生效，需要<strong>重命名文件</strong>，将其改为<code>pre-commit</code>：</p>
<p>bash</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code># To enable this hook, rename this file to &quot;pre-commit&quot;.</code></p>
<p>写好后，我们试试看是否能够校验成功：</p>
<p><img loading="lazy" src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3744be6ded4f4151ac875daa5ff7c1a2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW355-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1727762039&amp;x-signature=6wTtDsOSKj6mKFAPKoAUq0m7kM4%3D" alt="image.png"  />
</p>
<p>我们往代码里加点 <code>console.log</code> ，然后提交试试：</p>
<p><img loading="lazy" src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/598ab1825f0b4f6b82f81d9ac48a88cd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW355-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1727762039&amp;x-signature=GdT1oBHW%2B8ZRBI2OhkET9UVhcYA%3D" alt="image.png"  />
</p>
<p>芜湖，提交 <em>失败</em>，舒服了。😊</p>
<p>但是，俗话说的好：“道高一尺，魔高一丈。”</p>
<p>我们所新增的这条规则实际上可以被轻易地绕开，那就是给指令后面加上</p>
<p><code>--no-verify</code></p>
<p>只要加上了这个，我们在 <code>pre-commit</code> 写的东西就统统无效了。😶</p>
<p>还是同样的文件，我们再写一些 <code>console.log</code>：</p>
<p><img loading="lazy" src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/724a50d7094140a08e7f27b89d98153f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW355-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1727762039&amp;x-signature=vaWvBA6jqnCeqU38%2Bjahm32J7Es%3D" alt="image.png"  />
</p>
<p>然后尝试提交：</p>
<p><img loading="lazy" src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d97139ed2ae748118e1c88733ae3b044~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW355-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1727762039&amp;x-signature=8%2BE9UeK6Iy2phFMOTQik9UGnpdA%3D" alt="image.png"  />
</p>
<p>没有加上 <code>--no-verify</code> 自然提交失败。</p>
<p>现在我们给它加上，再看看：</p>
<p><img loading="lazy" src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/88ee75cc42dd4a4fa58b19c3e535c813~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW355-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1727762039&amp;x-signature=XnxnHpZEg%2Bdxillmc6cBz8J95o4%3D" alt="image.png"  />
</p>
<p>提交 <em>成功</em> 啦，难受。😫</p>
<h2 id="从-plugin-入手">从 <code>plugin</code> 入手<a hidden class="anchor" aria-hidden="true" href="#从-plugin-入手">#</a></h2>
<p>除了上述两种方法之外，我们还能从插件入手。</p>
<p>插件可以是 VSCODE 的插件，</p>
<p>也可以是 Webpack 的插件。</p>
<h3 id="vscode">VSCODE<a hidden class="anchor" aria-hidden="true" href="#vscode">#</a></h3>
<p>我们可以在插件商店中搜索 <code>remove-console</code></p>
<p><img loading="lazy" src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/80988b421692465dbeb923541c358bfd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW355-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1727762039&amp;x-signature=KIrSADaTHCSgMTn6DXJd%2BIEM%2F3c%3D" alt="image.png"  />
</p>
<p>然后安装一个，找到我们有 <code>console.log</code> 的文件，然后使用插件即可。</p>
<p>效果演示如下：</p>
<p><img loading="lazy" src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fd159c3970fd41398bd592e54f248252~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW355-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1727762039&amp;x-signature=tVo9oQqnMfBidz5c%2BNtBQ7JjdGs%3D" alt="remove-console.gif"  />
</p>
<p>有一说一，靠这个还不如哥们在【前言】章节整的活呢。😑😑😑</p>
<h3 id="webpack">Webpack<a hidden class="anchor" aria-hidden="true" href="#webpack">#</a></h3>
<p>其实本文包了那么多饺子，就是为了这口醋！</p>
<p>前端工程化在现在的环境下，几乎是面试必问了。</p>
<p>因此咱们就借着这个机会，一起来手写一个 plugin，帮助我们实现在打包的时候，干掉任何的<code>console.log</code> 漏网之鱼。</p>
<h4 id="造轮子前先看看现成轮子">造轮子前，先看看现成轮子<a hidden class="anchor" aria-hidden="true" href="#造轮子前先看看现成轮子">#</a></h4>
<p>且慢走，且慢走~</p>
<p>在造轮子前，我们先看看现成的轮子。</p>
<p>我们可以使用<code>'terser-webpack-plugin'</code>这个插件，它能够帮助我们压缩 JavaScript 代码。</p>
<p>如果我们的项目是基于 <code>create-react-app</code> 这个脚手架创建的，那么我们可以直接搜到它。</p>
<p><img loading="lazy" src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/20307db54f2f4f3b8d02a9ac688716f1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW355-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1727762039&amp;x-signature=LJwD0SHRol3vxgZBGr8nDMyqiC8%3D" alt="image.png"  />
</p>
<p>然后在使用它的地方进行相应的配置即可：</p>
<p><img loading="lazy" src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9a6e9235c3194088a0dd417a69e2bc37~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW355-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1727762039&amp;x-signature=eh0C5mc8Q80B1b26sM8lJTdRZNs%3D" alt="image.png"  />
</p>
<p>将 <code>drop_console</code> 的值设置为 <code>true</code>，这也就能在打包后去除全部的 <code>console.log</code> 了</p>
<p>举个例子，我在文件里添加了很多 <code>console.log</code>：</p>
<p><img loading="lazy" src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eaf863567172436d9bad8f4d42847729~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW355-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1727762039&amp;x-signature=9VOOyGmAKntbm4uUqvYKbpwG4Jo%3D" alt="image.png"  />
</p>
<p>此时我先不设置 <code>drop_console</code> 的值设置为 <code>true</code>：</p>
<p><img loading="lazy" src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/103026a6dde0456cbcf60c40d197ec26~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW355-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1727762039&amp;x-signature=i4JnkIpiAIRbHW7Wp%2F1Z9TPTGB8%3D" alt="image.png"  />
</p>
<p>然后我运行<code>npm run build</code>，去打包，得到打包后的js文件，我们在此文件里进行搜索：</p>
<p><img loading="lazy" src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8ebdee6cedeb49caa7336c16d4ffc0fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW355-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1727762039&amp;x-signature=oFAvPuAEtQUMALaNVp8sbPa%2FD%2BU%3D" alt="image.png"  />
</p>
<p>然后，我设置 <code>drop_console</code> 的值设置为 <code>true</code>，再重新打包：</p>
<p><img loading="lazy" src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ad71044cf1484c1c9e9a35ac4c35751f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW355-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1727762039&amp;x-signature=z6oXNAkaUmW2Y0wkZCtt1v59nUA%3D" alt="image.png"  />
</p>
<p>👆可以看到👆，这时候打包后的文件里就没有 <code>console.log</code> 了。</p>
<p>哇，太爽了，谁没事闲着造轮子啊，用现成的加个字段设置一下就OK了。</p>
<p>摆了摆了，本文到此结束。😆😆😆</p>
<p><img loading="lazy" src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7affe8fee6ff4b62b50758ceca699dc3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW355-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1727762039&amp;x-signature=4frLI0pS2GQ8z8606dXzEsT1GHw%3D" alt="image.png"  />
</p>
<p>.</p>
<p>.</p>
<p>.</p>
<p>.</p>
<p>.</p>
<p>.</p>
<p>唉，不行捏，必须学，咱们今天还真就得造个轮子了！</p>
<p><img loading="lazy" src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d5ab3b139fd447ca8033e7e06dad684d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW355-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1727762039&amp;x-signature=%2Fjc30EXz9VOrk3e0z0vD88rLoD0%3D" alt="image.png"  />
</p>
<h4 id="总之造了再说吧是值得的">总之造了再说吧，是值得的<a hidden class="anchor" aria-hidden="true" href="#总之造了再说吧是值得的">#</a></h4>
<p>想要亲自动手写一个 Webpack 的插件，那么我们不得不聊一下 Webpack 的构建过程。看看 plugin 是在什么阶段生效的，或者说 plugin 能生效的阶段都有哪些。</p>
<h5 id="webpack-的构建过程">Webpack 的构建过程<a hidden class="anchor" aria-hidden="true" href="#webpack-的构建过程">#</a></h5>
<p>Webpack 的构建过程可以分为以下几个主要步骤：</p>
<p>（下方的内容我会结合 <code>create-react-app</code> 这个脚手架去聊）</p>
<ol>
<li>
<p>初始化阶段（Initialization）</p>
<ul>
<li>
<p><strong>启动</strong>：webpack 通过 CLI 或 API 启动，并读取配置文件（例如 <code>webpack.config.js</code>）。</p>
<ul>
<li>我们会发现，在CRA中，配置文件不止一个，还存在另一个<code>webpackDevServer.config.js</code>文件，这是为什么？ <img loading="lazy" src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a59efacdcf9843edacf3636b012ede1d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW355-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1727762039&amp;x-signature=MOhHhaONeP6gsDYdNLShmuXAaO0%3D" alt="image.png"  />
</li>
<li>这其实就和 webpack 的优化有关了。通过区分环境（开发环境、生产环境），来实现优化。
<ul>
<li>很多时候开发环境中一些配置的设置，比如：热模块替换（HMR）、代理设置、静态文件服务等等，是生产环境不需要的。因此根据环境区分配置，可以使项目结构更清晰、便于管理和维护。
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.webpackjs.com%2Fconcepts%2Fhot-module-replacement%2F" title="https://www.webpackjs.com/concepts/hot-module-replacement/">热模块替换</a>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.webpackjs.com%2Fconfiguration%2Fdev-server%2F" title="https://www.webpackjs.com/configuration/dev-server/">webpack-dev-server</a> 支持 <code>hot</code> 模式，在试图重新加载整个页面之前，<code>hot</code> 模式会尝试使用 HMR 来更新。</li>
</ul>
</li>
<li>从性能优化的角度来看的话，在开发环境中，也不需要生产环境所需要的一些插件，比如代码压缩、Tree Shaking等等。根据环境区分配置，可以使得在开发过程中能够避免运行一些耗时的插件。</li>
<li>根据环境区分配置还能提升灵活性，可以在启动开发服务器时使用不同的命令行参数或环境变量。</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>创建 Compiler 对象</strong>：webpack 初始化一个 <code>Compiler</code> 对象，该对象负责控制整个构建过程。</p>
</li>
<li>
<p><strong>加载插件</strong>：webpack 读取配置中的插件，并调用插件的 <code>apply</code> 方法，让插件可以注册钩子函数。</p>
<ul>
<li>这里简单的贴一下一个 plugin 的基本结构：</li>
</ul>
<p>js</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>class DemoPlugin {   // options: 接收 plugin 的配置项   constructor(options) {     // 获取配置项，初始化插件   }   // apply 是与 webpack 通信的桥梁   apply(compiler) {     // 获取 compiler，可以通过 compiler 对象     // 访问 compilation 对象     // do something ...         } }</code></p>
<ul>
<li>apply 内部可以包含任何自定义逻辑，这些逻辑将在 Webpack 的特定生命周期钩子被触发时执行。插件可以利用这些钩子来修改构建结果、添加新的资产、或者执行其他任何必要的操作。</li>
<li>比如：</li>
</ul>
<p>js</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>apply(compiler) {   compiler.hooks.compile.tap('DemoPlugin', (compilationParams) =&gt; {     // 在编译器开始读取 Records 之前执行的操作   });   compiler.hooks.compilation.tap('DemoPlugin', (compilation) =&gt; {     // 在创建新的 compilation 之前执行的操作   }); }</code></p>
</li>
</ul>
</li>
<li>
<p>编译阶段（Compilation）</p>
<ul>
<li>
<p><strong>确定入口</strong>：webpack 根据配置中的 <code>entry</code> 找到所有入口文件。</p>
<p><img loading="lazy" src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b5daa1c5943d4e2eafaac1430e4be0b6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW355-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1727762039&amp;x-signature=Awqckz9MUhlQXJqndCk3b5KeNfI%3D" alt="image.png"  />
</p>
</li>
<li>
<p><strong>创建 Compilation 对象</strong>：每当检测到文件变化时，webpack 都会创建一个新的 <code>Compilation</code> 对象，该对象包含了当前的模块资源、编译生成资源、变化的文件等。</p>
</li>
<li>
<p><strong>编译模块</strong>：</p>
<ul>
<li>
<p><strong>递归编译</strong>：从入口文件开始，webpack 会递归地解析每个模块所依赖的其他模块，形成一个依赖关系图。</p>
<p><img loading="lazy" src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/afa1df9122de4119a5407d42f6d10de6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW355-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1727762039&amp;x-signature=ALPW3wjAvYrtaQDPURM0WwswgDI%3D" alt="image.png"  />
</p>
</li>
<li>
<p><strong><code>loader</code>（加载器）处理</strong>：在解析模块时，webpack 会使用配置中的 <code>loader</code> 对模块进行转换，例如通过 <code>ts-loader</code> 将 TypeScript 转换为 JavaScript。</p>
</li>
<li>
<p><strong>构建模块</strong>：webpack 会将模块转换后的内容封装成一个个的模块对象。</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>生成资源阶段（Make）</p>
<ul>
<li><strong>完成模块编译</strong>：在编译完所有模块后，webpack 会得到一个模块对象组成的列表。</li>
<li><strong>优化模块</strong>：webpack 可能会根据配置对模块进行优化，例如合并模块、摇树优化（Tree Shaking）等。</li>
<li><strong>确定 chunks</strong>：webpack 根据模块之间的依赖关系，将模块组合成多个 chunks，每个 chunk 对应一个输出文件。</li>
</ul>
</li>
<li>
<p>优化阶段（Seal）</p>
<ul>
<li><strong>优化 chunks</strong>：webpack 会进一步优化 chunks，比如合并相同的模块、删除无用的代码等。</li>
<li><strong>生成 chunks</strong>：webpack 根据优化后的 chunks 生成最终输出的资源。</li>
</ul>
</li>
<li>
<p>发射阶段（Emit）</p>
<ul>
<li>
<p><strong>资源输出</strong>：webpack 将编译和优化后的资源发射到输出目录，通常是 <code>dist</code> 文件夹。</p>
<p><img loading="lazy" src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f73c1ce30a054b9d9aa6e2cf267820a1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW355-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1727762039&amp;x-signature=%2BHEFJGHvZK1R%2F%2BdLWU6eJEBkoxc%3D" alt="image.png"  />
</p>
<p>在CRA中如果不明确指定的话，那就是 <code>'build'</code> 文件夹。</p>
<p><img loading="lazy" src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3c4054496800490f8819172a0932da0c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW355-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1727762039&amp;x-signature=nJ21VyczrcfksK7OPLWZZN%2BEc9M%3D" alt="image.png"  />
</p>
</li>
<li>
<p><strong>文件写入</strong>：webpack 将生成的文件写入到文件系统中。</p>
</li>
</ul>
</li>
<li>
<p>完成阶段（After）</p>
<ul>
<li>
<p><strong>完成通知</strong>：在所有文件写入完成后，webpack 通知插件构建过程结束。</p>
</li>
<li>
<p><strong>清理工作</strong>：插件可以进行清理工作，例如删除临时文件、日志记录等。</p>
</li>
<li>
<p>完成阶段也可以让 plugin 介入，我们只要在 apply 中注册hook即可：</p>
<p>js</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>apply(compiler) {  // 注册完成阶段的钩子  compiler.hooks.done.tap('AfterBuildPlugin', (stats) =&gt; {    // 完成通知    console.log('Webpack build is finished!');    // 清理工作    this.cleanup();  }); }</code></p>
</li>
</ul>
</li>
</ol>
<p>OK，我们简单地回顾了一下 webpack 的构建过程。</p>
<p>（如有任何错误之处，还请大佬们评论区赐教）</p>
<p>接下来，咱们就开始正式去写一个 plugin 了。</p>
<h5 id="开始造轮子">开始造轮子：<a hidden class="anchor" aria-hidden="true" href="#开始造轮子">#</a></h5>
<ol>
<li>
<p><strong>创建自定义 Webpack 插件</strong>：</p>
<p>在我们的项目中创建一个新的 JavaScript 文件，比如 <code>RemoveConsolePlugin.js</code>。</p>
<p><img loading="lazy" src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4be347b40345476facb186a88499dee2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW355-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1727762039&amp;x-signature=MJDpJo4JTGSVxW9GYV6Jre4S8Mc%3D" alt="image.png"  />
</p>
</li>
<li>
<p><strong>编写插件代码</strong>：</p>
<p>在 <code>RemoveConsolePlugin.js</code> 文件中，编写一个继承自 <code>webpack.Plugin</code> 的类，并在 <code>apply</code> 方法中使用 <code>compiler.hooks</code> 来注入自定义的编译步骤。</p>
</li>
</ol>
<p>js</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>// RemoveConsolePlugin.js class RemoveConsolePlugin { // 由于我们不需要从外部传入 options  // 因此这里就不显示地定义 constructor 了 // constructor (){...} apply(compiler) {     compiler.hooks.emit.tapAsync(       &quot;RemoveConsolePlugin&quot;,       (compilation, callback) =&gt; {         Object.keys(compilation.assets).forEach((filename) =&gt; {           // 仅处理 .js 文件           if (filename.endsWith(&quot;.js&quot;)) {             const asset = compilation.assets[filename];             let content = asset.source();             // 使用正则表达式移除整个 console.log 语句             // 匹配 console.log( 之后的任意字符，直到遇到闭合的括号             const consoleLogRegex = new RegExp(               &quot;console\\.log\\(.*?\\)&quot;,               &quot;g&quot;             );             const withoutConsole = content.replace(consoleLogRegex, &quot;&quot;);             // 更新资源             compilation.assets[filename] = {               source: () =&gt; withoutConsole,               size: () =&gt; Buffer.byteLength(withoutConsole, &quot;utf8&quot;),             };           }         });         callback();       }     );   } } module.exports = RemoveConsolePlugin;</code></p>
<p>我们来解释下上面代码的写法：</p>
<ul>
<li>
<p><code>compiler.hooks.emit</code>：在上一章节【Webpack的构建过程】里我们提到了我们可以通过 <code>compiler</code> 去获取一些hook，在这里，我们选择 <code>emit</code> 这个hook。</p>
<p><img loading="lazy" src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/34c165478c07414c998f07542a57bb3e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW355-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1727762039&amp;x-signature=vPX7sMNPp%2BMvk5QwgcqThRGiuMI%3D" alt="image.png"  />
</p>
<p>在 <code>asset</code> 被输出到 <code>output</code> 之前，我们去完成对 <code>console.log</code> 语句的删除。</p>
</li>
<li>
<p><code>compilation</code>：<code>compilation</code> 实例能够访问所有的模块和它们的依赖（大部分是循环依赖）。 它会对应用程序的依赖图中所有模块， 进行字面上的编译(literal compilation)。</p>
<p>在这里，我们通过 <code>compilation</code> 实例获取到 <code>assets</code>，这里面就存着所有被处理的文件了。考虑到插件的运行会影响打包的速度，因此我们这里仅对<code>.js</code>文件做删除 <code>console.log</code> 语句的处理，所以加了一个 <code>if</code> 判断。</p>
<p>我们通过调用 <code>asset.source()</code> 来获取文件的源代码。</p>
<p>之后就是大家很熟悉的字符串的正则匹配和替换了。注意给 <code>.</code> 和 <code>(</code> 加上 <code>\\</code> 来<strong>进行转义</strong>。</p>
</li>
</ul>
<ol start="3">
<li>
<p><strong>在 Webpack 配置中使用插件</strong>：</p>
<p>接下来我们回到 <code>webpack.config.js</code> 文件中，引入 <code>RemoveConsolePlugin</code> 并添加到插件数组中。</p>
<p>js</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>// webpack.config.js const RemoveConsolePlugin = require(&quot;../src/RemoveConsolePlugin&quot;); module.exports = {   // ...其他配置...   plugins: [     new RemoveConsolePlugin(),     // ...其他插件...   ], };</code></p>
</li>
<li>
<p><strong>运行 Webpack 构建</strong>：</p>
<p>大功告成，接下来只要自信输入 <code>npm run build</code> 即可。</p>
<p>然后发现g了。</p>
<p><img loading="lazy" src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef70cb37a48542bf93441901a77d5cf9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW355-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1727762039&amp;x-signature=D1TqfSz30vhUk46m6p%2FKVtJbjSU%3D" alt="image.png"  />
</p>
<p>怎么cjs、js全都没了？然后我们去ouput里看下：</p>
<p><img loading="lazy" src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aa517bd9f25d4fd5bf06a96e8b488643~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW355-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1727762039&amp;x-signature=9gPBW9vuUXrQr71L3yZEQAJjq%2B0%3D" alt="image.png"  />
</p>
<p><code>console.log</code>语句确实是被删除了，但是留下了_一堆逗号_，因为这一堆逗号，导致打包后的文件异常了，通过<code>&quot;webpack-bundle-analyzer&quot;</code> 展示的依赖图也异常，这是怎么回事？</p>
<p>现在我们先取消使用自定义插件，再打包一次看看：</p>
<p><img loading="lazy" src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/91db91e08f3e40bebc9aa9e61956d352~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW355-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1727762039&amp;x-signature=EtMtSaN5jhoKBYw8sqAj4o9rIqw%3D" alt="image.png"  />
</p>
<p><img loading="lazy" src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8e988729df6c403789040469506b24a2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW355-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1727762039&amp;x-signature=x1aDQBiiUF3Cwl5sWIelw%2BDB4vE%3D" alt="image.png"  />
</p>
<p>由上图可以看到，输出的文件里，每一行<code>console.log</code>语句后面都跟着一个逗号。这也告诉了我们，如果使用正则的方式去删除<code>console.log</code>语句，还得给正则表达式加上一个是否以逗号结尾的匹配规则：<code>(,|$)</code>。</p>
<p>我们修改一下 <code>RemoveConsolePlugin.js</code> 的代码：</p>
<p>js</p>
<p>代码解读</p>
<p>复制代码</p>
<p><code>// RemoveConsolePlugin.js class RemoveConsolePlugin { // 由于我们不需要从外部传入 options  // 因此这里就不显示地定义 constructor 了 // constructor (){...} apply(compiler) {     compiler.hooks.emit.tapAsync(       &quot;RemoveConsolePlugin&quot;,       (compilation, callback) =&gt; {         Object.keys(compilation.assets).forEach((filename) =&gt; {           // 仅处理 .js 文件           if (filename.endsWith(&quot;.js&quot;)) {             const asset = compilation.assets[filename];             let content = asset.source();             // 使用正则表达式移除整个 console.log 语句             // 匹配 console.log( 之后的任意字符，直到遇到闭合的括号             const consoleLogRegex = new RegExp(               &quot;console\\.log\\(.*?\\)(,|$)&quot;,               &quot;g&quot;             );             const withoutConsole = content.replace(consoleLogRegex, &quot;&quot;);             // 更新资源             compilation.assets[filename] = {               source: () =&gt; withoutConsole,               size: () =&gt; Buffer.byteLength(withoutConsole, &quot;utf8&quot;),             };           }         });         callback();       }     );   } } module.exports = RemoveConsolePlugin;</code></p>
<p>然后再执行一次打包：</p>
<p><img loading="lazy" src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f547d11ccc13404084da688f87456824~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW355-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1727762039&amp;x-signature=rtiRhT%2Bm13s%2BB8I23j3zb8YHmxI%3D" alt="image.png"  />
</p>
<p>依赖图很正常，我们再看看输出后的文件：</p>
<p><img loading="lazy" src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/662488cc227043698173ffb771c9c0dc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW355-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1727762039&amp;x-signature=%2Bt71dxPyx6NlEf2P1htqPsKUaYI%3D" alt="image.png"  />
</p>
<p>不仅把 <code>console.log</code> 语句删除干净了，并且成功解决了之前的报错。</p>
</li>
</ol>
<h4 id="扩展思考">扩展思考<a hidden class="anchor" aria-hidden="true" href="#扩展思考">#</a></h4>
<p>动手能力强的掘友可以试试：</p>
<ul>
<li>我们实现的自定义插件只是删除了console语句中的log而已，console语句还有很多种类型呢，比如 warn、debug 、info 等等。由于我们的 plugin 不支持options的配置，在功能的全面性上较差，该如何改进？</li>
<li>除了正则去删除console语句之外，还有其他方式吗？能结合ast去做这件事情不？</li>
</ul>
<h2 id="结语">结语<a hidden class="anchor" aria-hidden="true" href="#结语">#</a></h2>
<p>多的不谈了，祝大家之后面试顺利~😉</p>
<p>当然，也祝我自己之后面试顺利~😋</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/%E5%89%8D%E7%AB%AF/">前端</a></li>
      <li><a href="http://localhost:1313/tags/%E9%9D%A2%E8%AF%95/">面试</a></li>
      <li><a href="http://localhost:1313/tags/webpack/">Webpack</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://localhost:1313/posts/wiki/%E4%B8%8E%E6%80%9D%E5%BF%85%E9%A9%B0%E8%AF%AD%E9%9F%B3%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%8F%90%E4%BE%9B%E5%95%86%E9%97%AE%E9%A2%98%E7%99%BB%E8%AE%B0/">
    <span class="title">« 上一页</span>
    <br>
    <span>与思必驰语音解决方案提供商问题登记</span>
  </a>
  <a class="next" href="http://localhost:1313/posts/wiki/2023.07.06%E4%BC%9A%E8%AE%AE~h5%E7%AB%AF%E8%99%9A%E6%8B%9F%E4%BA%BA%E6%99%BA%E8%83%BD%E5%AE%A2%E6%9C%8Dued%E8%AE%BE%E8%AE%A1%E8%AF%84%E5%AE%A1/">
    <span class="title">下一页 »</span>
    <br>
    <span>2023.07.06会议~H5端虚拟人智能客服UED设计评审</span>
  </a>
</nav>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 面试官：代码里console.log比较多，该怎么办？ on x"
            href="https://x.com/intent/tweet/?text=%e9%9d%a2%e8%af%95%e5%ae%98%ef%bc%9a%e4%bb%a3%e7%a0%81%e9%87%8cconsole.log%e6%af%94%e8%be%83%e5%a4%9a%ef%bc%8c%e8%af%a5%e6%80%8e%e4%b9%88%e5%8a%9e%ef%bc%9f&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E9%259D%25A2%25E8%25AF%2595%25E5%25AE%2598%25E4%25BB%25A3%25E7%25A0%2581%25E9%2587%258Cconsole.log%25E6%25AF%2594%25E8%25BE%2583%25E5%25A4%259A%25E8%25AF%25A5%25E6%2580%258E%25E4%25B9%2588%25E5%258A%259E%2f&amp;hashtags=%e5%89%8d%e7%ab%af%2c%e9%9d%a2%e8%af%95%2cWebpack">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 面试官：代码里console.log比较多，该怎么办？ on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E9%259D%25A2%25E8%25AF%2595%25E5%25AE%2598%25E4%25BB%25A3%25E7%25A0%2581%25E9%2587%258Cconsole.log%25E6%25AF%2594%25E8%25BE%2583%25E5%25A4%259A%25E8%25AF%25A5%25E6%2580%258E%25E4%25B9%2588%25E5%258A%259E%2f&amp;title=%e9%9d%a2%e8%af%95%e5%ae%98%ef%bc%9a%e4%bb%a3%e7%a0%81%e9%87%8cconsole.log%e6%af%94%e8%be%83%e5%a4%9a%ef%bc%8c%e8%af%a5%e6%80%8e%e4%b9%88%e5%8a%9e%ef%bc%9f&amp;summary=%e9%9d%a2%e8%af%95%e5%ae%98%ef%bc%9a%e4%bb%a3%e7%a0%81%e9%87%8cconsole.log%e6%af%94%e8%be%83%e5%a4%9a%ef%bc%8c%e8%af%a5%e6%80%8e%e4%b9%88%e5%8a%9e%ef%bc%9f&amp;source=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E9%259D%25A2%25E8%25AF%2595%25E5%25AE%2598%25E4%25BB%25A3%25E7%25A0%2581%25E9%2587%258Cconsole.log%25E6%25AF%2594%25E8%25BE%2583%25E5%25A4%259A%25E8%25AF%25A5%25E6%2580%258E%25E4%25B9%2588%25E5%258A%259E%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 面试官：代码里console.log比较多，该怎么办？ on reddit"
            href="https://reddit.com/submit?url=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E9%259D%25A2%25E8%25AF%2595%25E5%25AE%2598%25E4%25BB%25A3%25E7%25A0%2581%25E9%2587%258Cconsole.log%25E6%25AF%2594%25E8%25BE%2583%25E5%25A4%259A%25E8%25AF%25A5%25E6%2580%258E%25E4%25B9%2588%25E5%258A%259E%2f&title=%e9%9d%a2%e8%af%95%e5%ae%98%ef%bc%9a%e4%bb%a3%e7%a0%81%e9%87%8cconsole.log%e6%af%94%e8%be%83%e5%a4%9a%ef%bc%8c%e8%af%a5%e6%80%8e%e4%b9%88%e5%8a%9e%ef%bc%9f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 面试官：代码里console.log比较多，该怎么办？ on facebook"
            href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E9%259D%25A2%25E8%25AF%2595%25E5%25AE%2598%25E4%25BB%25A3%25E7%25A0%2581%25E9%2587%258Cconsole.log%25E6%25AF%2594%25E8%25BE%2583%25E5%25A4%259A%25E8%25AF%25A5%25E6%2580%258E%25E4%25B9%2588%25E5%258A%259E%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 面试官：代码里console.log比较多，该怎么办？ on whatsapp"
            href="https://api.whatsapp.com/send?text=%e9%9d%a2%e8%af%95%e5%ae%98%ef%bc%9a%e4%bb%a3%e7%a0%81%e9%87%8cconsole.log%e6%af%94%e8%be%83%e5%a4%9a%ef%bc%8c%e8%af%a5%e6%80%8e%e4%b9%88%e5%8a%9e%ef%bc%9f%20-%20http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E9%259D%25A2%25E8%25AF%2595%25E5%25AE%2598%25E4%25BB%25A3%25E7%25A0%2581%25E9%2587%258Cconsole.log%25E6%25AF%2594%25E8%25BE%2583%25E5%25A4%259A%25E8%25AF%25A5%25E6%2580%258E%25E4%25B9%2588%25E5%258A%259E%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 面试官：代码里console.log比较多，该怎么办？ on telegram"
            href="https://telegram.me/share/url?text=%e9%9d%a2%e8%af%95%e5%ae%98%ef%bc%9a%e4%bb%a3%e7%a0%81%e9%87%8cconsole.log%e6%af%94%e8%be%83%e5%a4%9a%ef%bc%8c%e8%af%a5%e6%80%8e%e4%b9%88%e5%8a%9e%ef%bc%9f&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E9%259D%25A2%25E8%25AF%2595%25E5%25AE%2598%25E4%25BB%25A3%25E7%25A0%2581%25E9%2587%258Cconsole.log%25E6%25AF%2594%25E8%25BE%2583%25E5%25A4%259A%25E8%25AF%25A5%25E6%2580%258E%25E4%25B9%2588%25E5%258A%259E%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 面试官：代码里console.log比较多，该怎么办？ on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=%e9%9d%a2%e8%af%95%e5%ae%98%ef%bc%9a%e4%bb%a3%e7%a0%81%e9%87%8cconsole.log%e6%af%94%e8%be%83%e5%a4%9a%ef%bc%8c%e8%af%a5%e6%80%8e%e4%b9%88%e5%8a%9e%ef%bc%9f&u=http%3a%2f%2flocalhost%3a1313%2fposts%2fjuejin%2f%25E9%259D%25A2%25E8%25AF%2595%25E5%25AE%2598%25E4%25BB%25A3%25E7%25A0%2581%25E9%2587%258Cconsole.log%25E6%25AF%2594%25E8%25BE%2583%25E5%25A4%259A%25E8%25AF%25A5%25E6%2580%258E%25E4%25B9%2588%25E5%258A%259E%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span><a href="https://beian.miit.gov.cn/">粤ICP备2023039897号-1</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = '复制';

        function copyingDone() {
            copybutton.innerHTML = '已复制！';
            setTimeout(() => {
                copybutton.innerHTML = '复制';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
