---
author: "èœ¡ç¬”å°å¿ƒ_"
title: "ã€çµ¦ç¥–å›½å¦ˆå¦ˆåº†ç”Ÿã€‘ç”¨uniCloudäº‘å¼€å‘å¤´åƒæ¡†å°ç¨‹åºç»™è‡ªå·±çš„å¤´åƒåŠ ä¸Šå›½æ——å§"
date: 2022-09-28
description: "æŒç»­åˆ›ä½œï¼ŒåŠ é€Ÿæˆé•¿ï¼è¿™æ˜¯æˆ‘å‚ä¸ã€Œæ˜é‡‘æ—¥æ–°è®¡åˆ’Â·10æœˆæ›´æ–‡æŒ‘æˆ˜ã€çš„ç¬¬1å¤©ï¼Œç‚¹å‡»æŸ¥çœ‹æ´»åŠ¨è¯¦æƒ…å¼€å¤´è¿˜æœ‰ä¸¤å¤©å°±è¦åˆ°ä¼Ÿå¤§çš„ç¥–å›½73å‘¨å¹´çš„ç”Ÿæ—¥äº†ï¼Œä¸ºäº†è¡¨è¾¾è‡ªå·±å¯¹ç¥–å›½çš„æµ“æµ“çˆ±æ„ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠç¤¾äº¤è½¯ä»¶ä¸Šçš„å¤´åƒ"
tags: ["uni-app","å¾®ä¿¡å°ç¨‹åº","æ˜é‡‘Â·æ—¥æ–°è®¡åˆ’"]
ShowReadingTime: "é˜…è¯»8åˆ†é’Ÿ"
weight: 909
---
æŒç»­åˆ›ä½œï¼ŒåŠ é€Ÿæˆé•¿ï¼è¿™æ˜¯æˆ‘å‚ä¸ã€Œæ˜é‡‘æ—¥æ–°è®¡åˆ’ Â· 10 æœˆæ›´æ–‡æŒ‘æˆ˜ã€çš„ç¬¬1å¤©ï¼Œ[ç‚¹å‡»æŸ¥çœ‹æ´»åŠ¨è¯¦æƒ…](https://juejin.cn/post/7147654075599978532 "https://juejin.cn/post/7147654075599978532")

### å¼€å¤´

è¿˜æœ‰ä¸¤å¤©å°±è¦åˆ°ä¼Ÿå¤§çš„ç¥–å›½`73å‘¨å¹´`çš„ç”Ÿæ—¥äº†ï¼Œä¸ºäº†è¡¨è¾¾è‡ªå·±å¯¹ç¥–å›½çš„æµ“æµ“çˆ±æ„ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠç¤¾äº¤è½¯ä»¶ä¸Šçš„å¤´åƒæ¢æˆå›½æ——è¾¹æ¡†å“¦ã€‚

ğŸ“¢ ä¸èƒ½æŠŠè‡ªå·±çš„å¤´åƒæ¢æˆå¹¿å‘Šç­‰éæ³•ä¿¡æ¯å“¦ï¼Œè¦ä¿æŒå¯¹å›½æ——çš„æ•¬ç•ä¹‹å¿ƒï¼

### é¡¹ç›®

ğŸ‘‰ æœ¬æ–‡æ˜¯ä½¿ç”¨`uniappäº‘å¼€å‘çš„å¾®ä¿¡å°ç¨‹åº`ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨é™æ€ä»£ç åœ¨å‰ç«¯mockæ•°æ®è¿›è¡Œå¼€å‘ï¼Œæ¯•ç«Ÿäº‘å¼€å‘åªæ˜¯ä¸€ä¸ªæ–¹å¼è€Œå·²ï¼Œå¹¶ä¸æ˜¯çœŸå®éœ€æ±‚ã€‚

ğŸ‘‰ åœ¨ä½¿ç”¨äº‘å¼€å‘ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å»uniappå®˜ç½‘æ³¨å†Œè´¦å·ã€é˜¿é‡Œäº‘ç©ºé—´ç­‰ä¿¡æ¯ã€‚

ğŸ‘‰ ç‚¹å‡»é“¾æ¥å¯ä»¥çœ‹æˆ‘ä»¥å‰çš„æ–‡ç« ï¼Œé‡Œé¢æœ‰ä»‹ç»æ•´ä¸ªäº‘å¼€å‘çš„æµç¨‹ã€‚[ä½¿ç”¨ Uniapp + UniCloud äº‘å¼€å‘å¾®ä¿¡å°ç¨‹åºè·å–ç”¨æˆ·ä¿¡æ¯](https://juejin.cn/post/7110896927373262884 "https://juejin.cn/post/7110896927373262884")

### å»ºä¸ªè¡¨ç”¨æ¥æ”¾å¤´åƒæ¡†æ•°æ®

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bf8e4cc317e64a048a534b1db77b6237~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?)

ğŸ‘† ç‚¹å‡» + å·å³å¯æ–°å»ºè¡¨äº†ã€‚

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6f0163831197457dafd02687f8c99b15~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?)

ğŸ‘† åˆ›å»ºä¸€ä¸ªç©ºè¡¨å°±è¡Œï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦è‡ªå·±é…ç½®è¡¨ç»“æ„ã€‚

json

 ä»£ç è§£è¯»

å¤åˆ¶ä»£ç 

`// æ–‡æ¡£æ•™ç¨‹: https://uniapp.dcloud.net.cn/uniCloud/schema {     "bsonType": "object",     "required": ["image"],     "permission": {             "read": true,             "create": false,             "update": false,             "delete": false     },     "properties": {         "_id": {                 "description": "IDï¼Œç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆ"         },         "title": {                 "title": "è¾¹æ¡†åç§°",                 "bsonType": "string",                 "description": "è¾¹æ¡†åç§°",                 "trim": "both"         },         "origin": {                 "bsonType": "file",                 "title": "å›¾ç‰‡",                 "description": "è¾¹æ¡†å›¾ç‰‡",                 "fileMediaType": "image",                 "fileExtName": "jpg,png",                 "componentForShow": {                         "name": "image"                 }         },         "type": {                 "bsonType": "int",                 "title": "åˆ†ç±»",                 "description": "åˆ†ç±»",                 "foreignKey": "wz_border_image_category.type",                 "enum": {                         "collection": "wz_border_image_category",                         "field": "name as text, type as value",                         "where": "status == 1 && type > 0",                         "orderby": "sort asc"                 }         },         "hot": {                 "title": "çƒ­é—¨æ¨è",                 "bsonType": "int",                 "description": "æ˜¯å¦çƒ­é—¨æ¨è",                 "enum": [{                                 "value": 1,                                 "text": "æ¨è"                         },                         {                                 "value": 0,                                 "text": "ä¸æ¨è"                         }                 ]         },         "sort": {                 "bsonType": "int",                 "description": "å€¼è¶Šå¤§è¶Šé å",                 "title": "æ’åº"         },         "status": {                 "title": "çŠ¶æ€",                 "bsonType": "int",                 "description": "çŠ¶æ€",                 "enum": [{                                 "value": 1,                                 "text": "å¯ç”¨"                         },                         {                                 "value": 0,                                 "text": "ä¸å¯ç”¨"                         },                         {                                 "value": -1,                                 "text": "åˆ é™¤"                         }                 ]         },         "create_at": {                 "title": "åˆ›å»ºæ—¶é—´",                 "bsonType": "timestamp",                 "description": "åˆ›å»ºæ—¶é—´",                 "componentForShow": {                         "name": "uni-dateformat"                 },                 "permission": {                         "read": true,                         "write": false                 },                 "forceDefaultValue": {                         "$env": "now"                 }         },         "update_at": {                 "title": "æ›´æ–°æ—¶é—´",                 "bsonType": "timestamp",                 "description": "æ›´æ–°æ—¶é—´",                 "permission": {                         "read": true,                         "write": false                 },                 "componentForShow": {                         "name": "uni-dateformat"                 },                 "forceDefaultValue": {                         "$env": "now"                 }         }     } }`

ğŸ‘† è¡¨ç»“æ„å¯ä»¥ç›´æ¥å¤åˆ¶è¿›å»å“¦~ä¹Ÿå¯ä»¥æ ¹æ®è‡ªå·±çš„æƒ³æ³•å¢å‡è¡¨ç»“æ„ã€‚

### è¡¨ç»“æ„å»ºå¥½äº†ï¼Œä¸å¾—å»ºä¸ªé¡¹ç›®å˜›

ğŸ‘‰ uniappåˆ›å»ºé¡¹ç›®æ˜¯éœ€è¦ä¸‹è½½ä¸“ç”¨çš„IDEçš„ï¼Œåœ¨uniappå®˜æ–¹ä¸­å¯ä»¥æ‰¾åˆ°ä¸‹è½½è·¯å¾„ã€‚

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5e9975cbcf93440fbfb09be08579ffd5~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?)

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c0cc316f14d54a5db785b969d40acc7c~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?)

ğŸ‘† æ–°å»ºé¡¹ç›®çš„æ—¶å€™ï¼Œåˆ«å¿˜äº†å‹¾é€‰ä¸‹é¢çš„`å¯ç”¨uniCloud`ï¼Œå¹¶ä½¿ç”¨é˜¿é‡Œäº‘ã€‚

æ–°å»ºå¥½é¡¹ç›®ä¹‹åï¼Œå°±å¯ä»¥å¼€å‘ç”»é¡µé¢å’¯ã€‚

é¡µé¢æ˜¯å¾ˆç®€å•çš„ï¼Œåªéœ€è¦æ˜¾ç¤ºç”¨æˆ·å¤´åƒã€è·å–å¤´åƒçš„æŒ‰é’®ã€ä¿å­˜å¤´åƒçš„æŒ‰é’®ã€å¤´åƒæ¡†åˆ—è¡¨ã€‚

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/36f61e1e36d3419081a8d68ddcc37657~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?)

é¡µé¢ä¸­ä¸»è¦ç”±ä¸‹é¢å‡ å—å…ƒç´ ç»„æˆï¼š

1.  èƒŒæ™¯å›¾ï¼Œä¸»è¦æ˜¯ä¸ºäº†å‡¸å‡ºå›½åº†å…ƒç´ 
2.  è·³åŠ¨çš„æ–‡æ¡ˆï¼Œè®©é¡µé¢æ›´åŠ çµåŠ¨
3.  ç”¨æˆ·ä¿¡æ¯åŒºåŸŸï¼ŒåŒ…æ‹¬ç”¨æˆ·å¤´åƒã€è·å–å¤´åƒã€ä¿å­˜å¤´åƒæŒ‰é’®
4.  å¤´åƒæ¡†å…ƒç´ ï¼Œä½¿ç”¨çš„æ˜¯ç½‘ä¸Šéšä¾¿ä¸‹è½½çš„pngå›¾ç‰‡

ğŸ‘‰ æˆ‘è¿™é‡Œä¸ä»…ä»…ä½¿ç”¨äº†å›½åº†çš„å¤´åƒæ¡†ï¼Œè¿˜æœ‰å…¶ä»–å…ƒç´ çš„å¤´åƒæ¡†éƒ½æ˜¯ç±»ä¼¼çš„ï¼Œåªæ˜¯ä¸åŒçš„tabæ åˆ‡æ¢ä¸€ä¸‹å°±å¥½äº†ã€‚

### å›¾ç‰‡å­˜å‚¨

ğŸ‘‰ ç”±äºå¾®ä¿¡å°ç¨‹åºå¼€å‘çš„é¡¹ç›®å¤§å°æœ€å¤šåªèƒ½æœ‰ 2M ï¼ˆå¿½ç•¥åˆ†åŒ…çš„æƒ…å†µä¸‹ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†æ‰€æœ‰å›¾ç‰‡å…ƒç´ éƒ½æ”¾åœ¨é˜¿é‡Œäº‘ç©ºé—´ä¸­ã€‚

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6ff74d99ce1d4db583994d1d554f7b7d~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?)

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dc86389415ba4122a48f6ef27a134e79~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?)

ä¸Šé¢ä¸¤å¼ å°±æ˜¯èƒŒæ™¯å›¾å’Œlogoäº†ï¼Œå¯ä»¥è‡ªè¡Œä¸‹è½½ä¹‹åæ”¾åˆ°é˜¿é‡Œäº‘ç©ºé—´ä¸­ã€‚

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9ea3dd5c836846c2bb01cb331b1df062~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?)

èƒŒæ™¯å›¾å­˜å‚¨å®Œæˆä¹‹åï¼Œå¯ä»¥æŠŠå¤´åƒæ¡†ç´ æä¹Ÿå‚¨å­˜èµ·æ¥ã€‚

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/798d5eba58a04a02aaa4dda2c647f956~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?)

### å»ºä¸ªè¡¨æ”¾èƒŒæ™¯å›¾å§

ğŸ‘‰ ä¸ºäº†æ›´å¥½çš„æ‹“å±•ï¼Œæ‰€ä»¥éœ€è¦å»ºä¸€ä¸ªå•ç‹¬çš„è¡¨ï¼Œæ¯•ç«Ÿè¿˜æœ‰åœ£è¯å…ƒç´ ã€ä¸­ç§‹å…ƒç´ ç­‰ï¼Œéƒ½å¯ä»¥ç›´æ¥æ›¿æ¢ä¸åŒçš„èƒŒæ™¯å’Œæ–‡æ¡ˆã€‚

æ–°å»ºè¡¨å’Œä¸Šé¢å¤´åƒæ¡†ä¸€æ ·ï¼Œç©ºè¡¨å°±è¡Œï¼Œå…¶ä»–çš„è‡ªå·±é…ç½®ã€‚

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4dc36456e7e447539de5699492111576~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?)

json

 ä»£ç è§£è¯»

å¤åˆ¶ä»£ç 

`// æ–‡æ¡£æ•™ç¨‹: https://uniapp.dcloud.net.cn/uniCloud/schema { 	"bsonType": "object", 	"required": [], 	"permission": { 		"read": false, 		"create": false, 		"update": false, 		"delete": false 	}, 	"properties": { 		"_id": { 			"description": "IDï¼Œç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆ" 		}, 		"type": { 			"bsonType": "int", 			"title": "åˆ†ç±»ID", 			"description": "åˆ†ç±»ID" 		}, 		"name": { 			"title": "åˆ†ç±»åç§°", 			"bsonType": "string", 			"description": "åˆ†ç±»åç§°", 			"trim": "both" 		}, 		"sort": { 			"bsonType": "int", 			"description": "å€¼è¶Šå¤§è¶Šé å", 			"title": "æ’åº" 		}, 		"status": { 			"title": "çŠ¶æ€", 			"bsonType": "int", 			"description": "çŠ¶æ€", 			"enum": [{ 					"value": 1, 					"text": "å¯ç”¨" 				}, 				{ 					"value": 0, 					"text": "ä¸å¯ç”¨" 				} 			] 		}, 		"create_at": { 			"title": "åˆ›å»ºæ—¶é—´", 			"bsonType": "timestamp", 			"description": "åˆ›å»ºæ—¶é—´", 			"permission": { 				"read": true, 				"write": false 			}, 			"forceDefaultValue": { 				"$env": "now" 			} 		}, 		"update_at": { 			"title": "æ›´æ–°æ—¶é—´", 			"bsonType": "timestamp", 			"description": "æ›´æ–°æ—¶é—´", 			"permission": { 				"read": true, 				"write": false 			}, 			"forceDefaultValue": { 				"$env": "now" 			} 		} 	} }`

### è¡¨é‡Œé¢çš„æ•°æ®

ğŸ‘‰ åœ¨å¯¹åº”çš„è¡¨ä¸­ï¼Œç‚¹å‡»æ·»åŠ è®°å½•å³å¯åœ¨å¼¹å‡ºæ¡†ä¸­å¤åˆ¶ä¸‹é¢çš„jsonæ•°æ®è¿›å»ï¼Œä¿å­˜å°±æœ‰å¯¹åº”çš„æ•°æ®æ˜¾ç¤ºäº†ã€‚

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1661994586ea4fdabcaba1a73a9195eb~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?)

ğŸ‘‰ é…ç½®èƒŒæ™¯å›¾ä¸­çš„æ•°æ®å§

json

 ä»£ç è§£è¯»

å¤åˆ¶ä»£ç 

`{     "name": "å›½åº†",     "type": 1,     "sort": 11,     "status": 1,     "create_at": 1634191078630,     "update_at": 1634191078630,     "backgroundImg": "https://vkceyugu.cdn.bspapp.com/VKCEYUGU-298ded81-a496-47bd-a034-ccc7f0b4eb56/033212e6-ceac-4dca-864d-20c80c15d3b3.png",     "fontColor": "#FBD39A",     "logo": "https://vkceyugu.cdn.bspapp.com/VKCEYUGU-298ded81-a496-47bd-a034-ccc7f0b4eb56/28dd9dc2-0e4a-4a00-880d-0203845d1590.png",     "subTitle": "é¢†å–ä½ çš„ä¸“å±å›½åº†å…ƒç´ å¤´åƒ" }`

ğŸ‘‰ è¿˜æœ‰å¤´åƒæ¡†çš„é…ç½®æ•°æ®

json

 ä»£ç è§£è¯»

å¤åˆ¶ä»£ç 

`{     "type": 1,     "image": "https://vkceyugu.cdn.bspapp.com/VKCEYUGU-298ded81-a496-47bd-a034-ccc7f0b4eb56/8b68d201-0593-47c8-9300-06ec82cc8b3a.png",     "title": "å›½æ——çº¢è‰²è¾¹æ¡†",     "origin": {         "url": "https://vkceyugu.cdn.bspapp.com/VKCEYUGU-298ded81-a496-47bd-a034-ccc7f0b4eb56/8b68d201-0593-47c8-9300-06ec82cc8b3a.png"     },     "sort": 0,     "status": 1 }`

### äº‘å‡½æ•°è·å–èƒŒæ™¯å›¾å’Œå¤´åƒæ¡†æ•°æ®

ğŸ‘‰ å› ä¸ºèƒŒæ™¯å›¾å’Œå¤´åƒæ¡†éƒ½æ˜¯åªéœ€è¦æŸ¥è¯¢çš„ï¼Œæ²¡æœ‰å…¶ä»–å¢åˆ æ”¹çš„è¿‡ç¨‹ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªé€šç”¨çš„äº‘å‡½æ•°å»æŸ¥è¯¢å°±å¯ä»¥äº†ã€‚

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ed79585ca9224a8f88c30699bf1cc5c0~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?)

ğŸ‘† é¡¹ç›®é‡Œé¢æœ‰ä¸ªuniCloudæ–‡ä»¶å¤¹ï¼Œå³é”®é€‰æ‹©å…³è”äº‘ç©ºé—´

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c8d7ff81a68f41c781c8d0c8226e315a~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?)

ğŸ‘† åœ¨å¼¹å‡ºå±‚ä¸­é€‰æ‹©å¯¹åº”çš„äº‘ç©ºé—´å³å¯

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/803bc96b362848c0a56f9070b6f3b278~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?)

ğŸ‘† äº‘ç©ºé—´å…³è”å®Œæˆä¹‹åï¼Œå¯ä»¥åœ¨cloudfunctionsæ–‡ä»¶å¤¹ä¸Šå³é”®æ–°å»ºäº‘å‡½æ•°

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e8115b639f9041abb5f85118c1313ad8~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?)

ğŸ‘† åœ¨å¼¹å‡ºå±‚ä¸­ç»™äº‘å‡½æ•°å–ä¸ªåç§°å°±å¯ä»¥åˆ›å»ºäº†

ğŸ‘‡ ä¸‹é¢å°±æ˜¯å®Œæ•´äº‘å‡½æ•°ä»£ç äº†(åœ¨å‡½æ•°ä¸­å®šä¹‰äº†ä¸åŒçš„æ¥æ”¶å‚æ•°ï¼Œç”¨äºä¸åŒçš„è¡¨è¿›è¡ŒæŸ¥è¯¢æ•°æ®)

js

 ä»£ç è§£è¯»

å¤åˆ¶ä»£ç 

`'use strict'; const db = uniCloud.database(); const utils = require('utils'); exports.main = async (event, context) => { 	var dbName = event.dbName //é›†åˆè¡¨å 	var search = event.search //æœç´¢ 	var tags = event.tags //æœç´¢ 	var order = event.order ? event.order : {} //æ’åº 	var filter = event.filter ? event.filter : {} //ç­›é€‰æ¡ä»¶ 	var pageIndex = event.pageIndex ? event.pageIndex : 1 //å½“å‰é¡µæ•° 	var pageSize = event.pageSize ? event.pageSize : 15 //æ¯é¡µæ•°é‡ 	var aggregate = event.aggregate // èšåˆæŸ¥è¯¢ 	var lookup = event.lookup // èšåˆæŸ¥è¯¢ 	var sort = event.sort // èšåˆæŸ¥è¯¢ 	var unwind = event.unwind // èšåˆæŸ¥è¯¢ 	let countResult = {} 	if (search) { 		countResult = await db.collection(dbName).where({ 			"name": new RegExp(search, 'i'), 			"status": 1 		}).count() 	} else if (tags) { 		countResult = await db.collection(dbName).where({ 			"tags": new RegExp(tags, 'i'), 			"status": 1 		}).count() 	} else { 		countResult = await db.collection(dbName).where(filter).count() 	} 	const total = countResult.total //å¾—åˆ°æ€»è®°å½•æ•°  	const totalPage = Math.ceil(total / pageSize) //è®¡ç®—é¡µæ•° 	let hasMore //æç¤ºå‰ç«¯æ˜¯å¦è¿˜æœ‰æ•°æ® 	if (pageIndex > totalPage || pageIndex == totalPage) { //å¦‚æœæ²¡æœ‰æ•°æ®äº†ï¼Œå°±è¿”å›false 		hasMore = false 	} else { 		hasMore = true 	} 	var result = {} 	if (aggregate) { 		result = await db.collection(dbName).aggregate() 			.match(filter || {}) 			.lookup(lookup) 			.unwind(unwind) 			.sort(sort) 			.skip((pageIndex - 1) * pageSize) 			.limit(pageSize) 			.end() 	} else if (search) { 		result = await db.collection(dbName) 			.where({ 				"name": new RegExp(search, 'i'), 				"status": 1 			}) 			.skip((pageIndex - 1) * pageSize) 			.limit(pageSize) 			.get() 	} else if (tags) { 		result = await db.collection(dbName) 			.where({ 				"tags": new RegExp(tags, 'i'), 				"status": 1 			}) 			.skip((pageIndex - 1) * pageSize) 			.limit(pageSize) 			.get() 	} else { 		if (order.name && order.type) { 			result = await db.collection(dbName) 				.where(filter) 				.skip((pageIndex - 1) * pageSize) 				.limit(pageSize) 				.orderBy(order.name, order.type) 				.get() 		} else { 			result = await db.collection(dbName) 				.where(filter) 				.skip((pageIndex - 1) * pageSize) 				.limit(pageSize) 				.get() 		} 	} 	const json = await utils.success({ 			list: result.data || [], 			hasMore, 			page: { 				total, 				pageSize, 				pageIndex 			} 		}, 'è·å–æˆåŠŸ') 	return json };`

### é¡µé¢æ•ˆæœå’Œé€»è¾‘

ğŸ“¢ é¡µé¢æ•ˆæœå¤§å®¶å¯ä»¥æ ¹æ®è‡ªå·±çš„æƒ³æ³•å»å®ç°æ ·å¼ï¼Œä¸‹é¢åªåšé€»è¾‘éƒ¨åˆ†å“¦

ğŸ‘‰ è¿›å…¥é¡µé¢æ—¶å°±è¯·æ±‚äº‘å‡½æ•°ï¼Œè·å–èƒŒæ™¯å›¾ã€logoã€å¤´åƒæ¡†æ•°æ®

js

 ä»£ç è§£è¯»

å¤åˆ¶ä»£ç 

`// è·å–èƒŒæ™¯å›¾ async getBorderCategory() {         const {                 result         } = await uniCloud.callFunction({                 name: 'query_list',                 data: {                         dbName: "wz_border_image_category",                         filter: {                                 status: 1,                         },                         order: {                                 "name": "sort",                                 "type": "asc"                         },                         pageIndex: 1,                         pageSize: 50                 },         })         if (result.code === 0) {                 this.$data.borderCategory = result.data.list         } },`

js

 ä»£ç è§£è¯»

å¤åˆ¶ä»£ç 

``// è·å–å¤´åƒæ¡†æ•°æ® async getBorderImage() {         const {                 result         } = await uniCloud.callFunction({                 name: 'query_list',                 data: {                         dbName: "wz_border_image_urls",                         filter,                         order: {                                 "name": "sort",                                 "type": "asc"                         },                         pageIndex: this.$data.pageIndex,                         pageSize: 100                 },         })         if (result.code === 0) {                 let list = [...(this.$data.borderList[this.$data.borderType] || []), ...(result.data.list || [])]                 this.$set(this.$data.borderList, `${this.$data.borderType}`, list)         } },``

ğŸ‘† ä¸Šé¢å·²ç»æ‹¿åˆ°å¤´åƒæ¡†çš„æ•°æ®äº†ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥è·å–ç”¨æˆ·å¤´åƒä¿¡æ¯äº†ï¼ˆå…·ä½“è·å–æ–¹å¼å¯ä»¥å‚è€ƒæˆ‘ä»¥å‰çš„æ–‡ç« ï¼‰ [ä½¿ç”¨ Uniapp + UniCloud äº‘å¼€å‘å¾®ä¿¡å°ç¨‹åºè·å–ç”¨æˆ·ä¿¡æ¯](https://juejin.cn/post/7110896927373262884 "https://juejin.cn/post/7110896927373262884")

ğŸ‘‰ ç‚¹å‡»å¤´åƒæ¡†æ—¶ï¼Œå¯ä»¥åšä¸€ä¸ªä¸¤å¼ å›¾ç‰‡å åŠ çš„æ•ˆæœ

html

 ä»£ç è§£è¯»

å¤åˆ¶ä»£ç 

`<view class="page-avatar-box">         <view class="page-avatar">                 <image :src="avatarSrc" mode=""></image>                 <image :src="borderImage" mode="" class="_border-image"></image>         </view> </view>`

css

 ä»£ç è§£è¯»

å¤åˆ¶ä»£ç 

`.page-avatar-box {         background-color: #fff;         padding: 8px;         border-radius: 14px;         width: 150px;         height: 150px;         overflow: hidden;         .page-avatar {                 position: relative;                 width: 100%;                 height: 100%;                 border-radius: 10px;                 background-color: #F1F1F1;                 border: 0.5px solid #f1f1f1;                 overflow: hidden;                 > image {                         display: block;                         width: 100%;                         height: 100%;                         // transform: scale(0.99);                         overflow: hidden;                         border-radius: 10px;                 }                 ._border-image {                         position: absolute;                         top: 0;                         left: 0;                         right: 0;                         bottom: 0;                         // transform: scale(1);                 }                 .avatar-hat {                         position: relative;                         // z-index: 10;                         // top: 50%;                         // left: 50%;                         width: 100px;                         height: 100px;                         // margin: -50px 0 0 -50px;                         .hat-border-box {                                 position: absolute;                                 width: 100%;                         }                         .hat-border {                                 position: absolute;                                 border: 1px dashed #000;                                 width: 100px;                                 height: 100px;                                 .scale {                                         bottom: -25px;                                         right: -25px;                                 }                                 .rotate {                                         bottom: -25px;                                         left: -25px;                                 }                                 .del {                                         top: -25px;                                         right: -25px;                                 }                                 .btn {                                         position: absolute;                                         z-index: 5;                                         width: 50px;                                         height: 50px;                                 }                                 ._icon {                                         width: 25px;                                         height: 25px;                                         background: rgba(0,0,0,0.5);                                         line-height: 25px;                                         text-align: center;                                         border-radius: 50%;                                         color: #fff;                                 }                         }                         .imghat {                                 position: absolute;                                 width: 100px;                                 height: 100px;                         }                 }                 &.edit {                         position: absolute;                         width: 300px;                         height: 300px;                         z-index: 99;                         margin: auto;                         left: 0;                         right: 0;                         top: -20px;                         bottom: 0;                         background: #fff;                         &:after {                                 content: '';                                 display: block;                                 position: fixed;                                 background-color: rgba(0,0,0,0.8);                                 top: 0;                                 left: 0;                                 width: 100%;                                 height: 100%;                                 z-index: -6;                         }                         &:before {                                 content: '';                                 position: absolute;                                 width: 300px;                                 height: 300px;                                 z-index: -1;                                 margin: auto;                                 left: 0;                                 right: 0;                                 top: 0;                                 bottom: 0;                                 background-color: #fff;                         }                         ._border-image {                                 position: absolute;                                 top: 6px;                                 left: 6px;                                 right: 6px;                                 bottom: 6px;                                 overflow: hidden;                         }                         ._close {                                 position: fixed;                                 margin-top: 30px;                                 width: 100%;                                 left: 0;                         }                         .user-hat {                                 height: 54px;                                 width: 54px;;                                 .hat{                                         width: 50px;                                         height: 50px;                                         border:dashed 2px rgb(187, 183, 183);                                 }                         }                 }                 .user-hat{                         position: absolute;                         top:0;                         left:0;                         height: 27px;                         width: 27px;;                         .hat{                                 width: 25px;                                 height: 25px;                                 border:dashed 2px rgb(187, 183, 183);                         }                         .rotate{                                 width: 20px;                                 height: 20px;                                 text-align: center;                                 line-height: 20px;                                 position: absolute;                                 right: -8px;                                 bottom: -8px;                                 background-color: #d81e06;                                 border-radius: 50%;                                 .rotate-icon{                                         width: 20px;                                         height: 20px;                                 }                         }                 }         } }`

ğŸ‘‰ ç‚¹å‡»ä¿å­˜æŒ‰é’®æ—¶ï¼Œå°±éœ€è¦ä½¿ç”¨canvaså»ç”»æˆä¸€å¼ å›¾è¿›è¡Œä¿å­˜äº†ã€‚

js

 ä»£ç è§£è¯»

å¤åˆ¶ä»£ç 

``// ç‚¹å‡»ä¿å­˜æŒ‰é’®çš„æ–¹æ³• saveAvatar() {         uni.showLoading({                 title: 'æ­£åœ¨ç”Ÿæˆå¤´åƒ',                 mask: true         })         this.initCanvas() }, // å¼€å§‹ç»˜ç”» initCanvas() {         this.$data.ctx = uni.createCanvasContext(this.$data.canvasId)         this.$data.ctx.setFillStyle(this.$data.canvas.background)         this.$data.ctx.fillRect(0, 0, this.$data.canvas.width, this.$data.canvas.height)         // ç”»ç”¨æˆ·å¤´åƒ         this.drawAvatarUrlImage() }, /* ç»˜åˆ¶ç”¨æˆ·å¤´åƒ */ drawAvatarUrlImage() {         let avatarSrc = this.$data.avatarSrc || ''         if (avatarSrc && this.$data.isUpload) {                 this.$data.ctx.drawImage(avatarSrc, this.changeSize(0), this.changeSize(0), this.$data.screenWidth, this.$data.screenWidth)                 // ç”»å¤´åƒæ¡†                 this.drawAvatarBorderImage()         } else if (avatarSrc && this.$data.isWeChatAvatar) {                 uni.downloadFile({                         url: avatarSrc,                         success: (res) => {                                 console.log('result', res)                                 this.$data.ctx.drawImage(res.tempFilePath, this.changeSize(0), this.changeSize(0), this.$data.screenWidth, this.$data.screenWidth)                                 // ç”»å¤´åƒæ¡†                                 this.drawAvatarBorderImage()                         },                         fail: function() {                                 uni.hideLoading()                                 uni.showModal({                                         title: 'æç¤º',                                         content: 'æ— æ³•ä¸‹è½½å¤´åƒ',                                 })                         }                 })         } else {                 uni.hideLoading()                 uni.showModal({                         title: 'æç¤º',                         content: 'è¯·å…ˆç™»å½•æˆ–è€…ä¸Šä¼ å¤´åƒ',                 })         } }, drawAvatarBorderImage() {         let borderImg = this.$data.borderImage         // æ²¡æœ‰å¤´åƒæ¡†         if (!borderImg) {                 // å¼€å§‹ç”Ÿæˆ                 return this.draw()         }         // this.$data.ctx.drawImage(borderImg, this.changeSize(0), this.changeSize(0), this.$data.screenWidth, this.$data.screenWidth)         // // å¼€å§‹ç”Ÿæˆ         // return this.draw()         // æœ‰å¤´åƒæ¡†åˆ™ç»§ç»­æ‰§è¡Œ         uni.downloadFile({                 url: borderImg,                 success: (result) => {                         this.$data.ctx.drawImage(result.tempFilePath, this.changeSize(0), this.changeSize(0), this.$data.screenWidth, this.$data.screenWidth)                         // å¼€å§‹ç”Ÿæˆ                         this.draw()                 },                 fail: function() {                         uni.hideLoading()                         uni.showModal({                                 title: 'æç¤º',                                 content: 'æ— æ³•ä¸‹è½½å¤´åƒæ¡†',                         })                 }         }) }, draw() {         this.$data.ctx.draw(false, () => {                 setTimeout(() => {                         this.canvasToImage()                 }, 130)         }) }, // ç”Ÿæˆå›¾ç‰‡ canvasToImage() {         uni.canvasToTempFilePath({                 canvasId: this.$data.canvasId,                 success: (res) => {                         uni.hideLoading()                         this.$data.ctx = null                         console.log(res)                         this.$toast('ç”ŸæˆæˆåŠŸ,æ­£åœ¨ä¿å­˜', 'center', 'success', 2000)                         this.$data.imageBill = res.tempFilePath                         uni.setStorageSync('imageBill', this.$data.imageBill)                         uni.saveImageToPhotosAlbum({                                 filePath: res.tempFilePath,                                 success: () => {                                         // this.$tips('ä¿å­˜æˆåŠŸ\nä¸å¦¨åˆ†äº«ä¸€ä¸‹~', '', 3500)                                         wx.showToast({                                           title: 'ä¿å­˜æˆåŠŸ\nä¸å¦¨åˆ†äº«ä¸€ä¸‹~',                                           icon: 'none',                                           duration: 3000                                         })                                         uni.navigateTo({                                                 url: `/pages/avatar/result?url=${this.$data.imageBill}`                                         })                                         // // ç”Ÿæˆä»¥åç›´æ¥é¢„è§ˆå›¾ç‰‡                                         // uni.previewImage({                                         // 	current: res.tempFilePath,                                         // 	urls: [ res.tempFilePath ],                                         // })                                 },                                 fail: () => {                                         this.$toast('ä¿å­˜å¤±è´¥\nè¯·æˆæƒç›¸å†Œæƒé™~',  'error', 3000)                                 }                         });                 },                 fail() {                         uni.hideLoading()                         uni.showModal({                                 title: 'æç¤º',                                 content: 'å¤´åƒä¿å­˜å¤±è´¥',                         })                 }         }) },``

### å¤´åƒæ¡†å®Œç¾æ•ˆæœ

![975f87972929a5d210e6fd8c842e540.jpg](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b4ea308068294022a7754eef0b05a7f1~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?)