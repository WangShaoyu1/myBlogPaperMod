---
author: "æ²‰é»˜ç‹äºŒ"
title: "æ‘‡äººï¼ä»Šå¹´äº¬ä¸œæ–°æ‹›16000äºº"
date: 2024-08-06
description: "å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯äºŒå“¥å‘€ã€‚å°±åœ¨ä¸Šå‘¨ï¼Œäº¬ä¸œå®˜åª’å®£å¸ƒï¼Œäº¬ä¸œæ€»éƒ¨1å·å›­åŒºDEFä¸‰åº§æ–°æ¥¼æ­£å¼å¯ç”¨ï¼Œå¹¶ä¸”æ–°æ‹›16000äººï¼Œäº8æœˆ1æ—¥æ­£å¼å¼€å¯25å±Šç§‹æ‹›æ­£å¼æ‰¹é€šé“ï¼å¥½å®¶ä¼™ï¼Œè¿™æ¯”å»å¹´æ—©äº†2"
tags: ["åç«¯","é¢è¯•","GitHub"]
ShowReadingTime: "é˜…è¯»9åˆ†é’Ÿ"
weight: 558
---
å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯äºŒå“¥å‘€ã€‚

å°±åœ¨ä¸Šå‘¨ï¼Œäº¬ä¸œå®˜åª’å®£å¸ƒï¼Œäº¬ä¸œæ€»éƒ¨ 1 å·å›­åŒº DEF ä¸‰åº§æ–°æ¥¼æ­£å¼å¯ç”¨ï¼Œå¹¶ä¸”æ–°æ‹› 16000 äººï¼Œäº 8 æœˆ 1 æ—¥ æ­£å¼å¼€å¯ 25 å±Šç§‹æ‹›æ­£å¼æ‰¹é€šé“ï¼

![æˆªå›¾æ¥è‡ªäº¬ä¸œé»‘æ¿æŠ¥](https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/94dbcf5af5d045a599304af75104b50d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKJ6buY546L5LqM:q75.awebp?rk3s=f64ab15b&x-expires=1727777977&x-signature=lbmi3C%2FLDkrfxd9B%2FJ6pX6Idx%2B0%3D)

å¥½å®¶ä¼™ï¼Œè¿™æ¯”å»å¹´æ—©äº† 20 å¤šå¤©å•Šï¼Œå»å¹´æ˜¯ 8 æœˆ 21 æ—¥æ‰å¼€å¯ã€‚å¹¶ä¸”ä»Šå¹´çš„ HC æ¯”å»å¹´ç›´æ¥å¤šäº† 1000ï¼Œè¿™å¯ä¸æ˜¯å°æ•°ç›®å•Šï¼

äº¬ä¸œå¯èƒ½æ’ä¸åˆ°ç¬¬ä¸€æ¢¯é˜Ÿçš„äº’è”ç½‘å¤§å‚ï¼Œæ¯”å¦‚è¯´å­—èŠ‚ã€è…¾è®¯ã€é˜¿é‡Œï¼Œä½†æ’åˆ°ç¬¬äºŒæ¢¯é˜Ÿè‚¯å®šæ˜¯æ¯«æ— ç–‘é—®çš„ï¼Œå¹¶ä¸”äº¬ä¸œçš„è–ªèµ„å¾…é‡çœŸçš„å¯ä»¥ã€‚

![æˆªå›¾æ¥è‡ªäºŒå“¥çš„ Java é¢è¯•æŒ‡å—](https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/75e325c6c2b843068a5181a3663cb995~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKJ6buY546L5LqM:q75.awebp?rk3s=f64ab15b&x-expires=1727777977&x-signature=%2BLzLGqUX0tryFx%2FVt9ayybtot78%3D)

24 å±Šç§‹æ‹›çš„æ—¶å€™ï¼Œæˆ‘å°±ç»Ÿè®¡è¿‡ä¸€æ³¢äº¬ä¸œçš„è–ªèµ„å¾…é‡ï¼Œæ¯”å¦‚è¯´äº¬ä¸œ Java åç«¯æœ¬ç§‘ 211 å°±èƒ½æ‹¿åˆ° 23\*16 çš„å¹´åŒ…ï¼Œè¯´å®è¯ï¼Œä¸€å¹´ 37 ä¸‡å·¦å³ä¹Ÿæ˜¯äººä¸­é¾™å‡¤äº†ã€‚

åº”è¯¥æœ‰ä¸å°‘å°ä¼™ä¼´å¯¹äº¬ä¸œæ„Ÿå…´è¶£ï¼Œé‚£æ¥ä¸‹æ¥æˆ‘ä»¬å°±é€šè¿‡ã€ŠJava é¢è¯•æŒ‡å—ã€‹é‡Œæ”¶å½•çš„ã€Šäº¬ä¸œé¢ç»åŒå­¦4 äº‘å®ä¹ ã€‹ä¸ºä¾‹ï¼Œæ¥çœ‹çœ‹äº¬ä¸œé¢è¯•å®˜éƒ½å–œæ¬¢é—®å“ªäº›é—®é¢˜ï¼Œå¥½åšå»æ–°ç›–çš„ä¸‰åº§å¤§æ¥¼ä½“éªŒä¸€ä¸‹å®½æ•é«˜æ•ˆçš„åŠå…¬åœºæ‰€ï¼ˆé¡ºå¸¦å¸ä¸€ä¸¢ä¸¢ç”²é†›ğŸ˜‚ï¼‰ã€‚

![è®©å¤©ä¸‹æ‰€æœ‰çš„é¢æ¸£éƒ½èƒ½é€†è¢­ ğŸ˜](https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/51986b1010fd4f8eb6c8da8bbd047841~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKJ6buY546L5LqM:q75.awebp?rk3s=f64ab15b&x-expires=1727777977&x-signature=PLJfxiScOePk7IJ0jmxnCDp7PeQ%3D)

### äº¬ä¸œåŒå­¦4äº‘å®ä¹ é¢ç»

> ä¹‹å‰é¢ç»ä¸­é‡å¤å‡ºç°çš„é¢˜ç›®è¿™æ¬¡å°±ç•¥è¿‡äº†ï¼Œå¤§å®¶å¯ä»¥å»ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­åœ¨çº¿ç‰ˆæŸ¥çœ‹ï¼Œæˆ‘å·²ç»å¸®å¤§å®¶æ ‡è®°å¥½äº†ï¼š[javabetter.cn/sidebar/sanâ€¦](https://link.juejin.cn?target=https%3A%2F%2Fjavabetter.cn%2Fsidebar%2Fsanfene%2Fnixi.html "https://javabetter.cn/sidebar/sanfene/nixi.html")

![](https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/091c7c4cbb0f425ab99cacf85bf601d3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKJ6buY546L5LqM:q75.awebp?rk3s=f64ab15b&x-expires=1727777977&x-signature=%2F5nWI6bXpUtiixPDcNUMHULZxWo%3D)

#### hashmapæ˜¯ä¼šæ­»é”çš„, ä½ çŸ¥é“å—

HashMap ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¤šçº¿ç¨‹ä¸‹æ‰©å®¹ä¼šæ­»å¾ªç¯ã€‚å› ä¸º JDK1.7 ä¸­çš„ HashMap ä½¿ç”¨çš„æ˜¯å¤´æ’æ³•æ’å…¥å…ƒç´ ï¼Œåœ¨å¤šçº¿ç¨‹çš„ç¯å¢ƒä¸‹ï¼Œæ‰©å®¹çš„æ—¶å€™å°±æœ‰å¯èƒ½å¯¼è‡´å‡ºç°ç¯å½¢é“¾è¡¨ï¼Œé€ æˆæ­»å¾ªç¯ã€‚

![äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7310d6c73ebb41dba4ba55133545162d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKJ6buY546L5LqM:q75.awebp?rk3s=f64ab15b&x-expires=1727777977&x-signature=a33f17izWQI8LTgn4S9S210fBGM%3D)

ä¸è¿‡ï¼ŒJDK 8 æ—¶å·²ç»ä¿®å¤äº†è¿™ä¸ªé—®é¢˜ï¼Œæ‰©å®¹æ—¶ä¼šä¿æŒé“¾è¡¨åŸæ¥çš„é¡ºåºã€‚

#### i++æ˜¯åŸå­æ“ä½œå—ï¼Ÿ

åŸå­æ“ä½œæŒ‡çš„æ˜¯ä¸€ä¸ªæ“ä½œæ˜¯ä¸å¯åˆ†å‰²çš„ï¼Œè¦ä¹ˆå…¨éƒ¨æ‰§è¡ŒæˆåŠŸï¼Œè¦ä¹ˆå®Œå…¨ä¸æ‰§è¡Œã€‚

i++ ä¸æ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼Œå®ƒåŒ…æ‹¬ä¸‰ä¸ªæ­¥éª¤ï¼š

1.  ä»å†…å­˜ä¸­è¯»å– i çš„å€¼ã€‚
2.  å¯¹ i è¿›è¡ŒåŠ  1 æ“ä½œã€‚
3.  å°†æ–°çš„å€¼å†™å…¥å†…å­˜ã€‚

å‡å¦‚ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶å¯¹ i è¿›è¡Œ i++ æ“ä½œæ—¶ï¼Œå¯èƒ½ä¼šå‘ç”Ÿä»¥ä¸‹æƒ…å†µï¼š

1.  çº¿ç¨‹ A è¯»å– i çš„å€¼ï¼ˆå‡è®¾ i çš„åˆå§‹å€¼ä¸º 1ï¼‰ã€‚
2.  çº¿ç¨‹ B ä¹Ÿè¯»å– i çš„å€¼ï¼ˆå€¼ä»ç„¶æ˜¯ 1ï¼‰ã€‚
3.  çº¿ç¨‹ A å°† i å¢åŠ åˆ° 2ï¼Œå¹¶å°†å…¶å†™å›å†…å­˜ã€‚
4.  çº¿ç¨‹ B ä¹Ÿå°† i å¢åŠ åˆ° 2ï¼Œå¹¶å°†å…¶å†™å›å†…å­˜ã€‚

å°½ç®¡è¿›è¡Œäº†ä¸¤æ¬¡é€’å¢æ“ä½œï¼Œi çš„å€¼åªå¢åŠ äº† 1 è€Œä¸æ˜¯ 2ã€‚å¯ä»¥ä½¿ç”¨ synchronized æˆ– AtomicInteger ç¡®ä¿æ“ä½œçš„åŸå­æ€§ã€‚

#### å¸¸è§çš„7ä¸ªGCå›æ”¶å™¨

å°±ç›®å‰æ¥è¯´ï¼ŒJVM çš„åƒåœ¾æ”¶é›†å™¨ä¸»è¦åˆ†ä¸ºä¸¤å¤§ç±»ï¼šåˆ†ä»£æ”¶é›†å™¨å’Œåˆ†åŒºæ”¶é›†å™¨ï¼Œåˆ†ä»£æ”¶é›†å™¨çš„ä»£è¡¨æ˜¯ CMSï¼Œåˆ†åŒºæ”¶é›†å™¨çš„ä»£è¡¨æ˜¯ G1 å’Œ ZGCã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šHotSpotè™šæ‹Ÿæœºåƒåœ¾æ”¶é›†å™¨](https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/429e58cc23874622a3927fec82b40bc6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKJ6buY546L5LqM:q75.awebp?rk3s=f64ab15b&x-expires=1727777977&x-signature=TcVl0WqXaca%2BuFqxZS%2Bv%2FfVduMs%3D)

#### å››ä¸ªå¼•ç”¨(å¼ºè½¯å¼±è™š)

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šå››ç§å¼•ç”¨æ€»ç»“](https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9a762b89494741ab968ad9ea63d5b3fc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKJ6buY546L5LqM:q75.awebp?rk3s=f64ab15b&x-expires=1727777977&x-signature=u8uMkTx7xjiY9OBZpTY%2BLywiM8U%3D)

å¼ºå¼•ç”¨æ˜¯ Java ä¸­æœ€å¸¸è§çš„å¼•ç”¨ç±»å‹ã€‚ä½¿ç”¨ new å…³é”®å­—èµ‹å€¼çš„å¼•ç”¨å°±æ˜¯å¼ºå¼•ç”¨ï¼Œåªè¦å¼ºå¼•ç”¨å…³è”ç€å¯¹è±¡ï¼Œåƒåœ¾æ”¶é›†å™¨å°±ä¸ä¼šå›æ”¶è¿™éƒ¨åˆ†å¯¹è±¡ã€‚

java

 ä»£ç è§£è¯»

å¤åˆ¶ä»£ç 

`String str = new String("æ²‰é»˜ç‹äºŒ");`

è½¯å¼•ç”¨æ˜¯ä¸€ç§ç›¸å¯¹è¾ƒå¼±çš„å¼•ç”¨ç±»å‹ï¼Œå¯ä»¥é€šè¿‡ SoftReference ç±»å®ç°ã€‚è½¯å¼•ç”¨å¯¹è±¡åœ¨å†…å­˜ä¸è¶³æ—¶æ‰ä¼šè¢«å›æ”¶ã€‚

java

 ä»£ç è§£è¯»

å¤åˆ¶ä»£ç 

`SoftReference<String> softRef = new SoftReference<>(new String("æ²‰é»˜ç‹äºŒ"));`

å¼±å¼•ç”¨å¯ä»¥é€šè¿‡ WeakReference ç±»å®ç°ã€‚å¼±å¼•ç”¨å¯¹è±¡åœ¨ä¸‹ä¸€æ¬¡åƒåœ¾å›æ”¶æ—¶ä¼šè¢«å›æ”¶ï¼Œä¸è®ºå†…å­˜æ˜¯å¦å……è¶³ã€‚

java

 ä»£ç è§£è¯»

å¤åˆ¶ä»£ç 

`WeakReference<String> weakRef = new WeakReference<>(new String("æ²‰é»˜ç‹äºŒ"));`

è™šå¼•ç”¨å¯ä»¥é€šè¿‡ PhantomReference ç±»å®ç°ã€‚è™šå¼•ç”¨å¯¹è±¡åœ¨ä»»ä½•æ—¶å€™éƒ½å¯èƒ½è¢«å›æ”¶ã€‚ä¸»è¦ç”¨äºè·Ÿè¸ªå¯¹è±¡è¢«åƒåœ¾å›æ”¶çš„çŠ¶æ€ï¼Œå¯ä»¥ç”¨äºç®¡ç†ç›´æ¥å†…å­˜ã€‚

java

 ä»£ç è§£è¯»

å¤åˆ¶ä»£ç 

`PhantomReference<String> phantomRef = new PhantomReference<>(new String("æ²‰é»˜ç‹äºŒ"), new ReferenceQueue<>());`

#### mysqlçš„æ•°æ®å¼•æ“æœ‰å“ªäº›, åŒºåˆ«(innodb,MyISAM,Memory)

MySQL æ”¯æŒå¤šç§å­˜å‚¨å¼•æ“ï¼Œå¸¸è§çš„æœ‰ MyISAMã€InnoDBã€MEMORY ç­‰ã€‚MEMORY å¹¶ä¸å¸¸ç”¨ã€‚

![å­˜å‚¨å¼•æ“](https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b16c2a6d7bfd4475b9d2c2cc7c58b37c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKJ6buY546L5LqM:q75.awebp?rk3s=f64ab15b&x-expires=1727777977&x-signature=U0NvRxH9NvzonoqsFabL3XCbg8w%3D)

æˆ‘æ¥åšä¸€ä¸ªè¡¨æ ¼å¯¹æ¯”ï¼š

åŠŸèƒ½

InnoDB

MyISAM

MEMORY

æ”¯æŒäº‹åŠ¡

Yes

No

No

æ”¯æŒå…¨æ–‡ç´¢å¼•

Yes

Yes

No

æ”¯æŒ B+æ ‘ç´¢å¼•

Yes

Yes

Yes

æ”¯æŒå“ˆå¸Œç´¢å¼•

Yes

No

Yes

æ”¯æŒå¤–é”®

Yes

No

No

#### å¦‚ä½•åˆ‡æ¢æ•°æ®åº“å¼•æ“

å¯ä»¥é€šè¿‡ alter table è¯­å¥æ¥åˆ‡æ¢ MySQL çš„æ•°æ®å¼•æ“ã€‚

sql

 ä»£ç è§£è¯»

å¤åˆ¶ä»£ç 

`ALTER TABLE your_table_name ENGINE=InnoDB;`

ä¸è¿‡ä¸å»ºè®®ï¼Œåº”è¯¥æå‰è®¾è®¡å¥½åˆ°åº•ç”¨å“ªä¸€ç§å­˜å‚¨å¼•æ“ã€‚

#### mysqlä¸€å…±æœ‰å“ªäº›é”

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šMySQL ä¸­çš„é”](https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/91d34bab4bac47988848ad1eead038df~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKJ6buY546L5LqM:q75.awebp?rk3s=f64ab15b&x-expires=1727777977&x-signature=xx8mXKptJKPDd8m3cmMzdPtbn0w%3D)

æŒ‰é”ç²’åº¦åˆ’åˆ†çš„è¯ï¼ŒMySQL çš„é”æœ‰ï¼š

*   è¡¨é”ï¼šå¼€é”€å°ï¼ŒåŠ é”å¿«ï¼›é”å®šåŠ›åº¦å¤§ï¼Œå‘ç”Ÿé”å†²çªæ¦‚ç‡é«˜ï¼Œå¹¶å‘åº¦æœ€ä½ï¼›ä¸ä¼šå‡ºç°æ­»é”ã€‚
*   è¡Œé”ï¼šå¼€é”€å¤§ï¼ŒåŠ é”æ…¢ï¼›ä¼šå‡ºç°æ­»é”ï¼›é”å®šç²’åº¦å°ï¼Œå‘ç”Ÿé”å†²çªçš„æ¦‚ç‡ä½ï¼Œå¹¶å‘åº¦é«˜ã€‚
*   é¡µé”ï¼šå¼€é”€å’ŒåŠ é”é€Ÿåº¦ä»‹äºè¡¨é”å’Œè¡Œé”ä¹‹é—´ï¼›ä¼šå‡ºç°æ­»é”ï¼›é”å®šç²’åº¦ä»‹äºè¡¨é”å’Œè¡Œé”ä¹‹é—´ï¼Œå¹¶å‘åº¦ä¸€èˆ¬ã€‚

æŒ‰å…¼å®¹æ€§åˆ’åˆ†çš„è¯ï¼ŒMySQL çš„é”æœ‰ï¼š

*   å…±äº«é”ï¼ˆS Lockï¼‰ï¼Œä¹Ÿå«è¯»é”ï¼ˆread lockï¼‰ï¼Œç›¸äº’ä¸é˜»å¡ã€‚
*   æ’ä»–é”ï¼ˆX Lockï¼‰ï¼Œä¹Ÿå«å†™é”ï¼ˆwrite lockï¼‰ï¼Œæ’å®ƒé”æ˜¯é˜»å¡çš„ï¼Œåœ¨ä¸€å®šæ—¶é—´å†…ï¼Œåªæœ‰ä¸€ä¸ªè¯·æ±‚èƒ½æ‰§è¡Œå†™å…¥ï¼Œå¹¶é˜»æ­¢å…¶å®ƒé”è¯»å–æ­£åœ¨å†™å…¥çš„æ•°æ®ã€‚

#### è¯´è¯´ä½ å¯¹RocketMQçš„ç†è§£

![ç‰§å°å†œï¼šRocketMQ çš„ä½œç”¨](https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55ad450e937142f486db7f73e7eff6e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKJ6buY546L5LqM:q75.awebp?rk3s=f64ab15b&x-expires=1727777977&x-signature=ODODA3fMPTASK8rvSGQ2E60MLCY%3D)

RocketMQ æ˜¯é˜¿é‡Œå·´å·´å¼€æºçš„ä¸€æ¬¾åˆ†å¸ƒå¼æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œå…·æœ‰é«˜ååé‡ã€ä½å»¶è¿Ÿå’Œé«˜å¯ç”¨æ€§ã€‚å…¶ä¸»è¦ç»„ä»¶åŒ…æ‹¬ç”Ÿäº§è€…ã€æ¶ˆè´¹è€…ã€Brokerã€Topic å’Œé˜Ÿåˆ—ã€‚æ¶ˆæ¯ç”±ç”Ÿäº§è€…å‘é€åˆ° Brokerï¼Œå†æ ¹æ®è·¯ç”±è§„åˆ™å­˜å‚¨åˆ°é˜Ÿåˆ—ä¸­ï¼Œæ¶ˆè´¹è€…ä»é˜Ÿåˆ—ä¸­æ‹‰å–æ¶ˆæ¯è¿›è¡Œå¤„ç†ã€‚é€‚ç”¨äºå¼‚æ­¥è§£è€¦å’Œæµé‡å‰Šå³°ç­‰åœºæ™¯ã€‚

##### è¯´è¯´æ­»ä¿¡é˜Ÿåˆ—ï¼Ÿ

æ­»ä¿¡é˜Ÿåˆ—ç”¨äºå­˜å‚¨é‚£äº›æ— æ³•è¢«æ­£å¸¸å¤„ç†çš„æ¶ˆæ¯ï¼Œè¿™äº›æ¶ˆæ¯è¢«ç§°ä¸ºæ­»ä¿¡ï¼ˆDead Letterï¼‰ã€‚

![é˜¿é‡Œäº‘å®˜æ–¹æ–‡æ¡£ï¼šæ­»ä¿¡é˜Ÿåˆ—](https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bcb230ccf1d0423eb1dac7b7a30532a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKJ6buY546L5LqM:q75.awebp?rk3s=f64ab15b&x-expires=1727777977&x-signature=iYHJKENO2cy4c0jWwNbWkVMWOZg%3D)

äº§ç”Ÿæ­»ä¿¡çš„åŸå› æ˜¯ï¼Œæ¶ˆè´¹è€…åœ¨å¤„ç†æ¶ˆæ¯æ—¶å‘ç”Ÿå¼‚å¸¸ï¼Œä¸”è¾¾åˆ°äº†æœ€å¤§é‡è¯•æ¬¡æ•°ã€‚å½“æ¶ˆè´¹å¤±è´¥çš„åŸå› æ’æŸ¥å¹¶è§£å†³åï¼Œå¯ä»¥é‡å‘è¿™äº›æ­»ä¿¡æ¶ˆæ¯ï¼Œè®©æ¶ˆè´¹è€…é‡æ–°æ¶ˆè´¹ï¼›å¦‚æœæš‚æ—¶æ— æ³•å¤„ç†ï¼Œä¸ºé¿å…åˆ°æœŸåæ­»ä¿¡æ¶ˆæ¯è¢«åˆ é™¤ï¼Œå¯ä»¥å…ˆå°†æ­»ä¿¡æ¶ˆæ¯å¯¼å‡ºå¹¶è¿›è¡Œä¿å­˜ã€‚

##### å¦‚ä½•å¤„ç†æ¶ˆæ¯é‡å¤æ¶ˆè´¹çš„é—®é¢˜ï¼Ÿ

RocketMQ å¯ä»¥ä¿è¯æ¶ˆæ¯ä¸€å®šæŠ•é€’ï¼Œä¸”ä¸ä¸¢å¤±ï¼Œä½†æ— æ³•ä¿è¯æ¶ˆæ¯ä¸é‡å¤æ¶ˆè´¹ã€‚

å› æ­¤ï¼Œéœ€è¦åœ¨ä¸šåŠ¡ç«¯åšå¥½æ¶ˆæ¯çš„å¹‚ç­‰æ€§å¤„ç†ï¼Œæˆ–è€…åšæ¶ˆæ¯å»é‡ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šå¹‚ç­‰å’Œå»é‡](https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/70181d4925ad4a439719d3ca7e026015~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKJ6buY546L5LqM:q75.awebp?rk3s=f64ab15b&x-expires=1727777977&x-signature=UIfSdEUYlqnnzUR1oPvXc%2FJLLqQ%3D)

å¹‚ç­‰æ€§æ˜¯æŒ‡ä¸€ä¸ªæ“ä½œå¯ä»¥æ‰§è¡Œå¤šæ¬¡è€Œä¸ä¼šäº§ç”Ÿå‰¯ä½œç”¨ï¼Œå³æ— è®ºæ‰§è¡Œå¤šå°‘æ¬¡ï¼Œç»“æœéƒ½æ˜¯ç›¸åŒçš„ã€‚å¯ä»¥åœ¨ä¸šåŠ¡é€»è¾‘ä¸­åŠ å…¥æ£€æŸ¥é€»è¾‘ï¼Œç¡®ä¿åŒä¸€æ¶ˆæ¯å¤šæ¬¡æ¶ˆè´¹ä¸ä¼šäº§ç”Ÿå‰¯ä½œç”¨ã€‚

ä¾‹å¦‚ï¼Œåœ¨æ”¯ä»˜åœºæ™¯ä¸‹ï¼Œæ¶ˆè´¹è€…æ¶ˆè´¹æ‰£æ¬¾çš„æ¶ˆæ¯ï¼Œå¯¹ä¸€ç¬”è®¢å•æ‰§è¡Œæ‰£æ¬¾æ“ä½œï¼Œé‡‘é¢ä¸º100å…ƒã€‚

å¦‚æœå› ç½‘ç»œä¸ç¨³å®šç­‰åŸå› å¯¼è‡´æ‰£æ¬¾æ¶ˆæ¯é‡å¤æŠ•é€’ï¼Œæ¶ˆè´¹è€…é‡å¤æ¶ˆè´¹äº†è¯¥æ‰£æ¬¾æ¶ˆæ¯ï¼Œä½†æœ€ç»ˆçš„ä¸šåŠ¡ç»“æœè¦ä¿è¯åªæ‰£æ¬¾ä¸€æ¬¡ï¼Œé‡‘é¢ä¸º100å…ƒã€‚å¦‚æœæ‰£æ¬¾æ“ä½œæ˜¯ç¬¦åˆè¦æ±‚çš„ï¼Œé‚£ä¹ˆå°±å¯ä»¥è®¤ä¸ºæ•´ä¸ªæ¶ˆè´¹è¿‡ç¨‹å®ç°äº†æ¶ˆæ¯å¹‚ç­‰ã€‚

æ¶ˆæ¯å»é‡ï¼Œæ˜¯æŒ‡åœ¨æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯ä¹‹å‰ï¼Œå…ˆæ£€æŸ¥ä¸€ä¸‹æ˜¯å¦å·²ç»æ¶ˆè´¹è¿‡è¿™æ¡æ¶ˆæ¯ï¼Œå¦‚æœæ¶ˆè´¹è¿‡äº†ï¼Œå°±ä¸å†æ¶ˆè´¹ã€‚

ä¸šåŠ¡ç«¯å¯ä»¥é€šè¿‡ä¸€ä¸ªä¸“é—¨çš„è¡¨æ¥è®°å½•å·²ç»æ¶ˆè´¹è¿‡çš„æ¶ˆæ¯ IDï¼Œæ¯æ¬¡æ¶ˆè´¹æ¶ˆæ¯ä¹‹å‰ï¼Œå…ˆæŸ¥è¯¢ä¸€ä¸‹è¿™ä¸ªè¡¨ï¼Œå¦‚æœå·²ç»å­˜åœ¨ï¼Œå°±ä¸å†æ¶ˆè´¹ã€‚

java

 ä»£ç è§£è¯»

å¤åˆ¶ä»£ç 

`public void processMessage(String messageId, String message) {     if (!isMessageProcessed(messageId)) {         // å¤„ç†æ¶ˆæ¯         markMessageAsProcessed(messageId);     } } private boolean isMessageProcessed(String messageId) {     // æŸ¥è¯¢å»é‡è¡¨ï¼Œæ£€æŸ¥æ¶ˆæ¯IDæ˜¯å¦å­˜åœ¨ } private void markMessageAsProcessed(String messageId) {     // å°†æ¶ˆæ¯IDæ’å…¥å»é‡è¡¨ }`

#### å¦‚ä½•ä¿è¯å¹‚ç­‰æ€§

![å‹‡å“¥ï¼šæ¶ˆè´¹å¹‚ç­‰](https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0c94a6a9931e468abffcd8aa34f20e76~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKJ6buY546L5LqM:q75.awebp?rk3s=f64ab15b&x-expires=1727777977&x-signature=TsYKzMkbFkH5EXHA5Pe7tBbrBIg%3D)

é¦–å…ˆï¼Œæ¶ˆæ¯å¿…é¡»æºå¸¦ä¸šåŠ¡å”¯ä¸€æ ‡è¯†ï¼Œå¯ä»¥é€šè¿‡é›ªèŠ±ç®—æ³•ç”Ÿæˆå…¨å±€å”¯ä¸€ IDã€‚

java

 ä»£ç è§£è¯»

å¤åˆ¶ä»£ç 

`Message msg = new Message(TOPIC /* Topic */,              TAG /* Tag */,                ("Hello RocketMQ " + i).getBytes(RemotingHelper.DEFAULT_CHARSET) /* Message body */              ); message.setKey("ORDERID_100"); // è®¢å•ç¼–å· SendResult sendResult = producer.send(message);`      

å…¶æ¬¡ï¼Œåœ¨æ¶ˆè´¹è€…æ¥æ”¶åˆ°æ¶ˆæ¯åï¼Œåˆ¤æ–­ Redis ä¸­æ˜¯å¦å­˜åœ¨è¯¥ä¸šåŠ¡ä¸»é”®çš„æ ‡å¿—ä½ï¼Œè‹¥å­˜åœ¨æ ‡å¿—ä½ï¼Œåˆ™è®¤ä¸ºæ¶ˆè´¹æˆåŠŸï¼Œå¦åˆ™æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼Œæ‰§è¡Œå®Œæˆåï¼Œåœ¨ç¼“å­˜ä¸­æ·»åŠ æ ‡å¿—ä½ã€‚

java

 ä»£ç è§£è¯»

å¤åˆ¶ä»£ç 

`public ConsumeConcurrentlyStatus consumeMessage(List<MessageExt> msgs, ConsumeConcurrentlyContext context) {     try {         for (MessageExt messageExt : msgs) {            String bizKey = messageExt.getKeys(); // å”¯ä¸€ä¸šåŠ¡ä¸»é”®            //1. åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ ‡å¿—            if(redisTemplate.hasKey(RedisKeyConstants.WAITING_SEND_LOCK + bizKey)) {          			continue;        		 }          	 //2. æ‰§è¡Œä¸šåŠ¡é€»è¾‘            //TODO do business            //3. è®¾ç½®æ ‡å¿—ä½            redisTemplate.opsForValue().set(RedisKeyConstants.WAITING_SEND_LOCK + bizKey, "1", 72, TimeUnit.HOURS);         }         return ConsumeConcurrentlyStatus.CONSUME_SUCCESS;     } catch (Exception e) {         logger.error("consumeMessage error: ", e);         return ConsumeConcurrentlyStatus.RECONSUME_LATER;     } }`

ç„¶åï¼Œåˆ©ç”¨æ•°æ®åº“çš„å”¯ä¸€ç´¢å¼•æ¥é˜²æ­¢ä¸šåŠ¡çš„é‡å¤æ’å…¥ã€‚

sql

 ä»£ç è§£è¯»

å¤åˆ¶ä»£ç 

``CREATE TABLE `t_order` (   `id` bigint(20) NOT NULL AUTO_INCREMENT,   `order_id` varchar(64) NOT NULL COMMENT 'è®¢å•ç¼–å·',   `order_name` varchar(64) NOT NULL COMMENT 'è®¢å•åç§°',   PRIMARY KEY (`id`),   UNIQUE KEY `order_id` (`order_id`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='è®¢å•è¡¨';``

æœ€åï¼Œåœ¨æ•°æ®åº“è¡¨ä¸­ä½¿ç”¨ç‰ˆæœ¬å·ï¼Œé€šè¿‡ä¹è§‚é”æœºåˆ¶æ¥ä¿è¯å¹‚ç­‰æ€§ã€‚æ¯æ¬¡æ›´æ–°æ“ä½œæ—¶æ£€æŸ¥ç‰ˆæœ¬å·æ˜¯å¦ä¸€è‡´ï¼Œåªæœ‰ä¸€è‡´æ—¶æ‰æ‰§è¡Œæ›´æ–°å¹¶é€’å¢ç‰ˆæœ¬å·ã€‚å¦‚æœç‰ˆæœ¬å·ä¸ä¸€è‡´ï¼Œåˆ™è¯´æ˜æ“ä½œå·²è¢«æ‰§è¡Œè¿‡ï¼Œæ‹’ç»é‡å¤æ“ä½œã€‚

java

 ä»£ç è§£è¯»

å¤åˆ¶ä»£ç 

`public void updateRecordWithOptimisticLock(int id, String newValue, int expectedVersion) {     int updatedRows = jdbcTemplate.update(         "UPDATE records SET value = ?, version = version + 1 WHERE id = ? AND version = ?",         newValue, id, expectedVersion     );     if (updatedRows == 0) {         throw new OptimisticLockingFailureException("Record has been modified by another transaction");     } }`

æˆ–è€…æ‚²è§‚é”æœºåˆ¶ï¼Œé€šè¿‡æ•°æ®åº“çš„é”æœºåˆ¶æ¥ä¿è¯å¹‚ç­‰æ€§ã€‚

java

 ä»£ç è§£è¯»

å¤åˆ¶ä»£ç 

`public void updateRecordWithPessimisticLock(int id) {     jdbcTemplate.queryForObject("SELECT * FROM records WHERE id = ? FOR UPDATE", id);     jdbcTemplate.update("UPDATE records SET value = ? WHERE id = ?", "newValue", id); }`

#### ä»€ä¹ˆæ˜¯é›ªèŠ±ç®—æ³•ï¼Ÿ

é›ªèŠ±ç®—æ³•æ˜¯ç”± Twitter å¼€å‘çš„ä¸€ç§åˆ†å¸ƒå¼å”¯ä¸€ ID ç”Ÿæˆç®—æ³•ã€‚

![æŠ€æœ¯æ´¾æ•™ç¨‹ï¼šé›ªèŠ±ç®—æ³•](https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3e6bdc7c32f4ec0a7e7f9f0cbdacbea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKJ6buY546L5LqM:q75.awebp?rk3s=f64ab15b&x-expires=1727777977&x-signature=hjFM6alBf%2FiXgO%2F31qW%2FRN4IxDE%3D)

é›ªèŠ±ç®—æ³•ä»¥ 64 bit æ¥å­˜å‚¨ç»„æˆ ID çš„4 ä¸ªéƒ¨åˆ†ï¼š

1.  æœ€é«˜ä½å 1 bitï¼Œå§‹ç»ˆä¸º 0ï¼Œè¡¨ç¤ºæ­£æ•°ã€‚
2.  ä¸­ä½å  41 bitï¼Œå€¼ä¸ºæ¯«ç§’çº§æ—¶é—´æˆ³ï¼›
3.  ä¸­ä¸‹ä½å  10 bitï¼Œæœºå™¨ IDï¼ˆåŒ…æ‹¬æ•°æ®ä¸­å¿ƒ ID å’Œæœºå™¨ IDï¼‰ï¼Œå¯ä»¥æ”¯æŒ 1024 ä¸ªèŠ‚ç‚¹ã€‚
4.  æœ«ä½å  12 bitï¼Œå€¼ä¸ºå½“å‰æ¯«ç§’å†…ç”Ÿæˆçš„ä¸åŒçš„è‡ªå¢åºåˆ—ï¼Œå€¼çš„ä¸Šé™ä¸º 4096ï¼›

ç›®å‰é›ªèŠ±ç®—æ³•çš„å®ç°æ¯”è¾ƒå¤šï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ Hutool å·¥å…·ç±»åº“ä¸­çš„ `IdUtil.getSnowflake()` æ–¹æ³•æ¥è·å–é›ªèŠ± IDã€‚

java

 ä»£ç è§£è¯»

å¤åˆ¶ä»£ç 

`long id = IdUtil.getSnowflakeNextId();`

### å†…å®¹æ¥æº

*   æ˜Ÿçƒå˜‰å®¾ä¸‰åˆ†æ¶çš„é¢æ¸£é€†è¢­ï¼š[javabetter.cn/sidebar/sanâ€¦](https://link.juejin.cn?target=https%3A%2F%2Fjavabetter.cn%2Fsidebar%2Fsanfene%2Fnixi.html "https://javabetter.cn/sidebar/sanfene/nixi.html")
*   äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼ˆGitHub å·²æœ‰ 12000+starï¼‰ï¼š[javabetter.cn](https://link.juejin.cn?target=https%3A%2F%2Fjavabetter.cn "https://javabetter.cn")