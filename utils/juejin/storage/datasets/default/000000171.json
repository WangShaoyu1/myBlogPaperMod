{
	"title": "åŸºäºqiankunçš„å¾®å‰ç«¯æœ€ä½³å®è·µ-ï¼ˆåŒæ—¶åŠ è½½å¤šä¸ªå¾®åº”ç”¨ï¼‰",
	"author": "å‰ç«¯å¼€å‘çˆ±å¥½è€…",
	"publishTime": "2021-07-18",
	"readTime": "é˜…è¯»9åˆ†é’Ÿ",
	"tags": "[\"å‰ç«¯\"]",
	"description": "æœ¬æ–‡æˆ‘ä»¬ä¸»è¦å¯¹qiankunæ‰€åŸºäºçš„åŸºåº§æ¨¡å¼è¿›è¡Œä»‹ç»ã€‚å®ƒçš„ä¸»è¦æ€è·¯æ˜¯å°†ä¸€ä¸ªå¤§å‹åº”ç”¨æ‹†åˆ†æˆè‹¥å¹²ä¸ªæ›´å°ã€æ›´ç®€å•ï¼Œå¯ä»¥ç‹¬ç«‹å¼€å‘ã€æµ‹è¯•å’Œéƒ¨ç½²çš„å¾®åº”ç”¨ï¼Œç„¶åç”±ä¸€ä¸ªåŸºåº§åº”ç”¨æ ¹æ®è·¯ç”±è¿›è¡Œåº”ç”¨åˆ‡æ¢",
	"article": "> ã€Œæœ¬æ–‡å·²å‚ä¸å¥½æ–‡å¬é›†ä»¤æ´»åŠ¨ï¼Œç‚¹å‡»æŸ¥çœ‹:[åç«¯ã€å¤§å‰ç«¯åŒèµ›é“æŠ•ç¨¿ï¼Œ2ä¸‡å…ƒå¥–æ± ç­‰ä½ æŒ‘æˆ˜ï¼](https://juejin.cn/post/6978685539985653767 \"https://juejin.cn/post/6978685539985653767\")\n\n> å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯ `å‰ç«¯å°èœé¸¡ä¹‹èœé¸¡äº’å•„`,å¦‚æœä½ å–œæ¬¢æˆ‘çš„æ–‡ç« ï¼Œè®°å¾—ç»™æˆ‘ç‚¹ä¸ªèµå“¦ğŸ’ª\n\nä»‹ç» qiankun\n----------\n\n> åœ¨æ­£å¼ä»‹ç» qiankun ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ï¼Œqiankun æ˜¯ä¸€ä¸ªåŸºäº [single-spa](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FCanopyTax%2Fsingle-spa \"https://github.com/CanopyTax/single-spa\") çš„[å¾®å‰ç«¯](https://link.juejin.cn?target=https%3A%2F%2Fmicro-frontends.org%2F \"https://micro-frontends.org/\")å®ç°åº“ï¼Œæ—¨åœ¨å¸®åŠ©å¤§å®¶èƒ½æ›´ç®€å•ã€æ— ç—›çš„æ„å»ºä¸€ä¸ªç”Ÿäº§å¯ç”¨å¾®å‰ç«¯æ¶æ„ç³»ç»Ÿã€‚\n\n> å¾®å‰ç«¯çš„æ¦‚å¿µå€Ÿé‰´è‡ªåç«¯çš„å¾®æœåŠ¡ï¼Œä¸»è¦æ˜¯ä¸ºäº†è§£å†³å¤§å‹å·¥ç¨‹åœ¨å˜æ›´ã€ç»´æŠ¤ã€æ‰©å±•ç­‰æ–¹é¢çš„å›°éš¾è€Œæå‡ºçš„ã€‚ç›®å‰ä¸»æµçš„å¾®å‰ç«¯æ–¹æ¡ˆåŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªï¼š\n\n*   iframe\n*   åŸºåº§æ¨¡å¼ï¼Œä¸»è¦åŸºäºè·¯ç”±åˆ†å‘ï¼Œqiankun å’Œ single-spa å°±æ˜¯åŸºäºè¿™ç§æ¨¡å¼\n*   ç»„åˆå¼é›†æˆï¼Œå³å•ç‹¬æ„å»ºç»„ä»¶ï¼ŒæŒ‰éœ€åŠ è½½ï¼Œç±»ä¼¼ npm åŒ…çš„å½¢å¼\n*   EMPï¼Œä¸»è¦åŸºäº Webpack5 Module Federation\n*   Web Components\n\n> ä¸¥æ ¼æ¥è®²ï¼Œè¿™äº›æ–¹æ¡ˆéƒ½ä¸ç®—æ˜¯å®Œæ•´çš„å¾®å‰ç«¯è§£å†³æ–¹æ¡ˆï¼Œå®ƒä»¬åªæ˜¯ç”¨äºè§£å†³å¾®å‰ç«¯ä¸­è¿è¡Œæ—¶å®¹å™¨çš„ç›¸å…³é—®é¢˜ã€‚\n\næœ¬æ–‡æˆ‘ä»¬ä¸»è¦å¯¹ qiankun æ‰€åŸºäºçš„åŸºåº§æ¨¡å¼è¿›è¡Œä»‹ç»ã€‚å®ƒçš„ä¸»è¦æ€è·¯æ˜¯å°†ä¸€ä¸ªå¤§å‹åº”ç”¨æ‹†åˆ†æˆè‹¥å¹²ä¸ªæ›´å°ã€æ›´ç®€å•ï¼Œå¯ä»¥ç‹¬ç«‹å¼€å‘ã€æµ‹è¯•å’Œéƒ¨ç½²çš„å¾®åº”ç”¨ï¼Œç„¶åç”±ä¸€ä¸ªåŸºåº§åº”ç”¨æ ¹æ®è·¯ç”±è¿›è¡Œåº”ç”¨åˆ‡æ¢ã€‚\n\nqiankun çš„æ ¸å¿ƒè®¾è®¡ç†å¿µ\n---------------\n\n*   ğŸ¥„ ç®€å•\n    \n    ç”±äºä¸»åº”ç”¨å¾®åº”ç”¨éƒ½èƒ½åšåˆ°æŠ€æœ¯æ ˆæ— å…³ï¼Œqiankun å¯¹äºç”¨æˆ·è€Œè¨€åªæ˜¯ä¸€ä¸ªç±»ä¼¼ jQuery çš„åº“ï¼Œä½ éœ€è¦è°ƒç”¨å‡ ä¸ª qiankun çš„ API å³å¯å®Œæˆåº”ç”¨çš„å¾®å‰ç«¯æ”¹é€ ã€‚åŒæ—¶ç”±äº qiankun çš„ HTML entry åŠæ²™ç®±çš„è®¾è®¡ï¼Œä½¿å¾—å¾®åº”ç”¨çš„æ¥å…¥åƒä½¿ç”¨ iframe ä¸€æ ·ç®€å•ã€‚\n    \n*   ğŸ¡ è§£è€¦/æŠ€æœ¯æ ˆæ— å…³\n    \n    å¾®å‰ç«¯çš„æ ¸å¿ƒç›®æ ‡æ˜¯å°†å·¨çŸ³åº”ç”¨æ‹†è§£æˆè‹¥å¹²å¯ä»¥è‡ªæ²»çš„æ¾è€¦åˆå¾®åº”ç”¨ï¼Œè€Œ qiankun çš„è¯¸å¤šè®¾è®¡å‡æ˜¯ç§‰æŒè¿™ä¸€åŸåˆ™ï¼Œå¦‚ HTML entryã€æ²™ç®±ã€åº”ç”¨é—´é€šä¿¡ç­‰ã€‚è¿™æ ·æ‰èƒ½ç¡®ä¿å¾®åº”ç”¨çœŸæ­£å…·å¤‡ ç‹¬ç«‹å¼€å‘ã€ç‹¬ç«‹è¿è¡Œ çš„èƒ½åŠ›ã€‚\n    \n\nç‰¹æ€§\n--\n\n*   ğŸ“¦ **åŸºäº [single-spa](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FCanopyTax%2Fsingle-spa \"https://github.com/CanopyTax/single-spa\")** å°è£…ï¼Œæä¾›äº†æ›´åŠ å¼€ç®±å³ç”¨çš„ APIã€‚\n*   ğŸ“± **æŠ€æœ¯æ ˆæ— å…³**ï¼Œä»»æ„æŠ€æœ¯æ ˆçš„åº”ç”¨å‡å¯ ä½¿ç”¨/æ¥å…¥ï¼Œä¸è®ºæ˜¯ React/Vue/Angular/JQuery è¿˜æ˜¯å…¶ä»–ç­‰æ¡†æ¶ã€‚\n*   ğŸ’ª **HTML Entry æ¥å…¥æ–¹å¼**ï¼Œè®©ä½ æ¥å…¥å¾®åº”ç”¨åƒä½¿ç”¨ iframe ä¸€æ ·ç®€å•ã€‚\n*   ğŸ›¡â€‹ **æ ·å¼éš”ç¦»**ï¼Œç¡®ä¿å¾®åº”ç”¨ä¹‹é—´æ ·å¼äº’ç›¸ä¸å¹²æ‰°ã€‚\n*   ğŸ§³ **JS æ²™ç®±**ï¼Œç¡®ä¿å¾®åº”ç”¨ä¹‹é—´ å…¨å±€å˜é‡/äº‹ä»¶ ä¸å†²çªã€‚\n*   âš¡ï¸ **èµ„æºé¢„åŠ è½½**ï¼Œåœ¨æµè§ˆå™¨ç©ºé—²æ—¶é—´é¢„åŠ è½½æœªæ‰“å¼€çš„å¾®åº”ç”¨èµ„æºï¼ŒåŠ é€Ÿå¾®åº”ç”¨æ‰“å¼€é€Ÿåº¦ã€‚\n*   ğŸ”Œ **umi æ’ä»¶**ï¼Œæä¾›äº† [@umijs/plugin-qiankun](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fumijs%2Fplugins%2Ftree%2Fmaster%2Fpackages%2Fplugin-qiankun \"https://github.com/umijs/plugins/tree/master/packages/plugin-qiankun\") ä¾› umi åº”ç”¨ä¸€é”®åˆ‡æ¢æˆå¾®å‰ç«¯æ¶æ„ç³»ç»Ÿã€‚\n\né¡¹ç›®å®æˆ˜\n----\n\n> æœ¬æ–‡é€‚åˆåˆšæ¥è§¦ `qiankun` çš„æ–°äººï¼Œä»‹ç»äº†å¦‚ä½•ä» 0 æ„å»ºä¸€ä¸ª `qiankun` é¡¹ç›®ã€‚é¡¹ç›®ä¸»è¦æœ‰ä»¥ä¸‹æ„æˆï¼š\n\n*   **ä¸»åº”ç”¨ï¼š**\n    \n    *   ä½¿ç”¨ umi3.5ï¼Œæœªä½¿ç”¨ [@umijs/plugin-qiankun](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fumijs%2Fplugins%2Ftree%2Fmaster%2Fpackages%2Fplugin-qiankun \"https://github.com/umijs/plugins/tree/master/packages/plugin-qiankun\")ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨çš„ [qiankun](https://link.juejin.cn?target=https%3A%2F%2Fqiankun.umijs.org%2Fzh%2Fguide%2Fgetting-started \"https://qiankun.umijs.org/zh/guide/getting-started\")\n*   **vue å¾®åº”ç”¨ï¼š**\n    \n    *   ä½¿ç”¨ vue2.x åˆ›å»º\n    *   ä½¿ç”¨ vue3.xï¼Œæš‚æœªä½¿ç”¨ vite æ„å»ºï¼Œç›®æµ‹ vite ä¸å…¼å®¹\n*   **react å¾®åº”ç”¨ï¼š**\n    \n    *   ä½¿ç”¨ create-react-app åˆ›å»º\n*   **umi3 å¾®åº”ç”¨ï¼š**\n    \n    *   ä½¿ç”¨ umi3.ç»“åˆæ’ä»¶ [@umijs/plugin-qiankun](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fumijs%2Fplugins%2Ftree%2Fmaster%2Fpackages%2Fplugin-qiankun \"https://github.com/umijs/plugins/tree/master/packages/plugin-qiankun\")\n*   **é webpack æ„å»ºçš„å¾®åº”ç”¨ï¼š**\n    \n    *   ä¸€äº›é webpack æ„å»ºçš„é¡¹ç›®ï¼Œä¾‹å¦‚ jQuery é¡¹ç›®ã€jsp é¡¹ç›®ï¼Œéƒ½å¯ä»¥æŒ‰ç…§è¿™ä¸ªå¤„ç†ã€‚\n    *   æ¥å…¥ä¹‹å‰è¯·ç¡®ä¿ä½ çš„é¡¹ç›®é‡Œçš„å›¾ç‰‡ã€éŸ³è§†é¢‘ç­‰èµ„æºèƒ½æ­£å¸¸åŠ è½½ï¼Œå¦‚æœè¿™äº›èµ„æºçš„åœ°å€éƒ½æ˜¯å®Œæ•´è·¯å¾„ï¼ˆä¾‹å¦‚ [qiankun.umijs.org/logo.png](https://link.juejin.cn?target=https%3A%2F%2Fqiankun.umijs.org%2Flogo.png \"https://qiankun.umijs.org/logo.png\") ï¼‰ï¼Œåˆ™æ²¡é—®é¢˜ã€‚å¦‚æœéƒ½æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œéœ€è¦å…ˆå°†è¿™äº›èµ„æºä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œä½¿ç”¨å®Œæ•´è·¯å¾„ã€‚\n*   **Angular å¾®åº”ç”¨ï¼š**\n    \n    *   ä½¿ç”¨çš„ @angular/cli@9.1.12 ç‰ˆæœ¬\n\nä¸»åº”ç”¨ç¯å¢ƒæ­å»º\n-------\n\n> ä¸»åº”ç”¨æŒ‰ç…§å®˜æ–¹çš„è¯´æ³•ï¼Œä¸é™æŠ€æœ¯æ ˆï¼Œåªéœ€è¦æä¾›ä¸€ä¸ªå®¹å™¨ DOMï¼Œç„¶åæ³¨å†Œå¾®åº”ç”¨å¹¶ start å³å¯ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ umi æ¥åˆå§‹åŒ–ã€‚\n\n### åˆå§‹åŒ– & å®‰è£… qiankun\n\nbash\n\n ä»£ç è§£è¯»\n\nå¤åˆ¶ä»£ç \n\n  `# é¡¹ç›®åˆå§‹åŒ–   $ yarn create @umijs/umi-app   # å®‰è£…ä¾èµ–   $ yarn   # å¯åŠ¨   $ yarn start   # å®‰è£… qiankun   $ yarn add qiankun`\n\n> åŸºæœ¬ç¯å¢ƒæ­å»ºå®Œæˆï¼Œåœ¨ä¸»åº”ç”¨ä¸­å¢åŠ ä¸€äº›èœå•å’Œè·¯ç”±ï¼Œç”¨äºä¸»åº”ç”¨é¡µé¢ä»¥åŠä¸»åº”ç”¨å’Œå¾®åº”ç”¨ä¹‹é—´åˆ‡æ¢æ“ä½œã€‚é¡µé¢å¸ƒå±€å’Œè·¯ç”±é…ç½®è¿™é‡Œä¸åšè¿‡å¤šä»‹ç»ï¼Œæ–‡æœ«ä¼šå¥‰ä¸Šæºç ã€‚å¤§è‡´é¡µé¢å¦‚ä¸‹å›¾ï¼š\n\n![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5a5f1d7e944744e5af269e5059282698~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp)\n\n### ä¸»åº”ç”¨ä¸­æ³¨å†Œå¾®åº”ç”¨\n\n> æ³¨å†Œå¾®åº”ç”¨çš„åŸºç¡€é…ç½®ä¿¡æ¯ã€‚å½“æµè§ˆå™¨ url å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šè‡ªåŠ¨æ£€æŸ¥æ¯ä¸€ä¸ªå¾®åº”ç”¨æ³¨å†Œçš„ activeRule è§„åˆ™ï¼Œç¬¦åˆè§„åˆ™çš„åº”ç”¨å°†ä¼šè¢«è‡ªåŠ¨æ¿€æ´»ã€‚æœ¬ç¤ºåˆ—åˆ†åˆ«æœ‰ä¸€ä¸ªä¸»åº”ç”¨äº”ä¸ªå¾®åº”ç”¨æ„æˆï¼Œåœ¨ä¸»åº”ç”¨ä¸­å¢åŠ å¾®åº”ç”¨çš„é…ç½®æ–‡ä»¶ï¼Œå¯¹æ³¨å†Œå¾®åº”ç”¨åšå•ç‹¬çš„ç®¡ç†ã€‚\n\n### æ³¨å†Œå¾®åº”ç”¨åŸºæœ¬é…ç½®\n\n> ä¸»åº”ç”¨ src æ–‡ä»¶ä¸‹å¢åŠ  `registerMicroAppsConfig.ts`ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\n\njavascript\n\n ä»£ç è§£è¯»\n\nå¤åˆ¶ä»£ç \n\n`const loader = (loading: boolean) => {   // æ­¤å¤„å¯ä»¥è·å–å¾®åº”ç”¨æ˜¯å¦åŠ è½½æˆåŠŸ,å¯ä»¥ç”¨æ¥è§¦å‘å…¨å±€çš„ loading   console.log(\"loading\", loading); }; export const Microconfig = [   //name: å¾®åº”ç”¨çš„åç§°,   //entry: å¾®åº”ç”¨çš„å…¥å£,   //container: å¾®åº”ç”¨çš„å®¹å™¨èŠ‚ç‚¹çš„é€‰æ‹©å™¨æˆ–è€… Element å®ä¾‹,   //activeRule: æ¿€æ´»å¾®åº”ç”¨çš„è§„åˆ™(å¯ä»¥åŒ¹é…åˆ°å¾®åº”ç”¨çš„è·¯ç”±),   //loader: åŠ è½½å¾®åº”ç”¨çš„çŠ¶æ€ true | false   {     name: \"vue2\",     entry: \"http://localhost:8001\",     container: \"#subContainer\",     activeRule: \"/vue2\",     loader,   },   {     name: \"vue3\",     entry: \"http://localhost:8002\",     container: \"#subContainer\",     activeRule: \"/vue3\",     loader,   },   {     name: \"react\",     entry: \"http://localhost:8003\",     container: \"#subContainer\",     activeRule: \"/react\",     loader,   },   {     name: \"umi\",     entry: \"http://localhost:8004\",     container: \"#subContainer\",     activeRule: \"/umi\",     loader,   },   {     name: \"purehtml\",     entry: \"http://127.0.0.1:8005\",     container: \"#subContainer\",     activeRule: \"/purehtml\",     loader,   },   //angular   {     name: \"angular\",     entry: \"http://127.0.0.1:8006\",     container: \"#subContainer\",     activeRule: \"/angular\",     loader,   }, ];`\n\n> ä¸»åº”ç”¨å…¥å£æ–‡ä»¶å¼•å…¥ï¼ˆä¸»åº”ç”¨ä½¿ç”¨çš„ umi,æ‰€ä»¥ç›´æ¥åœ¨ pages/index.tsx å¼•å…¥ï¼‰\n\njavascript\n\n ä»£ç è§£è¯»\n\nå¤åˆ¶ä»£ç \n\n`import LayoutPage from \"@/layout/index\"; import {   registerMicroApps,   start,   addGlobalUncaughtErrorHandler, } from \"qiankun\"; import { Microconfig } from \"@/registerMicroAppsConfig\"; // æ³¨å†Œå¾®åº”ç”¨ registerMicroApps(Microconfig, {   // qiankun ç”Ÿå‘½å‘¨æœŸé’©å­ - å¾®åº”ç”¨åŠ è½½å‰   beforeLoad: (app: any) => {     console.log(\"before load\", app.name);     return Promise.resolve();   },   // qiankun ç”Ÿå‘½å‘¨æœŸé’©å­ - å¾®åº”ç”¨æŒ‚è½½å   afterMount: (app: any) => {     console.log(\"after mount\", app.name);     return Promise.resolve();   }, }); // å¯åŠ¨ qiankun start(); export default function IndexPage({ children }: any) {   return (     <LayoutPage>       <div>{children}</div>       {/* å¢åŠ å®¹å™¨ï¼Œç”¨äºæ˜¾ç¤ºå¾®åº”ç”¨ */}       <div id=\"subContainer\"></div>     </LayoutPage>   ); }`\n\n### æ·»åŠ å…¨å±€å¼‚å¸¸æ•è·\n\njavascript\n\n ä»£ç è§£è¯»\n\nå¤åˆ¶ä»£ç \n\n`// æ·»åŠ å…¨å±€å¼‚å¸¸æ•è· addGlobalUncaughtErrorHandler((handler) => {   console.log(\"å¼‚å¸¸æ•è·\", handler); });`\n\n### å¼€å¯é¢„åŠ è½½&æ²™ç®±æ¨¡å¼\n\n*   âš¡ï¸prefetch: å¼€å¯é¢„åŠ è½½\n    *   true | 'all' | string\\[\\] | function\n*   ğŸ§³sandboxï¼šæ˜¯å¦å¼€å¯æ²™ç®±\n    *   strictStyleIsolation ä¸¥æ ¼æ¨¡å¼(`ShadowDOM`)\n    *   experimentalStyleIsolation å®éªŒæ€§æ–¹æ¡ˆï¼Œå»ºè®®ä½¿ç”¨\n\njavascript\n\n ä»£ç è§£è¯»\n\nå¤åˆ¶ä»£ç \n\n`start({   prefetch: true, // å¼€å¯é¢„åŠ è½½   sandbox: {     experimentalStyleIsolation: true, //   å¼€å¯æ²™ç®±æ¨¡å¼,å®éªŒæ€§æ–¹æ¡ˆ   }, });`\n\n### è®¾ç½®ä¸»åº”ç”¨å¯åŠ¨åé»˜è®¤è¿›å…¥çš„å¾®åº”ç”¨\n\njs\n\n ä»£ç è§£è¯»\n\nå¤åˆ¶ä»£ç \n\n`import { setDefaultMountApp } from \"qiankun\"  setDefaultMountApp('/purehtml');`\n\nåˆ›å»ºå¯¹åº”çš„å¾®åº”ç”¨\n--------\n\n> æ³¨æ„å¾®åº”ç”¨çš„åç§° `package.json` => `name` éœ€è¦å’Œä¸»åº”ç”¨ä¸­æ³¨å†Œæ—¶çš„ `name` ç›¸å¯¹åº”ï¼Œä¸”å¿…é¡»ç¡®ä¿å”¯ä¸€ã€‚\n\n### å¾®åº”ç”¨ vue2.x\n\n#### åˆå§‹åŒ–\n\nbash\n\n ä»£ç è§£è¯»\n\nå¤åˆ¶ä»£ç \n\n`# å®‰è£… vueCli $ yarn add @vue/cli # åˆ›å»ºé¡¹ç›® $ vue create vue2.x_root # é€‰æ‹© vue2 ç‰ˆæœ¬ # å®‰è£…ä¾èµ– $ yarn # å¯åŠ¨ $ yarn serve`\n\n#### æ”¹é€ æˆå¾®åº”ç”¨\n\n1.  åœ¨ `src` ç›®å½•æ–°å¢ `public-path.js`ï¼š\n\njs\n\n ä»£ç è§£è¯»\n\nå¤åˆ¶ä»£ç \n\n`if (window.__POWERED_BY_QIANKUN__) {   __webpack_public_path__ = window.__INJECTED_PUBLIC_PATH_BY_QIANKUN__; }`\n\n2.  å…¥å£æ–‡ä»¶ `main.js` ä¿®æ”¹\n\njavascript\n\n ä»£ç è§£è¯»\n\nå¤åˆ¶ä»£ç \n\n   ``import \"./public-path\";    import Vue from \"vue\";    import App from \"./App.vue\";    import VueRouter from \"vue-router\";    import routes from \"./router\";    Vue.config.productionTip = false;    let router = null;    let instance = null;    function render(props = {}) {      const { container } = props;      router = new VueRouter({        // æ³¨æ„è¿™é‡Œçš„name,æœ€å¥½ä¸è¦å†™æ­»ï¼Œç›´æ¥ä½¿ç”¨ä¸»åº”ç”¨ä¼ è¿‡æ¥çš„name        base: window.__POWERED_BY_QIANKUN__ ? `${props.name}` : \"/\",        mode: \"history\",        routes,      });      Vue.use(VueRouter);      instance = new Vue({        router,        render: (h) => h(App),      }).$mount(container ? container.querySelector(\"#app\") : \"#app\");    }    // ç‹¬ç«‹è¿è¡Œæ—¶    if (!window.__POWERED_BY_QIANKUN__) {      render();    }    export async function bootstrap() {      console.log(\"[vue2] vue app bootstraped\");    }    export async function mount(props) {      render(props);    }    export async function unmount() {      instance.$destroy();      instance.$el.innerHTML = \"\";      instance = null;      router = null;    }``\n\n3.  æ‰“åŒ…é…ç½®ä¿®æ”¹ï¼ˆ`vue.config.js`ï¼‰ï¼š\n\njavascript\n\n ä»£ç è§£è¯»\n\nå¤åˆ¶ä»£ç \n\n ``const path = require(\"path\");  const { name } = require(\"./package\");  function resolve(dir) {    return path.join(__dirname, dir);  }  module.exports = {    filenameHashing: true,    lintOnSave: process.env.NODE * ENV !== \"production\",    runtimeCompiler: true,    productionSourceMap: false,    devServer: {      hot: true,      disableHostCheck: true,      // ä¿®æ”¹é»˜è®¤ç«¯å£ï¼Œå’Œæ³¨å†Œæ—¶ä¸€ç›´      port: 8001,      overlay: {        warnings: false,        errors: true,      },      // è§£å†³ä¸»åº”ç”¨åŠ è½½å­åº”ç”¨å‡ºç°è·¨åŸŸé—®é¢˜      headers: {        \"Access-Control-Allow-Origin\": \"*\",      },    },    // è‡ªå®šä¹‰ webpack é…ç½®    configureWebpack: {      resolve: {        alias: {          \"@\": resolve(\"src\"),        },      },      // è®©ä¸»åº”ç”¨èƒ½æ­£ç¡®è¯†åˆ«å¾®åº”ç”¨æš´éœ²å‡ºæ¥çš„ä¸€äº›ä¿¡æ¯      output: {        library: `${name}-[name]`,        libraryTarget: \"umd\", // æŠŠå­åº”ç”¨æ‰“åŒ…æˆ umd åº“æ ¼å¼        jsonpFunction: `webpackJsonp*${name}`,      },    },  };``\n\n4.  ä¸»åº”ç”¨æŸ¥çœ‹åŠ è½½æ•ˆæœ\n\n![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bc6b63d160114655932fa1eb4343c048~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp)\n\n### å¾®åº”ç”¨ vue3.x\n\n#### åˆå§‹åŒ–\n\nbash\n\n ä»£ç è§£è¯»\n\nå¤åˆ¶ä»£ç \n\n`# å®‰è£… vueCli $ yarn add @vue/cli # åˆ›å»ºé¡¹ç›® $ vue create vue3.x_root # é€‰æ‹© vue3 ç‰ˆæœ¬ # å®‰è£…ä¾èµ– $ yarn # å¯åŠ¨ $ yarn serve`\n\n#### æ”¹é€ æˆå¾®åº”ç”¨\n\n1.  åœ¨ `src` ç›®å½•æ–°å¢ `public-path.js`ï¼š\n\njs\n\n ä»£ç è§£è¯»\n\nå¤åˆ¶ä»£ç \n\n`if (window.__POWERED_BY_QIANKUN__) {   __webpack_public_path__ = window.__INJECTED_PUBLIC_PATH_BY_QIANKUN__; }`\n\n2.  å…¥å£æ–‡ä»¶ `main.ts` ä¿®æ”¹\n\njavascript\n\n ä»£ç è§£è¯»\n\nå¤åˆ¶ä»£ç \n\n  ``//@ts-nocheck import './public-path'; import { createApp } from 'vue'; import { createRouter, createWebHistory } from 'vue-router'; import App from './App.vue'; import routes from './router'; import store from './store'; let router = null; let instance = null; let history = null; function render(props = {}) {   const { container } = props;   history = createWebHistory(window.__POWERED_BY_QIANKUN__ ? `${props.name}` : '/');   router = createRouter({     history,     routes,   });   instance = createApp(App);   instance.use(router);   instance.use(store);   instance.mount(container ? container.querySelector('#app') : '#app'); } if (!window.__POWERED_BY_QIANKUN__) {   render(); } export async function bootstrap() {   console.log('%c ', 'color: green;', 'vue3.0 app bootstraped'); } export async function mount(props) {   render(props); } export async function unmount() {   instance.unmount();   instance._container.innerHTML = '';   instance = null;   router = null;   history.destroy(); }``\n\n3.  æ‰“åŒ…é…ç½®ä¿®æ”¹ï¼ˆ`vue.config.js`ï¼‰ï¼š\n\njavascript\n\n ä»£ç è§£è¯»\n\nå¤åˆ¶ä»£ç \n\n ``const path = require('path') const { name } = require('./package') function resolve (dir) {   return path.join(__dirname, dir) } module.exports = {   filenameHashing: true,   lintOnSave: process.env.NODE_ENV !== 'production',   runtimeCompiler: true,   productionSourceMap: false,   devServer: {     hot: true,     disableHostCheck: true,     // ä¿®æ”¹é»˜è®¤ç«¯å£ï¼Œå’Œæ³¨å†Œæ—¶ä¸€ç›´     port: 8002,     overlay: {       warnings: false,       errors: true     },     headers: {       'Access-Control-Allow-Origin': '*'     }   },   // è‡ªå®šä¹‰webpacké…ç½®   configureWebpack: {     resolve: {       alias: {         '@': resolve('src')       }     },     // è®©ä¸»åº”ç”¨èƒ½æ­£ç¡®è¯†åˆ«å¾®åº”ç”¨æš´éœ²å‡ºæ¥çš„ä¸€äº›ä¿¡æ¯     output: {       library: `${name}-[name]`,       libraryTarget: 'umd', // æŠŠå­åº”ç”¨æ‰“åŒ…æˆ umd åº“æ ¼å¼       jsonpFunction: `webpackJsonp_${name}`     }   } }``\n\n4.  ä¸»åº”ç”¨æŸ¥çœ‹åŠ è½½æ•ˆæœ\n\n![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/176f78505bb64a0f961597d72b167605~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp)\n\n### å¾®åº”ç”¨ react\n\n#### åˆå§‹åŒ–\n\nbash\n\n ä»£ç è§£è¯»\n\nå¤åˆ¶ä»£ç \n\n`# åˆ›å»ºé¡¹ç›® $ yarn add create-react-app react_root # å¯åŠ¨ $ yarn start`\n\n#### æ”¹é€ æˆå¾®åº”ç”¨\n\n1.  åœ¨ `src` ç›®å½•æ–°å¢ `public-path.js`ï¼š\n\njs\n\n ä»£ç è§£è¯»\n\nå¤åˆ¶ä»£ç \n\n`if (window.__POWERED_BY_QIANKUN__) {   __webpack_public_path__ = window.__INJECTED_PUBLIC_PATH_BY_QIANKUN__; }`\n\n2.  è®¾ç½® history æ¨¡å¼è·¯ç”±çš„ baseï¼š\n    \n    > åˆšåˆšåˆ›å»ºçš„é¡¹ç›®æ²¡æœ‰è·¯ç”±ï¼Œæ‰€ä»¥å…ˆè¦å®‰è£…è·¯ç”±\n    \n\nbash\n\n ä»£ç è§£è¯»\n\nå¤åˆ¶ä»£ç \n\n`# è·¯ç”±å®‰è£… $ yarn add react-router react-router-dom`\n\n> å…¥å£æ–‡ä»¶ index.js ä¿®æ”¹ï¼Œä¸ºäº†é¿å…æ ¹ id #root ä¸å…¶ä»–çš„ DOM å†²çªï¼Œéœ€è¦é™åˆ¶æŸ¥æ‰¾èŒƒå›´ã€‚\n\njavascript\n\n ä»£ç è§£è¯»\n\nå¤åˆ¶ä»£ç \n\n`import './public-path'; import React from 'react'; import ReactDOM from 'react-dom'; import App from './App'; import { BrowserRouter, Route, Link } from \"react-router-dom\" function render(props) {   const { container } = props;   ReactDOM.render(     <BrowserRouter basename={window.__POWERED_BY_QIANKUN__ ? '/react' : '/'}>       <App/>     </BrowserRouter>     , container ? container.querySelector('#root') : document.querySelector('#root')); } if (!window.__POWERED_BY_QIANKUN__) {   render({}); } export async function bootstrap() {   console.log('[react16] react app bootstraped'); } export async function mount(props) {   console.log('[react16] props from main framework', props);   render(props); } export async function unmount(props) {   const { container } = props;   ReactDOM.unmountComponentAtNode(container ? container.querySelector('#root') : document.querySelector('#root')); }`\n\n3.  webpack æ‰“åŒ…é…ç½®ä¿®æ”¹\n    \n    > å®‰è£…æ’ä»¶ @rescripts/cliï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é€‰æ‹©å…¶ä»–çš„æ’ä»¶ï¼Œä¾‹å¦‚ react-app-rewired\n    \n\nbash\n\n ä»£ç è§£è¯»\n\nå¤åˆ¶ä»£ç \n\n`# å®‰è£… $ yarn add @rescripts/cli`\n\n> æ ¹ç›®å½•å¢åŠ é…ç½®æ–‡ä»¶ `.rescriptsrc.js`,æ³¨æ„ä¸€å®šæ˜¯æ ¹ç›®å½•ä¸‹å“¦\n\njavascript\n\n ä»£ç è§£è¯»\n\nå¤åˆ¶ä»£ç \n\n``const { name } = require('./package'); module.exports = {   webpack: (config) => {     config.output.library = `${name}-[name]`;     config.output.libraryTarget = 'umd';     config.output.jsonpFunction = `webpackJsonp_${name}`;     config.output.globalObject = 'window';     return config;   },   devServer: (_) => {     const config = _;     config.headers = {       'Access-Control-Allow-Origin': '*',     };     config.historyApiFallback = true;     config.hot = false;     config.watchContentBase = false;     config.liveReload = false;     return config;   }, };``\n\n4.  `package.json`é…ç½®ä¿®æ”¹\n\njavascript\n\n ä»£ç è§£è¯»\n\nå¤åˆ¶ä»£ç \n\n`{   \"name\": \"react_root\",   \"version\": \"0.1.0\",   \"private\": true,   \"dependencies\": {     \"@rescripts/cli\": \"^0.0.16\",     \"@testing-library/jest-dom\": \"^5.11.4\",     \"@testing-library/react\": \"^11.1.0\",     \"@testing-library/user-event\": \"^12.1.10\",     \"react\": \"^17.0.2\",     \"react-dom\": \"^17.0.2\",     \"react-router-dom\": \"5.0\",     \"react-scripts\": \"4.0.3\",     \"web-vitals\": \"^1.0.1\"   },   \"scripts\": {     \"start\": \"set PORT=8003&&rescripts  start\",     \"build\": \"rescripts  build\",     \"test\": \"rescripts  test\",     \"eject\": \"rescripts  eject\"   },   \"eslintConfig\": {     \"extends\": [       \"react-app\",       \"react-app/jest\"     ]   },   \"browserslist\": {     \"production\": [       \">0.2%\",       \"not dead\",       \"not op_mini all\"     ],     \"development\": [       \"last 1 chrome version\",       \"last 1 firefox version\",       \"last 1 safari version\"     ]   } }`\n\n5.  ä¸»åº”ç”¨æŸ¥çœ‹åŠ è½½æ•ˆæœ\n\n![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9d61df1efe31424682f6a13f5bc60cb1~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp)\n\n### å¾®åº”ç”¨ umi\n\n> umi é¡¹ç›®åˆå§‹åŒ–æ–¹å¼å‚è€ƒåˆå§‹åŒ–ä¸»åº”ç”¨çš„æ–¹å¼ã€‚umi åº”ç”¨ä½¿ç”¨ `@umijs/plugin-qiankun` å¯ä»¥ä¸€é”®å¼€å¯å¾®å‰ç«¯æ¨¡å¼ã€‚\n\n#### å¯ç”¨æ–¹å¼\n\n1.  å®‰è£…æ’ä»¶\n\nbash\n\n ä»£ç è§£è¯»\n\nå¤åˆ¶ä»£ç \n\n`# å®‰è£… @umijs/plugin-qiankun $ yarn add @umijs/plugin-qiankun`\n\n2.  ä¿®æ”¹é…ç½®æ–‡ä»¶ `umirc.ts`\n    \n    > å¦‚æœæ˜¯é…ç½®æ–‡ä»¶æŠ½ç¦»åˆ°`config`ä¸­ï¼Œç›´æ¥ä¿®æ”¹ `config.js`\n    \n\njs\n\n ä»£ç è§£è¯»\n\nå¤åˆ¶ä»£ç \n\n`import { defineConfig } from 'umi'; export default defineConfig({   nodeModulesTransform: {     type: 'none',   },   routes: [     { path: '/', component: '@/pages/index' },   ],   fastRefresh: {},   //å¼€å¯qiankuné…ç½®   qiankun:{     slave:{     }   } });`\n\n> è¿™é‡Œåªæ˜¯åšäº†ç®€å•çš„é›†æˆé…ç½®ï¼Œæ›´è¿‡åŠŸèƒ½è¯·å‚çœ‹[@umijs/plugin-qiankun](https://link.juejin.cn?target=https%3A%2F%2Fumijs.org%2Fzh-CN%2Fplugins%2Fplugin-qiankun \"https://umijs.org/zh-CN/plugins/plugin-qiankun\")\n\n3.  åŠ è½½æ•ˆæœ\n\n![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cad400cccd114bb59272325ad5453650~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp)\n\n### å¾®åº”ç”¨é webpack åº”ç”¨\n\n> é webpack åº”ç”¨æœ‰ä¸ªéœ€è¦æ³¨æ„ç‚¹çš„ç‚¹ï¼šæ¥å…¥ä¹‹å‰è¯·ç¡®ä¿ä½ çš„é¡¹ç›®é‡Œçš„å›¾ç‰‡ã€éŸ³è§†é¢‘ç­‰èµ„æºèƒ½æ­£å¸¸åŠ è½½ï¼Œå¦‚æœè¿™äº›èµ„æºçš„åœ°å€éƒ½æ˜¯å®Œæ•´è·¯å¾„ï¼ˆä¾‹å¦‚ [qiankun.umijs.org/logo.pngï¼‰ï¼Œåˆ™â€¦](https://link.juejin.cn?target=https%3A%2F%2Fqiankun.umijs.org%2Flogo.png%25EF%25BC%2589%25EF%25BC%258C%25E5%2588%2599%25E6%25B2%25A1%25E9%2597%25AE%25E9%25A2%2598%25E3%2580%2582%25E5%25A6%2582%25E6%259E%259C%25E9%2583%25BD%25E6%2598%25AF%25E7%259B%25B8%25E5%25AF%25B9%25E8%25B7%25AF%25E5%25BE%2584%25EF%25BC%258C%25E9%259C%2580%25E8%25A6%2581%25E5%2585%2588%25E5%25B0%2586%25E8%25BF%2599%25E4%25BA%259B%25E8%25B5%2584%25E6%25BA%2590%25E4%25B8%258A%25E4%25BC%25A0%25E5%2588%25B0%25E6%259C%258D%25E5%258A%25A1%25E5%2599%25A8%25EF%25BC%258C%25E4%25BD%25BF%25E7%2594%25A8%25E5%25AE%258C%25E6%2595%25B4%25E8%25B7%25AF%25E5%25BE%2584%25E3%2580%2582 \"https://qiankun.umijs.org/logo.png%EF%BC%89%EF%BC%8C%E5%88%99%E6%B2%A1%E9%97%AE%E9%A2%98%E3%80%82%E5%A6%82%E6%9E%9C%E9%83%BD%E6%98%AF%E7%9B%B8%E5%AF%B9%E8%B7%AF%E5%BE%84%EF%BC%8C%E9%9C%80%E8%A6%81%E5%85%88%E5%B0%86%E8%BF%99%E4%BA%9B%E8%B5%84%E6%BA%90%E4%B8%8A%E4%BC%A0%E5%88%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%8C%E4%BD%BF%E7%94%A8%E5%AE%8C%E6%95%B4%E8%B7%AF%E5%BE%84%E3%80%82\")\n\n1.  å…¥å£æ–‡ä»¶å£°æ˜ `entry`å…¥å£\n\nhtml\n\n ä»£ç è§£è¯»\n\nå¤åˆ¶ä»£ç \n\n`<!DOCTYPE html> <html lang=\"en\">   <head>     <meta charset=\"UTF-8\" />     <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" />     <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />     <title>Document</title>   </head>   <script src=\"https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.min.js\"></script>   <body>     <div id=\"test\">æµ‹è¯•å¾®åº”ç”¨</div>   </body> </html> <!-- entry å…¥å£ --> <script src=\"./index.js\" entry></script>`\n\n2.  index.js\n\njs\n\n ä»£ç è§£è¯»\n\nå¤åˆ¶ä»£ç \n\n`const render = ($) => {   // è¿™é‡Œå¯ä»¥åœ¨æ¸²æŸ“ä¹‹å‰åšäº›ä»€ä¹ˆã€‚ã€‚ã€‚     return Promise.resolve();   };   ((global) => {    //purehtml æ˜¯å¯¹åº”çš„å¾®åº”ç”¨åç§°     global['purehtml'] = {       bootstrap: () => {         console.log('purehtml bootstrap');         return Promise.resolve();       },       mount: (props) => {         console.log('purehtml mount00000000000',props);         props.onGlobalStateChange((state,prev)=>{           console.log(state,prev)         })         return render($);       },       unmount: () => {         console.log('purehtml unmount');         return Promise.resolve();       },     };   })(window);`\n\n3.  ä¸ºäº†æ–¹ä¾¿å¯åŠ¨å’ŒåŠ è½½ï¼Œä½¿ç”¨ `http-server` å¯åŠ¨æœ¬åœ°æœåŠ¡\n    \n    > æ ¹ç›®å½•å¢åŠ  `package.json`æ–‡ä»¶, æ³¨æ„`name`:`purehtml`\n    \n\njson\n\n ä»£ç è§£è¯»\n\nå¤åˆ¶ä»£ç \n\n`{     \"name\": \"purehtml\",     \"version\": \"1.0.0\",     \"description\": \"\",     \"main\": \"index.html\",     \"scripts\": {       \"start\": \"cross-env PORT=8005 http-server . --cors\",       \"test\": \"echo \\\"Error: no test specified\\\" && exit 1\"     },     \"author\": \"\",     \"license\": \"MIT\",     \"devDependencies\": {       \"cross-env\": \"^7.0.2\",       \"http-server\": \"^0.12.1\"     }   }`\n\n4.  åŠ è½½æ•ˆæœ\n\n![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8f981a38a98840a89ce5c352899fbb73~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp)\n\n### å¾®åº”ç”¨ Angular\n\n#### åˆå§‹åŒ–\n\nbash\n\n ä»£ç è§£è¯»\n\nå¤åˆ¶ä»£ç \n\n`# å®‰è£… CLI $ yarn add -g @angular/cli@9.1.12 # åˆ›å»ºé¡¹ç›® $ ng new angular_root # å¯åŠ¨ $ ng serve`\n\n#### æ”¹é€ æˆå¾®åº”ç”¨\n\n1.  åœ¨ `src` ç›®å½•æ–°å¢ `public-path.js`ï¼š\n\njs\n\n ä»£ç è§£è¯»\n\nå¤åˆ¶ä»£ç \n\n`if (window.__POWERED_BY_QIANKUN__) {   // eslint-disable-next-line no-undef   __webpack_public_path__ = window.__INJECTED_PUBLIC_PATH_BY_QIANKUN__; } }`\n\n2.  è®¾ç½® history æ¨¡å¼è·¯ç”±çš„ baseï¼Œ`src/app/app-routing.module.ts` æ–‡ä»¶ï¼š\n\njs\n\n ä»£ç è§£è¯»\n\nå¤åˆ¶ä»£ç \n\n`import { NgModule } from '@angular/core'; import { Routes, RouterModule } from '@angular/router'; import { APP_BASE_HREF } from '@angular/common'; const routes: Routes = []; @NgModule({   imports: [RouterModule.forRoot(routes)],   exports: [RouterModule],   // @ts-ignore   providers: [{ provide: APP_BASE_HREF, useValue: window.__POWERED_BY_QIANKUN__ ? '/angular' : '/' }] }) export class AppRoutingModule { }`\n\n3.  ä¿®æ”¹å…¥å£æ–‡ä»¶ï¼Œsrc/main.ts æ–‡ä»¶\n\njs\n\n ä»£ç è§£è¯»\n\nå¤åˆ¶ä»£ç \n\n`import './public-path'; import { enableProdMode, NgModuleRef } from '@angular/core'; import { platformBrowserDynamic } from '@angular/platform-browser-dynamic'; import { AppModule } from './app/app.module'; import { environment } from './environments/environment'; if (environment.production) {   enableProdMode(); } let app: void | NgModuleRef<AppModule>; async function render() {   app = await platformBrowserDynamic()     .bootstrapModule(AppModule)     .catch((err) => console.error(err)); } if (!(window as any).__POWERED_BY_QIANKUN__) {   render(); } export async function bootstrap(props: Object) {   console.log(props); } export async function mount(props: Object) {   render(); } export async function unmount(props: Object) {   console.log(props);   // @ts-ignore   app.destroy(); }`\n\n4.  ä¿®æ”¹ webpack æ‰“åŒ…é…ç½®\n    \n    > æ ¹æ®å®˜æ–¹æŒ‡ç¤ºï¼šå…ˆå®‰è£… `@angular-builders/custom-webpack` ï¼Œæ³¨æ„ï¼šangular 9 é¡¹ç›®åªèƒ½å®‰è£… 9.x ç‰ˆæœ¬ï¼Œangular 10 é¡¹ç›®å¯ä»¥å®‰è£…æœ€æ–°ç‰ˆã€‚\n    \n\nbash\n\n ä»£ç è§£è¯»\n\nå¤åˆ¶ä»£ç \n\n`$ yarn add @angular-builders/custom-webpack@9.2.0`\n\n> åœ¨æ ¹ç›®å½•å¢åŠ  `custom-webpack.config.js`\n\njs\n\n ä»£ç è§£è¯»\n\nå¤åˆ¶ä»£ç \n\n``const appName = require('./package.json').name; module.exports = {   devServer: {     headers: {       'Access-Control-Allow-Origin': '*',     },   },   output: {     library: `${appName}-[name]`,     libraryTarget: 'umd',     jsonpFunction: `webpackJsonp_${appName}`,   }, };``\n\n> ä¿®æ”¹ angular.json é…ç½®æ–‡ä»¶\n\njson\n\n ä»£ç è§£è¯»\n\nå¤åˆ¶ä»£ç \n\n`{   \"$schema\": \"./node_modules/@angular/cli/lib/config/schema.json\",   \"version\": 1,   \"newProjectRoot\": \"projects\",   \"projects\": {     \"angularRoot\": {       \"projectType\": \"application\",       \"schematics\": {         \"@schematics/angular:component\": {           \"style\": \"scss\"         }       },       \"root\": \"\",       \"sourceRoot\": \"src\",       \"prefix\": \"app\",       \"architect\": {         \"build\": {           \"builder\": \"@angular-builders/custom-webpack:browser\",           \"options\": {             \"outputPath\": \"dist/angularRoot\",             \"index\": \"src/index.html\",             \"main\": \"src/main.ts\",             \"polyfills\": \"src/polyfills.ts\",             \"tsConfig\": \"tsconfig.app.json\",             \"aot\": true,             \"assets\": [               \"src/favicon.ico\",               \"src/assets\"             ],             \"styles\": [               \"src/styles.scss\"             ],             \"scripts\": [],             \"customWebpackConfig\": {               \"path\": \"./custom-webpack.config.js\"             }           },           \"configurations\": {             \"production\": {               \"fileReplacements\": [                 {                   \"replace\": \"src/environments/environment.ts\",                   \"with\": \"src/environments/environment.prod.ts\"                 }               ],               \"optimization\": true,               \"outputHashing\": \"all\",               \"sourceMap\": false,               \"extractCss\": true,               \"namedChunks\": false,               \"extractLicenses\": true,               \"vendorChunk\": false,               \"buildOptimizer\": true,               \"budgets\": [                 {                   \"type\": \"initial\",                   \"maximumWarning\": \"2mb\",                   \"maximumError\": \"5mb\"                 },                 {                   \"type\": \"anyComponentStyle\",                   \"maximumWarning\": \"6kb\",                   \"maximumError\": \"10kb\"                 }               ]             }           }         },         \"serve\": {           \"builder\": \"@angular-builders/custom-webpack:dev-server\",           \"options\": {             \"browserTarget\": \"angularRoot:build\"           },           \"configurations\": {             \"production\": {               \"browserTarget\": \"angularRoot:build:production\"             }           }         },         \"extract-i18n\": {           \"builder\": \"@angular-devkit/build-angular:extract-i18n\",           \"options\": {             \"browserTarget\": \"angularRoot:build\"           }         },         \"test\": {           \"builder\": \"@angular-devkit/build-angular:karma\",           \"options\": {             \"main\": \"src/test.ts\",             \"polyfills\": \"src/polyfills.ts\",             \"tsConfig\": \"tsconfig.spec.json\",             \"karmaConfig\": \"karma.conf.js\",             \"assets\": [               \"src/favicon.ico\",               \"src/assets\"             ],             \"styles\": [               \"src/styles.scss\"             ],             \"scripts\": []           }         },         \"lint\": {           \"builder\": \"@angular-devkit/build-angular:tslint\",           \"options\": {             \"tsConfig\": [               \"tsconfig.app.json\",               \"tsconfig.spec.json\",               \"e2e/tsconfig.json\"             ],             \"exclude\": [               \"**/node_modules/**\"             ]           }         },         \"e2e\": {           \"builder\": \"@angular-devkit/build-angular:protractor\",           \"options\": {             \"protractorConfig\": \"e2e/protractor.conf.js\",             \"devServerTarget\": \"angularRoot:serve\"           },           \"configurations\": {             \"production\": {               \"devServerTarget\": \"angularRoot:serve:production\"             }           }         }       }     }   },   \"defaultProject\": \"angular\" }`\n\n5.  å¯åŠ¨å°è¯•åŠ è½½\n    \n    > å“‡å’”å’”ï¼ï¼ï¼ æŠ¥é”™ã€‚ã€‚ã€‚\n    \n\n![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e9612d0173864cd6a70e31313a76a500~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp)\n\n*   è§£å†³æ–¹å¼\n    \n    *   ä¸»åº”ç”¨ä¸­å®‰è£… `zoom.js` , å¹¶ä¸”åœ¨ `import qiankun` ä¹‹å‰å¼•å…¥\n    *   å°†å¾®åº”ç”¨çš„ `src/polyfills.ts` é‡Œé¢çš„å¼•å…¥ `zone.js`\n    *   å¾®åº”ç”¨ `src/index.html` `<head>` ä¸­å¼•å…¥ `zone.js`\n\n6.  å†æ¬¡å¯åŠ¨å°è¯•åŠ è½½\n    \n    > å“‡å’”å’”ï¼ï¼ï¼ åˆæŠ¥é”™äº†ã€‚ã€‚ã€‚ ä»€ä¹ˆé¬¼ï¼Œé¡µé¢å€’æ˜¯åŠ è½½å‡ºæ¥äº†ï¼Œä½†æ˜¯æŠ¥äº†ä¸€ä¸²çº¢\n    \n\n![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/426ab88fbf7e4c36997699ce658eeb24~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp)\n\n> æŸ¥é˜…èµ„æ–™ï¼Œè²Œä¼¼æ˜¯çƒ­æ›´æ–°çš„ `bug` å•Šã€‚ è¿™é‡Œä¸åšè¿‡å¤šè§£é‡Šï¼Œæš´åŠ›è§£å†³æ–¹æ¡ˆï¼š`ä½œä¸ºå­åº”ç”¨æ—¶ä¸ä½¿ç”¨çƒ­æ›´æ–°`ã€‚\n\n*   `package.json` => `script` ä¸­å¢åŠ å¦‚ä¸‹å‘½ä»¤ï¼š\n\njs\n\n ä»£ç è§£è¯»\n\nå¤åˆ¶ä»£ç \n\n`\"serve:qiankun\": \"ng serve --disable-host-check --port 8006 --base-href /angular --live-reload false\"`\n\n> ä½œä¸ºå¾®åº”ç”¨æ—¶ä½¿ç”¨ï¼š`ng serve:qiankuan` å¯åŠ¨åŠ è½½\n\n> build æŠ¥é”™é—®é¢˜ï¼š ä¿®æ”¹ `tsconfig.json` æ–‡ä»¶\n\njson\n\n ä»£ç è§£è¯»\n\nå¤åˆ¶ä»£ç \n\n`{   \"compileOnSave\": false,   \"compilerOptions\": {     \"baseUrl\": \"./\",     \"outDir\": \"./dist/out-tsc\",     \"sourceMap\": true,     \"declaration\": false,     \"downlevelIteration\": true,     \"experimentalDecorators\": true,     \"module\": \"esnext\",     \"moduleResolution\": \"node\",     \"importHelpers\": true,     \"target\": \"es5\",     \"typeRoots\": [\"node_modules/@types\"],     \"lib\": [\"es2018\", \"dom\"]   },   \"angularCompilerOptions\": {     \"fullTemplateTypeCheck\": true,     \"strictInjectionParameters\": true   } }`\n\n4.  æŸ¥çœ‹åŠ è½½æ•ˆæœ\n\n![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d14cace27e7448b192e220f7efcca1ab~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp)\n\nåº”ç”¨é—´é€šä¿¡\n-----\n\n> å¤šä¸ªåº”ç”¨é—´é€šä¿¡ï¼Œè¿™é‡Œä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼šä¸»åº”ç”¨ä¸­ç™»å½•è·å–ç”¨æˆ·`id`ï¼Œå½“åŠ è½½å¾®åº”ç”¨æ—¶ï¼Œå¾®åº”ç”¨éœ€è¦æ ¹æ®ä¸åŒçš„ç”¨æˆ· `id` å±•ç¤ºä¸åŒçš„æ•°æ®æˆ–è€…å±•ç¤ºä¸åŒçš„é¡µé¢ã€‚è¿™ä¸ªæ—¶å€™å°±éœ€è¦ä¸»åº”ç”¨ä¸­æŠŠå¯¹åº”çš„ç”¨æˆ·`id`ä¼ åˆ°å¾®åº”ç”¨ä¸­å»ã€‚ä¼ å€¼æ–¹å¼ï¼Œè¿™é‡Œæ€»ç»“äº†ä¸‰ç§æ–¹å¼ï¼š\n\n*   æŒ‚è½½å¾®åº”ç”¨æ—¶ç›´æ¥`props`ä¼ å€¼\n*   `initGlobalState` å®šä¹‰å…¨å±€çŠ¶æ€\n*   å®šä¹‰å…¨å±€çš„çŠ¶æ€æ± \n\n### props ä¼ å€¼\n\n> æ³¨å†Œå¾®åº”ç”¨çš„åŸºç¡€é…ç½®ä¿¡æ¯æ—¶ï¼Œå¢åŠ  `props` ,ä¼ å…¥å¾®åº”ç”¨éœ€è¦çš„ä¿¡æ¯\n\njs\n\n ä»£ç è§£è¯»\n\nå¤åˆ¶ä»£ç \n\n`{     name: 'vue2',     entry: 'http://localhost:8001',     container: '#subContainer',     activeRule: '/vue2',     //props     props: {       id: 'propsåŸºç¡€ä¼ å€¼æ–¹å¼'     },     loader,   }`\n\n> å¾®åº”ç”¨ä¸­åœ¨ `mount` ç”Ÿå‘½å‘¨æœŸ `props` ä¸­è·å–\n\njs\n\n ä»£ç è§£è¯»\n\nå¤åˆ¶ä»£ç \n\n`export async function mount(props) {   console.log('è·å–ä¸»åº”ç”¨ä¼ å€¼',props)   render(props); }`\n\n![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9e9abb2508fe45239e31a8ad21dc1caf~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp)\n\n### initGlobalState (æ¨è)\n\n> å®šä¹‰å…¨å±€çŠ¶æ€ï¼Œå¹¶è¿”å›é€šä¿¡æ–¹æ³•ï¼Œå»ºè®®åœ¨ä¸»åº”ç”¨ä½¿ç”¨ï¼Œå¾®åº”ç”¨é€šè¿‡ `props` è·å–é€šä¿¡æ–¹æ³•ã€‚\n\n1.  ä¸»åº”ç”¨ä¸­å£°æ˜å…¨å±€çŠ¶æ€\n\njs\n\n ä»£ç è§£è¯»\n\nå¤åˆ¶ä»£ç \n\n`// å…¨å±€çŠ¶æ€ const state = {   id: 'main_ä¸»åº”ç”¨', }; // åˆå§‹åŒ– state const actions: MicroAppStateActions = initGlobalState(state); // ç›‘å¬çŠ¶æ€å˜æ›´ actions.onGlobalStateChange((state, prev) => {   // state: å˜æ›´åçš„çŠ¶æ€; prev å˜æ›´å‰çš„çŠ¶æ€   console.log(state, prev); });`\n\n2.  å¾®åº”ç”¨è·å–é€šä¿¡,åŒæ ·åœ¨ `mount` ç”Ÿå‘½å‘¨æœŸä¸­è·å–\n\njs\n\n ä»£ç è§£è¯»\n\nå¤åˆ¶ä»£ç \n\n`export async function mount(props) {   console.log('initGlobalStateä¼ å€¼',props)   render(props); }`\n\næ‰“å°å‡ºæ¥å‘ç°å¥½åƒå¹¶æ²¡æœ‰æˆ‘ä»¬éœ€è¦çš„å€¼ï¼š\n\n![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/05d11767c91f494e9ab2e185fc96e4a3~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp)\n\n> æˆ‘æƒ³åœ¨è¿™é‡Œï¼Œç»†å¿ƒçš„åŒå­¦åº”è¯¥ä¼šå‘ç°ï¼Œå¥½åƒæœ‰ä¸ª`onGlobalStateChange`ï¼Œ`setGlobalState` è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œè§åçŸ¥æ„ï¼Œåº”è¯¥æ˜¯ç”¨æ¥åšçŠ¶æ€çš„ç›‘å¬å’Œä¿®æ”¹ä½¿ç”¨çš„ã€‚ä¸ç®¡ä»€ä¹ˆç¥ä»™ï¼Œå…ˆè°ƒç”¨ä¸‹è¯•è¯•çœ‹å–½\n\n> å°è£…ä¸€ä¸ª `storeTest` æ–¹æ³•åšç»Ÿä¸€è°ƒç”¨\n\njs\n\n ä»£ç è§£è¯»\n\nå¤åˆ¶ä»£ç \n\n``function storeTest(props) {   props.onGlobalStateChange &&     props.onGlobalStateChange(       (value, prev) => console.log(`[onGlobalStateChange - ${props.name}]:`, value, prev),       true,     );   // ä¸ºäº†æ¼”ç¤ºæ•ˆæœæ˜æ˜¾å¢åŠ å®šæ—¶å™¨     setTimeout(() =>{       props.setGlobalState &&       props.setGlobalState({         id: `${props.name}_å­åº”ç”¨`       });     },3000) }``\n\njs\n\n ä»£ç è§£è¯»\n\nå¤åˆ¶ä»£ç \n\n`export async function mount(props) {   storeTest(props);   render(props); }`\n\n![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5759a6a2ce2b43be99df76870052a0a7~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp)\n\n`è¾“å‡ºä¸¤æ¬¡ ï¼Ÿï¼Ÿï¼Ÿ`\n\n> è¾“å‡ºä¸¤æ¬¡çš„åŸå› æ˜¯åœ¨ `å¾®åº”ç”¨` ä¸­è°ƒç”¨ `setGlobalState` , ä¸»åº”ç”¨ä¸­çš„ `onGlobalStateChange` ä¹Ÿä¼šæ‰§è¡Œ\n\n3.  æ€»ç»“ä¸‹\n\n*   `initGlobalState` åˆå§‹åŒ– `state`\n*   `onGlobalStateChange` ç›‘å¬çŠ¶æ€å˜æ›´\n*   `setGlobalState` ä¿®æ”¹çŠ¶æ€\n*   `offGlobalStateChange` ç§»é™¤ç›‘å¬\n\n4.  é—®é¢˜\n\n> å¦‚æœæƒ³åœ¨å¾®åº”ç”¨æŸä¸ªé¡µé¢å†…ä¿®æ”¹å…¨å±€çŠ¶æ€åº”è¯¥æ€ä¹ˆåš ï¼Ÿ å½“ç„¶æ˜¯å¯ä»¥æŠŠ `props` ä¸­çš„æ–¹æ³•æŒ‚è½½åˆ°å½“å‰åº”ç”¨çš„å…¨å±€ä¸Šå•¦ã€‚ä¾‹å¦‚ï¼š\n\njs\n\n ä»£ç è§£è¯»\n\nå¤åˆ¶ä»£ç \n\n`export async function mount(props) {   storeTest(props);   render(props);   // æŒ‚è½½åˆ°å…¨å±€ instance ä¸Š   instance.config.globalProperties.$onGlobalStateChange = props.onGlobalStateChange;   instance.config.globalProperties.$setGlobalState = props.setGlobalState; }`\n\n### å®šä¹‰å…¨å±€çš„çŠ¶æ€æ± \n\n> å®šä¹‰å…¨å±€çŠ¶æ€æ± ï¼Œè¯´ç™½äº†å°±æ˜¯åœ¨ä¸»åº”ç”¨ä¸­å®šä¹‰å…¨å±€çŠ¶æ€ï¼Œå¯ä»¥ä½¿ç”¨ `redux` `vuex` ç­‰æ¥å®šä¹‰ã€‚å®šä¹‰å¥½å…¨å±€çŠ¶æ€ï¼Œå¯ä»¥å®šä¹‰ä¸€ä¸ªå…¨å±€çš„ç±»ï¼Œç±»ä¸­å£°æ˜ä¸¤ä¸ªæ–¹æ³•ï¼Œä¸€ä¸ªç”¨æ¥è·å–å…¨å±€çŠ¶æ€ï¼Œä¸€ä¸ªç”¨æ¥ä¿®æ”¹å…¨å±€çŠ¶æ€ã€‚å®šä¹‰å¥½ä¹‹åï¼ŒæŠŠè¿™ä¸ªç±»é€šè¿‡ç¬¬ä¸€ç§ `props` çš„ä¼ å€¼æ–¹å¼ä¼ å…¥ï¼Œå¾®åº”ç”¨é€šè¿‡ `mount`\\=>`props` æ¥æ”¶ã€‚è¿™ç§æ–¹å¼å°±ä¸åšæ¼”ç¤ºï¼Œä¸ªäººå»ºè®®ä½¿ç”¨ç¬¬äºŒç§æ–¹å¼ã€‚\n\næ€»ç»“\n--\n\n> åˆ°è¿™é‡Œï¼ŒåŸºäº`qiankun`çš„å¾®å‰ç«¯æ­å»ºåŸºæœ¬å®Œæˆã€‚æœ¬æ–‡åªæ˜¯å¯¹qiankunä»0æ­å»ºåˆ°æ­å»ºè¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜å¹¶ä¸”è§£å†³é—®é¢˜ä»¥åŠåæœŸé¡¹ç›®ä¸­çš„ä¸€äº›åŸºç¡€é…ç½®å’Œä½¿ç”¨åšç®€å•æ¦‚è¿°ã€‚ä¸‹ä¸€æ¬¡å°†ä¼šå¯¹`å¤šåº”ç”¨éƒ¨ç½²`é—®é¢˜åšä¸ªè¯¦ç»†æ¦‚è¿°ã€‚\n\næºç åœ°å€\n----\n\n[github.com/xushanpei/qâ€¦](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxushanpei%2Fqiankun_template \"https://github.com/xushanpei/qiankun_template\")\n\næœ€å\n--\n\n> å¦‚æœè§‰å¾—æœ¬æ–‡å¯¹ä½ æœ‰å¸®åŠ©ï¼Œå¸Œæœ›èƒ½å¤Ÿç»™æˆ‘ç‚¹èµæ”¯æŒä¸€ä¸‹å“¦ ğŸ’ª ä¹Ÿå¯ä»¥å…³æ³¨å…¬ä¼—å·ï¼š**å‰ç«¯å¼€å‘çˆ±å¥½è€…** ä¸€èµ·å­¦ä¹ å‰ç«¯æŠ€èƒ½"
}