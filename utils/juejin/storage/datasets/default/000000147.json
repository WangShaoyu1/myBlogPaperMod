{
	"title": "ç”¨Optionalåä»£ç å˜æ¸…çˆ½å¤šäº†",
	"author": "ç‹¼çˆ·",
	"publishTime": "2024-09-07",
	"readTime": "é˜…è¯»5åˆ†é’Ÿ",
	"tags": "[\"Java\",\"ç¼–ç¨‹è¯­è¨€\"]",
	"description": "ä¸å…¶åœ¨åˆ¤ç©ºçš„æ³¥æ½­é‡Œè¶Šé™·è¶Šæ·±ï¼Œä¸å¦‚æ‹¥æŠ±Optionalï¼Œè®©æˆ‘ä»¬çš„ä»£ç è½»ç›ˆèµ·èˆï¼Œè¿œç¦»â€œç©ºæŒ‡é’ˆâ€çš„é˜´éœ¾ï¼Œè¿ˆå‘æ›´åŠ ä¼˜é›…å’Œå¥å£®çš„ç¼–ç¨‹æ–°å¢ƒç•Œã€‚",
	"article": "å‰è¨€\n--\n\nç¼–ç¨‹è·¯ä¸Šé£é›¨å…¼ç¨‹ï¼Œè¸©è¿‡çš„å‘æ¯”å–è¿‡çš„å¥¶èŒ¶è¿˜è¦å¤šå‡ åˆ†å›å‘³ã€‚ä»Šå¤©ï¼Œå’±ä»¬æ·±å…¥æµ…å‡ºï¼Œæ¢è®¨ä¸€ä¸ªæ—¢å¹³å‡¡åˆæ·±å¥¥çš„æ“ä½œâ€”â€”åˆ¤ç©ºè‰ºæœ¯ï¼Œç‰¹åˆ«æ˜¯é‚£ç»å…¸æ¡¥æ®µ != nullã€‚åœ¨ä¸è‡­åæ˜­è‘—çš„ NullPointerExceptionï¼ˆç®€ç§°NPEï¼Œç¨‹åºç•Œçš„â€œç©ºæŒ‡é’ˆå™©æ¢¦â€ï¼‰çš„æŒä¹…æˆ˜ä¸­ï¼Œè¿™æ‹›å‡ ä¹æ˜¯ç¨‹åºå‘˜çš„æŠ¤èº«æ³•å®ã€‚\n\næƒ³å½“å¹´ï¼Œæˆ‘è¿˜æ˜¯ç¼–ç¨‹ç•Œçš„æ–°å…µè›‹å­ï¼Œå¯¹ null æ•æ„Ÿå¾—åƒé›·è¾¾ï¼Œé€¢ null å¿…ä¸¥è°¨åˆ¤ç©ºï¼Œif (æŸç‰© != null)ç®€ç›´æ˜¯å¼€åœºç™½ä¸€èˆ¬çš„å­˜åœ¨ã€‚ä½†éšç€æ—¶é—´çš„å‘é…µï¼Œç»éªŒå€¼è¹­è¹­ä¸Šæ¶¨ï¼Œæˆ‘æ¸æ¸æ‚Ÿå‡ºï¼šè¿™é¢‘ç¹çš„åˆ¤ç©ºè™½æ˜¯ä¿é™©ï¼Œå´ä¹Ÿåƒç»™ä»£ç ç©¿ä¸Šäº†ä¸€å±‚åˆä¸€å±‚çš„ç§‹è¡£ï¼Œè‡ƒè‚¿ä¸è¯´ï¼Œè¿˜å¸¸å¸¸æ‚å‡ºäº›éš¾ä»¥æ‰æ‘¸çš„Bugæ¥ã€‚\n\nè¯•æƒ³ï¼Œä»£ç é‡Œå¸ƒæ»¡äº†è¿·å®«èˆ¬çš„ if-else åˆ¤ç©ºé€»è¾‘ï¼Œåˆ«è¯´ä¸€çœ¼æ‰¾å‡ºBugï¼Œå°±ç®—ä½ çªå¤§çœ¼ç›å¤–åŠ æ”¾å¤§é•œï¼Œä¹Ÿå¾—ç»•æ™•åœ¨é‚£â€œæ˜¯ç©ºéç©ºâ€çš„å“²å­¦è¿·é›¾ä¸­ã€‚æ›´åˆ«æï¼Œè¿‡åº¦åˆ¤ç©ºè®©ç¨‹åºå‘˜ä»¬å˜å¾—è‰æœ¨çš†å…µï¼Œæ¯è¡Œä»£ç éƒ½è—ç€ä¸€é¢—â€œæˆ‘åˆ°åº•æœ‰æ²¡æœ‰åˆ¤ç©ºï¼Ÿâ€çš„å¿å¿‘å¿ƒã€‚è¿™æ—¶å€™ï¼Œä¿®å¤Bugå°±åƒæ‹†ç›²ç›’ï¼Œåˆºæ¿€ä¸­å¸¦ç€ä¸€ä¸æ— å¥ˆï¼šâ€œæˆ‘å½“åˆä¸ºå•¥è¦åˆ¤è¿™ä¸ªç©ºæ¥ç€ï¼Ÿâ€ğŸ˜¢\n\nå¥½åœ¨ï¼ŒJava 8 å¸¦æ¥äº†æ•‘æ˜Ÿâ€”â€”Optionalï¼Œå®ƒç®€ç›´å°±æ˜¯åˆ¤ç©ºç•Œçš„æ¸…æµï¼Œä¼˜é›…åœ°è§£å†³äº†æˆ‘ä»¬çš„é—®é¢˜ã€‚ä½¿ç”¨ Optionalï¼Œä½ å¯ä»¥æŠŠå¯èƒ½ä¸º null çš„å¯¹è±¡åŒ…è£¹èµ·æ¥ï¼Œé€šè¿‡ä¸€ç³»åˆ—ç®€æ´çš„æ–¹æ³•è°ƒç”¨æ¥é¿å…ç›´æ¥è§¦ç¢°é‚£ä»¤äººå¤´ç–¼çš„ nullï¼Œä»è€Œè®©ä»£ç æ›´åŠ æ¸…æ™°ã€å®‰å…¨ï¼Œä»¿ä½›ç»™ä»£ç åšäº†ä¸€åœºç‘œä¼½ï¼ŒæŸ”éŸ§ä¸”æœ‰åŠ›ã€‚\n\næ‰€ä»¥ï¼Œä¸å…¶åœ¨åˆ¤ç©ºçš„æ³¥æ½­é‡Œè¶Šé™·è¶Šæ·±ï¼Œä¸å¦‚æ‹¥æŠ± Optionalï¼Œè®©æˆ‘ä»¬çš„ä»£ç è½»ç›ˆèµ·èˆï¼Œè¿œç¦» â€œç©ºæŒ‡é’ˆâ€çš„é˜´éœ¾ï¼Œè¿ˆå‘æ›´åŠ ä¼˜é›…å’Œå¥å£®çš„ç¼–ç¨‹æ–°å¢ƒç•Œã€‚ğŸŒŸ\n\nç”¨ Optional æ¥æ‹¯æ•‘ä½ çš„ä»£ç \n------------------\n\nJava 8 ç»™æˆ‘ä»¬å¸¦æ¥äº†ä¸ªç¥å™¨â€”â€”`Optional`ã€‚ ç®€å•æ¥è¯´ï¼Œå®ƒå°±æ˜¯ä¸ªåŒ…è£…ç±»ï¼Œç”¨æ¥è£…é‚£äº›å¯èƒ½ä¸º `null` çš„å¯¹è±¡ã€‚ç”¨äº† `Optional`ï¼Œä½ å°±ä¸ç”¨å†åˆ°å¤„å†™ `!= null` æ¥åˆ¤ç©ºäº†ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå’±ä»¬çœ‹ä¸ªä¼ ç»Ÿçš„å†™æ³•ï¼š\n\njava\n\n ä»£ç è§£è¯»\n\nå¤åˆ¶ä»£ç \n\n`User user = getUserFromSomewhere(); if (user!= null) {     Address address = user.getAddress();     if (address!= null) {         String city = address.getCity();         if (city!= null) {             System.out.println(city);         } else {             System.out.println(\"City not found.\");         }     } else {         System.out.println(\"Address not found.\");     } } else {     System.out.println(\"User not found.\"); }`\n\nå†çœ‹çœ‹ç”¨äº† Optional ä¹‹åçš„å†™æ³•ï¼š\n\njava\n\n ä»£ç è§£è¯»\n\nå¤åˆ¶ä»£ç \n\n`import java.util.Optional; Optional<User> optionalUser = Optional.ofNullable(getUserFromSomewhere()); optionalUser.map(User::getAddress)           .map(Address::getCity)           .ifPresent(System.out::println); optionalUser.map(User::getAddress)           .map(Address::getCity)           .orElse(\"City not found.\");`\n\nè¿™ä¸€ä¸‹æ˜¯ä¸æ˜¯æ¸…çˆ½äº†è®¸å¤šï¼Ÿä»£ç ä¸ä»…çŸ­äº†ï¼Œé€»è¾‘ä¹Ÿæ›´æ˜ç¡®äº†ã€‚ä¸€å¥è¯æ¦‚æ‹¬ï¼šå°‘ç‚¹å•°å—¦ï¼Œå¤šç‚¹ä¼˜é›…ã€‚\n\nå¸¸ç”¨API\n-----\n\nåˆ›å»ºOptionalçš„å¯¹ä¸‹ä½ ä¸ªæœ‰ä»¥ä¸‹ä¸‰ç§æ–¹å¼ï¼š\n\n`Optional.of(value)`: åˆ›å»ºä¸€ä¸ªåŒ…å«éç©ºå€¼çš„ Optional å¯¹è±¡ å¦‚æœä¼ é€’çš„å€¼ä¸º nullï¼Œä¼šæŠ›å‡º `NullPointerException`\n\njava\n\n ä»£ç è§£è¯»\n\nå¤åˆ¶ä»£ç \n\n`Optional<String> nonNullOptional = Optional.of(\"Hello, World!\");`\n\n`Optional.ofNullable(value)`: åˆ›å»ºä¸€ä¸ª `Optional` å¯¹è±¡ï¼Œå¦‚æœä¼ é€’çš„å€¼ä¸º `null`ï¼Œä»ç„¶ä¼šåˆ›å»ºä¸€ä¸ªç©ºçš„ `Optional` å¯¹è±¡\n\njava\n\n ä»£ç è§£è¯»\n\nå¤åˆ¶ä»£ç \n\n`Optional<String> optional = Optional.ofNullable(someNullableValue);`\n\n`Optional.empty()`: åˆ›å»ºä¸€ä¸ªç©ºçš„ Optional å¯¹è±¡\n\njava\n\n ä»£ç è§£è¯»\n\nå¤åˆ¶ä»£ç \n\n`Optional<String> emptyOptional = Optional.empty();`\n\nå¸¸ç”¨çš„æ“ä½œæ–¹æ³•\n-------\n\n`isPresent()`: åˆ¤æ–­ `Optional` å¯¹è±¡æ˜¯å¦åŒ…å«éç©ºå€¼\n\njava\n\n ä»£ç è§£è¯»\n\nå¤åˆ¶ä»£ç \n\n`if (optional.isPresent()) {     // do something }`\n\n`ifPresent(Consumer<? super T> consumer)`: å¦‚æœ `Optional` å¯¹è±¡åŒ…å«éç©ºå€¼ï¼Œåˆ™æ‰§è¡Œä¼ å…¥çš„æ“ä½œ\n\njava\n\n ä»£ç è§£è¯»\n\nå¤åˆ¶ä»£ç \n\n`optional.ifPresent(value -> System.out.println(\"value: \" + value));`\n\n`orElse(T other)`: å¦‚æœ `Optional` å¯¹è±¡åŒ…å«éç©ºå€¼ï¼Œåˆ™è¿”å›è¯¥å€¼ï¼›å¦åˆ™è¿”å›ä¼ å…¥çš„é»˜è®¤å€¼\n\njava\n\n ä»£ç è§£è¯»\n\nå¤åˆ¶ä»£ç \n\n`String result = optional.orElse(\"é»˜è®¤å€¼\");`\n\n`orElseGet(Supplier<? extends T> other)`: ç±»ä¼¼äº `orElse`ï¼Œä½†æ˜¯é»˜è®¤å€¼æ˜¯ç”±ä¼ å…¥çš„ `Supplier` æä¾›çš„\n\njava\n\n ä»£ç è§£è¯»\n\nå¤åˆ¶ä»£ç \n\n`String result = optional.orElseGet(() -> genDefaultValue());`\n\n`orElseThrow(Supplier<? extends X> exceptionSupplier)`: å¦‚æœ `Optional` å¯¹è±¡ä¸ºç©ºï¼Œåˆ™æŠ›å‡ºç”±ä¼ å…¥çš„ `Supplier` æä¾›çš„å¼‚å¸¸\n\njava\n\n ä»£ç è§£è¯»\n\nå¤åˆ¶ä»£ç \n\n`String result = optional.orElseThrow(() -> new NoSuchElementException(\"Value not present\"));`\n\nJava 9 å¢å¼º\n---------\n\næˆ‘ä»¬ä»‹ç»äº† Java 8 çš„ç‰¹æ€§ï¼ŒJava 9 ä¸º `Optional` ç±»æ·»åŠ äº†ä¸‰ä¸ªæ–¹æ³•ï¼š`or()`ã€`ifPresentOrElse()` å’Œ `stream()`ã€‚\n\n`or()` æ–¹æ³•ä¸ `orElse()` å’Œ `orElseGet()` ç±»ä¼¼ï¼Œå®ƒä»¬éƒ½åœ¨å¯¹è±¡ä¸ºç©ºçš„æ—¶å€™æä¾›äº†æ›¿ä»£æƒ…å†µã€‚`or()` çš„è¿”å›å€¼æ˜¯ç”± `Supplier` å‚æ•°äº§ç”Ÿçš„å¦ä¸€ä¸ª `Optional` å¯¹è±¡ã€‚\n\næ¥ä¸ªdemo\n------\n\nå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç”¨æˆ·ä¿¡æ¯ç³»ç»Ÿï¼Œå…¶ä¸­åŒ…å«ç”¨æˆ·çš„å§“åã€å¹´é¾„å’Œåœ°å€ã€‚æˆ‘ä»¬éœ€è¦ä»æ•°æ®åº“ä¸­è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œå¹¶è¿›è¡Œä¸€äº›å¤„ç†ã€‚\n\njava\n\n ä»£ç è§£è¯»\n\nå¤åˆ¶ä»£ç \n\n`import java.util.Optional; public class UserInfoSystem {     public static void main(String[] args) {         // ä»æ•°æ®åº“ä¸­è·å–ç”¨æˆ·ä¿¡æ¯ï¼ˆæ¨¡æ‹Ÿï¼‰         User user = getUserFromDatabase();         // ä½¿ç”¨Optionalå¤„ç†ç”¨æˆ·ä¿¡æ¯         Optional<User> optionalUser = Optional.ofNullable(user);         // æ‰“å°ç”¨æˆ·å§“å         optionalUser.ifPresent(u -> System.out.println(\"ç”¨æˆ·å§“å: \" + u.getName()));         // è®¡ç®—ç”¨æˆ·å¹´é¾„çš„å¹³æ–¹ï¼ˆå¦‚æœå¹´é¾„å­˜åœ¨ï¼‰         optionalUser.map(User::getAge)               .map(age -> age * age)               .ifPresent(squaredAge -> System.out.println(\"ç”¨æˆ·å¹´é¾„çš„å¹³æ–¹: \" + squaredAge));         // è·å–ç”¨æˆ·åœ°å€çš„åŸå¸‚ï¼ˆå¦‚æœåœ°å€å­˜åœ¨ï¼‰         optionalUser.flatMap(User::getAddress)               .map(Address::getCity)               .ifPresent(city -> System.out.println(\"ç”¨æˆ·åœ°å€çš„åŸå¸‚: \" + city));     }     public static User getUserFromDatabase() {         // æ¨¡æ‹Ÿä»æ•°æ®åº“ä¸­è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œè¿™é‡Œè¿”å›ä¸€ä¸ªå¯èƒ½ä¸ºç©ºçš„ç”¨æˆ·å¯¹è±¡         return new User(\"Alice\", 25, new Address(\"New York\"));         // å¯ä»¥è¿”å› null æ¥æ¨¡æ‹Ÿç”¨æˆ·ä¸å­˜åœ¨çš„æƒ…å†µ         // return null;     }     static class User {         private String name;         private int age;         private Address address;         public User(String name, int age, Address address) {             this.name = name;             this.age = age;             this.address = address;         }         public String getName() {             return name;         }         public int getAge() {             return age;         }         public Optional<Address> getAddress() {             return Optional.ofNullable(address);         }     }     static class Address {         private String city;         public Address(String city) {             this.city = city;         }         public String getCity() {             return city;         }     } }`\n\nåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨`Optional`æ¥åŒ…è£…ä»æ•°æ®åº“ä¸­è·å–çš„ç”¨æˆ·å¯¹è±¡ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¤„ç†ç”¨æˆ·ä¿¡æ¯æ—¶ï¼Œé¿å…ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚\n\nä¾‹å¦‚ï¼Œå½“æˆ‘ä»¬è·å–ç”¨æˆ·å§“åæ—¶ï¼Œä½¿ç”¨`ifPresent`æ–¹æ³•æ¥ç¡®ä¿ç”¨æˆ·å­˜åœ¨ã€‚å½“æˆ‘ä»¬è®¡ç®—ç”¨æˆ·å¹´é¾„çš„å¹³æ–¹æ—¶ï¼Œä½¿ç”¨`map`æ–¹æ³•æ¥è½¬æ¢å¹´é¾„ï¼Œå¹¶ä½¿ç”¨`ifPresent`æ–¹æ³•æ¥å¤„ç†ç»“æœã€‚å½“æˆ‘ä»¬è·å–ç”¨æˆ·åœ°å€çš„åŸå¸‚æ—¶ï¼Œä½¿ç”¨`flatMap`æ–¹æ³•æ¥å¤„ç†åµŒå¥—çš„`Optional`ã€‚\n\né€šè¿‡è¿™ç§æ–¹å¼ï¼Œ`Optional`æä¾›äº†ä¸€ç§æ›´å®‰å…¨ã€æ›´ä¼˜é›…çš„æ–¹å¼æ¥å¤„ç†å¯èƒ½ä¸ºç©ºçš„å€¼ï¼Œä½¿ä»£ç æ›´å…·å¯è¯»æ€§å’Œå¥å£®æ€§ã€‚\n\næ€»ç»“\n--\n\n`Optional` æ˜¯ Java è¯­è¨€çš„æœ‰ç›Šè¡¥å…… â€”â€” å®ƒæ—¨åœ¨å‡å°‘ä»£ç ä¸­çš„ `NullPointerException`ï¼Œè™½ç„¶è¿˜ä¸èƒ½å®Œå…¨æ¶ˆé™¤è¿™äº›å¼‚å¸¸ã€‚\n\nå®ƒä¹Ÿæ˜¯ç²¾å¿ƒè®¾è®¡ï¼Œè‡ªç„¶èå…¥ Java 8 å‡½æ•°å¼æ”¯æŒçš„åŠŸèƒ½ã€‚\n\næ€»çš„æ¥è¯´ï¼Œè¿™ä¸ªç®€å•è€Œå¼ºå¤§çš„ç±»æœ‰åŠ©äºåˆ›å»ºç®€å•ã€å¯è¯»æ€§æ›´å¼ºã€æ¯”å¯¹åº”ç¨‹åºé”™è¯¯æ›´å°‘çš„ç¨‹åºã€‚\n\nèµ„æ–™\n--\n\n*   [docs.oracle.com/en/java/javâ€¦](https://link.juejin.cn?target=https%3A%2F%2Fdocs.oracle.com%2Fen%2Fjava%2Fjavase%2F17%2Fdocs%2Fapi%2Fjava.base%2Fjava%2Futil%2FOptional.html \"https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Optional.html\")\n*   [forums.oracle.com/ords/apexdsâ€¦](https://link.juejin.cn?target=https%3A%2F%2Fforums.oracle.com%2Fords%2Fapexds%2Fpost%2Foptionals-patterns-and-good-practices-2540 \"https://forums.oracle.com/ords/apexds/post/optionals-patterns-and-good-practices-2540\")"
}