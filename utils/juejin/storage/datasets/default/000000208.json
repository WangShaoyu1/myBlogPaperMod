{
	"title": "用expo开发reactnative实在是太爽了",
	"author": "天平",
	"publishTime": "2024-04-14",
	"readTime": "阅读4分钟",
	"tags": "[\"ReactNative\",\"React.js\",\"Java\"]",
	"description": "expo出来已经有一段时间了，发现相关的文章还是比较少的。如果你在开发reactnative，那么我推荐你赶快使用expo来开发把！expo的好处是什么？一、零配置开发，降低开发者的心智负担。如",
	"article": "expo出来已经有一段时间了，发现相关的文章还是比较少的。如果你在开发react native，那么我推荐你赶快使用expo来开发把！\n\nexpo的好处是什么？\n===========\n\n一、零配置开发，降低开发者的心智负担。如果你之前开发过react native，那么你肯定会遇到要配置java，sdk等一大堆东西，并且版本还要对应上，否则开发不了。甚至说新手也会被这些东西劝退。使用expo后，无需配置这些开发环境，像开发web一样流畅的开发react native。\n\n二、实时真机调试。以前开发react native，要打包后才能真机调试，并且ios的打包要审核，审核要花很长的时间，导致Android和ios之间兼容性的问题不能实时的查看，大大降低了开发效率。使用了expo之后，能够进行实时的真机调试。\n\n三、云打包，一键推送到谷歌应用市场和Apple store。\n\n开始\n==\n\n一、安装依赖\n------\n\nnode 20 环境，首先安装全局脚手架\n\nshell\n\n 代码解读\n\n复制代码\n\n`npm i -g  eas-cli expo-cli`\n\nexpo-cli用于开发，eas-cli用于推送云打包。\n\n二、手机下载Expo go\n-------------\n\n安卓手机可以到谷歌市场下载Expo go，但是不知道为什么，下载的速度太慢了。所以我这里提供网页端下载。 [expo.dev/go](https://link.juejin.cn?target=https%3A%2F%2Fexpo.dev%2Fgo \"https://expo.dev/go\") 选择最新版下载安装就行了\n\n![c8e4198875cfdd9281d91fd2128dbbc.jpg](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8b29dfb595684688879a2414e1a407ea~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=756&h=654&s=101786&e=jpg&b=bcc9d0)\n\n三、创建项目\n------\n\nshell\n\n 代码解读\n\n复制代码\n\n`npx create-expo-app app`\n\n四、启动项目\n------\n\narduino\n\n 代码解读\n\n复制代码\n\n`npm run start`\n\n会出现一个二维码\n\n![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c7a28f7e7e214f8fbc8280e8d8fa647b~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=724&h=722&s=51338&e=png&b=212437)\n\n五、真机调试\n------\n\n拿出手机，打开Expo go，使用Scan QR code扫二维码，即可看到效果\n\n![c7aa116998932f390d75d2eca82804c.jpg](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/98b5bc72c6a845a68f2f616946f49569~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1080&h=2340&s=224428&e=jpg&b=f8f8fa)\n\n效果:\n\n![f0f5865ba8dced6db92b1e6b62423a0.jpg](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/15d2742f81ac46a5bfc68cb4fb8b0c84~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1080&h=2340&s=93749&e=jpg&b=ffffff) 修改一下代码后，按R reload一下\n\n![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3d8cf2d8fc4449fabcef93208946bbdc~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=773&h=147&s=24930&e=png&b=25283b) 效果：\n\n![311ed102d4c0168b5a80ce48f29487b.jpg](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ba1b873f53a74192bb62f6ea79da9afa~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1080&h=2340&s=77528&e=jpg&b=ffffff)\n\napp开发就这么简单。\n\n六、云打包app\n--------\n\n先到expo官网注册一下账号，[expo.dev/](https://link.juejin.cn?target=https%3A%2F%2Fexpo.dev%2F \"https://expo.dev/\") ，然后本地登录expo账号，输入：\n\n 代码解读\n\n复制代码\n\n`eas login`\n\n登录后，输入以下代码，让其自动生成eas.json配置文件。\n\ncss\n\n 代码解读\n\n复制代码\n\n`eas build --platform android`\n\n全选是就行了，没讲究 ![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3c67cd7650e341b5b3f3874dbfbbb6ec~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=627&h=342&s=51304&e=png&b=212336)\n\n![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a2962558d389455b88ecfe62e41c243e~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=2505&h=680&s=124279&e=png&b=24273a)\n\n会把当前的项目上传到expo，并且打包。终端显示Build in progress时，就说明正在排队打包。这里会等待很久，少则20分钟，多则两小时。此时就可以把终端关闭了，并且到expo的官网面板中查看项目\n\n![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/64795e982303465f984a5016f39cc783~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=367&h=185&s=16157&e=png&b=202335) ![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b0201442beee49c5a1481a4bb8d1af0c~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=2187&h=972&s=198844&e=png&b=ffffff) 第一次是生成AAB文件，不是我们想要的apk文件，此时我们要改造一下eas.json文件，加入一段\n\n![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/aafe6eb3831d4e22bb7f85a0e2d1261c~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=837&h=330&s=21065&e=png&b=ffffff)\n\njson\n\n 代码解读\n\n复制代码\n\n        `\"release\": {             \"android\": {                 \"buildType\": \"apk\"             }         }`\n\n![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e9a5c467c1824635b9ed7af336f2df69~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=754&h=815&s=77800&e=png&b=25283b) 然后重新打包一次\n\ncss\n\n 代码解读\n\n复制代码\n\n`eas build --platform android --profile release`\n\n因为要排队打包，快则20分钟，慢则2个小时。大家慢慢等待即可。\n\n打包好后，下载安装即可。\n\n![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/55dcb08e2df4434c94a3252910da7274~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1876&h=583&s=76847&e=png&b=ffffff)\n\n七、本地打包app\n---------\n\n首先云打包太慢了，并且代码上传也不安全。那么怎么实现本地打包呢？\n\n很遗憾，目前仅支持MacOS和Linux进行本地打包，windows暂不支持。\n\n### MacOS/Linux本地打包\n\n如果你的电脑已经配置好了java、NDK环境，只需执行\n\ncss\n\n 代码解读\n\n复制代码\n\n`eas build --platform android --profile release --local`\n\n然后按照操作即可。\n\n如果你的电脑没有配置好环境，那么就用我配置好的`docker`镜像进行打包，操作如下：\n\n### windows本地打包\n\nwindows可以用WSL下载Linux子系统进行打包。我这里提供另一种方法，是用docker进行打包\n\n先再项目中添加一个eas.json文件\n\n![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1285804a37d64de19d991e3b5abce837~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=196&h=57&s=2351&e=png&b=202335)\n\njson\n\n 代码解读\n\n复制代码\n\n`{     \"cli\": {         \"version\": \">= 10.0.0\"     },     \"build\": {         \"development\": {             \"developmentClient\": true,             \"distribution\": \"internal\"         },         \"preview\": {             \"distribution\": \"internal\"         },         \"production\": {},         \"release\": {             \"android\": {                 \"buildType\": \"apk\"             }         }     },     \"submit\": {         \"production\": {}     } }`\n\n然后到expo获取一个token [expo.dev/](https://link.juejin.cn?target=https%3A%2F%2Fexpo.dev%2F \"https://expo.dev/\")\n\n![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/13105f2f5b3641108fb948cbb34f3c7e~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=522&h=1271&s=53516&e=png&b=ffffff)\n\n![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ecbc1db705c34d21891a8a96a1de2029~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1924&h=507&s=50246&e=png&b=ffffff) 在项目中添加一个dockerfile.build用于打包，下面把token替换成你的token\n\nyml\n\n 代码解读\n\n复制代码\n\n`FROM mobiledevops/android-sdk-image:latest RUN apt update \\     && apt install -y nodejs npm RUN npm i -g eas-cli expo yarn COPY ./ /WWW/APP WORKDIR /WWW/APP ENV EXPO_TOKEN=这里替换成你的token ENV NODE_ENV=production RUN npm i CMD eas build --platform android --profile release --local`\n\n再写一个docker-compose.yaml进行自动化构建\n\nyml\n\n 代码解读\n\n复制代码\n\n`version: '3' name: build services:     build:         build:             context: .             dockerfile: dockerfile.build         image: build         container_name: app         tty: true         stdin_open: true         volumes:             - ./:/WWW/APP/`\n\n整体的结构\n\n![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/93ce19bb6af245b39a71ece240d55f86~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=351&h=601&s=34683&e=png&b=212437)\n\n运行命令\n\nyml\n\n 代码解读\n\n复制代码\n\n`docker-compose up -d`\n\n![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bfb7e2efc69a4e2aaad12b68ac086802~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=931&h=468&s=76824&e=png&b=ffffff) 最后成功了，拿去安装就可以了。\n\n![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1ca5f8d1f844430aa0cb916560069c35~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=382&h=157&s=12309&e=png&b=202335)\n\n当然最好的方案还是配好java，sdk等环境用macOS来打包。\n\n将create-react-native改造成expo\n===========================\n\n注：旧项目改造起来有点复杂，我没有成功，这里就不试了，你们自己研究一下。我这里演示的是用最新的react native开始改造\n---------------------------------------------------------------\n\n搭建项目\n----\n\njava\n\n 代码解读\n\n复制代码\n\n`npx react-native@latest init test`\n\n然后安装expo\n\ncss\n\n 代码解读\n\n复制代码\n\n`npm i expo -D`\n\n然后照着expo项目改就行了，把babel.config.js中的内容改成以下\n\n![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fb11f77025784e7a829448610aaed2bc~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=604&h=249&s=26597&e=png&b=26293c)\n\njs\n\n 代码解读\n\n复制代码\n\n`module.exports = function (api) {   api.cache(true);   return {     presets: ['babel-preset-expo'],   }; };`\n\n把index.js中的appName改成'main'。【本地打包的时候，记得改回来】\n\n![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8b919c3fde174357a4f1ea0bf206a26c~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=846&h=343&s=44779&e=png&b=26293c) package.json中添加一个expo的脚本\n\njson\n\n 代码解读\n\n复制代码\n\n   `\"expo\": \"expo start\",`\n\n然后启动即可\n\narduino\n\n 代码解读\n\n复制代码\n\n`npm run expo`\n\n改造成功\n\n![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a89b9bfc39b345eba945091670bb0852~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1014&h=874&s=80605&e=png&b=212437)\n\n效果：\n\n![50ffc358294acdeef01b2f86e8740ab.jpg](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8ddee02e65614db68e747d1308c75914~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1080&h=2340&s=470695&e=jpg&b=fcfcfc)\n\n### 如果你又不想云打包，又想本地打包，又没有配置好java等环境，又没有docker，那么睡大觉比较合适你。\n\n![C493D0010651F3A96CA62DCAA8326559.jpg](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e01cee01b8f3480badbce348380ce93f~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=270&h=224&s=4890&e=jpg&b=efeaef)\n\n旧项目改造失败怎么办？\n-----------\n\n旧项目改造会有很多环境的问题，我没有弄过，所以只能靠你们自己去研究。同时我也对旧项目用expo改造毫无兴趣，简直是浪费时间，所以最好还是开新项目的时候就用。"
}