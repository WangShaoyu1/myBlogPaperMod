{
	"title": "æˆ‘å¦‚ä½•æ§åˆ¶å¤§å±çœ‹æ¿1000ä¸ªEchartsæ¸²æŸ“å¹¶å‘?",
	"author": "å‰ç«¯æ‰‹æœ¯åˆ€",
	"publishTime": "2021-12-20",
	"readTime": "é˜…è¯»1åˆ†é’Ÿ",
	"tags": "[\"å‰ç«¯\"]",
	"description": "éšç€`é¢å‘é¢†å¯¼ç¼–ç¨‹`è¶Šæ¥è¶Šæ·±å…¥äººå¿ƒ,`çœ‹æ¿`é¡¹ç›®æƒ³å¿…æ˜¯æ¯ä¸ªå‰ç«¯å¼€å‘ä¸“å®¶çš„å¿…ä¿®ä¹‹è·¯äº§å“ç»ç†`å¼ ä¸‰`è¦æ±‚å‰ç«¯å¼€å‘ä¸“å®¶`çº¢ç›¾`åšä¸€ä¸ªç”±`1000ä¸ªå›¾è¡¨å®šæ—¶åˆ·æ–°`çš„å…¬å¸æœ€æ–°çš„è´¢åŠ¡æƒ…å†µ",
	"article": "> å…ˆæŒ‰é…å›¾ æ¥å¥—è‚©éƒ¨`spa`æ”¾æ¾æ“~\n\nå‰è¨€\n==\n\né˜…è¯»å®Œæœ¬æ–‡,å¤§æ¦‚éœ€è¦ `7 åˆ†é’Ÿ` æ—¶é—´\n\nä½ å°†ä¼šå­¦åˆ°\n\n**1\\. æ§åˆ¶ å¹¶å‘æ¸²æŸ“**\n\n**2\\. æ§åˆ¶ å¹¶å‘ http è¯·æ±‚**\n\n**3\\. æŠŠ Promise ç©åˆ°èŠ±é‡Œèƒ¡å“¨**\n\nDemo åœ°å€\n=======\n\n**äºŒè¯ä¸è¯´,å…ˆä¸Š demo åœ°å€**\n\n[codepen.io/firstblood9â€¦](https://link.juejin.cn?target=https%3A%2F%2Fcodepen.io%2Ffirstblood93%2Fpen%2FQWqgVJL \"https://codepen.io/firstblood93/pen/QWqgVJL\")\n\n**é¡¹ç›®èƒŒæ™¯**\n========\n\néšç€ `é¢å‘é¢†å¯¼ç¼–ç¨‹` è¶Šæ¥è¶Šæ·±å…¥äººå¿ƒ, `çœ‹æ¿` é¡¹ç›®æƒ³å¿…æ˜¯æ¯ä¸ªå‰ç«¯å¼€å‘ä¸“å®¶çš„å¿…ä¿®ä¹‹è·¯\n\näº§å“ç»ç† `å¼ ä¸‰` è¦æ±‚ å‰ç«¯å¼€å‘ä¸“å®¶ `çº¢ç›¾` åšä¸€ä¸ªç”± `1000ä¸ªå›¾è¡¨å®šæ—¶åˆ·æ–°` çš„å…¬å¸æœ€æ–°çš„è´¢åŠ¡æ”¯å‡ºæƒ…å†µ\n\n`çº¢ç›¾` åœ¨ `chrome` ä¸Š ä¸€é¡¿æ“ä½œçŒ›å¦‚è™,æ²¡ä¸¤ä¸‰å¤©å°±æŠŠ é¡¹ç›®æå®šäº† äº¤ä»˜ç»™äº§å“ç»ç† `å¼ ä¸‰`.\n\n**æ— å¹¶å‘æ§åˆ¶**\n=========\n\nè®©æˆ‘ä»¬æ¥çœ‹çœ‹ `çº¢ç›¾` æ­¤æ—¶`æ²¡æœ‰æ§åˆ¶å¹¶å‘`çš„ä»£ç æƒ…å†µ\n\njs\n\n ä»£ç è§£è¯»\n\nå¤åˆ¶ä»£ç \n\n`<template>   <div class=\"app-container\">     <div class=\"charts\">       <div v-for=\"item in domList\" :id=\"item\" :key=\"item\" class=\"chart\" />     </div>   </div> </template> <script> const echarts = require(\"echarts\"); const chartNum = 1000; // å›¾è¡¨æ•°é‡ const chartIntervalTime = 2000; // å›¾è¡¨å®šæ—¶æ¸²æŸ“æ¯«ç§’æ•° export default {   data() {     return {       domList: [],       chartObjs: {},       chartData: [150, 230, 224, 218, 135, 147, 260],     };   },   mounted() {     // åˆ›å»ºechartå¹¶ç»˜å›¾     this.createChart();     // éš”3ç§’æ›´æ–°å›¾è¡¨æ•°æ®å¹¶æ¸²æŸ“     this.intervalChartData(chartIntervalTime);   },   methods: {     // åˆ›å»ºechartå¹¶ç»˜å›¾     async createChart() {       for (let i = 1; i <= chartNum; i++) {         this.domList.push(\"chart\" + i);       }       this.$nextTick(this.renderChartList);     },     async renderChartList() {       this.domList.forEach((dom) => this.initChart(dom));     },     // éš”3ç§’æ›´æ–°å›¾è¡¨æ•°æ®å¹¶æ¸²æŸ“     intervalChartData(s) {       setInterval(() => {         this.renderChartList();       }, s);     },     // åˆå§‹åŒ–å›¾è¡¨     initChart(domId) {       if (!this.chartObjs[domId]) {         this.chartObjs[domId] = echarts.init(document.getElementById(domId));       }       const option = {         xAxis: {           type: \"category\",           data: [\"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\", \"Sun\"],         },         yAxis: {           type: \"value\",         },         series: [           {             data: this.chartData,             type: \"line\",           },         ],       };       this.chartObjs[domId].clear();       this.chartObjs[domId].setOption(option);     },   }, }; </script> <style scoped> .chart {   float: left;   width: 360px;   height: 300px;   margin: 10px;   border: 2px solid #ff9900; } </style>`\n\nç»“æœ `å¼ ä¸‰` ä¸æŒ‰å¥—è·¯å‡ºç‰Œ, åœ¨ç”µè§†æœºä¸Šå·å·å®‰äº†ä¸ª æµè§ˆå™¨(æ€§èƒ½æå·®),ç„¶åè¾“å…¥åœ°å€ `xxx.com` (è‡ªè¡Œè„‘è¡¥)...\n\nç›´æ¥æŠŠæµè§ˆå™¨ç»™`æ·¦`å¥”æºƒäº†...æ²¡é”™, `çº¢ç›¾` æ­¤æ—¶çš„å†…å¿ƒ\n\n![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0d7605deca0048c89c57035797cc6b98~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?)\n\nè¿™æ—¶å€™ ä»–æƒ³èµ·äº† åç«¯å¤§ä½¬ `è€é»„`,è€é»„ç»™äº†ä»–ä¸€ä¸ªæ€è·¯ `æ§åˆ¶å¹¶å‘`\n\n**å®ç°æ§åˆ¶å¹¶å‘**\n==========\n\n**å®ç°æ§åˆ¶å¹¶å‘å‡½æ•°(ç›´æ¥æ‹¿å»ç”¨)**\n-------------------\n\n1.  é¦–å…ˆæˆ‘ä»¬æ¥å®ç°ä¸€ä¸ªæ§åˆ¶`å¹¶å‘å‡½æ•°`\n\næƒ³ç›´æ¥è¿›å…¥ä¸»é¢˜çš„åŒå­¦å¯ä»¥ç›´æ¥è·³åˆ° `å®Œæ•´ä»£ç ` æŸ¥çœ‹\n\njs\n\n ä»£ç è§£è¯»\n\nå¤åˆ¶ä»£ç \n\n``/**  * @params {Number} poolLimit -æœ€å¤§å¹¶å‘é™åˆ¶æ•°  * @params {Array} array -æ‰€æœ‰çš„å¹¶å‘è¯·æ±‚|æ¸²æŸ“æ•°ç»„  * @params {Function} iteratorFn -å¯¹åº”æ‰§è¡Œçš„å¹¶å‘å‡½æ•°(æ¥å— array çš„æ¯ä¸€é¡¹å€¼)  */ async function asyncPool(poolLimit, array, iteratorFn) {   const ret = [] // æ‰€æœ‰æ‰§è¡Œä¸­çš„ promises   let executing = [] // æ­£åœ¨æ‰§è¡Œä¸­çš„ promises   for (const item of array) {     //æ¥å— iteratorFn çš„è¿”å›å€¼:Promise     const p = Promise.resolve().then(() => iteratorFn(item))     ret.push(p)     // å¦‚æœæ‰§è¡Œçš„æ•°ç»„ å¤§äºç­‰äº æœ€å¤§å¹¶å‘é™åˆ¶ é‚£ä¹ˆæˆ‘ä»¬å°±è¦æ§åˆ¶å¹¶å‘     if (array.length >= poolLimit) {       const e = p.then(() => executing.splice(executing.indexOf(e), 1))       // p.then è¿”å›çš„ ä¸€ä¸ªPromise æˆ‘ä»¬æŠŠå®ƒæ”¾åˆ°æ­£åœ¨æ‰§è¡Œæ•°ç»„ä¸­,ä¸€æ—¦æ‰§è¡Œå®Œ ä¾¿å‰”é™¤å¯¹åº”çš„å€¼       executing.push(e)       //æ ¸å¿ƒä»£ç :æ­£åœ¨æ‰§è¡Œçš„ promises æ•°ç»„ å¤§äºç­‰äº `æœ€å¤§å¹¶å‘é™åˆ¶` ç”¨.race æ–¹æ³•é‡Šæ”¾ä¸€ä¸ªæ‰§è¡Œæœ€å¿«çš„       if (executing.length >= poolLimit) await Promise.race(executing)     }   }   //è¿”å›ä¸€ä¸ª Promise.all   return Promise.all(ret) }``\n\n2.  æ”¹é€  `renderChartList` å‡½æ•°(`æ ¸å¿ƒ`)\n\njs\n\n ä»£ç è§£è¯»\n\nå¤åˆ¶ä»£ç \n\n``async renderChartList() {   // è¿™é‡Œçš„ MAX_CURRENT ä¹‹åå¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªæ•°å­—   await asyncPool(MAX_CURRENT, this.domList, (dom) => {     // æˆ‘ä»¬åœ¨è¿™é‡Œå¿…é¡»è¿”å›ä¸€ä¸ª promise å¯¹åº”ä¸º `å¹¶å‘å‡½æ•°` çš„ `p` å˜é‡     return new Promise(async (resolve) => {       const res = await this.initChart(dom);       resolve(res);// è¿™ä¸€æ­¥ä¹‹å, å¯¹åº”æ‰§è¡Œ `å¹¶å‘å‡½æ•°` çš„ p.then å‰”é™¤     }).then((data) => {       console.log(data);       return data;     });   }); }``\n\n3.æ”¹é€  `initChart` å‡½æ•°\n\næˆ‘ä»¬å¿…é¡»ä¿è¯ä¸€ä¸ªå›¾è¡¨æ¸²æŸ“å®Œæˆ,å†æ‰§è¡Œä¸‹ä¸€ä¸ªæ¸²æŸ“,æ­¤æ—¶æˆ‘ä»¬å°±éœ€è¦ç›‘å¬ `Echarts` çš„ `finished` äº‹ä»¶\n\njs\n\n ä»£ç è§£è¯»\n\nå¤åˆ¶ä»£ç \n\n``initChart(domId) {   // æˆ‘ä»¬ æŠŠå®ƒæ”¹é€ æˆä¸€ä¸ª promise å‡½æ•°   return new Promise((resolve) => {     ...     // æ ¸å¿ƒä»£ç  ç›‘å¬ echarts çš„ finished     this.chartObjs[domId].on(\"finished\", () => {       resolve(domId);// å¯¹åº” ä¸Šä¸€æ­¥çš„ `const res = await this.initChart(dom);`     });   }); }``\n\n4.æ”¹é€  `intervalChartData` å‡½æ•°\n\næˆ‘ä»¬å¿…é¡»ä¿è¯å¹¶å‘æ‰§è¡Œå®Œ æ‰€æœ‰çš„å›¾è¡¨æ¸²æŸ“,å†è¿›å…¥ä¸‹ä¸€ä¸ªå®šæ—¶å™¨é€»è¾‘ åˆ¤æ–­ `executing`çš„é•¿åº¦å³å¯(æ­¤æ—¶åº”è¯¥æŠŠ `executing` ç‹¬ç«‹ä¸ºå…¨å±€å˜é‡)\n\njs\n\n ä»£ç è§£è¯»\n\nå¤åˆ¶ä»£ç \n\n`intervalChartData(s) {   setInterval(() => {     if (executing.length > 0) return; // è¿˜æœ‰æ­£åœ¨æ‰§è¡Œçš„æ¸²æŸ“ ä¸é‡å¤æ·»åŠ      this.renderChartList();   }, s); }`\n\nå®Œæ•´ä»£ç \n====\n\né™„ä¸Šå®Œæ•´ä»£ç \n\njs\n\n ä»£ç è§£è¯»\n\nå¤åˆ¶ä»£ç \n\n`<template>   <div class=\"app-container\">     <div class=\"charts\">       <div v-for=\"item in domList\" :id=\"item\" :key=\"item\" class=\"chart\" />     </div>   </div> </template> <script> const echarts = require(\"echarts\"); const chartNum = 1000; // å›¾è¡¨æ•°é‡ const MAX_CURRENT = 50; // å›¾è¡¨æœ€å¤§æ¸²æŸ“å¹¶å‘æ•° const chartIntervalTime = 2000; // å›¾è¡¨å®šæ—¶æ¸²æŸ“æ¯«ç§’æ•° let executing = []; /**  * @params {Number} poolLimit -æœ€å¤§å¹¶å‘é™åˆ¶æ•°  * @params {Array} array -æ‰€æœ‰çš„å¹¶å‘è¯·æ±‚|æ¸²æŸ“æ•°ç»„  * @params {Function} iteratorFn -å¯¹åº”æ‰§è¡Œçš„å¹¶å‘å‡½æ•°(æ¥å— array çš„æ¯ä¸€é¡¹å€¼)  */ async function asyncPool(poolLimit, array, iteratorFn) {   const ret = []; // æ‰€æœ‰æ‰§è¡Œä¸­çš„ promises   executing = []; // æ­£åœ¨æ‰§è¡Œä¸­çš„ promises   for (const item of array) {     const p = Promise.resolve().then(() => iteratorFn(item));     ret.push(p);     if (array.length >= poolLimit) {       const e = p.then(() => executing.splice(executing.indexOf(e), 1));       executing.push(e);       if (executing.length >= poolLimit) await Promise.race(executing);     }   }   return Promise.all(ret); } export default {   data() {     return {       domList: [],       chartObjs: {},       chartData: [150, 230, 224, 218, 135, 147, 260],     };   },   mounted() {     // åˆ›å»ºechartå¹¶ç»˜å›¾     this.createChart();     // éš”3ç§’æ›´æ–°å›¾è¡¨æ•°æ®å¹¶æ¸²æŸ“     this.intervalChartData(chartIntervalTime);   },   methods: {     // åˆ›å»ºechartå¹¶ç»˜å›¾     async createChart() {       for (let i = 1; i <= chartNum; i++) {         this.domList.push(\"chart\" + i);       }       this.$nextTick(this.renderChartList);     },     async renderChartList() {       const res = await asyncPool(MAX_CURRENT, this.domList, (i, arr) => {         return new Promise(async (resolve) => {           const res = await this.initChart(i);           resolve(res);         }).then((data) => {           console.log(data);           return data;         });       });     },     // éš”3ç§’æ›´æ–°å›¾è¡¨æ•°æ®å¹¶æ¸²æŸ“     intervalChartData(s) {       setInterval(() => {         if (executing.length > 0) return; // è¿˜æœ‰æ­£åœ¨æ‰§è¡Œçš„æ¸²æŸ“ ä¸é‡å¤æ·»åŠ          this.renderChartList();       }, s);     },     // åˆå§‹åŒ–å›¾è¡¨     initChart(domId) {       return new Promise((resolve) => {         if (!this.chartObjs[domId]) {           this.chartObjs[domId] = echarts.init(document.getElementById(domId));         }         const option = {           xAxis: {             type: \"category\",             data: [\"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\", \"Sun\"],           },           yAxis: {             type: \"value\",           },           series: [             {               data: this.chartData,               type: \"line\",             },           ],         };         this.chartObjs[domId].clear();         this.chartObjs[domId].setOption(option);         this.chartObjs[domId].on(\"finished\", () => {           resolve(domId);         });       });     },   }, }; </script> <style scoped> .chart {   float: left;   width: 360px;   height: 300px;   margin: 10px;   border: 2px solid #ff9900; } </style>`\n\nå°å½©è›‹\n===\n\nå°å½©è›‹âœŒï¸, `çº¢ç›¾`è¯´æœ`å¼ ä¸‰`ä¹°äº†ä¸ªé«˜æ€§èƒ½çš„ç”µè§†æœº, å®Œç¾è§£å†³, çœŸæ˜¯ä¸“æ²»å„ç§ä¸æœ...\n\næœ€å\n==\n\næ¨èé˜…è¯»`è½®è¯¢æŠ€èƒ½` [æˆ‘å¦‚ä½•å®ç°ä¸€ä¸ªè½®è¯¢å‡½æ•°çš„å°è£…?](https://juejin.cn/post/7121168949282078750#comment \"https://juejin.cn/post/7121168949282078750#comment\")\n\n_å¦‚æœ‰ä¸å¯¹,æ¬¢è¿æŒ‡æ­£_ğŸŒŸ _å¦‚æœ‰å¸®åŠ©,å»ºè®®å°å¿ƒå¿ƒå¤§æ‹‡æŒ‡ä¸‰è¿_ğŸŒŸ"
}