{
	"title": "createObjectURL这个API真好用，我举几个场景你们就懂了~",
	"author": "Sunshine_Lin",
	"publishTime": "2024-04-16",
	"readTime": "阅读3分钟",
	"tags": "[\"前端\",\"JavaScript中文技术社区\",\"前端开发社区\",\"前端技术交流\",\"前端框架教程\",\"JavaScript 学习资源\",\"CSS 技巧与最佳实践\",\"HTML5 最新动态\",\"前端工程师职业发展\",\"开源前端项目\",\"前端技术趋势\"]",
	"description": "前言 大家好，我是林三心，用最通俗易懂的话讲最难的知识点是我的座右铭，基础是进阶的前提是我的初心~ 随着我用 URLcreateObjectURL 这个 API 越来越多次，越发感觉真的是一个很好用",
	"article": "前言\n--\n\n大家好，我是林三心，用最通俗易懂的话讲最难的知识点是我的座右铭，基础是进阶的前提是我的初心~\n\n随着我用 `URL.createObjectURL` 这个 API 越来越多次，越发感觉真的是一个很好用的方法，列举一下我在项目中用到它的场景吧~\n\n图片预览\n----\n\n以前我们想要预览图片，只能是上传图片到后端后，获取到url然后赋予给img标签，才能得到回显预览，但是有了`URL.createObjectURL`就不需要这么麻烦了，直接可以在前端就达到预览的效果~\n\n```html\n<body>\n<input type=\"file\" id=\"fileInput\">\n<img id=\"preview\" src=\"\" alt=\"Preview\">\n<script>\nconst fileInput = document.getElementById('fileInput');\n    fileInput.addEventListener('change', (event) => {\n    const file = event.target.files[0];\n    const fileUrl = URL.createObjectURL(file);\n    const previewElement = document.getElementById('preview');\n    previewElement.src = fileUrl;\n    });\n    </script>\n    </body>\n```\n\n![](/images/jueJin/5e1da7c7108d422.png)\n\n音视频流传输\n------\n\n举个例子，我们通过`MediaStream` 去不断推流，达到了视频显示的效果，有了`URL.createObjectURL`我们并不需要真的有一个url赋予video标签，去让视频显示出来，只需要使用`URL.createObjectURL`去构造一个临时的url即可非常方便\n\n```html\n<body>\n<video id=\"videoElement\" autoplay playsinline></video>\n\n<script>\nconst videoElement = document.getElementById('videoElement');\n\nnavigator.mediaDevices.getUserMedia({ video: true, audio: true })\n    .then((stream) => {\n    videoElement.srcObject = stream;\n    })\n        .catch((error) => {\n        console.error('Error accessing webcam:', error);\n        });\n        </script>\n        \n        </body>\n```\n\n![](/images/jueJin/ae1a68e0ce03446.png)\n\n结合 Blob\n-------\n\n`URL.createObjectURL`结合`Blob`也可以做很多方便开发的事情~\n\n### WebWorker\n\n我们知道，想要用 WebWorker 的话，是要先创建一个文件，然后在里面写代码，然后去与这个文件运行的代码进行通信，有了`URL.createObjectURL`就不需要新建文件了，比如下面这个解决excel耗时过长的场景，可以看到，我们传给WebWorker的不是一个真的文件路径，而是一个临时的路径~\n\n```ts\n    const handleImport = (ev: Event) => {\n    const file = (ev.target as HTMLInputElement).files![0];\n    const worker = new Worker(\n    URL.createObjectURL(\n        new Blob([\n        `\n        importScripts('https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.4/xlsx.full.min.js');\n            onmessage = function(e) {\n            const fileData = e.data;\n            const workbook = XLSX.read(fileData, { type: 'array' });\n            const sheetName = workbook.SheetNames[0];\n            const sheet = workbook.Sheets[sheetName];\n            const data = XLSX.utils.sheet_to_json(sheet, { header: 1 });\n            postMessage(data);\n            };\n            `,\n            ]),\n            ),\n            );\n            \n            // 使用FileReader读取文件内容\n            const reader = new FileReader();\n            \n                reader.onload = function (e: any) {\n                const data = new Uint8Array(e.target.result);\n                worker.postMessage(data);\n                };\n                \n                // 读取文件\n                reader.readAsArrayBuffer(file);\n                \n                // 监听Web Worker返回的消息\n                    worker.onmessage = function (e) {\n                    console.log('解析完成', e.data);\n                    worker.terminate(); // 当任务完成后，终止Web Worker\n                    };\n                    };\n```\n\n### 下载文件\n\n同样也可以应用在下载文件上，下载文件其实就是有一个url赋予到a标签上，然后点击a标签就能下载了，我们也可以用`URL.createObjectURL`去生成一个临时url\n\n```ts\n// 创建文件 Blob\nconst blob = new Blob([/* 文件数据 */], { type: 'application/pdf' });\n\n// 创建下载链接\nconst downloadUrl = URL.createObjectURL(blob);\nconst downloadLink = document.createElement('a');\ndownloadLink.href = downloadUrl;\ndownloadLink.download = 'document.pdf';\ndownloadLink.textContent = 'Download PDF';\ndocument.body.appendChild(downloadLink);\n```\n\n结语 & 加学习群 & 摸鱼群\n---------------\n\n我是林三心\n\n*   一个待过**小型toG型外包公司、大型外包公司、小公司、潜力型创业公司、大公司**的作死型前端选手；\n*   一个偏前端的全干工程师；\n*   一个不正经的掘金作者；\n*   一个逗比的B站up主；\n*   一个不帅的小红书博主；\n*   一个喜欢打铁的篮球菜鸟；\n*   一个喜欢历史的乏味少年；\n*   一个喜欢rap的五音不全弱鸡\n\n如果你想一起学习前端，一起摸鱼，一起研究简历优化，一起研究面试进步，一起交流历史音乐篮球rap，可以来俺的摸鱼学习群哈哈，点这个，有7000多名前端小伙伴在等着一起学习哦 --> [摸鱼沸点](https://juejin.cn/pin/7035153948126216206 \"https://juejin.cn/pin/7035153948126216206\")",
	"selfDefined": "likes:191,comments:14,collects:295,likes:7337"
}