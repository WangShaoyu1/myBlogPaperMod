{
	"title": "çœ‹äº†å°±ä¼šï¼Œæ‰‹å†™PromiseåŸç†ï¼Œæœ€é€šä¿—æ˜“æ‡‚çš„ç‰ˆæœ¬ï¼ï¼ï¼",
	"author": "Sunshine_Lin",
	"publishTime": "2021-08-10",
	"readTime": "é˜…è¯»11åˆ†é’Ÿ",
	"tags": "[\"å‰ç«¯\",\"JavaScriptä¸­æ–‡æŠ€æœ¯ç¤¾åŒº\",\"å‰ç«¯å¼€å‘ç¤¾åŒº\",\"å‰ç«¯æŠ€æœ¯äº¤æµ\",\"å‰ç«¯æ¡†æ¶æ•™ç¨‹\",\"JavaScript å­¦ä¹ èµ„æº\",\"CSS æŠ€å·§ä¸æœ€ä½³å®è·µ\",\"HTML5 æœ€æ–°åŠ¨æ€\",\"å‰ç«¯å·¥ç¨‹å¸ˆèŒä¸šå‘å±•\",\"å¼€æºå‰ç«¯é¡¹ç›®\",\"å‰ç«¯æŠ€æœ¯è¶‹åŠ¿\"]",
	"description": "å‰è¨€ å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯æ—ä¸‰å¿ƒï¼Œç›¸ä¿¡å¤§å®¶åœ¨æ—¥å¸¸å¼€å‘ä¸­éƒ½ç”¨è¿‡Promiseï¼Œæˆ‘ä¸€ç›´æœ‰ä¸ªæ¢¦æƒ³ï¼Œå°±æ˜¯ä»¥æœ€é€šä¿—çš„è¯ï¼Œè®²æœ€å¤æ‚çš„çŸ¥è¯†ï¼Œæ‰€ä»¥æˆ‘æŠŠé€šä¿—æ˜“æ‡‚æ”¾åœ¨äº†é¦–ä½ï¼Œä»Šå¤©å°±å¸¦å¤§å®¶æ‰‹å†™å®ç°ä»¥ä¸‹Promiseå§ï¼Œç›¸ä¿¡å¤§å®¶ä¸€çœ‹",
	"article": "å‰è¨€\n--\n\nå¤§å®¶å¥½ï¼Œæˆ‘æ˜¯æ—ä¸‰å¿ƒï¼Œç›¸ä¿¡å¤§å®¶åœ¨æ—¥å¸¸å¼€å‘ä¸­éƒ½ç”¨è¿‡**Promise**ï¼Œæˆ‘ä¸€ç›´æœ‰ä¸ªæ¢¦æƒ³ï¼Œå°±æ˜¯**ä»¥æœ€é€šä¿—çš„è¯ï¼Œè®²æœ€å¤æ‚çš„çŸ¥è¯†**ï¼Œæ‰€ä»¥æˆ‘æŠŠ**é€šä¿—æ˜“æ‡‚**æ”¾åœ¨äº†é¦–ä½ï¼Œä»Šå¤©å°±å¸¦å¤§å®¶æ‰‹å†™å®ç°ä»¥ä¸‹**Promiseå§**ï¼Œç›¸ä¿¡å¤§å®¶ä¸€çœ‹å°±æ‡‚ã€‚\n\n![image.png](/images/jueJin/032d1f70ba34471.png)\n\nresolveå’Œreject\n--------------\n\nå’±ä»¬æ¥çœ‹ä¸€æ®µPromiseçš„ä»£ç ï¼š\n\n```js\n    let p1 = new Promise((resolve, reject) => {\n    resolve('æˆåŠŸ')\n    reject('å¤±è´¥')\n    })\n    console.log('p1', p1)\n    \n        let p2 = new Promise((resolve, reject) => {\n        reject('å¤±è´¥')\n        resolve('æˆåŠŸ')\n        })\n        console.log('p2', p2)\n        \n            let p3 = new Promise((resolve, reject) => {\n            throw('æŠ¥é”™')\n            })\n            console.log('p3', p3)\n            \n```\n\né‚£ä¹ˆä¼šè¾“å‡ºä»€ä¹ˆå‘¢ï¼Ÿè¯·çœ‹ï¼š\n\n![æˆªå±2021-08-01 ä¸Šåˆ11.53.33.png](/images/jueJin/db87e7956fa2465.png)\n\nè¿™é‡Œæš´éœ²å‡ºäº†å››ä¸ªçŸ¥è¯†ç‚¹ï¼š\n\n*   1ã€æ‰§è¡Œäº†`resolve`ï¼ŒPromiseçŠ¶æ€ä¼šå˜æˆ`fulfilled`\n*   2ã€æ‰§è¡Œäº†`reject`ï¼ŒPromiseçŠ¶æ€ä¼šå˜æˆ`rejected`\n*   3ã€Promiseåªä»¥`ç¬¬ä¸€æ¬¡ä¸ºå‡†`ï¼Œç¬¬ä¸€æ¬¡æˆåŠŸå°±`æ°¸ä¹…`ä¸º`fulfilled`ï¼Œç¬¬ä¸€æ¬¡å¤±è´¥å°±æ°¸è¿œçŠ¶æ€ä¸º`rejected`\n*   4ã€Promiseä¸­æœ‰`throw`çš„è¯ï¼Œå°±ç›¸å½“äºæ‰§è¡Œäº†`reject` é‚£ä¹ˆå’±ä»¬å°±æŠŠè¿™å››ä¸ªçŸ¥è¯†ç‚¹ä¸€æ­¥æ­¥å®ç°å§ï¼ï¼ï¼\n\n### 1ã€å®ç°resolveä¸reject\n\nå¤§å®¶è¦æ³¨æ„ï¼šPromiseçš„åˆå§‹çŠ¶æ€æ˜¯`pending`\n\nè¿™é‡Œå¾ˆé‡è¦çš„ä¸€æ­¥æ˜¯`resolveå’Œrejectçš„ç»‘å®šthis`ï¼Œä¸ºä»€ä¹ˆè¦ç»‘å®š`this`å‘¢ï¼Ÿè¿™æ˜¯ä¸ºäº†resolveå’Œrejectçš„`thisæŒ‡å‘`æ°¸è¿œæŒ‡å‘å½“å‰çš„`MyPromiseå®ä¾‹`ï¼Œé˜²æ­¢éšç€å‡½æ•°æ‰§è¡Œç¯å¢ƒçš„æ”¹å˜è€Œæ”¹å˜\n\n```js\n    class MyPromise {\n    // æ„é€ æ–¹æ³•\n        constructor(executor) {\n        \n        // åˆå§‹åŒ–å€¼\n        this.initValue()\n        // åˆå§‹åŒ–thisæŒ‡å‘\n        this.initBind()\n        // æ‰§è¡Œä¼ è¿›æ¥çš„å‡½æ•°\n        executor(this.resolve, this.reject)\n    }\n    \n        initBind() {\n        // åˆå§‹åŒ–this\n        this.resolve = this.resolve.bind(this)\n        this.reject = this.reject.bind(this)\n    }\n    \n        initValue() {\n        // åˆå§‹åŒ–å€¼\n        this.PromiseResult = null // ç»ˆå€¼\n        this.PromiseState = 'pending' // çŠ¶æ€\n    }\n    \n        resolve(value) {\n        // å¦‚æœæ‰§è¡Œresolveï¼ŒçŠ¶æ€å˜ä¸ºfulfilled\n        this.PromiseState = 'fulfilled'\n        // ç»ˆå€¼ä¸ºä¼ è¿›æ¥çš„å€¼\n        this.PromiseResult = value\n    }\n    \n        reject(reason) {\n        // å¦‚æœæ‰§è¡Œrejectï¼ŒçŠ¶æ€å˜ä¸ºrejected\n        this.PromiseState = 'rejected'\n        // ç»ˆå€¼ä¸ºä¼ è¿›æ¥çš„reason\n        this.PromiseResult = reason\n    }\n}\n```\n\nå’±ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ä»£ç å§ï¼š\n\n```js\n    const test1 = new MyPromise((resolve, reject) => {\n    resolve('æˆåŠŸ')\n    })\nconsole.log(test1) // MyPromise { PromiseState: 'fulfilled', PromiseResult: 'æˆåŠŸ' }\n\n    const test2 = new MyPromise((resolve, reject) => {\n    reject('å¤±è´¥')\n    })\nconsole.log(test2) // MyPromise { PromiseState: 'rejected', PromiseResult: 'å¤±è´¥' }\n```\n\n### 2\\. çŠ¶æ€ä¸å¯å˜\n\nå…¶å®ä¸Šé¢çš„ä»£ç æ˜¯æœ‰é—®é¢˜çš„ï¼Œä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿçœ‹çœ‹ï¼š\n\n```js\n    const test1 = new MyPromise((resolve, reject) => {\n    resolve('æˆåŠŸ')\n    reject('å¤±è´¥')\n    })\nconsole.log(test1) // MyPromise { PromiseState: 'rejected', PromiseResult: 'å¤±è´¥' }\n```\n\næ­£ç¡®çš„åº”è¯¥æ˜¯çŠ¶æ€ä¸º`fulfilled`ï¼Œç»“æœæ˜¯`æˆåŠŸ`ï¼Œè¿™é‡Œæ˜æ˜¾æ²¡æœ‰`ä»¥ç¬¬ä¸€æ¬¡ä¸ºå‡†`\n\nä¹‹å‰è¯´äº†ï¼ŒPromiseåªä»¥`ç¬¬ä¸€æ¬¡ä¸ºå‡†`ï¼Œç¬¬ä¸€æ¬¡æˆåŠŸå°±`æ°¸ä¹…`ä¸º`fulfilled`ï¼Œç¬¬ä¸€æ¬¡å¤±è´¥å°±æ°¸è¿œçŠ¶æ€ä¸º`rejected`ï¼Œå…·ä½“æ˜¯ä»€ä¹ˆæµç¨‹å‘¢ï¼Ÿæˆ‘ç»™å¤§å®¶ç”»äº†ä¸€å¼ å›¾ï¼š\n\nPromiseæœ‰ä¸‰ç§çŠ¶æ€ï¼š\n\n*   `pending`ï¼šç­‰å¾…ä¸­ï¼Œæ˜¯åˆå§‹çŠ¶æ€\n*   `fulfilled`ï¼šæˆåŠŸçŠ¶æ€\n*   `rejected`ï¼šå¤±è´¥çŠ¶æ€\n\nä¸€æ—¦çŠ¶æ€ä»`pending`å˜ä¸º`fulfilledæˆ–è€…rejected`ï¼Œé‚£ä¹ˆæ­¤Promiseå®ä¾‹çš„çŠ¶æ€å°±å®šæ­»äº†ã€‚ ![æˆªå±2021-08-01 ä¸‹åˆ12.33.10.png](/images/jueJin/2c9636d819ef4bc.png)\n\nå…¶å®å®ç°èµ·æ¥ä¹Ÿå¾ˆå®¹æ˜“ï¼ŒåŠ ä¸ªåˆ¤æ–­æ¡ä»¶å°±è¡Œï¼š\n\n```js\n    resolve(value) {\n    // stateæ˜¯ä¸å¯å˜çš„\n    +        if (this.PromiseState !== 'pending') return\n    // å¦‚æœæ‰§è¡Œresolveï¼ŒçŠ¶æ€å˜ä¸ºfulfilled\n    this.PromiseState = 'fulfilled'\n    // ç»ˆå€¼ä¸ºä¼ è¿›æ¥çš„å€¼\n    this.PromiseResult = value\n}\n\n    reject(reason) {\n    // stateæ˜¯ä¸å¯å˜çš„\n    +        if (this.PromiseState !== 'pending') return\n    // å¦‚æœæ‰§è¡Œrejectï¼ŒçŠ¶æ€å˜ä¸ºrejected\n    this.PromiseState = 'rejected'\n    // ç»ˆå€¼ä¸ºä¼ è¿›æ¥çš„reason\n    this.PromiseResult = reason\n}\n```\n\nå†æ¥çœ‹çœ‹æ•ˆæœï¼š\n\n```js\n    const test1 = new MyPromise((resolve, reject) => {\n    // åªä»¥ç¬¬ä¸€æ¬¡ä¸ºå‡†\n    resolve('æˆåŠŸ')\n    reject('å¤±è´¥')\n    })\nconsole.log(test1) // MyPromise { PromiseState: 'fulfilled', PromiseResult: 'æˆåŠŸ' }\n```\n\n### 3\\. throw\n\n![æˆªå±2021-08-01 ä¸‹åˆ12.57.17.png](/images/jueJin/fa2e17b24a124da.png)\n\nPromiseä¸­æœ‰`throw`çš„è¯ï¼Œå°±ç›¸å½“äºæ‰§è¡Œäº†`reject`ã€‚è¿™å°±è¦ä½¿ç”¨`try catch`äº†\n\n```js\n    +        try {\n    // æ‰§è¡Œä¼ è¿›æ¥çš„å‡½æ•°\n    executor(this.resolve, this.reject)\n        +        } catch (e) {\n        // æ•æ‰åˆ°é”™è¯¯ç›´æ¥æ‰§è¡Œreject\n        +            this.reject(e)\n    +        }\n```\n\nå’±ä»¬æ¥çœ‹çœ‹æ•ˆæœï¼š\n\n```js\n    const test3 = new MyPromise((resolve, reject) => {\n    throw('å¤±è´¥')\n    })\nconsole.log(test3) // MyPromise { PromiseState: 'rejected', PromiseResult: 'å¤±è´¥' }\n```\n\nthen\n----\n\nå’±ä»¬å¹³æ—¶ä½¿ç”¨thenæ–¹æ³•æ˜¯è¿™ä¹ˆç”¨çš„ï¼š\n\n```js\n// é©¬ä¸Šè¾“å‡º â€æˆåŠŸâ€œ\n    const p1 = new Promise((resolve, reject) => {\n    resolve('æˆåŠŸ')\n    }).then(res => console.log(res), err => console.log(err))\n    \n    // 1ç§’åè¾“å‡º â€å¤±è´¥â€œ\n        const p2 = new Promise((resolve, reject) => {\n            setTimeout(() => {\n            reject('å¤±è´¥')\n            }, 1000)\n            }).then(res => console.log(res), err => console.log(err))\n            \n            // é“¾å¼è°ƒç”¨ è¾“å‡º 200\n                const p3 = new Promise((resolve, reject) => {\n                resolve(100)\n                }).then(res => 2 * res, err => console.log(err))\n                .then(res => console.log(res), err => console.log(err))\n```\n\nå¯ä»¥æ€»ç»“å‡ºè¿™å‡ ä¸ªçŸ¥è¯†ç‚¹ï¼š\n\n*   thenæ¥æ”¶ä¸¤ä¸ªå›è°ƒï¼Œä¸€ä¸ªæ˜¯`æˆåŠŸå›è°ƒ`ï¼Œä¸€ä¸ªæ˜¯`å¤±è´¥å›è°ƒ`\n*   å½“PromiseçŠ¶æ€ä¸º`fulfilled`æ‰§è¡Œ`æˆåŠŸå›è°ƒ`ï¼Œä¸º`rejected`æ‰§è¡Œ`å¤±è´¥å›è°ƒ`\n*   å¦‚resolveæˆ–rejectåœ¨å®šæ—¶å™¨é‡Œï¼Œ`åˆ™å®šæ—¶å™¨ç»“æŸåå†æ‰§è¡Œthen`\n*   thenæ”¯æŒ`é“¾å¼è°ƒç”¨`ï¼Œä¸‹ä¸€æ¬¡thenæ‰§è¡Œ`å—ä¸Šä¸€æ¬¡thenè¿”å›å€¼çš„å½±å“`\n\nä¸‹é¢å’±ä»¬å°±ä¸€æ­¥ä¸€æ­¥åœ°å»å®ç°ä»–å§\n\n### 1\\. å®ç°then\n\n```js\n    then(onFulfilled, onRejected) {\n    // æ¥æ”¶ä¸¤ä¸ªå›è°ƒ onFulfilled, onRejected\n    \n    // å‚æ•°æ ¡éªŒï¼Œç¡®ä¿ä¸€å®šæ˜¯å‡½æ•°\n    onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : val => val\nonRejected = typeof onRejected === 'function' ? onRejected : reason => { throw reason }\n\n    if (this.PromiseState === 'fulfilled') {\n    // å¦‚æœå½“å‰ä¸ºæˆåŠŸçŠ¶æ€ï¼Œæ‰§è¡Œç¬¬ä¸€ä¸ªå›è°ƒ\n    onFulfilled(this.PromiseResult)\n        } else if (this.PromiseState === 'rejected') {\n        // å¦‚æœå½“å‰ä¸ºå¤±è´¥çŠ¶æ€ï¼Œæ‰§è¡Œç¬¬äºŒå“¥å›è°ƒ\n        onRejected(this.PromiseResult)\n    }\n    \n}\n```\n\nå’±ä»¬æ¥çœ‹çœ‹æ•ˆæœï¼š\n\n```js\n// è¾“å‡º â€æˆåŠŸâ€œ\n    const test = new MyPromise((resolve, reject) => {\n    resolve('æˆåŠŸ')\n    }).then(res => console.log(res), err => console.log(err))\n```\n\n### 2\\. å®šæ—¶å™¨æƒ…å†µ\n\nä¸Šé¢æˆ‘ä»¬å·²ç»å®ç°äº†`then`çš„åŸºæœ¬åŠŸèƒ½ã€‚é‚£å¦‚æœæ˜¯`å®šæ—¶å™¨`æƒ…å†µå‘¢ï¼Ÿ\n\nè¿˜æ˜¯é‚£ä¸ªä»£ç ï¼Œæ€ä¹ˆæ‰èƒ½ä¿è¯ï¼Œ1ç§’åæ‰æ‰§è¡Œthené‡Œçš„å¤±è´¥å›è°ƒå‘¢ï¼Ÿ\n\n```js\n// 1ç§’åè¾“å‡º â€æˆåŠŸâ€œ\n    const p2 = new Promise((resolve, reject) => {\n        setTimeout(() => {\n        reject('å¤±è´¥')\n        }, 1000)\n        }).then(res => console.log(res), err => console.log(err))\n```\n\næˆ‘ä»¬ä¸èƒ½ç¡®ä¿1ç§’åæ‰æ‰§è¡Œthenå‡½æ•°ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ä¿è¯1ç§’åå†æ‰§è¡Œthené‡Œçš„å›è°ƒï¼Œå¯èƒ½è¿™é‡Œå¤§å®¶æœ‰ç‚¹æ‡µé€¼ï¼Œæˆ‘åŒæ ·ç”¨ä¸€å¼ å›¾ç»™å¤§å®¶è®²è®²å§ï¼š\n\n![æˆªå±2021-08-01 ä¸‹åˆ9.05.24.png](/images/jueJin/6ba5a2544b11445.png)\n\nä¹Ÿå°±æ˜¯åœ¨è¿™1ç§’æ—¶é—´å†…ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆæŠŠthené‡Œçš„ä¸¤ä¸ªå›è°ƒä¿å­˜èµ·æ¥ï¼Œç„¶åç­‰åˆ°1ç§’è¿‡åï¼Œæ‰§è¡Œäº†resolveæˆ–è€…rejectï¼Œå’±ä»¬å†å»åˆ¤æ–­çŠ¶æ€ï¼Œå¹¶ä¸”åˆ¤æ–­è¦å»æ‰§è¡Œåˆšåˆšä¿å­˜çš„ä¸¤ä¸ªå›è°ƒä¸­çš„å“ªä¸€ä¸ªå›è°ƒã€‚\n\né‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæˆ‘ä»¬æ€ä¹ˆçŸ¥é“å½“å‰1ç§’è¿˜æ²¡èµ°å®Œç”šè‡³è¿˜æ²¡å¼€å§‹èµ°å‘¢ï¼Ÿå…¶å®å¾ˆå¥½åˆ¤æ–­ï¼Œåªè¦çŠ¶æ€æ˜¯`pending`ï¼Œé‚£å°±è¯æ˜å®šæ—¶å™¨è¿˜æ²¡è·‘å®Œï¼Œå› ä¸ºå¦‚æœå®šæ—¶å™¨è·‘å®Œçš„è¯ï¼Œé‚£çŠ¶æ€è‚¯å®šå°±ä¸æ˜¯`pending`ï¼Œè€Œæ˜¯`fulfilledæˆ–è€…rejected`\n\né‚£æ˜¯ç”¨ä»€ä¹ˆæ¥ä¿å­˜è¿™äº›å›è°ƒå‘¢ï¼Ÿå»ºè®®ä½¿ç”¨`æ•°ç»„`ï¼Œå› ä¸ºä¸€ä¸ªpromiseå®ä¾‹å¯èƒ½ä¼š`å¤šæ¬¡then`ï¼Œç”¨æ•°ç»„å°±ä¸€ä¸ªä¸€ä¸ªä¿å­˜äº†\n\n```js\n    initValue() {\n    // åˆå§‹åŒ–å€¼\n    this.PromiseResult = null // ç»ˆå€¼\n    this.PromiseState = 'pending' // çŠ¶æ€\n    +        this.onFulfilledCallbacks = [] // ä¿å­˜æˆåŠŸå›è°ƒ\n    +        this.onRejectedCallbacks = [] // ä¿å­˜å¤±è´¥å›è°ƒ\n}\n\n    resolve(value) {\n    // stateæ˜¯ä¸å¯å˜çš„\n    if (this.PromiseState !== 'pending') return\n    // å¦‚æœæ‰§è¡Œresolveï¼ŒçŠ¶æ€å˜ä¸ºfulfilled\n    this.PromiseState = 'fulfilled'\n    // ç»ˆå€¼ä¸ºä¼ è¿›æ¥çš„å€¼\n    this.PromiseResult = value\n    // æ‰§è¡Œä¿å­˜çš„æˆåŠŸå›è°ƒ\n        +        while (this.onFulfilledCallbacks.length) {\n        +            this.onFulfilledCallbacks.shift()(this.PromiseResult)\n    +        }\n}\n\n    reject(reason) {\n    // stateæ˜¯ä¸å¯å˜çš„\n    if (this.PromiseState !== 'pending') return\n    // å¦‚æœæ‰§è¡Œrejectï¼ŒçŠ¶æ€å˜ä¸ºrejected\n    this.PromiseState = 'rejected'\n    // ç»ˆå€¼ä¸ºä¼ è¿›æ¥çš„reason\n    this.PromiseResult = reason\n    // æ‰§è¡Œä¿å­˜çš„å¤±è´¥å›è°ƒ\n        +        while (this.onRejectedCallbacks.length) {\n        +            this.onRejectedCallbacks.shift()(this.PromiseResult)\n    +        }\n}\n\n    then(onFulfilled, onRejected) {\n    // æ¥æ”¶ä¸¤ä¸ªå›è°ƒ onFulfilled, onRejected\n    \n    // å‚æ•°æ ¡éªŒï¼Œç¡®ä¿ä¸€å®šæ˜¯å‡½æ•°\n    onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : val => val\nonRejected = typeof onRejected === 'function' ? onRejected : reason => { throw reason }\n\n    if (this.PromiseState === 'fulfilled') {\n    // å¦‚æœå½“å‰ä¸ºæˆåŠŸçŠ¶æ€ï¼Œæ‰§è¡Œç¬¬ä¸€ä¸ªå›è°ƒ\n    onFulfilled(this.PromiseResult)\n        } else if (this.PromiseState === 'rejected') {\n        // å¦‚æœå½“å‰ä¸ºå¤±è´¥çŠ¶æ€ï¼Œæ‰§è¡Œç¬¬äºŒå“¥å›è°ƒ\n        onRejected(this.PromiseResult)\n            +        } else if (this.PromiseState === 'pending') {\n            +            // å¦‚æœçŠ¶æ€ä¸ºå¾…å®šçŠ¶æ€ï¼Œæš‚æ—¶ä¿å­˜ä¸¤ä¸ªå›è°ƒ\n            +            this.onFulfilledCallbacks.push(onFulfilled.bind(this))\n            +            this.onRejectedCallbacks.push(onRejected.bind(this))\n        +        }\n        \n    }\n    \n```\n\nåŠ å®Œä¸Šé¢çš„ä»£ç ï¼Œå’±ä»¬æ¥çœ‹çœ‹å®šæ—¶å™¨çš„æ•ˆæœå§ï¼š\n\n```js\n    const test2 = new MyPromise((resolve, reject) => {\n        setTimeout(() => {\n        resolve('æˆåŠŸ') // 1ç§’åè¾“å‡º æˆåŠŸ\n        // resolve('æˆåŠŸ') // 1ç§’åè¾“å‡º å¤±è´¥\n        }, 1000)\n        }).then(res => console.log(res), err => console.log(err))\n```\n\n### 3\\. é“¾å¼è°ƒç”¨\n\nthenæ”¯æŒ`é“¾å¼è°ƒç”¨`ï¼Œä¸‹ä¸€æ¬¡thenæ‰§è¡Œ`å—ä¸Šä¸€æ¬¡thenè¿”å›å€¼çš„å½±å“`ï¼Œç»™å¤§å®¶ä¸¾ä¸ªä¾‹å­ï¼š\n\n```js\n// é“¾å¼è°ƒç”¨ è¾“å‡º 200\n    const p3 = new Promise((resolve, reject) => {\n    resolve(100)\n    }).then(res => 2 * res, err => console.log(err))\n    .then(res => console.log(res), err => console.log(err))\n    \n    // é“¾å¼è°ƒç”¨ è¾“å‡º300\n        const p4 = new Promise((resolve, reject) => {\n        resolve(100)\n        }).then(res => new Promise((resolve, reject) => resolve(3 * res)), err => console.log(err))\n        .then(res => console.log(res), err => console.log(err))\n```\n\nä»ä¸Šæ–¹ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥è·å–åˆ°å‡ ä¸ªçŸ¥è¯†ç‚¹ï¼š\n\n*   1ã€thenæ–¹æ³•æœ¬èº«ä¼šè¿”å›ä¸€ä¸ªæ–°çš„Promiseå¯¹è±¡\n*   2ã€å¦‚æœè¿”å›å€¼æ˜¯promiseå¯¹è±¡ï¼Œè¿”å›å€¼ä¸ºæˆåŠŸï¼Œæ–°promiseå°±æ˜¯æˆåŠŸ\n*   3ã€å¦‚æœè¿”å›å€¼æ˜¯promiseå¯¹è±¡ï¼Œè¿”å›å€¼ä¸ºå¤±è´¥ï¼Œæ–°promiseå°±æ˜¯å¤±è´¥\n*   4ã€å¦‚æœè¿”å›å€¼épromiseå¯¹è±¡ï¼Œæ–°promiseå¯¹è±¡å°±æ˜¯æˆåŠŸï¼Œå€¼ä¸ºæ­¤è¿”å›å€¼\n\nå’±ä»¬çŸ¥é“thenæ˜¯Promiseä¸Šçš„æ–¹æ³•ï¼Œé‚£å¦‚ä½•å®ç°thenå®Œè¿˜èƒ½å†thenå‘¢ï¼Ÿå¾ˆç®€å•ï¼Œthenæ‰§è¡Œåè¿”å›ä¸€ä¸ª`Promiseå¯¹è±¡`å°±è¡Œäº†ï¼Œå°±èƒ½ä¿è¯thenå®Œè¿˜èƒ½ç»§ç»­æ‰§è¡Œthenï¼š\n\n![æˆªå±2021-08-01 ä¸‹åˆ9.06.02.png](/images/jueJin/62a3c3afcf0a426.png)\n\nä»£ç å®ç°ï¼š\n\n```js\n    then(onFulfilled, onRejected) {\n    // æ¥æ”¶ä¸¤ä¸ªå›è°ƒ onFulfilled, onRejected\n    \n    // å‚æ•°æ ¡éªŒï¼Œç¡®ä¿ä¸€å®šæ˜¯å‡½æ•°\n    onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : val => val\nonRejected = typeof onRejected === 'function' ? onRejected : reason => { throw reason }\n\n\n    var thenPromise = new MyPromise((resolve, reject) => {\n    \n        const resolvePromise = cb => {\n            try {\n            const x = cb(this.PromiseResult)\n                if (x === thenPromise) {\n                // ä¸èƒ½è¿”å›è‡ªèº«å“¦\n                throw new Error('ä¸èƒ½è¿”å›è‡ªèº«ã€‚ã€‚ã€‚')\n            }\n                if (x instanceof MyPromise) {\n                // å¦‚æœè¿”å›å€¼æ˜¯Promise\n                // å¦‚æœè¿”å›å€¼æ˜¯promiseå¯¹è±¡ï¼Œè¿”å›å€¼ä¸ºæˆåŠŸï¼Œæ–°promiseå°±æ˜¯æˆåŠŸ\n                // å¦‚æœè¿”å›å€¼æ˜¯promiseå¯¹è±¡ï¼Œè¿”å›å€¼ä¸ºå¤±è´¥ï¼Œæ–°promiseå°±æ˜¯å¤±è´¥\n                // è°çŸ¥é“è¿”å›çš„promiseæ˜¯å¤±è´¥æˆåŠŸï¼Ÿåªæœ‰thençŸ¥é“\n                x.then(resolve, reject)\n                    } else {\n                    // éPromiseå°±ç›´æ¥æˆåŠŸ\n                    resolve(x)\n                }\n                    } catch (err) {\n                    // å¤„ç†æŠ¥é”™\n                    reject(err)\n                    throw new Error(err)\n                }\n            }\n            \n                if (this.PromiseState === 'fulfilled') {\n                // å¦‚æœå½“å‰ä¸ºæˆåŠŸçŠ¶æ€ï¼Œæ‰§è¡Œç¬¬ä¸€ä¸ªå›è°ƒ\n                resolvePromise(onFulfilled)\n                    } else if (this.PromiseState === 'rejected') {\n                    // å¦‚æœå½“å‰ä¸ºå¤±è´¥çŠ¶æ€ï¼Œæ‰§è¡Œç¬¬äºŒä¸ªå›è°ƒ\n                    resolvePromise(onRejected)\n                        } else if (this.PromiseState === 'pending') {\n                        // å¦‚æœçŠ¶æ€ä¸ºå¾…å®šçŠ¶æ€ï¼Œæš‚æ—¶ä¿å­˜ä¸¤ä¸ªå›è°ƒ\n                        // å¦‚æœçŠ¶æ€ä¸ºå¾…å®šçŠ¶æ€ï¼Œæš‚æ—¶ä¿å­˜ä¸¤ä¸ªå›è°ƒ\n                        this.onFulfilledCallbacks.push(resolvePromise.bind(this, onFulfilled))\n                        this.onRejectedCallbacks.push(resolvePromise.bind(this, onRejected))\n                    }\n                    })\n                    \n                    // è¿”å›è¿™ä¸ªåŒ…è£…çš„Promise\n                    return thenPromise\n                    \n                }\n```\n\nç°åœ¨å¤§å®¶å¯ä»¥è¯•è¯•æ•ˆæœæ€ä¹ˆæ ·äº†ï¼Œå¤§å®¶è¦**è¾¹æ•²è¾¹è¯•**å“¦ï¼š\n\n```js\n    const test3 = new Promise((resolve, reject) => {\n    resolve(100) // è¾“å‡º çŠ¶æ€ï¼šæˆåŠŸ å€¼ï¼š 200\n    // reject(100) // è¾“å‡º çŠ¶æ€ï¼šæˆåŠŸ å€¼ï¼š300\n    }).then(res => 2 * res, err => 3 * err)\n    .then(res => console.log('æˆåŠŸ', res), err => console.log('å¤±è´¥', err))\n    \n    \n        const test4 = new Promise((resolve, reject) => {\n        resolve(100) // è¾“å‡º çŠ¶æ€ï¼šå¤±è´¥ å€¼ï¼š200\n        // reject(100) // è¾“å‡º çŠ¶æ€ï¼šæˆåŠŸ å€¼ï¼š300\n        // è¿™é‡Œå¯æ²¡æåå“¦ã€‚çœŸçš„ææ‡‚äº†ï¼Œå°±çŸ¥é“äº†ä¸ºå•¥è¿™é‡Œæ˜¯åçš„\n        }).then(res => new Promise((resolve, reject) => reject(2 * res)), err => new Promise((resolve, reject) => resolve(3 * err)))\n        .then(res => console.log('æˆåŠŸ', res), err => console.log('å¤±è´¥', err))\n```\n\n### 4\\. å¾®ä»»åŠ¡\n\nçœ‹è¿‡`jsæ‰§è¡Œæœºåˆ¶`çš„å…„å¼Ÿéƒ½çŸ¥é“ï¼Œthenæ–¹æ³•æ˜¯`å¾®ä»»åŠ¡`ï¼Œå•¥å«å¾®ä»»åŠ¡å‘¢ï¼Ÿå…¶å®ä¸çŸ¥é“ä¹Ÿä¸è¦ç´§ï¼Œæˆ‘é€šè¿‡ä¸‹é¢ä¾‹å­è®©ä½ çŸ¥é“ï¼š\n\n```js\n    const p = new Promise((resolve, reject) => {\n    resolve(1)\n    }).then(res => console.log(res), err => console.log(err))\n    \n    console.log(2)\n    \n    è¾“å‡ºé¡ºåºæ˜¯ 2 1\n```\n\nä¸ºå•¥ä¸æ˜¯ 1 2 å‘¢ï¼Ÿå› ä¸ºthenæ˜¯ä¸ªå¾®ä»»åŠ¡å•Šã€‚ã€‚ã€‚åŒæ ·ï¼Œæˆ‘ä»¬ä¹Ÿè¦ç»™æˆ‘ä»¬çš„MyPromiseåŠ ä¸Šè¿™ä¸ªç‰¹æ€§(æˆ‘è¿™é‡Œä½¿ç”¨å®šæ—¶å™¨ï¼Œå¤§å®¶åˆ«ä»‹æ„å“ˆ)\n\nåªéœ€è¦è®©`resolvePromiseå‡½æ•°`å¼‚æ­¥æ‰§è¡Œå°±å¯ä»¥äº†\n\n```js\n    const resolvePromise = cb => {\n        setTimeout(() => {\n            try {\n            const x = cb(this.PromiseResult)\n                if (x === thenPromise) {\n                // ä¸èƒ½è¿”å›è‡ªèº«å“¦\n                throw new Error('ä¸èƒ½è¿”å›è‡ªèº«ã€‚ã€‚ã€‚')\n            }\n                if (x instanceof MyPromise) {\n                // å¦‚æœè¿”å›å€¼æ˜¯Promise\n                // å¦‚æœè¿”å›å€¼æ˜¯promiseå¯¹è±¡ï¼Œè¿”å›å€¼ä¸ºæˆåŠŸï¼Œæ–°promiseå°±æ˜¯æˆåŠŸ\n                // å¦‚æœè¿”å›å€¼æ˜¯promiseå¯¹è±¡ï¼Œè¿”å›å€¼ä¸ºå¤±è´¥ï¼Œæ–°promiseå°±æ˜¯å¤±è´¥\n                // è°çŸ¥é“è¿”å›çš„promiseæ˜¯å¤±è´¥æˆåŠŸï¼Ÿåªæœ‰thençŸ¥é“\n                x.then(resolve, reject)\n                    } else {\n                    // éPromiseå°±ç›´æ¥æˆåŠŸ\n                    resolve(x)\n                }\n                    } catch (err) {\n                    // å¤„ç†æŠ¥é”™\n                    reject(err)\n                    throw new Error(err)\n                }\n                })\n            }\n```\n\nçœ‹çœ‹æ•ˆæœï¼š\n\n```js\n    const test4 = new MyPromise((resolve, reject) => {\n    resolve(1)\n    }).then(res => console.log(res), err => console.log(err))\n    \n    console.log(2)\n    \n    è¾“å‡ºé¡ºåº 2 1\n    \n```\n\nå…¶ä»–æ–¹æ³•\n----\n\nè¿™äº›æ–¹æ³•éƒ½æ¯”è¾ƒç®€å•ï¼Œæˆ‘å°±ä¸å¤ªè¿‡è¯¦ç»†åœ°è®²äº†ï¼Œå¤§å®¶ä¹Ÿå¯ä»¥å€Ÿè¿™ä¸ªæœºä¼šï¼Œè‡ªå·±æ‘¸ç´¢ï¼Œå·©å›ºè¿™ç¯‡æ–‡ç« çš„çŸ¥è¯†ã€‚\n\n### all\n\n*   æ¥æ”¶ä¸€ä¸ªPromiseæ•°ç»„ï¼Œæ•°ç»„ä¸­å¦‚æœ‰éPromiseé¡¹ï¼Œåˆ™æ­¤é¡¹å½“åšæˆåŠŸ\n*   å¦‚æœæ‰€æœ‰Promiseéƒ½æˆåŠŸï¼Œåˆ™è¿”å›æˆåŠŸç»“æœæ•°ç»„\n*   å¦‚æœæœ‰ä¸€ä¸ªPromiseå¤±è´¥ï¼Œåˆ™è¿”å›è¿™ä¸ªå¤±è´¥ç»“æœ\n\n```js\n    static all(promises) {\nconst result = []\nlet count = 0\n    return new MyPromise((resolve, reject) => {\n        const addData = (index, value) => {\n        result[index] = value\n        count++\n        if (count === promises.length) resolve(result)\n    }\n        promises.forEach((promise, index) => {\n            if (promise instanceof MyPromise) {\n                promise.then(res => {\n                addData(index, res)\n                }, err => reject(err))\n                    } else {\n                    addData(index, promise)\n                }\n                })\n                })\n            }\n```\n\n### race\n\n*   æ¥æ”¶ä¸€ä¸ªPromiseæ•°ç»„ï¼Œæ•°ç»„ä¸­å¦‚æœ‰éPromiseé¡¹ï¼Œåˆ™æ­¤é¡¹å½“åšæˆåŠŸ\n*   å“ªä¸ªPromiseæœ€å¿«å¾—åˆ°ç»“æœï¼Œå°±è¿”å›é‚£ä¸ªç»“æœï¼Œæ— è®ºæˆåŠŸå¤±è´¥\n\n```js\n    static race(promises) {\n        return new MyPromise((resolve, reject) => {\n            promises.forEach(promise => {\n                if (promise instanceof MyPromise) {\n                    promise.then(res => {\n                    resolve(res)\n                        }, err => {\n                        reject(err)\n                        })\n                            } else {\n                            resolve(promise)\n                        }\n                        })\n                        })\n                    }\n```\n\n### allSettled\n\n*   æ¥æ”¶ä¸€ä¸ªPromiseæ•°ç»„ï¼Œæ•°ç»„ä¸­å¦‚æœ‰éPromiseé¡¹ï¼Œåˆ™æ­¤é¡¹å½“åšæˆåŠŸ\n*   æŠŠæ¯ä¸€ä¸ªPromiseçš„ç»“æœï¼Œé›†åˆæˆæ•°ç»„ï¼Œè¿”å›\n\n```js\n    static allSettled(promises) {\n        return new Promise((resolve, reject) => {\n    const res = []\n    let count = 0\n        const addData = (status, value, i) => {\n            res[i] = {\n            status,\n            value\n        }\n        count++\n            if (count === promises.length) {\n            resolve(res)\n        }\n    }\n        promises.forEach((promise, i) => {\n            if (promise instanceof MyPromise) {\n                promise.then(res => {\n                addData('fulfilled', res, i)\n                    }, err => {\n                    addData('rejected', err, i)\n                    })\n                        } else {\n                        addData('fulfilled', promise, i)\n                    }\n                    })\n                    })\n                }\n```\n\n### any\n\nanyä¸allç›¸å\n\n*   æ¥æ”¶ä¸€ä¸ªPromiseæ•°ç»„ï¼Œæ•°ç»„ä¸­å¦‚æœ‰éPromiseé¡¹ï¼Œåˆ™æ­¤é¡¹å½“åšæˆåŠŸ\n*   å¦‚æœæœ‰ä¸€ä¸ªPromiseæˆåŠŸï¼Œåˆ™è¿”å›è¿™ä¸ªæˆåŠŸç»“æœ\n*   å¦‚æœæ‰€æœ‰Promiseéƒ½å¤±è´¥ï¼Œåˆ™æŠ¥é”™\n\n```js\n    static any(promises) {\n        return new Promise((resolve, reject) => {\n        let count = 0\n            promises.forEach((promise) => {\n                promise.then(val => {\n                resolve(val)\n                    }, err => {\n                    count++\n                        if (count === promises.length) {\n                        reject(new AggregateError('All promises were rejected'))\n                    }\n                    })\n                    })\n                    })\n                }\n            }\n```\n\n### ç»“è¯­\n\nå†ä¹Ÿä¸æ€•é¢è¯•å®˜é—®ä½ PromiseåŸç†å•¦å“ˆå“ˆå“ˆå“ˆğŸ˜\n\nå¦‚æœä½ è§‰å¾—æ­¤æ–‡å¯¹ä½ æœ‰ä¸€ä¸ç‚¹å¸®åŠ©ï¼Œç‚¹ä¸ªèµï¼Œé¼“åŠ±ä¸€ä¸‹æ—ä¸‰å¿ƒå“ˆå“ˆã€‚\n\n**å¦‚æœä½ æƒ³ä¸€èµ·å­¦ä¹ å‰ç«¯æˆ–è€…æ‘¸é±¼ï¼Œé‚£ä½ å¯ä»¥åŠ æˆ‘ï¼ŒåŠ å…¥æˆ‘çš„æ‘¸é±¼å­¦ä¹ ç¾¤ï¼Œç‚¹å‡»è¿™é‡Œ**Â ---> [æ‘¸é±¼æ²¸ç‚¹](https://juejin.cn/pin/7035153948126216206 \"https://juejin.cn/pin/7035153948126216206\")\n\n**å¦‚æœä½ æ˜¯æœ‰å…¶ä»–ç›®çš„çš„ï¼Œåˆ«åŠ æˆ‘ï¼Œæˆ‘ä¸æƒ³è·Ÿä½ äº¤æœ‹å‹ï¼Œæˆ‘åªæƒ³ç®€ç®€å•å•å­¦ä¹ å‰ç«¯ï¼Œä¸æƒ³æä¸€äº›æœ‰çš„æ²¡çš„ï¼ï¼ï¼**",
	"selfDefined": "likes:1600,comments:0,collects:2700,likes:78655"
}