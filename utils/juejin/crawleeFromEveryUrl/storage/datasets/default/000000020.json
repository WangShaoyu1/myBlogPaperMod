{
	"title": "每一个前端，都要拥有属于自己的埋点库~",
	"author": "Sunshine_Lin",
	"publishTime": "2024-06-10",
	"readTime": "阅读5分钟",
	"tags": "[\"前端中文技术社区\",\"前端开发社区\",\"前端技术交流\",\"前端框架教程\",\"JavaScript 学习资源\",\"CSS 技巧与最佳实践\",\"HTML5 最新动态\",\"前端工程师职业发展\",\"开源前端项目\",\"前端技术趋势\"]",
	"description": "大家好，我是林三心，用最通俗易懂的话讲最难的知识点是我的座右铭，基础是进阶的前提是我的初心~ 简介 sunshine-track 应用于前端监控， 基于 行为上报，实现了 用户行为、错误监控、页",
	"article": "前言\n--\n\n大家好，我是林三心，用最通俗易懂的话讲最难的知识点是我的座右铭，基础是进阶的前提是我的初心~\n\n![](/images/jueJin/56f153149f154e1.png)\n\n简介\n--\n\n`sunshine-track` 应用于前端监控， 基于 `行为上报`，实现了 `用户行为、错误监控、页面跳转、页面白屏检测、页面性能检测`等上报功能。适用于 `Vue、React、Angular` 等框架\n\n> 本项目源码：[github.com/sanxin-lin/…](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fsanxin-lin%2Fsunshine-track \"https://github.com/sanxin-lin/sunshine-track\") 各位兄弟姐妹如果觉得喜欢的话，可以点个star 哦~\n\n功能\n--\n\n`sunshine-track`具备以下功能：\n\n*   ✅ 用户行为上报：包括 `点击、跳转页面、跳转页面记录数组、请求` 等\n*   ✅ 用户手动上报：提供 `Vue 自定义指令` 以及`add、report`函数，实现用户手动上报\n*   ✅ 自定义上报：提供 `格式化上报数据、自定义上报函数、自定义决定上不上报` 等配置项，更灵活地上报数据\n*   ✅ 请求数据上报：提供 `检测请求返回、过滤请求` 等配置项，让用户决定上报哪些请求数据\n*   ✅ 上报方式：提供 `上报方式` 配置项，用户可选择 `img、http、beacon` 三种方式，`http`方式又支持 `xhr、fetch` 两种，且支持 `自定义headers`\n*   ✅ 上报数据缓存：可配置 `本地缓存、浏览器本地缓存、IndexedDB` 三种方式\n*   ✅ 上报数据阈值：可配置上报数据 `阈值` ，达到 `阈值` 后进行上报操作\n*   ✅ 全局点击上报：可通过配置 `选择器、元素文本`，对全局DOM节点进行点击上报\n*   ✅ 页面的性能检测，包括 `白屏、FP、FCP、LCP、CLS、TTFB、FID` 等\n\n上报数据格式\n------\n\n选项\n\n描述\n\n类型\n\n`uuid`   \n\n上报数据的id\n\n`string`\n\n`type`   \n\n上报数据的类型\n\n`string`\n\n`data`   \n\n上报数据\n\n`any`\n\n`time`    \n\n上报时间\n\n`number`\n\n`status`    \n\n上报状态\n\n`string`\n\n`domain`    \n\n当前域名\n\n`string`\n\n`href`    \n\n当前网页路径\n\n`string`\n\n`userAgent`    \n\n当前user-agent\n\n`string`\n\n`deviceInfo`   \n\n设备的相关信息\n\n`object`\n\n安装\n--\n\n![](/images/jueJin/37ae5bf9a5c546f.png)\n\n使用\n--\n\n![](/images/jueJin/33f2c27081f7437.png)\n\n### 全局点击监听\n\n可以通过配置`globalClickListeners`来对于某些DOM节点进行点击监听上报\n\n![](/images/jueJin/b8c5128738604e2.png)\n\n### 配置上报阈值\n\n上报分为几种：\n\n*   用户行为上报：点击、跳转页面、请求，这些上报数据会缓存着，当达到阈值时再进行上报\n*   错误上报：请求报错、代码报错、异步错误，这些是立即上报\n*   页面性能上报：白屏、FP、FCP、LCP、CLS、TTFB、FID，这些是立即上报\n\n用户行为上报的阈值默认是 `10`，支持自定义 `maxEvents`\n\n![](/images/jueJin/e6b57b4dd21c425.png)\n\n### 配置缓存方式\n\n如果你想要避免用户重新打开网页之后，造成上报数据的丢失，那么你可以配置缓存方式，通过配置`cacheType`：\n\n*   normal：默认，本地缓存\n*   storage：浏览器 localStorage 本地缓存\n*   db：浏览器 IndexedDB 本地缓存\n\n```js\n    app.use(Track, {\n    ...options,\n    cacheType: 'storage' // 配置缓存方式\n    })\n```\n\n### 打印上报数据\n\n可以通过配置 `log` ，开启打印上报数据\n\n![](/images/jueJin/7ad28a75aa09439.png)\n\n### 灵活上报请求数据\n\n请求也是一种行为，也是需要上报的，或许我们有这个需求\n\n*   过滤：某些请求我们并不想上报\n*   自定义校验请求响应数据：每个项目的响应规则可能都不同，我们想自己判断哪些响应是成功，哪些是失败\n\n![](/images/jueJin/2e108a09bdee48f.png)\n\n### 格式化上报数据、自定义决定上不上报、自定义上报\n\n如果你想在数据上报之前，格式化上报数据的话，可以配置`report`中的`format`\n\n![](/images/jueJin/f804178325444de.png)\n\n如果你想要自己决定某次上报的时候，进行取消，可以配置`report`中的`isReport`\n\n![](/images/jueJin/8982a398b9154b1.png)\n\n如果你不想用这个库自带的上报功能，想要自己上报，可以配置`report`中的`customReport`\n\n![](/images/jueJin/13187c682290495.png)\n\n### 手动上报\n\n手动上报分为三种：\n\n*   手动添加上报数据：添加到缓存中，等到达到阈值再上报\n*   手动执行数据上报：立即上报\n*   自定义指令上报：如果你是 Vue 项目，支持指令上报\n\n![](/images/jueJin/37184650d849436.png)\n\n如果你是 Vue 项目，可以使用指令`v-track`进行上报\n\n![](/images/jueJin/36f0a10584fc4e4.png)\n\n配置参数\n----\n\n选项\n\n描述\n\n类型\n\n`projectKey`   \n\n项目key\n\n`string`\n\n`userId`   \n\n用户id\n\n`string`\n\n`report.url`   \n\n上报url\n\n`string`\n\n`report.reportType`  \n\n上报方式\n\n`img、http、beacon`\n\n`report.headers`  \n\n上报自定义请求头，`http` 上报模式生效\n\n`object`\n\n`report.format`  \n\n上报数据格式化\n\n`function`\n\n`report.customReport`  \n\n自定义上报\n\n`function`\n\n`report.isReport`  \n\n自定义决定上不上报\n\n`function`\n\n`cacheType`   \n\n数据缓存方式\n\n`normal、storage、db`\n\n`globalClickListeners`   \n\n上报状态\n\n`array`\n\n`log`   \n\n当前域名\n\n`boolean`\n\n`maxEvents`   \n\n上报阈值\n\n`number`\n\n`historyUrlsNum`   \n\n需要记录的url跳转数组\n\n`number`\n\n`checkHttpStatus`   \n\n判断响应数据\n\n`function`\n\n`filterHttpUrl`   \n\n过滤上报请求数据\n\n`function`\n\n`switchs.xhr`   \n\n是否开启xhr请求上报\n\n`boolean`\n\n`switchs.fetch`   \n\n是否开启fetch请求上报\n\n`boolean`\n\n`switchs.error`   \n\n是否开启错误上报\n\n`boolean`\n\n`switchs.whitescreen`   \n\n是否开启白屏检测上报\n\n`boolean`\n\n`switchs.hashchange`   \n\n是否开启hash变化请求上报\n\n`boolean`\n\n`switchs.history`   \n\n是否开启history变化上报\n\n`boolean`\n\n`switchs.performance`   \n\n是否开启页面性能上报\n\n`boolean`\n\n> 本项目源码：[github.com/sanxin-lin/…](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fsanxin-lin%2Fsunshine-track \"https://github.com/sanxin-lin/sunshine-track\") 各位兄弟姐妹如果觉得喜欢的话，可以点个star 哦~\n\n结语 & 加学习群 & 摸鱼群\n---------------\n\n我是林三心\n\n*   一个待过**小型toG型外包公司、大型外包公司、小公司、潜力型创业公司、大公司**的作死型前端选手；\n*   一个偏前端的全干工程师；\n*   一个不正经的掘金作者；\n*   一个逗比的B站up主；\n*   一个不帅的小红书博主；\n*   一个喜欢打铁的篮球菜鸟；\n*   一个喜欢历史的乏味少年；\n*   一个喜欢rap的五音不全弱鸡\n\n如果你想一起学习前端，一起摸鱼，一起研究简历优化，一起研究面试进步，一起交流历史音乐篮球rap，可以来俺的摸鱼学习群哈哈，点这个，有7000多名前端小伙伴在等着一起学习哦 --> [摸鱼沸点](https://juejin.cn/pin/7035153948126216206 \"https://juejin.cn/pin/7035153948126216206\")",
	"selfDefined": "likes:269,comments:40,collects:554,likes:16458"
}