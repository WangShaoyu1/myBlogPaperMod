{
	"title": "百度人脸识别API使用",
	"author": "王宇",
	"publishTime": "七月12,2024",
	"readTime": "12s",
	"tags": "[\"摄像头使用相关\"]",
	"description": "摄像头使用相关",
	"article": "### API准备工作\n\n1.  **获取百度人脸识别API Key和Secret Key**\n    \n    *   注册并获取API Key和Secret Key，用于访问百度人脸识别API。\n2.  **获取访问令牌**\n    \n    *   使用API Key和Secret Key获取访问令牌（Access Token），用于访问API接口。\n\n### 图像处理流程\n\n1.  **拍照**\n    \n    *   使用Android相机API拍摄照片，并将照片保存为Bitmap对象。\n2.  **将Bitmap转换为Base64**\n    \n    *   将Bitmap对象转换为Base64编码的字符串，便于传输和处理。\n3.  **调用百度人脸识别API**\n    \n    *   构建JSON请求体，包含Base64编码的图像数据和其他参数（如人脸属性要求）。\n    *   发送POST请求到百度人脸识别API的检测接口。\n4.  **处理API响应**\n    \n    *   获取API返回的JSON响应，解析其中的人脸检测结果或其他相关信息。\n\n### 示例代码\n\n以下是一个简化的示例代码，演示了如何在Android应用中使用摄像头拍照，并利用百度人脸识别API进行人脸检测。\n\nxml配置\n\n[?](#)\n\n1\n\n2\n\n3\n\n4\n\n5\n\n6\n\n7\n\n8\n\n9\n\n10\n\n11\n\n12\n\n13\n\n14\n\n15\n\n16\n\n17\n\n18\n\n19\n\n20\n\n21\n\n22\n\n23\n\n24\n\n25\n\n26\n\n27\n\n28\n\n29\n\n30\n\n31\n\n32\n\n`<?``xml` `version``=``\"1.0\"` `encoding``=``\"utf-8\"``?>`\n\n`<``manifest` `xmlns:android``=``\"[http://schemas.android.com/apk/res/android](http://schemas.android.com/apk/res/android)\"`\n\n    `xmlns:tools``=``\"[http://schemas.android.com/tools](http://schemas.android.com/tools)\"``>`\n\n    `<``uses-permission` `android:name``=``\"android.permission.CAMERA\"` `/>`\n\n    `<``uses-feature` `android:name``=``\"android.hardware.camera\"` `android:required``=``\"true\"` `/>`\n\n    `<``uses-permission` `android:name``=``\"android.permission.INTERNET\"``/>`\n\n    `<``application`\n\n        `android:allowBackup``=``\"true\"`\n\n        `android:dataExtractionRules``=``\"@xml/data_extraction_rules\"`\n\n        `android:fullBackupContent``=``\"@xml/backup_rules\"`\n\n        `android:icon``=``\"@mipmap/ic_launcher\"`\n\n        `android:label``=``\"@string/app_name\"`\n\n        `android:roundIcon``=``\"@mipmap/ic_launcher_round\"`\n\n        `android:supportsRtl``=``\"true\"`\n\n        `android:theme``=``\"@style/Theme.MyCameraApp\"`\n\n        `tools:targetApi``=``\"31\"``>`\n\n        `<``activity`\n\n            `android:name``=``\".MainActivity\"`\n\n            `android:exported``=``\"true\"`\n\n            `android:label``=``\"@string/app_name\"`\n\n            `android:theme``=``\"@style/Theme.MyCameraApp\"``>`\n\n            `<``intent-filter``>`\n\n                `<``action` `android:name``=``\"android.intent.action.MAIN\"` `/>`\n\n                `<``category` `android:name``=``\"android.intent.category.LAUNCHER\"` `/>`\n\n            `</``intent-filter``>`\n\n        `</``activity``>`\n\n    `</``application``>`\n\n`</``manifest``>`\n\n  \n\njava代码\n\n[?](#)\n\n1\n\n2\n\n3\n\n4\n\n5\n\n6\n\n7\n\n8\n\n9\n\n10\n\n11\n\n12\n\n13\n\n14\n\n15\n\n16\n\n17\n\n18\n\n19\n\n20\n\n21\n\n22\n\n23\n\n24\n\n25\n\n26\n\n27\n\n28\n\n29\n\n30\n\n31\n\n32\n\n33\n\n34\n\n35\n\n36\n\n37\n\n38\n\n39\n\n40\n\n41\n\n42\n\n43\n\n44\n\n45\n\n46\n\n47\n\n48\n\n49\n\n50\n\n51\n\n52\n\n53\n\n54\n\n55\n\n56\n\n57\n\n58\n\n59\n\n60\n\n61\n\n62\n\n63\n\n64\n\n65\n\n66\n\n67\n\n68\n\n69\n\n70\n\n71\n\n72\n\n73\n\n74\n\n75\n\n76\n\n77\n\n78\n\n79\n\n80\n\n81\n\n82\n\n83\n\n84\n\n85\n\n86\n\n87\n\n88\n\n89\n\n90\n\n91\n\n92\n\n93\n\n94\n\n95\n\n96\n\n97\n\n98\n\n99\n\n100\n\n101\n\n102\n\n103\n\n104\n\n105\n\n106\n\n107\n\n108\n\n109\n\n110\n\n111\n\n112\n\n113\n\n114\n\n115\n\n116\n\n117\n\n118\n\n119\n\n120\n\n121\n\n122\n\n123\n\n124\n\n125\n\n126\n\n127\n\n128\n\n129\n\n130\n\n131\n\n132\n\n133\n\n134\n\n135\n\n136\n\n137\n\n138\n\n139\n\n140\n\n141\n\n142\n\n143\n\n144\n\n145\n\n146\n\n147\n\n`import` `android.content.Intent;`\n\n`import` `android.graphics.Bitmap;`\n\n`import` `android.os.Bundle;`\n\n`import` `android.provider.MediaStore;`\n\n`import` `android.util.Base64;`\n\n`import` `android.view.View;`\n\n`import` `android.widget.Button;`\n\n`import` `android.widget.TextView;`\n\n`import` `androidx.annotation.Nullable;`\n\n`import` `androidx.appcompat.app.AppCompatActivity;`\n\n`import` `org.json.JSONException;`\n\n`import` `org.json.JSONObject;`\n\n`import` `java.io.ByteArrayOutputStream;`\n\n`import` `java.io.IOException;`\n\n`import` `okhttp3.*;`\n\n`public` `class` `MainActivity` `extends` `AppCompatActivity {`\n\n    `private` `static` `final` `int` `REQUEST_IMAGE_CAPTURE =` `1``;` `// 请求拍照的请求码`\n\n    `private` `Bitmap imageBitmap;` `// 保存拍摄的图片的Bitmap对象`\n\n    `private` `TextView resultTextView;` `// 显示处理结果的TextView`\n\n    `// 百度人脸识别API的API Key和Secret Key`\n\n    `public` `static` `final` `String API_KEY =` `\"\"``;`\n\n    `public` `static` `final` `String SECRET_KEY =` `\"\"``;`\n\n    `// OkHttpClient实例，用于发送HTTP请求`\n\n    `static` `final` `OkHttpClient HTTP_CLIENT =` `new` `OkHttpClient();`\n\n    `@Override`\n\n    `protected` `void` `onCreate(Bundle savedInstanceState) {`\n\n        `super``.onCreate(savedInstanceState);`\n\n        `setContentView(R.layout.activity_main);` `// 设置布局文件`\n\n        `// 获取布局中的按钮和TextView`\n\n        `Button takePhotoButton = findViewById(R.id.button_take_photo);`\n\n        `Button processButton = findViewById(R.id.button_process);`\n\n        `resultTextView = findViewById(R.id.textview_result);`\n\n        `// 拍照按钮点击事件监听器`\n\n        `takePhotoButton.setOnClickListener(``new` `View.OnClickListener() {`\n\n            `@Override`\n\n            `public` `void` `onClick(View v) {`\n\n                `dispatchTakePictureIntent();` `// 调用方法启动相机拍照`\n\n            `}`\n\n        `});`\n\n        `// 处理按钮点击事件监听器`\n\n        `processButton.setOnClickListener(``new` `View.OnClickListener() {`\n\n            `@Override`\n\n            `public` `void` `onClick(View v) {`\n\n                `if` `(imageBitmap !=` `null``) {`\n\n                    `// 在新线程中处理图像`\n\n                    `new` `Thread(() -> {`\n\n                        `String base64Image = bitmapToBase64(imageBitmap);` `// 将Bitmap转换为Base64编码字符串`\n\n                        `try` `{`\n\n                            `String result = processImage(base64Image);` `// 调用百度人脸识别API处理图像`\n\n                            `runOnUiThread(() -> resultTextView.setText(result));` `// 在UI线程更新处理结果显示`\n\n                        `}` `catch` `(IOException | JSONException e) {`\n\n                            `e.printStackTrace();`\n\n                            `runOnUiThread(() -> resultTextView.setText(``\"处理图像时出错: \"` `+ e.getMessage()));` `// 显示处理图像时的错误信息`\n\n                        `}`\n\n                    `}).start();`\n\n                `}` `else` `{`\n\n                    `resultTextView.setText(``\"请先拍照\"``);` `// 如果没有拍摄照片，则提示用户先拍照`\n\n                `}`\n\n            `}`\n\n        `});`\n\n    `}`\n\n    `// 启动相机拍照Intent`\n\n    `private` `void` `dispatchTakePictureIntent() {`\n\n        `Intent takePictureIntent =` `new` `Intent(MediaStore.ACTION_IMAGE_CAPTURE);` `// 创建启动相机拍照的Intent`\n\n        `if` `(takePictureIntent.resolveActivity(getPackageManager()) !=` `null``) {`\n\n            `startActivityForResult(takePictureIntent, REQUEST_IMAGE_CAPTURE);` `// 启动拍照Activity，并等待结果返回`\n\n        `}`\n\n    `}`\n\n    `@Override`\n\n    `protected` `void` `onActivityResult(``int` `requestCode,` `int` `resultCode,` `@Nullable` `Intent data) {`\n\n        `super``.onActivityResult(requestCode, resultCode, data);`\n\n        `if` `(requestCode == REQUEST_IMAGE_CAPTURE && resultCode == RESULT_OK) {`\n\n            `Bundle extras = data.getExtras();`\n\n            `imageBitmap = (Bitmap) extras.get(``\"data\"``);` `// 获取拍摄的照片Bitmap对象`\n\n        `}`\n\n    `}`\n\n    `// 将Bitmap对象转换为Base64编码字符串`\n\n    `private` `String bitmapToBase64(Bitmap bitmap) {`\n\n        `ByteArrayOutputStream byteArrayOutputStream =` `new` `ByteArrayOutputStream();`\n\n        `bitmap.compress(Bitmap.CompressFormat.JPEG,` `100``, byteArrayOutputStream);` `// 将Bitmap压缩为JPEG格式，质量为100%`\n\n        `byte``[] byteArray = byteArrayOutputStream.toByteArray();` `// 将压缩后的数据转换为字节数组`\n\n        `return` `Base64.encodeToString(byteArray, Base64.DEFAULT);` `// 使用Base64进行编码，返回编码后的字符串`\n\n    `}`\n\n    `// 使用百度人脸识别API处理图像`\n\n    `private` `String processImage(String base64Image)` `throws` `IOException, JSONException {`\n\n        `MediaType mediaType = MediaType.parse(``\"application/json\"``);`\n\n        `// 构建JSON请求体，设置请求参数`\n\n        `String json =` `new` `JSONObject()`\n\n                `.put(``\"image\"``, base64Image)` `// 图像数据，Base64编码字符串`\n\n                `.put(``\"image_type\"``,` `\"BASE64\"``)` `// 图像数据类型，此处为BASE64`\n\n                `.put(``\"face_field\"``,` `\"age,expression,face_shape,gender,glasses,landmark,landmark150,quality,eye_status,emotion,face_type,mask,spoofing\"``)` `// 请求返回的人脸属性信息`\n\n                `.put(``\"face_type\"``,` `\"LIVE\"``)` `// 人脸类型，此处为活体检测`\n\n                `.put(``\"liveness_control\"``,` `\"NONE\"``)` `// 活体检测控制，默认为NONE`\n\n                `.toString();`\n\n        `RequestBody body = RequestBody.create(mediaType, json);`\n\n        `// 创建HTTP请求，向百度人脸识别API发送POST请求`\n\n        `Request request =` `new` `Request.Builder()`\n\n                `.url(``\"[https://aip.baidubce.com/rest/2.0/face/v3/detect?access_token=](https://aip.baidubce.com/rest/2.0/face/v3/detect?access_token=)\"` `+ getAccessToken()) // 请求URL，包含访问令牌`\n\n                `.post(body)` `// 设置请求体为JSON数据`\n\n                `.addHeader(``\"Content-Type\"``,` `\"application/json\"``)` `// 设置请求头，指定Content-Type为JSON格式`\n\n                `.build();`\n\n        `// 发送HTTP请求，并获取响应`\n\n        `Response response = HTTP_CLIENT.newCall(request).execute();`\n\n        `return` `response.body().string();` `// 返回百度人脸识别API的响应结果字符串`\n\n    `}`\n\n    `// 获取百度人脸识别API的访问令牌`\n\n    `private` `String getAccessToken()` `throws` `IOException, JSONException {`\n\n        `MediaType mediaType = MediaType.parse(``\"application/x-www-form-urlencoded\"``);`\n\n        `// 创建获取访问令牌的请求体，包含client_credentials授权方式和API Key/Secret Key`\n\n        `RequestBody body = RequestBody.create(mediaType,` `\"grant_type=client_credentials&client_id=\"` `+ API_KEY`\n\n                `+` `\"&client_secret=\"` `+ SECRET_KEY);`\n\n        `// 创建HTTP请求，向百度人脸识别API获取访问令牌`\n\n        `Request request =` `new` `Request.Builder()`\n\n                `.url(``\"[https://aip.baidubce.com/oauth/2.0/token](https://aip.baidubce.com/oauth/2.0/token)\"``)`\n\n                `.post(body)` `// 设置请求体为URL编码格式`\n\n                `.addHeader(``\"Content-Type\"``,` `\"application/x-www-form-urlencoded\"``)` `// 设置请求头，指定Content-Type为URL编码格式`\n\n                `.build();`\n\n        `// 发送HTTP请求，并获取响应`\n\n        `Response response = HTTP_CLIENT.newCall(request).execute();`\n\n        `return` `new` `JSONObject(response.body().string()).getString(``\"access_token\"``);` `// 解析响应JSON，获取访问令牌`\n\n    `}`\n\n`}`\n\n关于获取百度人脸识别API的API Key和Secret Key需要进行以下步骤：\n\n1.  **注册百度账号**：如果还没有百度账号，需要先注册一个。可以访问百度注册页面进行注册。\n    \n2.  **创建应用**：登录百度账号后，进入[百度AI开放平台](https://ai.baidu.com/)。在控制台中，创建一个新的应用或者选择已有的应用（确保该应用支持人脸识别服务）。\n    \n3.  **获取API Key和Secret Key**：\n    \n    *   在控制台的应用详情页中，可以找到API Key和Secret Key。这两个密钥用于通过API访问百度人脸识别服务。\n    *   将获取到的API Key和Secret Key填写到你的应用程序中，例如在上面提到的Android应用程序中的`API_KEY`和`SECRET_KEY`变量中。\n\n确保在使用API Key和Secret Key时，遵循百度的安全最佳实践，不要将这些密钥硬编码在公开的代码库或者客户端应用中，以防止泄露和滥用。\n\n[Filter table data](#)[Create a pivot table](#)[Create a chart from data series](#)\n\n[Configure buttons visibility](/users/tfac-settings.action)"
}