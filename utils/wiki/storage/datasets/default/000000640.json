{
	"title": "算法接口设计",
	"author": "王宇",
	"publishTime": "八月09,2024",
	"readTime": "12s",
	"tags": "[\"知识插件\"]",
	"description": "知识插件",
	"article": "*   1[1\\. 领域通用检索服务接口](#id-算法接口设计-领域通用检索服务接口)\n*   2[2\\. 知识插件检索服务接口](#id-算法接口设计-知识插件检索服务接口)\n*   3[3\\. 知识库构建文件格式及限制](#id-算法接口设计-知识库构建文件格式及限制)\n\n**应用名(**nacos注册的应用名**)：yingzi-algorithm-rag**\n\n**开发环境： 172.18.64.37**\n\n**测试/预生产/生产环境：k8s**\n\n**算法服务错误码：**\n\n错误码\n\n触发条件\n\n错误信息示例\n\n备注\n\n错误码\n\n触发条件\n\n错误信息示例\n\n备注\n\n100000000\n\n成功返回\n\n  \n\n  \n\n100100201\n\n数据越界\n\n数据越界：问题长度超出限制：\\[1, 750\\]\n\n  \n\n100100203\n\n输入参数类型/格式错误。\n\n不支持的数据格式：app\\_type\n\n  \n\n100100205\n\n输入字段缺失\n\n输入字段缺失：query\n\n  \n\n100100206\n\n输入数据缺失\n\n输入数据缺失：knowledge\\_configs\n\n  \n\n100600900\n\n算法服务未知错误/服务器内部错误\n\n未知错误，请联系算法管理员\n\n  \n\n1\\. 领域通用检索服务接口\n==============\n\n**请求方式：**POST，application/json\n\n**算法测试请求路径： http://{domain}/yingzi-algorithm-rag/knowledge\\_retrieval/general\\_retrieval\\_server**\n\n**测试环境算法ID：**1224373964580098048\n\n**开发环境算法ID：1260527562179137536**，**domain****：**172.18.64.37:8081\n\n**预生产环境算法ID：**1224374964406145024\n\n**生产环境算法ID：**1224376023880523776\n\n  \n**请求字段说明：**\n\n参数字段\n\n类型\n\n必须\n\n说明\n\n备注\n\n参数字段\n\n类型\n\n必须\n\n说明\n\n备注\n\nquery\n\nstring\n\nY\n\n用户问题，长度不能超过750个字符。\n\n  \n\ntopk\n\nint\n\nN\n\n知识库查询数量（大于0），不同的应用类型有对应的默认值。\n\n  \n\nvector\\_threshold\n\nfloat\n\nN\n\n向量查询分数阈值，低于这个阈值的结果丢弃，取值范围(0, 1\\]，不同的应用类型有对应的默认值。\n\n  \n\nmatch\\_score\n\nfloat\n\nN\n\n关键词匹配得分阈值（大于0），低于这个阈值的结果丢弃，不同的应用类型有对应的默认值。\n\n  \n\nvector\\_boost\n\nfloat\n\nN\n\n向量查询权重，取值范围\\[0, 1\\]，不同的应用类型有对应的默认值。\n\n关键词匹配和向量查询权重和为1；若vector\\_boost=0，表示只有关键词查询；vector\\_boost=1，表示只有向量/语义查询\n\napp\\_type\n\nstring\n\nY\n\n应用类型，需与算法内部统一。屏端企业知识问答服务可统一设为：“knowledge\\_qa\\_enterprise\\_screen”，养猪专家问答服务可统一设为“swine\\_experts\\_general”，营养健康专家问答服务可统一设为“health\\_assistant\\_general”\n\n不同类型应用检索的知识库范围不同。\n\n**请求示例:**\n\nPOST \n\n{  \n\"app\\_type\": \"health\\_assistant\\_general\",  \n\"topk\": 5,  \n\"query\": \"高血压适合吃什么食物？\"  \n}\n\n**响应示例：**  \n{  \n\"code\": 100000000,  \n\"data\": \\[  \n{  \n\"content\": \"第六章医疗膳食：第三节调整成分膳食：八、高钾饮食：(二)适用范围：2.适用于防治高血压。有人观察高钾、低钠饮食有防治高血压的作用。\",  \n\"file\\_id\": \"临床营养学\",  \n\"chunk\\_id\": \"paragraph-1341\",  \n\"score\": 0.6007977489999999  \n},  \n{  \n\"content\": \"食物与高血压的关系\\\\n特定食物摄入与高血压关联，如高盐和高饱和脂肪饮食会提升血压水平和患病率。\",  \n\"file\\_id\": \"营养与食品卫生学\",  \n\"chunk\\_id\": \"section2-26\",  \n\"score\": 0.5938752709999999  \n},  \n{  \n\"content\": \"\\\\t单元5营养与健康：5.2膳食营养与慢性疾病预防：四 、高血压、高血脂与膳食营养防治：(一)高血压：3.高血压的饮食治疗：(2)减少及限制饮食中的钠盐：高血压患者可根据病情给予不同程度的限钠膳食，对大多数高血压病人，建议食盐控制在2～3g/d(相当于每月用盐1～2两)的水平。除食盐外还应考虑其他含钠的食物，如用盐腌制的食物等。\",  \n\"file\\_id\": \"饮食营养与安全\",  \n\"chunk\\_id\": \"paragraph-924\",  \n\"score\": 0.592150886  \n},  \n{  \n\"content\": \"第九章营养与营养相关疾病：第三节心脑血管疾病：四、冠状动脉粥样硬化性心脏病(冠心病)：(三)食物选择：1.推荐摄入食物：(4)富含特殊成分，有降脂降压作用的海带、香菇、木耳、洋葱、大蒜等。\",  \n\"file\\_id\": \"现代营养学郭顺堂主编\",  \n\"chunk\\_id\": \"paragraph-2368\",  \n\"score\": 0.591887409  \n},  \n{  \n\"content\": \"第九章营养与营养相关疾病：第三节心脑血管疾病：二、原发性高血压：(四)食物选择：1.推荐摄入食物：(3)富含维生素的新鲜果蔬：如莴笋、青菜、小白菜、柑橘、大枣、猕猴桃、苹果等。\",  \n\"file\\_id\": \"现代营养学郭顺堂主编\",  \n\"chunk\\_id\": \"paragraph-2312\",  \n\"score\": 0.5905978479999999  \n}  \n\\],  \n\"msg\": \"成功返回\"  \n}\n\n**响应字段说明：**\n\n参数字段\n\n类型\n\n说明\n\n参数字段\n\n类型\n\n说明\n\ncode\n\nint\n\n响应编码（参照算法服务错误码），成功返回100000000\n\nmsg\n\nstring\n\n响应信息\n\ndata\n\nlist<dict>\n\n查询结果列表（根据总分数逆序排列，若没有相关结果，则为空列表），包含knowledge\\_id、file\\_id、chunk\\_id、score和content五个字段\n\n<file\\_id>\n\nstring\n\n查询的文件id\n\n<chunk\\_id>\n\nstring\n\n文件内知识分块id\n\n<score\\>\n\nfloat\n\n查询内容总得分\n\n<content\\>\n\nstring\n\n查询的知识内容\n\n<text\\_group>\n\nstring\n\n查询的知识内容分组（部分知识库没有分组字段返回，常见的有FAQ、指令和query对应的sql分组）\n\n2\\. 知识插件检索服务接口\n==============\n\n**请求方式：**POST，application/json\n\n**算法测试请求路径： http://{domain}/yingzi-algorithm-rag/knowledge\\_retrieval/plugin\\_retrieval\\_server**\n\n**测试环境算法ID：1260533361517563904**\n\n**开发环境算法ID：1260531561738063872**，**domain****：**172.18.64.37:8081\n\n**预生产环境算法ID：1260535831421997056**\n\n**生产环境算法ID：1260536937721585664**\n\n  \n**请求字段说明：**\n\n参数字段\n\n类型\n\n必须\n\n说明\n\n备注\n\n参数字段\n\n类型\n\n必须\n\n说明\n\n备注\n\nquery\n\nstring\n\nY\n\n用户问题，长度不能超过750个字符。\n\n  \n\nauto\\_config\n\nint\n\nN\n\n自动配置/智能重排开关，取值：0/1，默认值为0。  \n0：表示每个知识库按独立检索参数配置返回。  \n1：表示检索参数配置相同的知识库自动分配返回数目，检索参数配置不同的知识库不受影响。\n\n  \n\nknowledge\\_configs\n\nlist<dict>\n\nY\n\n知识库配置列表（不能为空列表），决定了知识插件检索的知识库范围，包含topk、vector\\_threshold、match\\_score和vector\\_boost四个字段\n\n  \n\n<knowledge\\_id>\n\nstring\n\nY\n\n知识库id，必须是算法这边存在导入文件的知识库\n\n  \n\n<retrieval\\_type>\n\nint\n\nN\n\n检索类型，取值：1/2/3，默认值为1。\n\n1-混合检索 2-向量/语义检索 3-关键词检索\n\n<topk>\n\nint\n\nN\n\n知识库查询数量（大于0），默认值为3。\n\n  \n\n<vector\\_threshold>\n\nfloat\n\nN\n\n向量查询分数阈值，低于这个阈值的结果丢弃，取值范围(0, 1\\]，默认值为0.75。\n\n  \n\n<match\\_score>\n\nfloat\n\nN\n\n关键词匹配得分阈值（大于0），低于这个阈值的结果丢弃，默认值为0.8。\n\n  \n\n<vector\\_boost>\n\nfloat\n\nN\n\n向量查询权重，取值范围\\[0, 1\\]，默认值为0.85。\n\n关键词匹配和向量查询权重和为1；若vector\\_boost=0，表示只有关键词查询；vector\\_boost=1，表示只有向量/语义查询\n\n**请求示例:**\n\nPOST \n\n{  \n\"query\": \"高血压适合吃什么食物？\",  \n\"knowledge\\_configs\": \\[  \n{  \n\"knowledge\\_id\": \"health\\_assistant\\_general\",  \n\"topk\": 5,  \n\"vector\\_boost\": 0.74  \n},  \n{  \n\"knowledge\\_id\": \"health\\_assistant\\_table\",  \n\"topk\": 2,  \n\"vector\\_boost\": 0.74  \n}  \n\\]  \n}\n\n**响应示例：**  \n{  \n\"code\": 100000000,  \n\"data\": \\[  \n{  \n\"knowledge\\_id\": \"health\\_assistant\\_general\",  \n\"knowledge\\_content\": \\[  \n{  \n\"content\": \"第六章医疗膳食：第三节调整成分膳食：八、高钾饮食：(二)适用范围：2.适用于防治高血压。有人观察高钾、低钠饮食有防治高血压的作用。\",  \n\"file\\_id\": \"临床营养学\",  \n\"chunk\\_id\": \"paragraph-1341\",  \n\"score\": 0.6007977489999999  \n},  \n{  \n\"content\": \"食物与高血压的关系\\\\n特定食物摄入与高血压关联，如高盐和高饱和脂肪饮食会提升血压水平和患病率。\",  \n\"file\\_id\": \"营养与食品卫生学\",  \n\"chunk\\_id\": \"section2-26\",  \n\"score\": 0.5938752709999999  \n},  \n{  \n\"content\": \"\\\\t单元5营养与健康：5.2膳食营养与慢性疾病预防：四 、高血压、高血脂与膳食营养防治：(一)高血压：3.高血压的饮食治疗：(2)减少及限制饮食中的钠盐：高血压患者可根据病情给予不同程度的限钠膳食，对大多数高血压病人，建议食盐控制在2～3g/d(相当于每月用盐1～2两)的水平。除食盐外还应考虑其他含钠的食物，如用盐腌制的食物等。\",  \n\"file\\_id\": \"饮食营养与安全\",  \n\"chunk\\_id\": \"paragraph-924\",  \n\"score\": 0.592150886  \n},  \n{  \n\"content\": \"第九章营养与营养相关疾病：第三节心脑血管疾病：四、冠状动脉粥样硬化性心脏病(冠心病)：(三)食物选择：1.推荐摄入食物：(4)富含特殊成分，有降脂降压作用的海带、香菇、木耳、洋葱、大蒜等。\",  \n\"file\\_id\": \"现代营养学郭顺堂主编\",  \n\"chunk\\_id\": \"paragraph-2368\",  \n\"score\": 0.591887409  \n},  \n{  \n\"content\": \"第九章营养与营养相关疾病：第三节心脑血管疾病：二、原发性高血压：(四)食物选择：1.推荐摄入食物：(3)富含维生素的新鲜果蔬：如莴笋、青菜、小白菜、柑橘、大枣、猕猴桃、苹果等。\",  \n\"file\\_id\": \"现代营养学郭顺堂主编\",  \n\"chunk\\_id\": \"paragraph-2312\",  \n\"score\": 0.5905978479999999  \n}  \n\\]  \n},  \n{  \n\"knowledge\\_id\": \"health\\_assistant\\_table\",  \n\"knowledge\\_content\": \\[  \n{  \n\"content\": \"此表格旨在指导高血压患者合理安排日常饮食，通过控制特定营养素摄入量以辅助血压管理。关键应用包括高血压防治饮食计划制定，关联计算涉及热量转换及营养成分配比。常见于医疗营养咨询、健康管理App及慢性病饮食指南。关键词：高血压饮食、营养管理、电解质平衡、心血管健康。\\\\n表格部分内容：\\\\n表的标题：高血压患者推荐的营养素摄入量:\\\\n营养素名称|每日推荐摄入量\\\\n膳食纤维|不少于14g/(1000kcal/d)\\\\n钠|<2000mg(相当于食盐5g)\\\\n钾|>2500mg(相当于氯化钾4.75g801~1000mg350-500mg\\\\n钙|801~1000mg\\\\n镁|350~500mg\\\\n维生素C|100~150mg\\\\n维生素D|5~10μg(200～400IU)\\\\n烟酸|10~20mg\\\\n表的备注：nan\",  \n\"file\\_id\": \"营养配餐设计与实践\",  \n\"chunk\\_id\": \"81\",  \n\"score\": 0.568815726  \n},  \n{  \n\"content\": \"此表格旨在为高脂血症患者提供膳食指导，帮助控制血脂。通过设定不同食物类别的建议摄入量与限制项，促进健康饮食习惯。应用涉及营养学、疾病管理领域，常见于健康管理、医疗咨询及减肥计划中。关键词包括：\\\\\"高脂血症饮食\\\\\"、\\\\\"血脂管理\\\\\"、\\\\\"健康膳食规划\\\\\"。该表未直接涉及的计算问题可能包括热量计算、营养成分比例分析等。\\\\n表格部分内容：\\\\n表的标题：高脂血症膳食控制方案：\\\\n食物类别|限制量|推荐摄入食物|限制摄入食物\\\\n糖类|10g/d|白糖、红糖|—\\\\n新鲜蔬菜|400~500g/d|深绿色、红黄色蔬菜|—\\\\n新鲜水果|50g/d|各种水果|加工果汁、果味饮料\\\\n食盐|<6g|—|含盐高的食物及调料\\\\n谷类|男：500g/d;女：400g/d|五谷粗杂粮|—\\\\n干豆及豆|干豆30g/d或豆腐150g/d或豆腐干45g/d|黄豆及其制品|含油多的豆制品，如油豆腐、素什锦等\\\\n表的备注：注：①指脑力劳动或轻体力劳动、体重正常者。\",  \n\"file\\_id\": \"现代营养学郭顺堂主编\",  \n\"chunk\\_id\": \"83\",  \n\"score\": 0.562396633  \n}  \n\\]  \n},  \n\"msg\": \"成功返回\"  \n}\n\n**响应字段说明：**\n\n参数字段\n\n类型\n\n说明\n\n参数字段\n\n类型\n\n说明\n\ncode\n\nint\n\n响应编码（参照算法服务错误码），成功返回100000000\n\nmsg\n\nstring\n\n响应信息\n\ndata\n\nlist<dict>\n\n查询结果对象列表（根据知识库id分块返回，若没有相关结果，则为空列表），包含knowledge\\_id和knowledge\\_content两个字段\n\n<knowledge\\_id>\n\nstring\n\n查询的知识库id\n\n<knowledge\\_content>\n\nlist<dict>\n\n查询的知识库内容列表（根据总分数逆序排列），包含file\\_id、chunk\\_id、score和content四个字段\n\n<<file\\_id>>\n\nstring\n\n查询的文件id\n\n<<chunk\\_id>>\n\nstring\n\n文件内知识分块id\n\n<<score\\>>\n\nfloat\n\n查询内容总得分\n\n<<content\\>>\n\nstring\n\n查询的知识内容\n\n<<text\\_group>>\n\nstring\n\n查询的知识内容分组（部分知识库没有分组字段返回，常见的有FAQ、指令和query对应的sql分组）\n\n3\\. 知识库构建文件格式及限制\n================\n\n*   语言类型只支持中文（1）\n*   不同知识类型支持的文件类型及要求如下**（注意文件不能加密）**：  \n    **（1）长文本文档：**普通docx或doc文件（特别适用于带不同层级标题的word文本）  \n    **（2）结构化文档/表格类文档：**带表头的csv和xlsx/xls文件，编码为**utf-8**，**至少包含2列**，可在最后两行放置表的标题和表的备注（非必须，格式需规范）。其中csv文件只支持一个sheet；excel文件则支持多sheet。示例文件如下：\n\n![](/download/attachments/122522160/image2024-6-24_9-57-21.png?version=1&modificationDate=1719194241291&api=v2)  \n**（3）问答对文档/短文本文档：**docx/doc和txt文档，均以**换行符（“\\\\n”）**作为内容的分隔符。xlsx和xls格式的excel文件，只支持一个sheet且表头为**“text”列**（必须，作为文本切分和检索的内容）和**“text\\_group”列**（非必须，作为文本分组的依据，检索时只返回组内得分最高的一条数据）的内容处理，“text”列以**单元格**及**换行符（“\\\\n”）**作为内容的分隔符。**注意有“text\\_group”列和没有“text\\_group”列的内容需分库存储，**因为他们检索返回的逻辑和字段内容不一样。\n\n[Filter table data](#)[Create a pivot table](#)[Create a chart from data series](#)\n\n[Configure buttons visibility](/users/tfac-settings.action)"
}