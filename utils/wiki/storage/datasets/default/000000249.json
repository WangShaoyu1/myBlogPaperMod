{
	"title": "GPTembedding和fine-tuning技术解析",
	"author": "王宇",
	"publishTime": "四月24,2023",
	"readTime": "12s",
	"tags": "[\"唐玮\"]",
	"description": "唐玮",
	"article": "大模型（AGI）+embedding、fine-tuning（企业知识） = BGI（企业模型） 会成为很多AI应用系统的技术实现方式之一。目前所有基于GPT、或者类似GPT的语言大模型或者是AIGC类的图像大模型进行扩展的应用，基本都是基于embedding和fine-tuning两门技术实现的。例如replike、duolingo等。embedding、fine-tuning 两门技术实质上不会受到模态的限制。它可以在语言大模型、图像大模型、视频大模型等等不同模态的模型中使用。正如Jay Alammar 一个AI专家所说的：“万物皆可embedding”。\n\n通常，基于大模型进行的应用开发会比从头开始构建模型要实用和方便得多（更少的数据，更好的效果）。从头构建模型，主要所需要涉及的数据量和计算量是非常庞大的一个数字。而大模型，因为其已经训练有通用的语义理解能力，所以基于大模型去训练企业的模型所需的数据量相比从头构建模型要少得很多。例如下面embedding测试GPT回答万得厨服务助手类问题的示例中，只需把标准问和标准答传给GPT，GPT即能准确识别不同问法的所真正要问的问题，并且能够产生多种不同的回答文本。而原来以知识库的技术方式是需要人工把相似问梳理出来，并且只能产生一种回答。\n\n经过梳理，基于 ”语言大模型“+embedding、finr-tuning ，可以实现以下功能：\n\n*   让GPT回答GPT不熟悉的主题。如21年9月后的事件、非公开的文档、公司私有数据等\n*   推荐相似的项目。如推荐相似的食谱\n*   分析类需求。如用户画像的聚类分析、异常监测、用户分类等\n*   个性化对话。如依据每个用户的用户画像和历史记录，按照用户喜欢的风格回答问题。\n*   修改语言风格，或者回复句式。\n*   ... \n\n1\\. embedding后，GPT能够回答万得厨相关问题，并具备较好的泛化能力\n========================================\n\n1.1. embedding可以实现的功能\n---------------------\n\nembedding技术，抽象来说是提供给了GPT一个短期的记忆。能让GPT基于短期记忆进行回复。短期记忆中除了与问题相关的知识，还可以补充该用户的画像信息、喜好等数据，以让GPT能够个性化的回复用户。同时结合GPT大模型提供的向量转化算法。embedding能够实现下面这些功能\n\n*   **让GPT回答GPT不熟悉的主题。如21年9月后的事件、非公开的文档、公司私有数据等**\n*   **推荐相似的项目。如推荐相似的食谱**\n*   **分析类需求。如用户画像的聚类分析、异常监测、用户分类等**\n*   **个性化对话。如依据每个用户的用户画像和历史记录，按照用户喜欢的风格回答问题。**\n\n1.2. embedding原理\n----------------\n\nembedding原理其实很简单。即把公司的知识库以prompt的形式加入到用户的问句中（这些问题中即包含了问题的答案），chatGPT依据这个“知识库”+“用户问题” 组合而成的问题去进行回答。\n\n因为知识库是庞大的，所以先需要通过 “找相似知识的算法” 去找到相似的知识库，即与提问相关的知识，然后GPT用这些知识来回答问题。\n\n![](/download/attachments/101812168/image2023-4-21_11-16-40.png?version=1&modificationDate=1682047000818&api=v2)\n\n举个例子：\n\n*   用户输入“你知不知道万得厨是什么？”\n*   随即系统计算这个问题与知识库中的哪些知识比较相关。通过计算与各个知识的余弦相似度，按相似度高低进行排序，根据设定条件提取出部分相关的知识\n\n![](/download/attachments/101812168/image2023-4-21_11-24-12.png?version=1&modificationDate=1682047452957&api=v2)\n\n*   与用户输入进行拼接。下面是拼接的结果（因实际数据很多，这里省略了大部分数据）\n\n使用以下的FAQ来回答后续问题，如果在FAQ中找不到答案，请写下“我找不到一个答案”\n\n0相似问和回答:  \n\"\"\"  \n万得厨可以烹饪不是新食记的预制菜嘛 如果是可微波且包装合适的食品，都可以用万得厨进行烹饪哟  \n\"\"\"\n\n1相似问和回答:  \n\"\"\"  \n一台万得厨多少钱 您可以在京东平台上面查看价格哦  \n\"\"\"\n\n2相似问和回答:  \n\"\"\"  \n怎么使用语音烹饪 您可以把食品放入万得厨内，然后对我说想要烹饪什么食品  \n\"\"\"\n\n3相似问和回答:  \n\"\"\"  \n食品烹饪后没有熟怎么办 您可以根据情况使用万得厨继续烹饪哦  \n\"\"\"\n\n4相似问和回答:  \n\"\"\"  \n万得厨怎么联网 您可以找一下万得厨的操作说明书进行了解哦  \n\"\"\"\n\n5相似问和回答:  \n\"\"\"  \n购买万得厨会不会有额外的赠品？ 具体信息可以咨询销售人员哦  \n\"\"\"\n\n6相似问和回答:  \n\"\"\"  \n万得厨最近有什么优惠活动吗 关于万得厨的详细情况请打客服电话4001106888进行了解哦  \n\"\"\"\n\n**_... ... （省略。测试用例中，总共拼接了60条相似知识）_**\n\n问题: 你知不知道万得厨是什么？\n\n*   将上面拼接后的问题，提供给GPT，接收答案\n\n![](/download/attachments/101812168/image2023-4-21_11-35-14.png?version=1&modificationDate=1682048114573&api=v2)\n\n  \n\n对于计算拼接的内容环节，可以做更多的事以实现更好的效果\n\n*   **除了拼接相似度较高的知识库，还可以考虑从流行度、时间接近度、与先前搜索结果的冗余度、点击率等角度进行抽取知识**\n*   **使用HyDE技术提高问答检索的性能**\n*   **通过GPT提取问题和知识库的关键字、搜索词集、内容概要，以改善搜索结果**\n\n1.3. embedding测试示例\n------------------\n\n### 1.3.1. 让GPT回答关于公司内部的知识\n\n这是使用内容团队14周输出的“服务助手”FAQ数据（不包含相似问数据，只包括标准问和回复话术的数据，共164条问答）和gpt-3.5-turbo模型，embedding后输出的部分对话实例结果：\n\n  \n\n问\n\nGPT答\n\n  \n\n问\n\nGPT答\n\n1\n\n你知不知道万得厨是什么？\n\n万得厨是一种智能厨房电器，可以通过语音控制或万得厨App完成食品的烹饪、解冻等功能。\n\n2\n\n你知不知道万得厨是什么？\n\n万得厨是一款智能厨房电器，可以通过语音控制和App远程控制，支持多种烹饪模式，适用于各种食材的烹饪和加热。\n\n3\n\n你知不知道万得厨是什么？\n\n万得厨是一款智能厨具，能够通过语音控制和扫码烹饪，具备多种烹饪模式和智能预判功能，为用户提供便捷的烹饪体验。\n\n4\n\n你知不知道万得厨是什么？\n\n万得厨是一款智能微波炉，可以通过语音指令、扫码等方式进行烹饪，具有智能预判和自动停止等功能。同时还拥有万得厨App提供的食谱、美食广场、商城等多种实用功能。\n\n5\n\n你知不知道万得厨是什么？\n\n万得厨是一款智能厨房电器，可以通过语音、扫码、触屏等方式进行烹饪，具有多种烹饪模式和智能控制功能。\n\n6\n\n购买万得厨食品有赠品吗？\n\n具体信息可以咨询销售人员哦。\n\n7\n\n啥是小孩？\n\n这个问题和万得厨无关，无法回答。\n\n8\n\n怎么购买万得厨？\n\n您可以在万得厨官网、京东、天猫等电商平台上进行购买，也可以到万得厨线下门店购买。具体购买方式可以咨询销售人员哦。\n\n9\n\n我想买一台万得厨，该怎么弄？\n\n您可以在京东等电商平台上搜索“万得厨”进行购买，或者到万得厨官网进行购买。在购买前可以咨询销售人员了解更多信息。\n\n10\n\n我想买一台万得厨，该怎么弄？\n\n您可以在京东等电商平台上搜索“万得厨”进行购买，或者到万得厨官网进行购买。在购买前，建议您先了解一下产品的详细信息和使用说明。\n\n![](/download/attachments/101812168/image2023-4-21_9-6-13.png?version=1&modificationDate=1682039173564&api=v2)\n\nGPT本身具备比较好的语义理解能力，并且让回答更有创意（通过调整api参数）。如，问了4次“你知不知道万得厨是什么？”，GPT每次都能给出不同的回复。\n\n2\\. fine-tuning更改模型\n===================\n\nfine-tuning的功能是修改原模型。主要的应用领域在于修改GPT的回复语气、语言风格。比如你是一个情感辅导师，你有自己的说话方式、口头禅，这时你可以通过使用fine-tuning去修改模型，这样模型就可以模仿你的语言风格和口头禅去回复。\n\n这个技术的应用领域：\n\n*   **分析类需求。如用户画像的聚类分析、异常监测、用户分类等**\n*   **修改风格，或者回复句式。**\n*   **...**\n\n理论上，fine-tuning和embedding都能实现模型用户风格、实现分析类需求、个性化，或者是让让GPT回答GPT不熟悉的主题的功能。但是两者的性能、成本和原理的差异让两者主要偏向于不同领域。\n\n**（1）fine-tuning需要花费大量钱进行训练，不过训练完后，对话成本将比embedding小很多。**\n\n训练中，fine-tuning训练需要耗费很多的钱，依据网上网友给出的案例，训练1000条数据，可能会花费400~1000左右的人民币，如果训练的好，回复相关问题就不需要插入提示，所以对话的token就会比较少。embedding是在prompt中加入提示，不需要训练，但总体每次对话平均可能会花费3000~4000左右的token。用个不一定准确的比喻，原来100块钱能对话4k次，使用embedding后，对话降到2k次左右。对于固定的话式、固定的风格很适合fine-tuning，因为这样就可以不用每次都需要把 话式和风格 的prompt加到输入中，可以起到减少token、减少成本的作用。\n\n**（2）一般，fine-tuning回答准确度比embedding回答准确度差。**\n\nfine-tuning的技术原理主要是调整单词的权重，让某个词出现的概率更高。比如， GPT原来喜欢用首先、其次、再次这样的说法，通过数据fine-tuning GPT模型后，首先、其次、再次 这些词的权重降低，GPT再回复的时候就很少出现这些词了。所以从技术角度来说，让GPT回答正确万得厨的问题，fine-tuning的方式效果要比embedding差。因为针对比如“帮我推荐个食品“这样的问题，fine-tuning后，GPT依旧可能不使用万得厨生态的食品去回复用户（概率大，不代表一定会出现），而embedding可以指示该条回答必须用万得厨生态的食品去推荐，所以embedding回复的准确度会高很多。\n\n**（3）fine-tuning回答效率比embedding高。**\n\n在对话时，embedding比fine-tuning多了查询相关知识的一步，所以fine-tuning的延迟更低。\n\n**（4）相关知识更多的时候，fine-tuning效果更好。**\n\nembedding的使用会收到prompt的token数量的限制，即可能只能加2k字以内的提示。当需要的相关知识比较多，超过2k字时，要么通过切换更昂贵的模型，以较少token的限制，或者使用提取概要等缩减文本的技术减少知识的文本量。而fine-tuning不会受到字数的限制，所以当相关知识很多的时候，使用fine-tuning会更好\n\n所以：\n\n*   fine-tuning更适合于改进语气、风格类的，让每个问答都按这样的风格去回答\n*   embedding更适合于提供准确答案\n\n2.1. fine-tuning技术原理\n--------------------\n\nfine-tuning的技术原理概括说主要是调整单词的权重，让某个词出现的概率更高。**通俗说，fine-tuning能够让GPT更偏向于，用我们期望的方式去回答。**偏向不等于一定。\n\nfine-tuning其实属于模型的二次训练。\n\n  \n\n  \n\n参考文献：\n\n[openai-cookbook/Question\\_answering\\_using\\_embeddings.ipynb at main · openai/openai-cookbook · GitHub](https://github.com/openai/openai-cookbook/blob/main/examples/Question_answering_using_embeddings.ipynb)\n\n[嵌入 - OpenAI API](https://platform.openai.com/docs/guides/embeddings/what-are-embeddings)\n\n[Jay Alammar – Visualizing machine learning one concept at a time. (jalammar.github.io)](https://jalammar.github.io/)\n\n[如何使用OpenAI fine-tuning(微调)训练属于自己的专有模型？ - 知乎 (zhihu.com)](https://www.zhihu.com/question/591066880)\n\n[微调 - OpenAI API](https://platform.openai.com/docs/guides/fine-tuning)\n\n  \n\n  \n\n  \n\n[Filter table data](#)[Create a pivot table](#)[Create a chart from data series](#)\n\n[Configure buttons visibility](/users/tfac-settings.action)"
}