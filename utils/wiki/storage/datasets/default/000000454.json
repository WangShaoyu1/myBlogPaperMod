{
	"title": "fetchSSEdemo",
	"author": "王宇",
	"publishTime": "三月07,2023",
	"readTime": "12s",
	"tags": "[\"chatGPT与OpenAI相关学习资料\"]",
	"description": "chatGPT与OpenAI相关学习资料",
	"article": "stream配置为true时\n\n[?](#)\n\n1\n\n2\n\n3\n\n4\n\n5\n\n6\n\n7\n\n8\n\n9\n\n10\n\n11\n\n12\n\n13\n\n14\n\n15\n\n16\n\n17\n\n18\n\n19\n\n20\n\n21\n\n22\n\n23\n\n24\n\n25\n\n26\n\n27\n\n28\n\n29\n\n30\n\n31\n\n32\n\n33\n\n34\n\n35\n\n36\n\n37\n\n38\n\n39\n\n40\n\n41\n\n42\n\n43\n\n44\n\n45\n\n46\n\n47\n\n`const eventSource =` `new` `EventSource(``'/sse'``);`\n\n`eventSource.onmessage = (event) => {`\n\n  `console.log(event.data);`\n\n`};`\n\n`eventSource.onerror = (error) => {`\n\n  `console.error(error);`\n\n`};`\n\n`function` `fetchSSE(url) {`\n\n  `return` `fetch(url, {`\n\n    `headers: {`\n\n      `'Accept'``:` `'text/event-stream'`\n\n    `}`\n\n  `});`\n\n`}`\n\n`fetchSSE(``'/sse'``)`\n\n  `.then((response) => {`\n\n    `const reader = response.body.getReader();`\n\n    `const decoder =` `new` `TextDecoder(``'utf-8'``);`\n\n    `let buffer =` `''``;`\n\n    `reader.read().then(``function` `processResult(result) {`\n\n      `if` `(result.done) {`\n\n        `return``;`\n\n      `}`\n\n      `buffer += decoder.decode(result.value, {stream:` `true``});`\n\n      `const events = buffer.split(``'\\n\\n'``);`\n\n      `for` `(let i = 0; i < events.length - 1; i++) {`\n\n        `const event =` `new` `Event(``'message'``);`\n\n        `event.data = events[i];`\n\n        `eventSource.dispatchEvent(event);`\n\n      `}`\n\n      `buffer = events[events.length - 1];`\n\n      `return` `reader.read().then(processResult);`\n\n    `});`\n\n  `})`\n\n  `.``catch``((error) => {`\n\n    `console.error(error);`\n\n  `});`\n\n[Filter table data](#)[Create a pivot table](#)[Create a chart from data series](#)\n\n[Configure buttons visibility](/users/tfac-settings.action)"
}