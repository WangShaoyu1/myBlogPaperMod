{
	"title": "优化记录",
	"author": "王宇",
	"publishTime": "一月12,2024",
	"readTime": "12s",
	"tags": "[\"年度报告\"]",
	"description": "年度报告",
	"article": "**注意，因为项目使用vite,本地开发调试跟打包后的表现会不一致，本地启动项目是no bundle，而部署会用rollup打包，看到调试面板的请求资源会有区别**\n==================================================================================\n\n**弱网下，FCP首屏过慢**\n===============\n\nchrome停用缓存后选高速3G后\n\n![](/download/attachments/114680930/image2024-1-9_10-23-48.png?version=1&modificationDate=1704767028470&api=v2)\n===============================================================================================================\n\n1.请求资源减少\n--------\n\n![](/download/attachments/114680930/image2024-1-9_10-24-37.png?version=1&modificationDate=1704767077530&api=v2)\n\n项目没使用路由功能，纯粹单一页面，\n\n2.有资源重复加载\n---------\n\n虚拟人资源重复请求了，2024.01.10排查到是用了viteVConsole插件会复现\n\n![](/download/attachments/114680930/image2024-1-10_11-46-42.png?version=1&modificationDate=1704858402410&api=v2)\n\n  \n\n![](/download/attachments/114680930/image2024-1-10_11-49-52.png?version=1&modificationDate=1704858592374&api=v2)\n\n3.资源延迟请求、加载\n-----------\n\n### 1.图片懒加载\n\n#### 1.Swiper里内容（主要是图片）配置\n\n#### 2.将所有后面出现的图片资源延迟请求\n\n#### 方案：[图片延迟加载优化](/pages/viewpage.action?pageId=114678112)\n\n剩下首屏必须的图片\n\n![](/download/attachments/114680930/image2024-1-9_11-40-52.png?version=1&modificationDate=1704771652403&api=v2)\n\n#### 3.能不用图片就不用图片\n\n用css代替\n\n### 2.第三方库懒加载\n\n顶层import都改到函数体import\n\n1.  html2canvas(351kb)\n2.  echarts(1.6Mb)\n3.  echarts-worlcloud(37.3kb)  这个不知为什么只能放顶层，还未能搞到按需加载\n\n### 3.组件懒加载\n\nSuspense\n\n  \n\n4.资源压缩\n------\n\n### 1.图片\n\n1.  工具转换压缩\n2.  利用oss路径做质量变换，如https://yz-common-production.oss-cn-shenzhen.aliyuncs.com/vdh/ics/px/px-Apr-1.jpeg?x-oss-process=image/quality,q\\_\\_80\n\n同一张图片，87 138 239\n\nq\n\nsize\n\n  \n\nq\n\nsize\n\n  \n\n80\n\n87\n\n  \n\n90\n\n138\n\n  \n\n\\-\n\n239\n\n  \n\n### 2.字体\n\n#### 字蛛（font-spider）\n\n对已知用到的字体裁剪\n\n  \n\n#### Google Fonts API \n\n可惜只能用网站上的字体\n\n[https://www.googlefonts.cn/english](https://www.googlefonts.cn/english)\n\n#### 字体格式转换\n\nttf → woff2，节省40%+\n\n[https://kombu.kanejaku.org/](https://kombu.kanejaku.org/)\n\n### 3.音频\n\n工具转换压缩\n\n  \n\n#### 4.引用包\n\n1.  按需加载**echarts**，改**echarts/lib/echarts，1.3mb → 2.9kb**\n\n5.分包\n----\n\n![](/download/attachments/114680930/image2024-1-10_14-21-4.png?version=1&modificationDate=1704867664631&api=v2)\n\nvite.config.ts 添加配置，将生态包分包\n\n[?](#)\n\n`rollupOptions: {`\n\n        `output: {`\n\n          `manualChunks: id => {`\n\n            `if` `(id.includes(``'node_modules'``)) {`\n\n              `return` `id.toString().split(``'node_modules/'``)[1].split(``'/'``)[0].toString()`\n\n            `}`\n\n          `}`\n\n        `}`\n\n      `}`\n\n  \n\n  \n\n![](/download/attachments/114680930/image2024-1-10_14-39-44.png?version=1&modificationDate=1704868784669&api=v2)\n\n  \n\n  \n\n**性能优化**\n========\n\n1.动画延迟执行，适时停止\n=============\n\n![](/download/attachments/114680930/image2024-1-9_10-44-15.png?version=1&modificationDate=1704768255361&api=v2)\n\n进入活动状态时，才执行运动，离开时停止\n\n  \n\n  \n\n[Filter table data](#)[Create a pivot table](#)[Create a chart from data series](#)\n\n[Configure buttons visibility](/users/tfac-settings.action)"
}