---
author: "Gaby"
title: "å†å¤ä¹ å¤ä¹  Promise "
date: 2022-06-24
description: "promise æ˜¯ES6å¼•å…¥çš„è¿›è¡Œå¼‚æ­¥ç¼–ç¨‹æ–°çš„è§£å†³æ–¹æ¡ˆï¼Œæ—§æ–¹æ¡ˆéƒ½æ˜¯å•çº¯ä½¿ç”¨å›è°ƒå‡½æ•°ï¼Œä»è¯­æ³•ä¸Šæ¥è¯´å®ƒå°±æ˜¯ä¸ªæ„é€ å‡½æ•°ï¼Œä»åŠŸèƒ½ä¸Šæ¥è¯´ï¼Œpromiseå¯¹è±¡ç”¨æ¥å°è£…å¼‚æ­¥çš„ä»»åŠ¡ï¼Œå¹¶ä¸”å¯ä»¥å¯¹ç»“æœè¿›è¡Œå¤„ç†ã€‚"
tags: ["JavaScript","é¢è¯•","ECMAScript 6ä¸­æ–‡æŠ€æœ¯ç¤¾åŒº","å‰ç«¯å¼€å‘ç¤¾åŒº","å‰ç«¯æŠ€æœ¯äº¤æµ","å‰ç«¯æ¡†æ¶æ•™ç¨‹","JavaScript å­¦ä¹ èµ„æº","CSS æŠ€å·§ä¸æœ€ä½³å®è·µ","HTML5 æœ€æ–°åŠ¨æ€","å‰ç«¯å·¥ç¨‹å¸ˆèŒä¸šå‘å±•","å¼€æºå‰ç«¯é¡¹ç›®","å‰ç«¯æŠ€æœ¯è¶‹åŠ¿"]
ShowReadingTime: "é˜…è¯»8åˆ†é’Ÿ"
weight: 1
selfDefined:"likes:37,comments:0,collects:52,views:3229,"
---
æŒç»­åˆ›ä½œï¼ŒåŠ é€Ÿæˆé•¿ï¼è¿™æ˜¯æˆ‘å‚ä¸ã€Œæ˜é‡‘æ—¥æ–°è®¡åˆ’ Â· 6 æœˆæ›´æ–‡æŒ‘æˆ˜ã€çš„ç¬¬25å¤©ï¼Œ[ç‚¹å‡»æŸ¥çœ‹æ´»åŠ¨è¯¦æƒ…](https://juejin.cn/post/7099702781094674468 "https://juejin.cn/post/7099702781094674468")

åºŸè¯åªè¯´ä¸€å¥ï¼šç å­—ä¸æ˜“æ±‚ä¸ªğŸ‘ï¼Œæ”¶è— === å­¦ä¼š,å¿«è¡ŒåŠ¨èµ·æ¥å§ï¼ğŸ™‡â€ğŸ™‡â€ğŸ™‡â€ã€‚

### Promiseä»‹ç»ä¸åŸºæœ¬ä½¿ç”¨

promise æ˜¯ES6å¼•å…¥çš„è¿›è¡Œå¼‚æ­¥ç¼–ç¨‹æ–°çš„è§£å†³æ–¹æ¡ˆï¼Œæ—§æ–¹æ¡ˆéƒ½æ˜¯å•çº¯ä½¿ç”¨å›è°ƒå‡½æ•°ï¼Œä»è¯­æ³•ä¸Šæ¥è¯´å®ƒå°±æ˜¯ä¸ªæ„é€ å‡½æ•°ï¼Œä»åŠŸèƒ½ä¸Šæ¥è¯´ï¼Œpromiseå¯¹è±¡ç”¨æ¥å°è£…å¼‚æ­¥çš„ä»»åŠ¡ï¼Œå¹¶ä¸”å¯ä»¥å¯¹ç»“æœè¿›è¡Œå¤„ç†ã€‚promiseçš„æœ€å¤§å¥½å¤„åœ¨äºæ”¯æŒé“¾å¼æ“ä½œå¹¶å¯ä»¥è§£å†³å›è°ƒåœ°ç‹±çš„é—®é¢˜ï¼Œä¸”å®ƒåœ¨æŒ‡å®šå›è°ƒå’Œé”™è¯¯å¤„ç†è¿™å—æ›´åŠ çµæ´»ä¸æ–¹ä¾¿ã€‚

å¼‚æ­¥ç¼–ç¨‹åŒ…æ‹¬ï¼šfsæ–‡ä»¶æ“ä½œã€æ•°æ®åº“æ“ä½œã€Ajaxã€å®šæ—¶å™¨

1.ä»€ä¹ˆæ˜¯å›è°ƒåœ°ç‹±ï¼Ÿ å›è°ƒå‡½æ•°åµŒå¥—è°ƒç”¨ï¼Œå¤–éƒ¨å›è°ƒå‡½æ•°å¼‚æ­¥æ‰§è¡Œçš„ç»“æœæ˜¯åµŒå¥—çš„å›è°ƒæ‰§è¡Œçš„æ¡ä»¶ 2.å›è°ƒåœ°ç‹±çš„ç¼ºç‚¹ï¼Ÿ ä¸ä¾¿äºé˜…è¯» ä¸ä¾¿äºå¼‚å¸¸å¤„ç† 3.è§£å†³æ–¹æ¡ˆï¼Ÿ promiseé“¾å¼è°ƒç”¨

// resolve è§£å†³ å¼‚æ­¥ä»»åŠ¡æˆåŠŸæ—¶è°ƒç”¨ // reject æ‹’ç» å¼‚æ­¥ä»»åŠ¡å¤±è´¥æ—¶è°ƒç”¨

Promise APl Promiseå…³é”®é—®é¢˜ Promiseè‡ªå®šä¹‰å°è£… async ä¸ await

### ä¸ºä»€ä¹ˆè¦ç”¨Promiseï¼Ÿ

2.2.1.æŒ‡å®šå›è°ƒå‡½æ•°çš„æ–¹å¼æ›´åŠ çµæ´» 1ã€æ—§çš„ï¼šå¿…é¡»åœ¨å¯åŠ¨å¼‚æ­¥ä»»åŠ¡å‰æŒ‡å®š 2. promiseï¼šå¯åŠ¨å¼‚æ­¥ä»»åŠ¡=>è¿”å› promise å¯¹è±¡=>ç»™promiseå¯¹è±¡ç»‘å®šå›è°ƒå‡½ æ•°ï¼ˆç”šè‡³å¯ä»¥åœ¨å¼‚æ­¥ä»»åŠ¡ç»“æŸåæŒ‡å®š/å¤šä¸ªï¼‰ 2.2.2.æ”¯æŒé“¾å¼è°ƒç”¨ï¼Œå¯ä»¥è§£å†³å›è°ƒåœ°ç‹±é—®é¢˜ 1.ä»€ä¹ˆæ˜¯å›è°ƒåœ°ç‹±ï¼Ÿ

```js
// ä½¿ç”¨ Promise å¤„ç†
    const p = new Promise((resolve, reject)=>{
    // å¯ä»¥é€šè¿‡ promise è¿›è¡Œå°è£… å½“è¯·æ±‚æˆåŠŸ n ä¸ªä¹‹åè¿”å›æˆåŠŸçŠ¶æ€
        setTimeout(() =>{
        //è·å–ä»1-100çš„ä¸€ä¸ªéšæœºæ•°
        let n = Math.floor(Math.random(1,100)*100);
        console.log(n);
            if(n>30){
            resolve(n);//å°†promiseå¯¹è±¡çš„çŠ¶æ€è®¾ç½®ä¸ºã€ŒæˆåŠŸã€
                } else {
                reject(n);//å°†promiseå¯¹è±¡çš„çŠ¶æ€è®¾ç½®ä¸ºã€Œå¤±è´¥ã€
            }
            
            }, 1000);
            });
            // è°ƒç”¨  value å€¼  reason ç†ç”± ï¼Œå°±æ˜¯æ¥æ”¶resolveæˆ–rejectæ–¹æ³•ä¸­ä¼ çš„å½¢å‚
                p.then((value) => {
                console.log('æˆåŠŸäº†å‘—');
                    },(reason)=>{
                    console.log('å¤±è´¥äº†å§');
                    })
``````js
// Promiseå®è·µç»ƒä¹ -fsè¯»å–æ–‡ä»¶ è¦åœ¨ node ç¯å¢ƒä¸‹æ‰§è¡Œ
const fs = require('fs');
//Promise å½¢å¼
    let p = new Promise((resolve , reject)=>{
        fs.readFile('./resource/content.tx', (err, data)=>{
        //å¦‚æœå‡ºé”™
        if(err) reject(err);
        //å¦‚æœæˆåŠŸ
        resolve(data);
        });
        });
        //è°ƒç”¨ then
            p.then(value=>{
            console.log(value.toString())
            },
                reason=>{
                console.log(reason);
                });
``````js
const btn = document.querySelector('#btn');

    btn.addEventListener('click', function(){
    //1.åˆ›å»ºå¯¹è±¡
    const xhr = new XMLHttpRequest();
    //2.åˆå§‹åŒ– è°ƒç”¨è¯—è¯æ¥å£
    xhr.open('GET','http://poetry.apiopen.top/sentences');
    //3.å‘é€
    xhr.send();
    //4.å¤„ç†å“åº”ç»“æœ
        xhr.onreadystatechange = function(){
            if(xhr.readyState === 4){
            //åˆ¤æ–­å“åº”çŠ¶æ€ç 2xx
                if(xhr.status >= 200 && xhr.status < 300){
                //æ§åˆ¶å°è¾“å‡ºå“åº”ä½“
                console.log(xhr.response);
                    }else{
                    //æ§åˆ¶å°è¾“å‡ºå“åº”çŠ¶æ€ç 
                    console.log(xhr.status);
                }
            }
        }
        })
``````js
// ä½¿ç”¨ Promise å°è£… AJAXè¯·æ±‚
//åˆ›å»º Promise å½¢å¼
    let p = new Promise((resolve, reject)=>{
    //1.åˆ›å»ºå¯¹è±¡
    const xhr = new XMLHttpRequest();
    //2.åˆå§‹åŒ– è°ƒç”¨è¯—è¯æ¥å£
    xhr.open('GET','http://poetry.apiopen.top/sentences');
    //3.å‘é€
    xhr.send();
    //4.å¤„ç†å“åº”ç»“æœ
        xhr.onreadystatechange = function(){
            if(xhr.readyState === 4){
            //åˆ¤æ–­å“åº”çŠ¶æ€ç 2xx
                if(xhr.status >= 200 && xhr.status < 300){
                //æ§åˆ¶å°è¾“å‡ºå“åº”ä½“
                resolve(xhr.response);
                    }else{
                    //æ§åˆ¶å°è¾“å‡ºå“åº”çŠ¶æ€ç 
                    reject(xhr.status);
                }
            }
        }
        });
        
        //è°ƒç”¨ then
            p.then(value=>{
            console.log(value.toString())
            },
                reason=>{
                console.log(reason);
                });
```

å°è£… Promise å‡½æ•°

```js
    function promFn (){
        return new Promise((resolve, reject)=>{
        // åˆ¤æ–­
        let err = 'é”™è¯¯'
        if(err) reject(err);
        let data = 'æˆåŠŸäº†';
        // æˆåŠŸ
        resolve(data);
        });
    }
    
        promFn().then(value=>{
        console.log(value.toString());
            }, reason=>{
            console.log(reason);
            });
            
```

### promiseçš„çŠ¶æ€æ”¹å˜

```js
[[Prototype]]: Promise
[[PromiseState]]: "fulfilled"
[[PromiseResult]]: "{\"code\":200,\"message\":\"æˆåŠŸ!\"}"

Promise {<pending>}
[[Prototype]]: Promise
catch: Æ’ catch()
constructor: Æ’ Promise()
finally: Æ’ finally()
then: Æ’ then()
Symbol(Symbol.toStringTag): "Promise"
[[Prototype]]: Object
[[PromiseState]]: "pending"
[[PromiseResult]]: undefined
```

### Promiseå¯¹è±¡

#### Promiseå¯¹è±¡çš„çŠ¶æ€å€¼

å®ä¾‹å¯¹è±¡ä¸­çš„ä¸€ä¸ªå±æ€§ã€ PromiseState ã€

*   pendingæœªå†³å®šçš„
*   resolved/ fullfilled æˆåŠŸ
*   rejectedå¤±è´¥

#### Promiseå¯¹è±¡çš„ç»“æœå€¼

å®ä¾‹å¯¹è±¡ä¸­çš„å¦ä¸€ä¸ªå±æ€§PromiseResult ä¿å­˜ç€å¯¹è±¡ã€æˆåŠŸ/å¤±è´¥ã€çš„ç»“æœ

*   resolved
*   rejected åªæœ‰è¿™ä¸¤ä¸ªå€¼å¯ä»¥å¯¹ç»“æœè¿›è¡Œæ”¹å˜

1.  ç”± pending å˜ä¸º resolved
2.  ç”± pendingå˜ä¸º rejected è¯´æ˜ï¼šåªæœ‰è¿™2ç§ï¼Œä¸”ä¸€ä¸ª promiseå¯¹è±¡åªèƒ½æ”¹å˜ä¸€æ¬¡ æ— è®ºå˜ä¸ºæˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ªç»“æœæ•°æ® æˆåŠŸçš„ç»“æœæ•°æ®ä¸€èˆ¬ç§°ä¸º valueï¼Œå¤±è´¥çš„ç»“æœæ•°æ®ä¸€èˆ¬ç§°ä¸º reason

### Promise çš„åŸºæœ¬å·¥ä½œæµç¨‹

é¦–å…ˆè¦é€šè¿‡ new promise() åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œåœ¨ promise å†…éƒ¨å°è£…å¼‚æ­¥æ“ä½œï¼Œå¦‚æœå¼‚æ­¥æ“ä½œæˆåŠŸåˆ™è°ƒç”¨ resolve() å‡½æ•°ï¼Œresolveä¸€è°ƒåˆ™å°† promise çš„çŠ¶æ€è¯¥ä¸ºæˆåŠŸå³ fullfilledã€‚æˆåŠŸåœ¨è°ƒ then æ–¹æ³•æ—¶ï¼Œè°ƒç”¨çš„æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå³ç¬¬ä¸€ä¸ªå›è°ƒå‡½æ•°ä¸­çš„ä»£ç ï¼Œè®©å®ƒè¿”å›ä¸€ä¸ªæ–°çš„ promise å¯¹è±¡ã€‚then æ–¹æ³•çš„è¿”å›å¯¹è±¡ä¹Ÿæ˜¯ä¸€ä¸ªæ–°çš„ promise å¯¹è±¡ã€‚ å¦‚æœ promise å¯¹è±¡çš„æ“ä½œå¤±è´¥äº†ï¼Œåˆ™è°ƒ reject() å°†çŠ¶æ€è®¾ç½®ä¸ºå¤±è´¥ï¼Œè°ƒç”¨reject æ—¶ï¼Œå¤±è´¥ä¹‹åå°†è°ƒç”¨ then æ–¹æ³•å½“ä¸­çš„ç¬¬äºŒä¸ªå›è°ƒå‡½æ•°ï¼Œå¹¶ä¸”è¿”å›ä¸€ä¸ª promiseã€‚

### Promise çš„ API

1.  promiseæ„é€ å‡½æ•°ï¼šå¯ä»¥é€šè¿‡ new Promise() å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡ã€‚å®ä¾‹åŒ–éœ€è¦æ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼Œè¿™ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°ç±»å‹çš„å‚æ•°ã€‚ç§°ä¹‹ä¸ºæ‰§è¡Œå™¨å‡½æ•°ï¼Œå¯ä»¥ä½¿ç”¨ç®­å¤´å‡½æ•°å»å£°æ˜ï¼Œä¹Ÿå¯ä»¥é€šè¿‡åŒ¿åå‡½æ•°å»å£°æ˜ã€‚ Promise(excutor){} ï¼Œè€Œä¸”è¿™ä¸ªå‡½æ•°å½“ä¸­æœ‰ä¸¤ä¸ªå½¢å‚ resolve å’Œ rejectã€‚

*   ï¼ˆ1ï¼‰executorå‡½æ•°:æ‰§è¡Œå™¨å‡½æ•°ï¼ˆresolveï¼Œrejectï¼‰=> {}, resolve å’Œ reject æ˜¯å†…éƒ¨å®šä¹‰çš„ã€‚
*   ï¼ˆ2ï¼‰ resolveå‡½æ•°ï¼šå†…éƒ¨å®šä¹‰å¼‚æ­¥ä»»åŠ¡æ‰§è¡ŒæˆåŠŸæ—¶æˆ‘ä»¬è°ƒç”¨çš„å‡½æ•°value=>{}
*   ï¼ˆ3ï¼‰rejectå‡½æ•°ï¼šå†…éƒ¨å®šä¹‰å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œå¤±è´¥æ—¶æˆ‘ä»¬è°ƒç”¨çš„å‡½æ•°reason=>{} è¯´æ˜ï¼šæ‰§è¡Œå™¨å‡½æ•° executor æ˜¯åœ¨ Promise å†…éƒ¨ç«‹å³åŒæ­¥è°ƒç”¨çš„ï¼Œå¼‚æ­¥æ“ä½œåœ¨æ‰§è¡Œå™¨ä¸­æ‰§è¡Œã€‚

2.  Promise.prototype.thenæ–¹æ³•ï¼šï¼ˆonResolvedï¼ŒonRejectedï¼‰ =>{}

*   (1)onResolved å‡½æ•°ï¼šæˆåŠŸçš„å›è°ƒå‡½æ•°ï¼ˆvalueï¼‰=ã€‹{}
*   ï¼ˆ2ï¼‰onRejectedå‡½æ•°ï¼šå¤±è´¥çš„å›è°ƒå‡½æ•°ï¼ˆreasonï¼‰=ã€‹{} è¯´æ˜ï¼šæŒ‡å®šç”¨äºå¾—åˆ°æˆåŠŸvalueçš„æˆåŠŸå›è°ƒå’Œç”¨äºå¾—åˆ°å¤±è´¥reasonçš„å¤±è´¥å›è°ƒ è¿”å›ä¸€ä¸ªæ–°çš„promiseå¯¹è±¡

3.  Promise.prototype.catchæ–¹æ³•ï¼šæ•è·å¼‚æ­¥æ‰§è¡Œå¤±è´¥çš„æƒ…å†µï¼ˆonRejectedï¼‰=>{}

*   ï¼ˆ1ï¼‰onRejectedå‡½æ•°ï¼šå¤±è´¥çš„å›è°ƒå‡½æ•°ï¼ˆreasonï¼‰=>{}

4.  Promise.resolveæ–¹æ³•ï¼šï¼ˆvalueï¼‰=>{}

*   ï¼ˆ1ï¼‰ valueï¼šæˆåŠŸçš„æ•°æ®æˆ–promiseå¯¹è±¡ è¯´æ˜ï¼šè¿”å›ä¸€ä¸ªæœåŠŸ/å¤±è´¥çš„promiseå¯¹è±¡ //å¦‚æœä¼ å…¥çš„å‚æ•°ä¸ºéPromiseç±»å‹çš„å¯¹è±¡ï¼Œåˆ™è¿”å›çš„ç»“æœä¸ºæˆåŠŸpromiseå¯¹è±¡ //å¦‚æœä¼ å…¥çš„å‚æ•°ä¸ºPromiseå¯¹è±¡ï¼Œåˆ™å‚æ•°çš„ç»“æœå†³å®šäº†resolveçš„ç»“æœ let p2= Promise.resolve(new Promise((resolve, reject) =>{

}))

5.  Promise.rejectæ–¹æ³•ï¼šï¼ˆreasonï¼‰=>{}

*   ï¼ˆ1ï¼‰ reasonï¼šå¤±è´¥çš„åŸå›  è¯´æ˜ï¼šè¿”å›ä¸€ä¸ªå¤±è´¥çš„promiseå¯¹è±¡

6.  Promise.allæ–¹æ³•ï¼šï¼ˆpromisesï¼‰=>{}

*   ï¼ˆ1ï¼‰ promisesï¼šåŒ…å«nä¸ªpromiseçš„æ•°ç»„ è¯´æ˜ï¼šè¿”å›ä¸€ä¸ªæ–°çš„promiseï¼Œåªæœ‰æ‰€æœ‰çš„promiseéƒ½æˆåŠŸæ‰æˆåŠŸï¼Œåªè¦æœ‰ä¸€ä¸ªå¤±è´¥äº†å°±ç›´æ¥å¤±è´¥ã€‚æˆåŠŸæ—¶æ˜¯æ‰€æœ‰æˆåŠŸ promise çš„ç»“æœå€¼ç»„åˆæˆçš„æ•°ç»„ï¼Œå¤±è´¥æ—¶è¿”å›çš„æ˜¯ç¬¬ä¸€ä¸ªå¤±è´¥çš„é‚£ ä¸ª promise çš„çŠ¶æ€å’Œå€¼ã€‚

```js
const p1 = Promise.reject('å¤±è´¥1')
const p2 = Promise.reject('å¤±è´¥2')
const p3 = Promise.resolve('æˆåŠŸ')

const res = Promise.all([p1,p2,p3])
console.log(res);// è¿”å› p1 çš„ç»“æœ
```

7.  Promise.raceæ–¹æ³•ï¼šï¼ˆpromisesï¼‰=>{}

*   ï¼ˆ1ï¼‰ promisesï¼šåŒ…å«nä¸ªpromiseçš„æ•°ç»„ è¯´æ˜ï¼šè¿”å›ä¸€ä¸ªæ–°çš„promiseï¼Œç¬¬ä¸€ä¸ªå®Œæˆçš„promiseçš„ç»“æœçŠ¶æ€å°±æ˜¯æœ€ç»ˆçš„ç»“æœçŠ¶æ€

### promiseçš„å‡ ä¸ªå…³é”®é—®é¢˜

1.  å¦‚ä½•æ”¹å˜promise çš„çŠ¶æ€ï¼Ÿ

*   ï¼ˆ1ï¼‰ resolve(value)ï¼šå¦‚æœå½“å‰æ˜¯pendingå°±ä¼šå˜ä¸ºresolved
*   ï¼ˆ2ï¼‰ reject(reason)ï¼šå¦‚æœå½“å‰æ˜¯pendingå°±ä¼šå˜ä¸ºrejected
*   ï¼ˆ3ï¼‰æ‹‹å‡ºå¼‚å¸¸ï¼š`throw 'å‡ºé—®é¢˜äº†';` å¦‚æœå½“å‰æ˜¯pendingå°±ä¼šå˜ä¸ºrejected

2.  ä¸€ä¸ª promise ä½¿ç”¨ then æ–¹æ³•æŒ‡å®šå¤šä¸ªæˆåŠŸ/å¤±è´¥å›è°ƒå‡½æ•°ï¼Œéƒ½ä¼šè°ƒç”¨å—ï¼Ÿ  
    å½“promise æ”¹å˜ä¸ºå¯¹åº”çŠ¶æ€æ—¶å¯¹åº”çš„å›è°ƒå‡½æ•°éƒ½ä¼šè¢«è°ƒç”¨
    
3.  æ”¹å˜promiseçŠ¶æ€å’ŒæŒ‡å®šå›è°ƒå‡½æ•°è°å…ˆè°åï¼Ÿ(å…ˆæ”¹å˜çŠ¶æ€è¿˜æ˜¯å…ˆæ‰§è¡Œå›è°ƒ)
    

*   ï¼ˆ1ï¼‰éƒ½æœ‰å¯èƒ½ï¼Œæ­£å¸¸æƒ…å†µä¸‹æ˜¯å…ˆæŒ‡å®šå›è°ƒå†æ”¹å˜çŠ¶æ€ï¼Œresolve ä¸­ä»»åŠ¡ä¸ºå¼‚æ­¥ä»»åŠ¡çš„æ—¶å€™ï¼Œå¼‚æ­¥ä»»åŠ¡å±…å¤šã€‚ä½†ä¹Ÿå¯ä»¥å…ˆæ”¹çŠ¶æ€å†æŒ‡å®šå›è°ƒï¼Œresolve ä¸­çš„ä»»åŠ¡ä¸ºåŒæ­¥ä»»åŠ¡çš„æ—¶å€™ã€‚
*   ï¼ˆ2ï¼‰å¦‚ä½•å…ˆæ”¹çŠ¶æ€å†æŒ‡å®šå›è°ƒï¼Ÿ â‘ åœ¨æ‰§è¡Œå™¨ä¸­ç›´æ¥è°ƒç”¨resolve()/reject() â‘¡å»¶è¿Ÿæ›´é•¿æ—¶é—´æ‰è°ƒç”¨then()
*   ï¼ˆ3ï¼‰ä»€ä¹ˆæ—¶å€™æ‰èƒ½å¾—åˆ°æ•°æ®ï¼Ÿ  
    æŒ‡å›è°ƒå‡½æ•°ä»€ä¹ˆæ—¶å€™æ‰§è¡Œï¼Œæ‰§è¡Œçš„æ—¶å€™å³å¯ä»¥æ‹¿åˆ°æ•°æ®  
    â‘ å¦‚æœå…ˆæŒ‡å®šçš„å›è°ƒï¼Œé‚£å½“çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œå›è°ƒå‡½æ•°å°±ä¼šè°ƒç”¨ï¼Œå¾—åˆ°æ•°æ®  
    â‘¡å¦‚æœå…ˆæ”¹å˜çš„çŠ¶æ€ï¼Œé‚£å½“æŒ‡å®šå›è°ƒæ—¶ï¼Œå›è°ƒå‡½æ•°å°±ä¼šè°ƒç”¨ï¼Œå¾—åˆ°æ•°æ®

4.  promise.thenï¼ˆï¼‰è¿”å›çš„æ–°promiseçš„ç»“æœçŠ¶æ€ç”±ä»€ä¹ˆå†³å®šï¼Ÿ

*   ï¼ˆ1ï¼‰ç®€å•è¡¨è¾¾ï¼šç”±thenï¼ˆï¼‰æŒ‡å®šçš„å›è°ƒå‡½æ•°æ‰§è¡Œçš„ç»“æœå†³å®š
*   ï¼ˆ2ï¼‰è¯¦ç»†è¡¨è¾¾ï¼š â‘ å¦‚æœæŠ›å‡ºå¼‚å¸¸ï¼Œæ–°promiseå˜ä¸ºrejectedï¼Œreasonä¸ºæŠ›å‡ºçš„å¼‚å¸¸å¦‚æœè¿”å›çš„æ˜¯épromiseçš„ä»»æ„å€¼ï¼Œæ–°promiseå˜ä¸ºresolvedï¼Œvalueä¸ºè¿”å›çš„å€¼å¦‚æœè¿”å›çš„æ˜¯å¦ä¸€ä¸ªæ–°promiseï¼Œæ­¤promiseçš„ç»“æœå°±ä¼šæˆä¸ºæ–°promiseçš„ç»“æœ

5.  promise å¦‚ä½•ä¸²è¿å¤šä¸ªæ“ä½œä»»é›¾ï¼Ÿ ï¼ˆ1ï¼‰ promise çš„ then() è¿”å›ä¸€ä¸ªæ–°çš„promiseï¼Œå¯ä»¥å†™æˆ then() çš„é“¾å¼è°ƒç”¨ ï¼ˆ2ï¼‰é€šè¿‡thençš„é“¾å¼è°ƒç”¨ä¸²è¿å¤šä¸ªåŒæ­¥/å¼‚æ­¥ä»»åŠ¡
    
6.  promiseå¼‚å¸¸ä¼ é€ï¼Ÿ ï¼ˆ1ï¼‰å½“ä½¿ç”¨promiseçš„thené“¾å¼è°ƒç”¨æ—¶ï¼Œå¯ä»¥åœ¨æœ€åæŒ‡å®šå¤±è´¥çš„å›è°ƒ ï¼ˆ2ï¼‰å‰é¢ä»»ä½•æ“ä½œå‡ºäº†å¼‚å¸¸ï¼Œéƒ½ä¼šä¼ åˆ°æœ€åå¤±è´¥çš„å›è°ƒä¸­å¤„ç†
    

```js
// æ— è®ºä¸­é—´é‚£ä¸€å±‚å‡ºç°é”™è¯¯ï¼Œæœ€ç»ˆéƒ½ä¼šç”± catch æ•è·
    p.then(value =>{
    // console.log(111);
    throw'å¤±è´¥å•¦ï¼"ï¼›
        }).then(value =>{
        console.log(222);
            }).then(value =>{
            console.log(333);
                }).catch(reason =>{
                console.warn(reason)
                })
                
```

7.  ä¸­æ–­promiseé“¾ï¼Ÿ ï¼ˆ1ï¼‰å½“ä½¿ç”¨promiseçš„thené“¾å¼è°ƒç”¨æ—¶ï¼Œåœ¨ä¸­é—´ä¸­æ–­ï¼Œä¸å†è°ƒç”¨åé¢çš„å›è°ƒå‡½æ•° ï¼ˆ2ï¼‰åŠæ³•ï¼šæœ‰ä¸”åªæœ‰ä¸€ç§æ–¹å¼ï¼Œåˆ™æ˜¯åœ¨å›è°ƒå‡½æ•°ä¸­è¿”å›ä¸€ä¸ª pendding çŠ¶æ€çš„promise å¯¹è±¡

### Promise all æ–¹æ³•å®ç°

```js
//æ·»åŠ allæ–¹æ³•
    Promise.all = function(promises){
    //è¿”å›ç»“æœä¸ºpromiseå¯¹è±¡
        return new Promise((resolve, reject)=>{
        //å£°æ˜å˜é‡
        let count = 0;
        let arr = [];
            for(let i=0;i<promises.length;i++){
                promises[i].then(v=>{
                //å¾—çŸ¥å¯¹è±¡çš„çŠ¶æ€æ˜¯æˆåŠŸ æˆåŠŸæ—¶ count + 1
                count++;
                // ä¿å­˜æ‰§è¡Œç»“æœ
                arr[i]=v;
                // æ¯ä¸ª promise å¯¹è±¡ éƒ½æˆåŠŸçš„æ—¶å€™æ‰ä¼šè¿”å› resolve()
                    if(count === promises.length){
                    resolve(arr);
                }
                    },r=>{
                    reject(r);
                    });
                }
                });
            }
```

### Promise race æ–¹æ³•å®ç°

```js
//æ·»åŠ allæ–¹æ³•
    Promise.race = function(promises){
    //è¿”å›ç»“æœä¸ºpromiseå¯¹è±¡
        return new Promise((resolve, reject)=>{
            for(let i=0;i<promises.length;i++){
                promises[i].then(v=>{
                resolve(v);
                    },r=>{
                    reject(r);
                    });
                }
                });
            }
```

### awaitè¡¨è¾¾å¼

*   1.awaitå³ä¾§çš„è¡¨è¾¾å¼ä¸€èˆ¬ä¸ºpromiseå¯¹è±¡ï¼Œä½†ä¹Ÿå¯ä»¥æ˜¯å…¶å®ƒçš„å€¼ï¼›
*   2.å¦‚æœè¡¨è¾¾å¼æ˜¯promiseå¯¹è±¡ï¼Œawaitè¿”å›çš„æ˜¯promiseæˆåŠŸçš„å€¼
*   3.å¦‚æœè¡¨è¾¾å¼æ˜¯å…¶å®ƒå€¼ï¼Œç›´æ¥å°†æ­¤å€¼ä½œä¸ºawaitçš„è¿”å›å€¼

#### æ³¨æ„

1.awaitå¿…é¡»å†™åœ¨asyncå‡½æ•°ä¸­ï¼Œä½†asyncå‡½æ•°ä¸­å¯ä»¥æ²¡æœ‰await  
2.å¦‚æœawaitçš„promiseå¤±è´¥äº†ï¼Œå°±ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œéœ€è¦é€šè¿‡try...catchæ•è·å¤„ç†