---
author: "Gaby"
title: "‰Ω†ËøòÂú®Áõ¥Êé•Áî® localStorage ‰πàÔºüËØ•ÊèêÂçá‰∏ãÈÄºÊ†º‰∫Ü"
date: 2022-06-01
description: "ÂæàÂ§ö‰∫∫Âú®Áî® `localStorage` ÁöÑÊó∂ÂÄôÂñúÊ¨¢Áõ¥Êé•Áî®ÔºåÊòéÊñáÂ≠òÂÇ®ÔºåÁõ¥Êé•Â∞Ü‰ø°ÊÅØÊö¥Èú≤Âú®ÔºõÊµèËßàÂô®‰∏≠ÔºåËôΩÁÑ∂‰∏ÄËà¨Âú∫ÊôØ‰∏ãÈÉΩËÉΩÂ∫î‰ªòÂæó‰∫Ü‰∏îÁÆÄÂçïÁ≤óÊö¥Ôºå‰ΩÜÁâπÊÆäÈúÄÊ±ÇÊÉÖÂÜµ‰∏ãÂ∞±‰∏çË°å‰∫ÜÔºåËØ•Â≠¶Â≠¶Â∞ÅË£ÖÊèêÂçá‰∏ãÈÄºÊ†º‰∫ÜÔºÅ"
tags: ["JavaScript","Êû∂ÊûÑ","Èù¢ËØï‰∏≠ÊñáÊäÄÊúØÁ§æÂå∫","ÂâçÁ´ØÂºÄÂèëÁ§æÂå∫","ÂâçÁ´ØÊäÄÊúØ‰∫§ÊµÅ","ÂâçÁ´ØÊ°ÜÊû∂ÊïôÁ®ã","JavaScript Â≠¶‰π†ËµÑÊ∫ê","CSS ÊäÄÂ∑ß‰∏éÊúÄ‰Ω≥ÂÆûË∑µ","HTML5 ÊúÄÊñ∞Âä®ÊÄÅ","ÂâçÁ´ØÂ∑•Á®ãÂ∏àËÅå‰∏öÂèëÂ±ï","ÂºÄÊ∫êÂâçÁ´ØÈ°πÁõÆ","ÂâçÁ´ØÊäÄÊúØË∂ãÂäø"]
ShowReadingTime: "ÈòÖËØª5ÂàÜÈíü"
weight: 1
selfDefined:"likes:1100,comments:261,collects:1600,views:93412,"
---
ÊåÅÁª≠Âàõ‰ΩúÔºåÂä†ÈÄüÊàêÈïøÔºÅËøôÊòØÊàëÂèÇ‰∏é„ÄåÊéòÈáëÊó•Êñ∞ËÆ°Âàí ¬∑ 6 ÊúàÊõ¥ÊñáÊåëÊàò„ÄçÁöÑÁ¨¨5Â§©Ôºå[ÁÇπÂáªÊü•ÁúãÊ¥ªÂä®ËØ¶ÊÉÖ](https://juejin.cn/post/7099702781094674468 "https://juejin.cn/post/7099702781094674468")

Â∫üËØùÂè™ËØ¥‰∏ÄÂè•ÔºöÁ†ÅÂ≠ó‰∏çÊòìÊ±Ç‰∏™üëçÔºåÊî∂Ëóè === Â≠¶‰ºö,Âø´Ë°åÂä®Ëµ∑Êù•ÂêßÔºÅüôá‚Äçüôá‚Äçüôá‚Äç„ÄÇ

ÊÑüË∞¢ÁÇπËµû„ÄÅÊî∂Ëóè„ÄÅÂÖ≥Ê≥®ÂíåÊèêÂá∫Âª∫ËÆÆÁöÑÂ∞è‰ºô‰º¥ÔºåÂ∏åÊúõÂ§ßÂÆ∂Â∑•‰ΩúÈ°∫Âà©„ÄÅËÄÅÊùøËÉΩÁªô‰Ω†‰ª¨Âä†È∏°ËÖø!

‰∏∫ÂõûÈ¶àÊéòÈáëÁöÑÂ∞è‰ºô‰º¥‰ª¨ÔºåÁâπÂú∞ÂÅö‰∫Ü‰∏™ÊñáÊ°£Á´ôÁÇπÔºåÂ∞ÜÂâçÁ´ØÈù¢ËØïÈ¢ò„ÄÅÂ∏∏Áî®Áü•ËØÜÁÇπÂèäÊó•Â∏∏Â∞ÅË£ÖÁöÑÂ∑•ÂÖ∑Á±ªÁ≥ªÁªüÁöÑÊï¥ÁêÜÂú®ËØ•Á´ôÁÇπ‰∏äÔºåÂ∏åÊúõËÉΩÂ∏ÆÂà∞Êõ¥Â§öÁöÑÂ∞è‰ºô‰º¥[‚òû‰º†ÈÄÅÈó®](https://link.juejin.cn?target=https%3A%2F%2Fdocs.ycsnews.com%2F "https://docs.ycsnews.com/")ÔºåÁõÆÂâçÔºåÊú¨Á´ôÂÜÖÂÆπÊ≠£Á¥ßÈî£ÂØÜÈºìÁöÑÊõ¥Êñ∞‰∏≠ÔºÅ

ÂæàÂ§ö‰∫∫Âú®Áî® `localStorage` Êàñ `sessionStorage` ÁöÑÊó∂ÂÄôÂñúÊ¨¢Áõ¥Êé•Áî®ÔºåÊòéÊñáÂ≠òÂÇ®ÔºåÁõ¥Êé•Â∞Ü‰ø°ÊÅØÊö¥Èú≤Âú®ÔºõÊµèËßàÂô®‰∏≠ÔºåËôΩÁÑ∂‰∏ÄËà¨Âú∫ÊôØ‰∏ãÈÉΩËÉΩÂ∫î‰ªòÂæó‰∫Ü‰∏îÁÆÄÂçïÁ≤óÊö¥Ôºå‰ΩÜÁâπÊÆäÈúÄÊ±ÇÊÉÖÂÜµ‰∏ãÔºåÊØîÂ¶ÇËÆæÁΩÆÂÆöÊó∂ÂäüËÉΩÔºåÂ∞±‰∏çËÉΩÂÆûÁé∞„ÄÇÂ∞±ÈúÄË¶ÅÂØπÂÖ∂ËøõË°å‰∫åÊ¨°Â∞ÅË£ÖÔºå‰∏∫‰∫ÜÂú®‰ΩøÁî®‰∏äÂ¢ûÂä†‰∫õÂÆâÂÖ®ÊÑüÔºåÈÇ£Âä†ÂØÜ‰πüÂøÖÁÑ∂ÊòØÂ∞ë‰∏ç‰∫ÜÁöÑ‰∫Ü„ÄÇ‰∏∫Êñπ‰æøÈ°πÁõÆ‰ΩøÁî®ÔºåÁâπÂØπÂ∏∏ËßÑÊìç‰ΩúËøõË°åÂ∞ÅË£Ö„ÄÇ‰∏çÂÆåÂñÑ‰πãÂ§Ñ‰ºöËøõ‰∏ÄÊ≠•Êõ¥Êñ∞...(Êõ¥Êñ∞‰∫éÔºö2022.07.04 17:30) Â∑≤Êõ¥Êñ∞„ÄÇ

### ËÆæËÆ°

Â∞ÅË£Ö‰πãÂâçÂÖàÊ¢≥ÁêÜ‰∏ãÊâÄÈúÄÂäüËÉΩÔºåÂπ∂Ë¶ÅÂÅöÊàê‰ªÄ‰πàÊ†∑ÔºåÈááÁî®‰ªÄ‰πàÊ†∑ÁöÑËßÑËåÉÔºåÈÉ®ÂàÜ‰∏ªË¶Å‰ª£Á†ÅÁâáÊÆµÊòØ‰ª• `localStorage`‰Ωú‰∏∫Á§∫‰æãÔºåÊúÄÂêé‰ºöË¥¥Âá∫ÂÆåÊï¥‰ª£Á†ÅÁöÑ„ÄÇÂèØ‰ª•ÁªìÂêàÈ°πÁõÆËá™Ë°å‰ºòÂåñÔºå‰πüÂèØ‰ª•Áõ¥Êé•‰ΩøÁî®„ÄÇ

```js
// Âå∫ÂàÜÂ≠òÂÇ®Á±ªÂûã type
// Ëá™ÂÆö‰πâÂêçÁß∞ÂâçÁºÄ prefix
// ÊîØÊåÅËÆæÁΩÆËøáÊúüÊó∂Èó¥ expire
// ÊîØÊåÅÂä†ÂØÜÂèØÈÄâÔºåÂºÄÂèëÁéØÂ¢É‰∏ãÊú™Êñπ‰æøË∞ÉËØïÂèØÂÖ≥Èó≠Âä†ÂØÜ

// ÊîØÊåÅÊï∞ÊçÆÂä†ÂØÜ ËøôÈáåÈááÁî® crypto-js Âä†ÂØÜ ‰πüÂèØ‰ΩøÁî®ÂÖ∂‰ªñÊñπÂºè

// Âà§Êñ≠ÊòØÂê¶ÊîØÊåÅ Storage isSupportStorage

// ËÆæÁΩÆ setStorage

// Ëé∑Âèñ getStorage

// ÊòØÂê¶Â≠òÂú® hasStorage

// Ëé∑ÂèñÊâÄÊúâkey getStorageKeys

// Ê†πÊçÆÁ¥¢ÂºïËé∑Âèñkey getStorageForIndex

// Ëé∑ÂèñlocalStorageÈïøÂ∫¶ getStorageLength

// Ëé∑ÂèñÂÖ®ÈÉ® getAllStorage

// Âà†Èô§ removeStorage

// Ê∏ÖÁ©∫ clearStorage

//ÂÆö‰πâÂèÇÊï∞ Á±ªÂûã window.localStorage,window.sessionStorage,
    const config = {
    type: 'localStorage', // Êú¨Âú∞Â≠òÂÇ®Á±ªÂûã localStorage/sessionStorage
    prefix: 'xxx_0.0.1', // ÂêçÁß∞ÂâçÁºÄ Âª∫ËÆÆÔºöÈ°πÁõÆÂêç + È°πÁõÆÁâàÊú¨
    expire: 1, //ËøáÊúüÊó∂Èó¥ Âçï‰ΩçÔºöÁßí
    isEncrypt: true // ÈªòËÆ§Âä†ÂØÜ ‰∏∫‰∫ÜË∞ÉËØïÊñπ‰æø, ÂºÄÂèëËøáÁ®ã‰∏≠ÂèØ‰ª•‰∏çÂä†ÂØÜ
}
```

### ËÆæÁΩÆ setStorage

Storage Êú¨Ë∫´ÊòØ‰∏çÊîØÊåÅËøáÊúüÊó∂Èó¥ËÆæÁΩÆÁöÑÔºåË¶ÅÊîØÊåÅËÆæÁΩÆËøáÊúüÊó∂Èó¥ÔºåÂèØ‰ª•Êïà‰ªø Cookie ÁöÑÂÅöÊ≥ïÔºå`setStorage(key,value,expire)` ÊñπÊ≥ïÔºåÊé•Êî∂‰∏â‰∏™ÂèÇÊï∞ÔºåÁ¨¨‰∏â‰∏™ÂèÇÊï∞Â∞±ÊòØËÆæÁΩÆËøáÊúüÊó∂Èó¥ÁöÑÔºåÁî®Áõ∏ÂØπÊó∂Èó¥ÔºåÂçï‰ΩçÁßíÔºåË¶ÅÂØπÊâÄ‰º†ÂèÇÊï∞ËøõË°åÁ±ªÂûãÊ£ÄÊü•„ÄÇÂèØ‰ª•ËÆæÁΩÆÁªü‰∏ÄÁöÑËøáÊúüÊó∂Èó¥Ôºå‰πüÂèØ‰ª•ÂØπÂçï‰∏™ÂÄºÂæóËøáÊúüÊó∂Èó¥ËøõË°åÂçïÁã¨ÈÖçÁΩÆ„ÄÇ‰∏§ÁßçÊñπÂºèÊåâÈúÄÈÖçÁΩÆ„ÄÇ

‰ª£Á†ÅÂÆûÁé∞Ôºö

```js
// ËÆæÁΩÆ setStorage
    export const setStorage = (key, value, expire = 0) => {
        if (value === '' || value === null || value === undefined) {
        value = null;
    }
    
    if (isNaN(expire) || expire < 0) throw new Error('Expire must be a number');
    
    expire = (expire ? expire : config.expire) * 1000;
        let data = {
        value: value, // Â≠òÂÇ®ÂÄº
        time: Date.now(), //Â≠òÂÄºÊó∂Èó¥Êà≥
        expire: expire // ËøáÊúüÊó∂Èó¥
        };
        const encryptString = config.isEncrypt
        ? encrypt(JSON.stringify(data))
        : JSON.stringify(data);
        window[config.type].setItem(autoAddPrefix(key), encryptString);
        };
```

### Ëé∑Âèñ getStorage

È¶ñÂÖàË¶ÅÂØπ `key` ÊòØÂê¶Â≠òÂú®ËøõË°åÂà§Êñ≠ÔºåÈò≤Ê≠¢Ëé∑Âèñ‰∏çÂ≠òÂú®ÁöÑÂÄºËÄåÊä•Èîô„ÄÇÂØπËé∑ÂèñÊñπÊ≥ïËøõ‰∏ÄÊ≠•Êâ©Â±ïÔºåÂè™Ë¶ÅÂú®ÊúâÊïàÊúüÂÜÖËé∑Âèñ `Storage` ÂÄºÔºåÂ∞±ÂØπËøáÊúüÊó∂Èó¥ËøõË°åÁª≠ÊúüÔºåÂ¶ÇÊûúËøáÊúüÂàôÁõ¥Êé•Âà†Èô§ËØ•ÂÄº„ÄÇÂπ∂ËøîÂõû `null`

```js
// Ëé∑Âèñ getStorage
    export const getStorage = key => {
    let value = null;
    key = autoAddPrefix(key);
    // key ‰∏çÂ≠òÂú®Âà§Êñ≠
    if (
    !window[config.type].getItem(key) ||
    JSON.stringify(window[config.type].getItem(key)) === 'null'
        ) {
        return null;
    }
    
    // ‰ºòÂåñ ÊåÅÁª≠‰ΩøÁî®‰∏≠Áª≠Êúü
    const storage = config.isEncrypt
    ? JSON.parse(decrypt(window[config.type].getItem(key)))
    : JSON.parse(window[config.type].getItem(key));
    const nowTime = Date.now();
    // ËøáÊúüÂà†Èô§
        if (storage.expire && storage.expire < nowTime - storage.time) {
        removeStorage(key);
        return null;
            } else {
            // // Êú™ËøáÊúüÊúüÈó¥Ë¢´Ë∞ÉÁî® ÂàôËá™Âä®Áª≠Êúü ËøõË°å‰øùÊ¥ª
            // setStorage(autoRemovePrefix(key), storage.value);
                if (isJson(storage.value)) {
                value = JSON.parse(storage.value);
                    } else {
                    value = storage.value;
                }
                return value;
            }
            };
```

### Ëé∑ÂèñÊâÄÊúâÂÄº

```js
// Ëé∑ÂèñÂÖ®ÈÉ® getAllStorage
    export const getStorageAll = () => {
    const len = getStorageLength(); // Ëé∑ÂèñÈïøÂ∫¶
    let arr = []; // ÂÆö‰πâÊï∞ÊçÆÈõÜ
        for (let i = 0; i < len; i++) {
        const key = window[config.type].key(i);
        // Ëé∑Âèñkey Á¥¢Âºï‰ªé0ÂºÄÂßã
        const getKey = autoRemovePrefix(key);
        // Ëé∑ÂèñkeyÂØπÂ∫îÁöÑÂÄº
        const storage = config.isEncrypt
        ? JSON.parse(decrypt(window[config.type].getItem(key)))
        : JSON.parse(window[config.type].getItem(key));
        
        const nowTime = Date.now();
            if (storage.expire && nowTime - storage.time > storage.expire) {
            removeStorage(getKey);
                } else {
                let getVal = storage.value;
                // console.log(Object.prototype.toString.call(value));
                    if (isJson(getVal)) {
                    getVal = JSON.parse(getVal);
                }
                // ÊîæËøõÊï∞ÁªÑ
                arr.push({ key: getKey, val: getVal });
            }
        }
        return arr;
        };
```

### Âà†Èô§ removeStorage

```js
// ÂêçÁß∞ÂâçËá™Âä®Ê∑ªÂä†ÂâçÁºÄ
    const autoAddPrefix = (key) => {
    const prefix = config.prefix ? config.prefix + '_' : '';
    return  prefix + key;
}

// Âà†Èô§ removeStorage
    export const removeStorage = (key) => {
    window[config.type].removeItem(autoAddPrefix(key));
}
```

### Ê∏ÖÁ©∫ clearStorage

```js
// Ê∏ÖÁ©∫ clearStorage
    export const clearStorage = () => {
    window[config.type].clear();
}
```

### Âä†ÂØÜ„ÄÅËß£ÂØÜ

Âä†ÂØÜÈááÁî®ÁöÑÊòØ `crypto-js`

```js
// ÂÆâË£Öcrypto-js
npm install crypto-js

// ÂºïÂÖ• crypto-js Êúâ‰ª•‰∏ã‰∏§ÁßçÊñπÂºè
import CryptoJS from "crypto-js";
// ÊàñËÄÖ
const CryptoJS = require("crypto-js");
```

ÂØπ `crypto-js` ËÆæÁΩÆÂØÜÈí•ÂíåÂØÜÈí•ÂÅèÁßªÈáè,ÂèØ‰ª•ÈááÁî®Â∞Ü‰∏Ä‰∏™ÁßÅÈí•Áªè `MD5` Âä†ÂØÜÁîüÊàê16‰ΩçÂØÜÈí•Ëé∑Âæó„ÄÇ

```js
// ÂçÅÂÖ≠‰ΩçÂçÅÂÖ≠ËøõÂà∂Êï∞‰Ωú‰∏∫ÂØÜÈí•
const SECRET_KEY = CryptoJS.enc.Utf8.parse("3333e6e143439161");
// ÂçÅÂÖ≠‰ΩçÂçÅÂÖ≠ËøõÂà∂Êï∞‰Ωú‰∏∫ÂØÜÈí•ÂÅèÁßªÈáè
const SECRET_IV = CryptoJS.enc.Utf8.parse("e3bbe7e3ba84431a");
```

ÂØπÂä†ÂØÜÊñπÊ≥ïËøõË°åÂ∞ÅË£Ö

```js
/**
* Âä†ÂØÜÊñπÊ≥ï
* @param data
* @returns {string}
*/
    export function encrypt(data) {
        if (typeof data === "object") {
            try {
            data = JSON.stringify(data);
                } catch (error) {
                console.log("encrypt error:", error);
            }
        }
        const dataHex = CryptoJS.enc.Utf8.parse(data);
            const encrypted = CryptoJS.AES.encrypt(dataHex, SECRET_KEY, {
            iv: SECRET_IV,
            mode: CryptoJS.mode.CBC,
            padding: CryptoJS.pad.Pkcs7
            });
            return encrypted.ciphertext.toString();
        }
```

ÂØπËß£ÂØÜÊñπÊ≥ïËøõË°åÂ∞ÅË£Ö

```js
/**
* Ëß£ÂØÜÊñπÊ≥ï
* @param data
* @returns {string}
*/
    export function decrypt(data) {
    const encryptedHexStr = CryptoJS.enc.Hex.parse(data);
    const str = CryptoJS.enc.Base64.stringify(encryptedHexStr);
        const decrypt = CryptoJS.AES.decrypt(str, SECRET_KEY, {
        iv: SECRET_IV,
        mode: CryptoJS.mode.CBC,
        padding: CryptoJS.pad.Pkcs7
        });
        const decryptedStr = decrypt.toString(CryptoJS.enc.Utf8);
        return decryptedStr.toString();
    }
```

Âú®Â≠òÂÇ®Êï∞ÊçÆÂèäËé∑ÂèñÊï∞ÊçÆ‰∏≠ËøõË°å‰ΩøÁî®Ôºö

ËøôÈáåÊàë‰ª¨‰∏ªË¶ÅÁúã‰∏ãËøõË°åÂä†ÂØÜÂíåËß£ÂØÜÈÉ®ÂàÜÔºåÈÉ®ÂàÜÊñπÊ≥ïÂú®‰∏ãÈù¢‰ª£Á†ÅÊÆµ‰∏≠Âπ∂Êú™Â±ïÁ§∫ÔºåËØ∑Ê≥®ÊÑèÔºå‰∏çËÉΩÁõ¥Êé•ËøêË°å„ÄÇ

```js
    const config = {
    type: 'localStorage', // Êú¨Âú∞Â≠òÂÇ®Á±ªÂûã sessionStorage
    prefix: 'xxx_0.0.1', // ÂêçÁß∞ÂâçÁºÄ Âª∫ËÆÆÔºöÈ°πÁõÆÂêç + È°πÁõÆÁâàÊú¨
    expire: 1, //ËøáÊúüÊó∂Èó¥ Âçï‰ΩçÔºöÁßí
    isEncrypt: true // ÈªòËÆ§Âä†ÂØÜ ‰∏∫‰∫ÜË∞ÉËØïÊñπ‰æø, ÂºÄÂèëËøáÁ®ã‰∏≠ÂèØ‰ª•‰∏çÂä†ÂØÜ
}

// ËÆæÁΩÆ setStorage
    export const setStorage = (key, value, expire = 0) => {
        if (value === '' || value === null || value === undefined) {
        value = null;
    }
    
    if (isNaN(expire) || expire < 0) throw new Error('Expire must be a number');
    
    expire = (expire ? expire : config.expire) * 1000;
        let data = {
        value: value, // Â≠òÂÇ®ÂÄº
        time: Date.now(), //Â≠òÂÄºÊó∂Èó¥Êà≥
        expire: expire // ËøáÊúüÊó∂Èó¥
        };
        const encryptString = config.isEncrypt
        ? encrypt(JSON.stringify(data))
        : JSON.stringify(data);
        window[config.type].setItem(autoAddPrefix(key), encryptString);
        };
        
        // Ëé∑Âèñ getStorage
            export const getStorage = key => {
            let value = null;
            key = autoAddPrefix(key);
            // key ‰∏çÂ≠òÂú®Âà§Êñ≠
            if (
            !window[config.type].getItem(key) ||
            JSON.stringify(window[config.type].getItem(key)) === 'null'
                ) {
                return null;
            }
            
            // ‰ºòÂåñ ÊåÅÁª≠‰ΩøÁî®‰∏≠Áª≠Êúü
            const storage = config.isEncrypt
            ? JSON.parse(decrypt(window[config.type].getItem(key)))
            : JSON.parse(window[config.type].getItem(key));
            const nowTime = Date.now();
            // ËøáÊúüÂà†Èô§
                if (storage.expire && storage.expire < nowTime - storage.time) {
                removeStorage(key);
                return null;
                    } else {
                    // // Êú™ËøáÊúüÊúüÈó¥Ë¢´Ë∞ÉÁî® ÂàôËá™Âä®Áª≠Êúü ËøõË°å‰øùÊ¥ª
                    // setStorage(autoRemovePrefix(key), storage.value);
                        if (isJson(storage.value)) {
                        value = JSON.parse(storage.value);
                            } else {
                            value = storage.value;
                        }
                        return value;
                    }
                    };
```

### ‰ΩøÁî®

‰ΩøÁî®ÁöÑÊó∂ÂÄô‰Ω†ÂèØ‰ª•ÈÄöËøá `import` ÊåâÈúÄÂºïÂÖ•Ôºå‰πüÂèØ‰ª•ÊåÇËΩΩÂà∞ÂÖ®Â±Ä‰∏ä‰ΩøÁî®Ôºå‰∏ÄËà¨Âª∫ËÆÆÂ∞ëÁî®ÂÖ®Â±ÄÊñπÂºèÊàñÂÖ®Â±ÄÂèòÈáèÔºå‰∏∫ÂêéÊù•Êé•ÊâãÈ°πÁõÆÁªßÁª≠ÂºÄÂèëÁª¥Êä§ÁöÑ‰∫∫ÔºåËøΩÊü•‰ª£Á†ÅÁïôÊù°‰æøÊç∑‰πãË∑ØÔºÅ‰∏çË¶Å‰∏∫‰∫ÜÂ∞ÅË£ÖËÄåÂ∞ÅË£ÖÔºåÂ∞ΩÂèØËÉΩÂü∫‰∫éÈ°πÁõÆÈúÄÊ±ÇÂíåÂêéÁª≠ÁöÑÈÄöÁî®Ôºå‰ª•Âèä‰ΩøÁî®‰∏äÁöÑ‰æøÊç∑„ÄÇÊØîÂ¶ÇËé∑ÂèñÂÖ®ÈÉ®Â≠òÂÇ®ÂèòÈáèÔºåÂ¶ÇÊûú‰Ω†È°πÁõÆ‰∏äÈÉΩÊú™ÊõæÁî®Âà∞ËøáÔºåÂÄí‰∏çÂ¶ÇÂà†ÂáèÊéâÔºåÁïôÁùÄËøáÂπ¥‰πü‰∏çËßÅÂæóÊúâÂ§öÈ¶ôÔºå‰∏çÂ¶Ç‰∏∫ÂáèÂ∞è‰ΩìÁßØÂÅöÁÇπË¥°ÁåÆÔºÅ

```js
import {isSupportStorage, hasStorage, setStorage,getStorage,getStorageKeys,getStorageForIndex,getStorageLength,removeStorage,getStorageAll,clearStorage} from '@/utils/storage'

setStorage('token', 'xxx');
getStorage('token');
```

ÊÉ≥ÁúÅ‰∫ãÁÇπÂ∞±ÂÖ®Â±ÄÊ≥®ÂÜå‰∏ãÔºåÊé®ËçêÂÖ®Â±ÄÁî®„ÄÇ

```js
// main.js
import Storage from '@/libs/storage';
Vue.use(Storage);

// ‰ΩøÁî®
this.$storage.set('token', 'xxx');
this.$storage.get('token');
```

![image.png](/images/jueJin/5081f9be56e4429.png)

### ÂÆåÊï¥‰ª£Á†Å

ËØ•‰ª£Á†ÅÂ∑≤Ëøõ‰∏ÄÊ≠•ÂÆåÂñÑÔºåÈúÄË¶ÅÁöÑÂèØ‰ª•Áõ¥Êé•Ëøõ‰∏ÄÊ≠•‰ºòÂåñÔºå‰πüÂèØ‰ª•Â∞ÜÂèØ‰ºòÂåñÊàñÂèØÊâ©Â±ïÁöÑÂª∫ËÆÆÔºåÁïôË®ÄËØ¥ÊòéÔºåÊàë‰ºöËøõ‰∏ÄÊ≠•Ëø≠‰ª£ÁöÑ„ÄÇÂèØ‰ª•Ê†πÊçÆËá™Â∑±ÁöÑÈúÄË¶ÅÂà†Èô§‰∏Ä‰∫õ‰∏çÁî®ÁöÑÊñπÊ≥ïÔºå‰ª•ÂáèÂ∞èÊñá‰ª∂Â§ßÂ∞è„ÄÇ

```js
/***
* title: storage.js
* Author: Gaby
* Email:
* Time: 2022/6/8 15:53
* last: 2022/7/4 15:53
* Desc: ÂØπÊú¨Âú∞Â≠òÂÇ®ËøõË°åÂ∞ÅË£Ö, ÂëΩÂêçËßÑËåÉ„ÄÅËÆæÁΩÆËøáÊúüÊó∂Èó¥„ÄÅÂÆâÂÖ®Âä†ÂØÜ
*/

import CryptoJS from 'crypto-js';

// ÂçÅÂÖ≠‰ΩçÂçÅÂÖ≠ËøõÂà∂Êï∞‰Ωú‰∏∫ÂØÜÈí•
const SECRET_KEY = CryptoJS.enc.Utf8.parse('3333e6e143439161');
// ÂçÅÂÖ≠‰ΩçÂçÅÂÖ≠ËøõÂà∂Êï∞‰Ωú‰∏∫ÂØÜÈí•ÂÅèÁßªÈáè
const SECRET_IV = CryptoJS.enc.Utf8.parse('e3bbe7e3ba84431a');

// Á±ªÂûã window.localStorage,window.sessionStorage,
    const config = {
    type: 'sessionStorage', // Êú¨Âú∞Â≠òÂÇ®Á±ªÂûã localStorage sessionStorage
    prefix: 'xxx_0.0.1', // ÂêçÁß∞ÂâçÁºÄ Âª∫ËÆÆÔºöÈ°πÁõÆÂêç + È°πÁõÆÁâàÊú¨
    expire: 0, //ËøáÊúüÊó∂Èó¥ Âçï‰ΩçÔºöÁßí
    isEncrypt: false // ÈªòËÆ§Âä†ÂØÜ ‰∏∫‰∫ÜË∞ÉËØïÊñπ‰æø, ÂºÄÂèëËøáÁ®ã‰∏≠ÂèØ‰ª•‰∏çÂä†ÂØÜ
    };
    
    // Âà§Êñ≠ÊòØÂê¶ÊîØÊåÅ Storage
        export const isSupStorage = () => {
            if (!window) {
            throw new Error('ÂΩìÂâçÁéØÂ¢ÉÈùûÊµèËßàÂô®ÔºåÊó†Ê≥ïÊ∂àË¥πÂÖ®Â±ÄwindowÂÆû‰æã„ÄÇ');
        }
            if (!window.localStorage) {
            throw new Error('ÂΩìÂâçÁéØÂ¢ÉÈùûÊó†Ê≥ï‰ΩøÁî®localStorage');
        }
            if (!window.sessionStorage) {
            throw new Error('ÂΩìÂâçÁéØÂ¢ÉÈùûÊó†Ê≥ï‰ΩøÁî®sessionStorage');
        }
        
        return typeof Storage !== 'undefined' ? true : false;
        };
        
        // ËÆæÁΩÆ setStorage
            export const setStorage = (key, value, expire = 0) => {
                if (value === '' || value === null || value === undefined) {
                value = null;
            }
            
            if (isNaN(expire) || expire < 0) throw new Error('Expire must be a number');
            
            expire = (expire ? expire : config.expire) * 1000;
                let data = {
                value: value, // Â≠òÂÇ®ÂÄº
                time: Date.now(), //Â≠òÂÄºÊó∂Èó¥Êà≥
                expire: expire // ËøáÊúüÊó∂Èó¥
                };
                const encryptString = config.isEncrypt
                ? encrypt(JSON.stringify(data))
                : JSON.stringify(data);
                window[config.type].setItem(autoAddPrefix(key), encryptString);
                };
                
                // Ëé∑Âèñ getStorage
                    export const getStorage = key => {
                    let value = null;
                    key = autoAddPrefix(key);
                    // key ‰∏çÂ≠òÂú®Âà§Êñ≠
                    if (
                    !window[config.type].getItem(key) ||
                    JSON.stringify(window[config.type].getItem(key)) === 'null'
                        ) {
                        return null;
                    }
                    
                    // ‰ºòÂåñ ÊåÅÁª≠‰ΩøÁî®‰∏≠Áª≠Êúü
                    const storage = config.isEncrypt
                    ? JSON.parse(decrypt(window[config.type].getItem(key)))
                    : JSON.parse(window[config.type].getItem(key));
                    const nowTime = Date.now();
                    // ËøáÊúüÂà†Èô§
                        if (storage.expire && storage.expire < nowTime - storage.time) {
                        removeStorage(key);
                        return null;
                            } else {
                            // // Êú™ËøáÊúüÊúüÈó¥Ë¢´Ë∞ÉÁî® ÂàôËá™Âä®Áª≠Êúü ËøõË°å‰øùÊ¥ª
                            // setStorage(autoRemovePrefix(key), storage.value);
                                if (isJson(storage.value)) {
                                value = JSON.parse(storage.value);
                                    } else {
                                    value = storage.value;
                                }
                                return value;
                            }
                            };
                            
                            // ÊòØÂê¶Â≠òÂú® hasStorage
                                export const hasStorage = key => {
                                key = autoAddPrefix(key);
                                    let arr = getStorageAll().filter(item => {
                                    return item.key === key;
                                    });
                                    return arr.length ? true : false;
                                    };
                                    
                                    // Ëé∑ÂèñÊâÄÊúâkey
                                        export const getStorageKeys = () => {
                                        let items = getStorageAll();
                                        let keys = [];
                                            for (let index = 0; index < items.length; index++) {
                                            keys.push(items[index].key);
                                        }
                                        return keys;
                                        };
                                        
                                        // Ê†πÊçÆÁ¥¢ÂºïËé∑Âèñkey
                                            export const getStorageForIndex = index => {
                                            return window[config.type].key(index);
                                            };
                                            
                                            // Ëé∑ÂèñlocalStorageÈïøÂ∫¶
                                                export const getStorageLength = () => {
                                                return window[config.type].length;
                                                };
                                                
                                                // Ëé∑ÂèñÂÖ®ÈÉ® getAllStorage
                                                    export const getStorageAll = () => {
                                                    const len = getStorageLength(); // Ëé∑ÂèñÈïøÂ∫¶
                                                    let arr = []; // ÂÆö‰πâÊï∞ÊçÆÈõÜ
                                                        for (let i = 0; i < len; i++) {
                                                        const key = window[config.type].key(i);
                                                        // Ëé∑Âèñkey Á¥¢Âºï‰ªé0ÂºÄÂßã
                                                        const getKey = autoRemovePrefix(key);
                                                        // Ëé∑ÂèñkeyÂØπÂ∫îÁöÑÂÄº
                                                        const storage = config.isEncrypt
                                                        ? JSON.parse(decrypt(window[config.type].getItem(key)))
                                                        : JSON.parse(window[config.type].getItem(key));
                                                        
                                                        const nowTime = Date.now();
                                                            if (storage.expire && nowTime - storage.time > storage.expire) {
                                                            removeStorage(getKey);
                                                                } else {
                                                                let getVal = storage.value;
                                                                // console.log(Object.prototype.toString.call(value));
                                                                    if (isJson(getVal)) {
                                                                    getVal = JSON.parse(getVal);
                                                                }
                                                                // ÊîæËøõÊï∞ÁªÑ
                                                                arr.push({ key: getKey, val: getVal });
                                                            }
                                                        }
                                                        return arr;
                                                        };
                                                        
                                                        // Âà†Èô§ removeStorage
                                                            export const removeStorage = key => {
                                                            window[config.type].removeItem(autoAddPrefix(key));
                                                            };
                                                            
                                                            // Ê∏ÖÁ©∫ clearStorage
                                                                export const clearStorage = () => {
                                                                window[config.type].clear();
                                                                };
                                                                
                                                                // Âà§Êñ≠ÊòØÂê¶ÂèØÁî® JSON.parse
                                                                    export const isJson = value => {
                                                                        if (Object.prototype.toString.call(value) === '[object String]') {
                                                                            try {
                                                                            const obj = JSON.parse(value);
                                                                            const objType = Object.prototype.toString.call(obj);
                                                                            return objType === '[object Object]' || objType === '[object Array]';
                                                                                } catch (e) {
                                                                                // console.log('errorÔºö' + value + '!!!' + e);
                                                                                return false;
                                                                            }
                                                                        }
                                                                        return false;
                                                                        };
                                                                        
                                                                        // ÂêçÁß∞ÂâçËá™Âä®Ê∑ªÂä†ÂâçÁºÄ
                                                                            const autoAddPrefix = key => {
                                                                            const prefix = config.prefix ? config.prefix + '_' : '';
                                                                            return prefix + key;
                                                                            };
                                                                            
                                                                            // ÁßªÈô§Â∑≤Ê∑ªÂä†ÁöÑÂâçÁºÄ
                                                                                const autoRemovePrefix = key => {
                                                                                const len = config.prefix ? config.prefix.length + 1 : '';
                                                                                return key.substr(len);
                                                                                };
                                                                                
                                                                                /**
                                                                                * Âä†ÂØÜÊñπÊ≥ï
                                                                                * @param data
                                                                            * @returns {string}
                                                                            */
                                                                                const encrypt = data => {
                                                                                    if (typeof data === 'object') {
                                                                                        try {
                                                                                        data = JSON.stringify(data);
                                                                                            } catch (error) {
                                                                                            console.log('encrypt error:', error);
                                                                                        }
                                                                                    }
                                                                                    const dataHex = CryptoJS.enc.Utf8.parse(data);
                                                                                        const encrypted = CryptoJS.AES.encrypt(dataHex, SECRET_KEY, {
                                                                                        iv: SECRET_IV,
                                                                                        mode: CryptoJS.mode.CBC,
                                                                                        padding: CryptoJS.pad.Pkcs7
                                                                                        });
                                                                                        return encrypted.ciphertext.toString();
                                                                                        };
                                                                                        
                                                                                        /**
                                                                                        * Ëß£ÂØÜÊñπÊ≥ï
                                                                                        * @param data
                                                                                    * @returns {string}
                                                                                    */
                                                                                        const decrypt = data => {
                                                                                        const encryptedHexStr = CryptoJS.enc.Hex.parse(data);
                                                                                        const str = CryptoJS.enc.Base64.stringify(encryptedHexStr);
                                                                                            const decrypt = CryptoJS.AES.decrypt(str, SECRET_KEY, {
                                                                                            iv: SECRET_IV,
                                                                                            mode: CryptoJS.mode.CBC,
                                                                                            padding: CryptoJS.pad.Pkcs7
                                                                                            });
                                                                                            const decryptedStr = decrypt.toString(CryptoJS.enc.Utf8);
                                                                                            return decryptedStr.toString();
                                                                                            };
                                                                                            
                                                                                                export default {
                                                                                                    install(Vue) {
                                                                                                    // ÊåÇËΩΩÂÖ®Â±Ä
                                                                                                        if (!Vue.$storage) {
                                                                                                            Vue.$storage = {
                                                                                                            set: setStorage,
                                                                                                            get: getStorage,
                                                                                                            getAll: getStorageAll,
                                                                                                            getLen: getStorageLength,
                                                                                                            isSub: isSupStorage,
                                                                                                            isJson: isJson,
                                                                                                            has: hasStorage,
                                                                                                            del: removeStorage,
                                                                                                            clear: clearStorage
                                                                                                            };
                                                                                                                } else {
                                                                                                                Vue.$storage.set = setStorage;
                                                                                                                Vue.$storage.get = getStorage;
                                                                                                                Vue.$storage.getAll = getStorageAll;
                                                                                                                Vue.$storage.getLen = getStorageLength;
                                                                                                                Vue.$storage.isSub = isSupStorage;
                                                                                                                Vue.$storage.isJson = isJson;
                                                                                                                Vue.$storage.has = hasStorage;
                                                                                                                Vue.$storage.del = removeStorage;
                                                                                                                Vue.$storage.clear = clearStorage;
                                                                                                            }
                                                                                                                Vue.mixin({
                                                                                                                    created: function () {
                                                                                                                    this.$storage = Vue.$storage;
                                                                                                                }
                                                                                                                });
                                                                                                            }
                                                                                                            };
```