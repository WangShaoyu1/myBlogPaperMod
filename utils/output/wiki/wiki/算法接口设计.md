---
author: "王宇"
title: "算法接口设计"
date: 八月09,2024
description: "知识插件"
tags: ["知识插件"]
ShowReadingTime: "12s"
weight: 699
---
*   1[1\. 领域通用检索服务接口](#id-算法接口设计-领域通用检索服务接口)
*   2[2\. 知识插件检索服务接口](#id-算法接口设计-知识插件检索服务接口)
*   3[3\. 知识库构建文件格式及限制](#id-算法接口设计-知识库构建文件格式及限制)

**应用名(**nacos注册的应用名**)：yingzi-algorithm-rag**

**开发环境： 172.18.64.37**

**测试/预生产/生产环境：k8s**

**算法服务错误码：**

错误码

触发条件

错误信息示例

备注

错误码

触发条件

错误信息示例

备注

100000000

成功返回

  

  

100100201

数据越界

数据越界：问题长度超出限制：\[1, 750\]

  

100100203

输入参数类型/格式错误。

不支持的数据格式：app\_type

  

100100205

输入字段缺失

输入字段缺失：query

  

100100206

输入数据缺失

输入数据缺失：knowledge\_configs

  

100600900

算法服务未知错误/服务器内部错误

未知错误，请联系算法管理员

  

1\. 领域通用检索服务接口
==============

**请求方式：**POST，application/json

**算法测试请求路径： http://{domain}/yingzi-algorithm-rag/knowledge\_retrieval/general\_retrieval\_server**

**测试环境算法ID：**1224373964580098048

**开发环境算法ID：1260527562179137536**，**domain****：**172.18.64.37:8081

**预生产环境算法ID：**1224374964406145024

**生产环境算法ID：**1224376023880523776

  
**请求字段说明：**

参数字段

类型

必须

说明

备注

参数字段

类型

必须

说明

备注

query

string

Y

用户问题，长度不能超过750个字符。

  

topk

int

N

知识库查询数量（大于0），不同的应用类型有对应的默认值。

  

vector\_threshold

float

N

向量查询分数阈值，低于这个阈值的结果丢弃，取值范围(0, 1\]，不同的应用类型有对应的默认值。

  

match\_score

float

N

关键词匹配得分阈值（大于0），低于这个阈值的结果丢弃，不同的应用类型有对应的默认值。

  

vector\_boost

float

N

向量查询权重，取值范围\[0, 1\]，不同的应用类型有对应的默认值。

关键词匹配和向量查询权重和为1；若vector\_boost=0，表示只有关键词查询；vector\_boost=1，表示只有向量/语义查询

app\_type

string

Y

应用类型，需与算法内部统一。屏端企业知识问答服务可统一设为：“knowledge\_qa\_enterprise\_screen”，养猪专家问答服务可统一设为“swine\_experts\_general”，营养健康专家问答服务可统一设为“health\_assistant\_general”

不同类型应用检索的知识库范围不同。

**请求示例:**

POST 

{  
"app\_type": "health\_assistant\_general",  
"topk": 5,  
"query": "高血压适合吃什么食物？"  
}

**响应示例：**  
{  
"code": 100000000,  
"data": \[  
{  
"content": "第六章医疗膳食：第三节调整成分膳食：八、高钾饮食：(二)适用范围：2.适用于防治高血压。有人观察高钾、低钠饮食有防治高血压的作用。",  
"file\_id": "临床营养学",  
"chunk\_id": "paragraph-1341",  
"score": 0.6007977489999999  
},  
{  
"content": "食物与高血压的关系\\n特定食物摄入与高血压关联，如高盐和高饱和脂肪饮食会提升血压水平和患病率。",  
"file\_id": "营养与食品卫生学",  
"chunk\_id": "section2-26",  
"score": 0.5938752709999999  
},  
{  
"content": "\\t单元5营养与健康：5.2膳食营养与慢性疾病预防：四 、高血压、高血脂与膳食营养防治：(一)高血压：3.高血压的饮食治疗：(2)减少及限制饮食中的钠盐：高血压患者可根据病情给予不同程度的限钠膳食，对大多数高血压病人，建议食盐控制在2～3g/d(相当于每月用盐1～2两)的水平。除食盐外还应考虑其他含钠的食物，如用盐腌制的食物等。",  
"file\_id": "饮食营养与安全",  
"chunk\_id": "paragraph-924",  
"score": 0.592150886  
},  
{  
"content": "第九章营养与营养相关疾病：第三节心脑血管疾病：四、冠状动脉粥样硬化性心脏病(冠心病)：(三)食物选择：1.推荐摄入食物：(4)富含特殊成分，有降脂降压作用的海带、香菇、木耳、洋葱、大蒜等。",  
"file\_id": "现代营养学郭顺堂主编",  
"chunk\_id": "paragraph-2368",  
"score": 0.591887409  
},  
{  
"content": "第九章营养与营养相关疾病：第三节心脑血管疾病：二、原发性高血压：(四)食物选择：1.推荐摄入食物：(3)富含维生素的新鲜果蔬：如莴笋、青菜、小白菜、柑橘、大枣、猕猴桃、苹果等。",  
"file\_id": "现代营养学郭顺堂主编",  
"chunk\_id": "paragraph-2312",  
"score": 0.5905978479999999  
}  
\],  
"msg": "成功返回"  
}

**响应字段说明：**

参数字段

类型

说明

参数字段

类型

说明

code

int

响应编码（参照算法服务错误码），成功返回100000000

msg

string

响应信息

data

list<dict>

查询结果列表（根据总分数逆序排列，若没有相关结果，则为空列表），包含knowledge\_id、file\_id、chunk\_id、score和content五个字段

<file\_id>

string

查询的文件id

<chunk\_id>

string

文件内知识分块id

<score\>

float

查询内容总得分

<content\>

string

查询的知识内容

<text\_group>

string

查询的知识内容分组（部分知识库没有分组字段返回，常见的有FAQ、指令和query对应的sql分组）

2\. 知识插件检索服务接口
==============

**请求方式：**POST，application/json

**算法测试请求路径： http://{domain}/yingzi-algorithm-rag/knowledge\_retrieval/plugin\_retrieval\_server**

**测试环境算法ID：1260533361517563904**

**开发环境算法ID：1260531561738063872**，**domain****：**172.18.64.37:8081

**预生产环境算法ID：1260535831421997056**

**生产环境算法ID：1260536937721585664**

  
**请求字段说明：**

参数字段

类型

必须

说明

备注

参数字段

类型

必须

说明

备注

query

string

Y

用户问题，长度不能超过750个字符。

  

auto\_config

int

N

自动配置/智能重排开关，取值：0/1，默认值为0。  
0：表示每个知识库按独立检索参数配置返回。  
1：表示检索参数配置相同的知识库自动分配返回数目，检索参数配置不同的知识库不受影响。

  

knowledge\_configs

list<dict>

Y

知识库配置列表（不能为空列表），决定了知识插件检索的知识库范围，包含topk、vector\_threshold、match\_score和vector\_boost四个字段

  

<knowledge\_id>

string

Y

知识库id，必须是算法这边存在导入文件的知识库

  

<retrieval\_type>

int

N

检索类型，取值：1/2/3，默认值为1。

1-混合检索 2-向量/语义检索 3-关键词检索

<topk>

int

N

知识库查询数量（大于0），默认值为3。

  

<vector\_threshold>

float

N

向量查询分数阈值，低于这个阈值的结果丢弃，取值范围(0, 1\]，默认值为0.75。

  

<match\_score>

float

N

关键词匹配得分阈值（大于0），低于这个阈值的结果丢弃，默认值为0.8。

  

<vector\_boost>

float

N

向量查询权重，取值范围\[0, 1\]，默认值为0.85。

关键词匹配和向量查询权重和为1；若vector\_boost=0，表示只有关键词查询；vector\_boost=1，表示只有向量/语义查询

**请求示例:**

POST 

{  
"query": "高血压适合吃什么食物？",  
"knowledge\_configs": \[  
{  
"knowledge\_id": "health\_assistant\_general",  
"topk": 5,  
"vector\_boost": 0.74  
},  
{  
"knowledge\_id": "health\_assistant\_table",  
"topk": 2,  
"vector\_boost": 0.74  
}  
\]  
}

**响应示例：**  
{  
"code": 100000000,  
"data": \[  
{  
"knowledge\_id": "health\_assistant\_general",  
"knowledge\_content": \[  
{  
"content": "第六章医疗膳食：第三节调整成分膳食：八、高钾饮食：(二)适用范围：2.适用于防治高血压。有人观察高钾、低钠饮食有防治高血压的作用。",  
"file\_id": "临床营养学",  
"chunk\_id": "paragraph-1341",  
"score": 0.6007977489999999  
},  
{  
"content": "食物与高血压的关系\\n特定食物摄入与高血压关联，如高盐和高饱和脂肪饮食会提升血压水平和患病率。",  
"file\_id": "营养与食品卫生学",  
"chunk\_id": "section2-26",  
"score": 0.5938752709999999  
},  
{  
"content": "\\t单元5营养与健康：5.2膳食营养与慢性疾病预防：四 、高血压、高血脂与膳食营养防治：(一)高血压：3.高血压的饮食治疗：(2)减少及限制饮食中的钠盐：高血压患者可根据病情给予不同程度的限钠膳食，对大多数高血压病人，建议食盐控制在2～3g/d(相当于每月用盐1～2两)的水平。除食盐外还应考虑其他含钠的食物，如用盐腌制的食物等。",  
"file\_id": "饮食营养与安全",  
"chunk\_id": "paragraph-924",  
"score": 0.592150886  
},  
{  
"content": "第九章营养与营养相关疾病：第三节心脑血管疾病：四、冠状动脉粥样硬化性心脏病(冠心病)：(三)食物选择：1.推荐摄入食物：(4)富含特殊成分，有降脂降压作用的海带、香菇、木耳、洋葱、大蒜等。",  
"file\_id": "现代营养学郭顺堂主编",  
"chunk\_id": "paragraph-2368",  
"score": 0.591887409  
},  
{  
"content": "第九章营养与营养相关疾病：第三节心脑血管疾病：二、原发性高血压：(四)食物选择：1.推荐摄入食物：(3)富含维生素的新鲜果蔬：如莴笋、青菜、小白菜、柑橘、大枣、猕猴桃、苹果等。",  
"file\_id": "现代营养学郭顺堂主编",  
"chunk\_id": "paragraph-2312",  
"score": 0.5905978479999999  
}  
\]  
},  
{  
"knowledge\_id": "health\_assistant\_table",  
"knowledge\_content": \[  
{  
"content": "此表格旨在指导高血压患者合理安排日常饮食，通过控制特定营养素摄入量以辅助血压管理。关键应用包括高血压防治饮食计划制定，关联计算涉及热量转换及营养成分配比。常见于医疗营养咨询、健康管理App及慢性病饮食指南。关键词：高血压饮食、营养管理、电解质平衡、心血管健康。\\n表格部分内容：\\n表的标题：高血压患者推荐的营养素摄入量:\\n营养素名称|每日推荐摄入量\\n膳食纤维|不少于14g/(1000kcal/d)\\n钠|<2000mg(相当于食盐5g)\\n钾|>2500mg(相当于氯化钾4.75g801~1000mg350-500mg\\n钙|801~1000mg\\n镁|350~500mg\\n维生素C|100~150mg\\n维生素D|5~10μg(200～400IU)\\n烟酸|10~20mg\\n表的备注：nan",  
"file\_id": "营养配餐设计与实践",  
"chunk\_id": "81",  
"score": 0.568815726  
},  
{  
"content": "此表格旨在为高脂血症患者提供膳食指导，帮助控制血脂。通过设定不同食物类别的建议摄入量与限制项，促进健康饮食习惯。应用涉及营养学、疾病管理领域，常见于健康管理、医疗咨询及减肥计划中。关键词包括：\\"高脂血症饮食\\"、\\"血脂管理\\"、\\"健康膳食规划\\"。该表未直接涉及的计算问题可能包括热量计算、营养成分比例分析等。\\n表格部分内容：\\n表的标题：高脂血症膳食控制方案：\\n食物类别|限制量|推荐摄入食物|限制摄入食物\\n糖类|10g/d|白糖、红糖|—\\n新鲜蔬菜|400~500g/d|深绿色、红黄色蔬菜|—\\n新鲜水果|50g/d|各种水果|加工果汁、果味饮料\\n食盐|<6g|—|含盐高的食物及调料\\n谷类|男：500g/d;女：400g/d|五谷粗杂粮|—\\n干豆及豆|干豆30g/d或豆腐150g/d或豆腐干45g/d|黄豆及其制品|含油多的豆制品，如油豆腐、素什锦等\\n表的备注：注：①指脑力劳动或轻体力劳动、体重正常者。",  
"file\_id": "现代营养学郭顺堂主编",  
"chunk\_id": "83",  
"score": 0.562396633  
}  
\]  
},  
"msg": "成功返回"  
}

**响应字段说明：**

参数字段

类型

说明

参数字段

类型

说明

code

int

响应编码（参照算法服务错误码），成功返回100000000

msg

string

响应信息

data

list<dict>

查询结果对象列表（根据知识库id分块返回，若没有相关结果，则为空列表），包含knowledge\_id和knowledge\_content两个字段

<knowledge\_id>

string

查询的知识库id

<knowledge\_content>

list<dict>

查询的知识库内容列表（根据总分数逆序排列），包含file\_id、chunk\_id、score和content四个字段

<<file\_id>>

string

查询的文件id

<<chunk\_id>>

string

文件内知识分块id

<<score\>>

float

查询内容总得分

<<content\>>

string

查询的知识内容

<<text\_group>>

string

查询的知识内容分组（部分知识库没有分组字段返回，常见的有FAQ、指令和query对应的sql分组）

3\. 知识库构建文件格式及限制
================

*   语言类型只支持中文（1）
*   不同知识类型支持的文件类型及要求如下**（注意文件不能加密）**：  
    **（1）长文本文档：**普通docx或doc文件（特别适用于带不同层级标题的word文本）  
    **（2）结构化文档/表格类文档：**带表头的csv和xlsx/xls文件，编码为**utf-8**，**至少包含2列**，可在最后两行放置表的标题和表的备注（非必须，格式需规范）。其中csv文件只支持一个sheet；excel文件则支持多sheet。示例文件如下：

![](/download/attachments/122522160/image2024-6-24_9-57-21.png?version=1&modificationDate=1719194241291&api=v2)  
**（3）问答对文档/短文本文档：**docx/doc和txt文档，均以**换行符（“\\n”）**作为内容的分隔符。xlsx和xls格式的excel文件，只支持一个sheet且表头为**“text”列**（必须，作为文本切分和检索的内容）和**“text\_group”列**（非必须，作为文本分组的依据，检索时只返回组内得分最高的一条数据）的内容处理，“text”列以**单元格**及**换行符（“\\n”）**作为内容的分隔符。**注意有“text\_group”列和没有“text\_group”列的内容需分库存储，**因为他们检索返回的逻辑和字段内容不一样。

[Filter table data](#)[Create a pivot table](#)[Create a chart from data series](#)

[Configure buttons visibility](/users/tfac-settings.action)