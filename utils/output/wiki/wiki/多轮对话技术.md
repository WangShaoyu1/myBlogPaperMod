---
author: "王宇"
title: "多轮对话技术"
date: 七月13,2023
description: "黄婷"
tags: ["黄婷"]
ShowReadingTime: "12s"
weight: 221
---
1\. 多轮对话概述
==========

智能对话系统按照表现形式一般分为单轮对话和多轮对话两种。单轮对话与传统问答系统类似，属于对话系统的初级应用，通过一问一答的形式完成用户的简单请求或意图，或者执行一些特定操作。单轮对话一般不存在指代省略或者上下文连贯性问题，其生成技术一般应用在电商平台客服等产品中。相对于单轮对话，多轮对话中存在人机的多轮交互，通过这样多轮交互的形式完成**连续的主题对话( 开放域的多轮对话) 或者对用户的复杂意图或请求加以完成( 封闭域的多轮对话)** 。多轮对话对聊天的上下文、指代省略的补全和复杂需求的明确等问题都有着更为复杂的要求，也更贴近包括咨询、推荐、服务需求、闲聊等现实情况的应用场景。

多轮对话涉及到槽位信息以及意图信息的继承与切换，这也是多轮对话对话管理模块需要解决的重点问题！目前市场上的语音助手（例如：小爱同学、siri等），在对话轮次超过5轮以后，就很难准确的实现槽位与意图的继承与切换了，AI仍旧任重而道远。

2\. 封闭域的多轮对话
============

**定义：根据上下文内容，进行连续的，以达到解决某一类特定任务为目的的对话。**

这里有3点：

*   **上下文：**机器人的每次出话，都是跟上文有强关联关系的；
*   **连续性：**一个完整的对话内可进行多次连续的对话交互；
*   **某一类特定问题：**这里主要是限定下讨论范围，讨论的是一个封闭域内的问题，一个完整的对话，只负责处理一个特定的任务。比如说订机票是一个特定的任务；订外卖是一个特定的任务；查天气也是一个特定的任务。

2.1. 多轮对话和多轮对话平台的关系
-------------------

那怎么来实现多轮对话呢？市面上各大厂家的做法是开发一个用于构建多轮对话的平台。有了这样的平台，你就可以构建出你想要的对话流程。

![](https://image.woshipm.com/wp-files/2021/02/5nkYizgXmAae6ui29hew.png)

多轮比较擅长处理的两类经典任务：

1.  **分类任务**（如上左图），用户的表达属于分支的哪一类，每一类应该走什么分支。
2.  **信息收集/查询类任务**（如上右图），需要向用户收集哪些必要信息，如查航班，需要收集出发地、目的地、出发时间3个必要信息。

这里你可能想说，这个哪里智能了，不就是我们实现定义好的流程吗？是的，它确实并没有你想象中的那么智能，没有你想象中的那样通过大量的数据就能自己学习出一个流程，也没你想象中的那样机器可以自己生成新的答复话术。

但是它确实能解决很多工业上的问题，特别是一些比较固定的流程，比如说：

*   电销，机器人询问用户是否感兴趣；这里机器人最重要的事情不是促成下单，而是筛选有意向的用户。比如说用户说感兴趣，甚至是跟机器人多聊几句，就会被标识为感兴趣，然后后面就会有人工客服来跟进了。
*   自助服务，传统的IVR是通过按键的形式来识别用户的意图的（充值服务请按1，业务办理请按2…..），那智能机器人可以直接识别并理解用户的自然语言来提供服务（如用户可以直接说：我要查询话费）。
*   满意度回访，机器人通过电话回访来收集用户对服务的满意度情况，是否满意、不满意原因是什么，有什么改进意见等等。
*   疫情期间人员基本情况调查，如收集用户是否有从武汉回来、有没有接触从武汉回来的人，有没有发烧、流鼻涕等信息。

这些固化的流程完全可以用机器人来完成，大大减少人力成本。相比于人，机器人可以一天24小时，同一时间多线路给多个人拨打电话。

2.2. 多轮对话平台目前的存在的问题
-------------------

### 2.2.1.  解析工具与场景的不默契

**1）例子1**

*   用户：帮我订一张机票
*   机器人：好的，请问你要从哪里出发呢
*   用户：深圳明天会下雨吗

问在哪里出发后，我们往往会调用一个地址解析器来解用户接下来说的话，用户回复“深圳明天会下雨吗”，这时会抽到地址【深圳】，那机器人就理解为出发地是【深圳】了。解析器确实没有问题，解出了地址【深圳】，但是解出的地址是不是符合上文需要填充的槽位，这时机器人就无能为力了，因为解析器只管解析，不管业务。

**2）例子2**

*   用户：帮我查询电费
*   机器人：请问你要查几月份的呢
*   用户：8

问是几月份，我们往往会在这个时候调用一个时间解析器来解用户接着说的话，用户只回复“8”，这时时间解析器解不出结果，因为时间解析器只能解“8月”、“8号”等等这个带单位的时间。纯说一个数字，机器人就懵掉了。

从上面两个例子就可以看出，解析工具跟实际应用场景的隔阂，导致了运用起来不够灵活，主要矛盾点体现在：

*   如果解析工具跟场景分割开，就会出现以上的问题；
*   如果解析工具跟场景紧密关联，那通用性就比较差，这样会导致这个解析工具仅适用于某个场景，而无法迁移到其他场景。

### 2.2.2. 解析工具与解析工具之间不默契

举例：

*   用户：帮我订一张机票
*   机器人：好的，请问你要从哪里出发呢
*   用户：深圳明天会下雨吗

还是以上面例子为例，首先来了解几个概念：

*   **主流程与辅助问答：**这个多轮的主流程就是收集订机票所需要的槽位，辅助问答是只在主流程的过程中用户可能会问些相关的问题，如“怎么退票”、“深圳明天天气怎么样”。机器人回答完辅助问答之后，会继续回答主流程，继续收集槽位信息。
*   **信心分：**是指解析工具，匹配到结果的分数值。假设分数值是从（0–100），假设信心分高于80分机器人就采纳。
*   **中控优先级：**是指取解析工具结果的优先顺序，比如说解析工具A的优先级大于解析工具B，那解析工具A和B解析结果的信息分都是90分，那机器人会优先取A的结果。

了解了上面的概念之后，我们再回过来看这个例子。

用户说了：深圳明天会下雨吗？

会有两个解析工具解到结果，假设地址解析工具得到的信心分是90分，意图解析工具解到的【查天气】意图的信心分也是90，但是由于地址解析工具属于主流程，优先级高于查天气意图，因此机器人最后选择的是前者。因此机器人的动作是把【深圳】当作了出发地填入槽位。

因此，从这里可以看到有两个问题：

1.  **人为事先设定的死死的规则，是没办法应对在自然对话中无穷无尽的场景。**因此机器人的决策机制不能全由预设规则决定，应该是要结合实际的数据，比如说可以针对单个节点做训练，A类数据出A回复；B类数据出B回复。
2.  **解析工具与工具之间没有建立连接，它们之间各自评分，相互之间没有通讯，没有协作关系。**如果解析工具之间先经过讨论，再给出结果，是不是会有更好的效果呢，就比如说，识别到查天气的意图之后，意图工具会告诉地址解析工具，这里的【深圳】是只深圳的天气，可能不是你想要的出发地，你要再考虑下。这只是一个脑洞，但值得我们去深思。

### 2.2.3. 机器人的回复话术是非生成式的

这里先理清一对概念：

*   **预设式话术：**话术提前设定，不会改变
*   **生成式话术：**机器人根据场景的各变化因素，而创造出的话术

举例：

*   机器人问题1：请问你平均每天运动有超过30分钟吗？
*   用户：我平均每天至少跑步1小时
*   机器人问题2：请问你会经常熬夜吗？

机器人的话术已经被事先死死的设定了，问完问题1，就问问题2。没有根据用户的话做出一些反馈，就会显得很生硬。

假设能这样：

*   机器人问题1：请问你平均每天运动有超过30分钟吗？
*   用户：我平均每天至少跑步1小时
*   机器人问题2：那你很自律啊，这么说你应该不会经常熬夜吧？

这样不但能对用户的回答做出响应，还根据用户前面说的话来调整问题2的问法。这就是非生成式回答无法达到的效果，这也是机器人比较死板的原因。

### 2.2.4. NLP理解的维度比较局限

正常人与人的对话，一般会根据语调、文字、表情、动作等维度，组合起来理解对话所表达的内容。但是目前大多数的多轮对话平台都是只以【文字】单一维度来做解析处理，即使很多平台都亮出了自己在ASR环节的情绪理解有多么强大，但真正跟多轮平台运用起来是隔离开的，训练数据只是转译成文本的形式训练，而不是直接拿语音去训练。

比如：不同语气的“呵呵”，表达的意思是不一样，有的是开心，有的是讽刺。如果丢失了语调的维度，那解析的结果肯定是会失真的。

### 2.2.5. 使用门槛高，优化难度大

在以用户体验为王的时代，如果你操作一个软件或APP，你还要看它的说明书，甚至看了说明书还不会操作，那你肯定会疯掉。没错，多轮对话操作平台就是一个看了说明说还不会用平台，通常需要经常专业的培训才会使用，因此是有很高的使用门槛的，而且逻辑能力不好人，还真做不来。除了操作门槛高，后续的优化也不灵活。不是说像我们想象中的那么简单，加点数据，标注下就能解决的。比如说机器人询问：你是马先生吗？你一开始想到的用户可能的回答是两类：肯定回复（是的、我是）、否定回复（不是、打错了）。但是上线后，你会发现还有很多类型的回复：中性回复【怎么啦、你说】、式有关系人【我是他老婆、我是他儿子】、反问【你是谁呀、是机器人吧你】。

每增加一个分类，就要重新在流程图里增加分支，从新设定规则等等，并非直接加点数据重新训练就能解决问题了。

2.3. 多轮的核心——对话管理
----------------

人能够进行多轮对话，很大程度和我们能记住并且使用沟通过程产生的信息和共识，这里值得注意的是，有两个关键的能力，一个是记住，另一个是使用。而现有的大量技术也都是围绕着这两点来搭建的，甚至，比较统一的形成了一个“对话管理模块”，即Dialog Management，DM。

对话管理承担了多轮对话中信息的记录和使用，所谓的记录，就是对话过程的跟踪，一般被称为"Dialog State Tracking"，"DST"对话状态跟踪，而所谓的使用，有一个跟有意思的说法，叫做对话策略，"Dialog Policy"，DP。这点和我们日常的聊天很像，我们在对话过程中，一方面是能接收双方交换的信息，另一方面也会根据自己的目标或者想法制定不同的对话策略，从而达到自己的目标。

**对话管理（Dialog Management, DM）**控制着人机对话的过程，DM 根据对话历史信息，决定此刻对用户的反应。最常见的应用还是任务驱动的多轮对话，用户带着明确的目的如订餐、订票等，用户需求比较复杂，有很多限制条件，可能需要分多轮进行陈述，一方面，用户在对话过程中可以不断修改或完善自己的需求，另一方面，当用户的陈述的需求不够具体或明确的时候，机器也可以通过询问、澄清或确认来帮助用户找到满意的结果。

总的来说，对话管理的任务大致有下面一些：

*   **对话状态维护（dialog state tracking, DST）**  
    维护 & 更新对话状态  
    t+1 时刻的对话状态st+1，依赖于之前时刻 t 的状态 st，和之前时刻 t 的系统行为at，以及当前时刻 t+1 对应的用户行为at+1。可以写成 st+1←st+at+at+1
*   **生成系统决策（dialog policy）**  
    根据 DST 中的对话状态（DS），产生系统行为（dialog act），决定下一步做什么  
    dialog act 可以表示观测到的用户输入（用户输入 -> DA，就是 NLU 的过程），以及系统的反馈行为（DA -> 系统反馈，就是 NLG 的过程）
*   **作为接口与后端/任务模型进行交互**
*   **提供语义表达的期望值（expectations for interpretation）**  
    interpretation: 用户输入的 internal representation，包括 speech recognition 和 parsing/semantic representation 的结果

本质上，任务驱动的对话管理实际就是一个决策过程，系统在对话过程中不断根据当前状态决定下一步应该采取的最优动作（如：提供结果，询问特定限制条件，澄清或确认需求…）从而最有效的辅助用户完成信息或服务获取的任务。

2.4. 任务型对话系统中的状态追踪
------------------

**定义：**对话状态St是一种将到t时刻为止的对话历史简化为可供系统选择下一时刻action信息的**数据结构，**往往可以理解为每个slot的取值分布情况。

DST（Dialog State Tracking）就是根据所有对话历史信息推断当前**对话状态St和用户目标**。往往是pipeline对话系统中至关重要的一个模块，上接NLU，下接Policy。

如果把DST当做是一个黑盒的话，那么就可以简化为如下“输入-->输出”的形式，

*   输入往往包含：ASR、SLU 的输出结果N-best，系统采取的action，外部知识等等；
*   输出：对化状态St，用于选择下一步动作；

由于ASR、SLU等组件的识别结果往往会出错，所以常常会输出N-best列表（带置信度概率），这就要求DST拥有比较强的鲁棒性。所以DST往往输出各个状态的概率分布，这样可以在多轮对话中进行修改，并且方便bot向用户发起澄清query。

### 2.4.1.  **状态建模和实例说明**

何谓对话状态？其实状态St是一种**包含0时刻到t时刻的对话历史、用户目标、意图和槽值对的数据结构**，这种数据结构可以供DPL阶段学习策略（比如定机票时，是询问出发地还是确定订单？）并完成NLG阶段的回复。

![](https://pic2.zhimg.com/v2-258318fe7d1f65c5dae3d31c4ef9cec1_r.jpg)

对话状态追踪DST：作用是根据领域(domain)/意图(intention) 、曹植对(slot-value pairs)、之前的状态以及之前系统的Action等来追踪当前状态。它的**输入是Un（n时刻的意图和槽值对，也叫用户Action）、An-1（n-1时刻的系统Action）和Sn-1（n-1时刻的状态），输出是Sn（n时刻的状态）**。

S = {Gn,Un,Hn}，Gn是用户目标、Un同上、Hn是聊天的历史，Hn= {U0, A0, U1, A1, ... , U −1, A −1}，S =f(S −1,A −1,U )。

DST涉及到两方面内容：**状态表示、状态追踪**。另外为了解决领域数据不足的问题，DST还有很多迁移学习(Transfer Learning)方面的工作。比如基于特征的迁移学习、基于模型的迁移学习等。

### 2.4.2. **状态表示**

通过前面的建模和实例化，不难看出对话状态数跟意图和槽值对的数成**指数关系**，维护所有状态的一个分布非常非常浪费资源，因此需要比较好的状态表示法来减少状态维护的资源开销（相当于特定任务下，更合理的数据结构设计，好的数据结构带来的直接影响就是算法开销变小）。

3\. 开放域的多轮对话
============

之前一些开放领域对话的解决方案如微软的小冰都是一套很复杂的架构，但是随着最近几年预训练模型取得的成功，对话系统领域也开始探索端到端的实现方式，尤其在2019，2020，2021这三年涌现出了很多相关研究。比如2020年1月份google发表的Meena、4月份Facebook的Blender以及百度PLATO系列包括PLATO、PLATO-2、PLATO-XL等等，目前效果比较好的就是百度的PLATO-XL系列。这里做一个简单的总结：

![](/download/attachments/105258676/image2023-7-3_20-53-19.png?version=1&modificationDate=1688388799880&api=v2)

目前在中文领域，百度的PLATO应该是效果最好的了，这里展示一个聊天片段：

![](/download/attachments/105258676/image2023-7-3_20-49-6.png?version=1&modificationDate=1688388547299&api=v2)

4\. 对话的评价
=========

4.1. 评价方式
---------

![](/download/attachments/105258676/image2023-6-8_18-4-27.png?version=1&modificationDate=1688090772248&api=v2)

4.2. 评价的一些指标
------------

![](/download/attachments/105258676/image2023-6-8_18-5-30.png?version=1&modificationDate=1688090772287&api=v2)

**更多内容：**[对话系统调研-学术](https://wiki.yingzi.com/pages/viewpage.action?pageId=101840835)

**参考内容：**

1.  [做了20+个AI多轮对话项目后的总结](https://www.woshipm.com/ai/4386978.html)
2.  [聊聊对话系统：多轮对话](https://blog.csdn.net/baidu_25854831/article/details/124240036)
3.  [最新对话系统综述 (qq.com)](https://mp.weixin.qq.com/s/ICzDwMbC5FVkFzVOuL9pIA)
4.  [一文看懂任务型对话中的对话策略学习（DPL）](https://zhuanlan.zhihu.com/p/370788806)
5.  [来也科技多轮对话搭建提要](https://documents.laiye.com/chatbot-command-manual/docs/Chap3_Multiround_Dialogue_Building)

  

[Filter table data]()[Create a pivot table](#)[Create a chart from data series](#)

[Configure buttons visibility](/users/tfac-settings.action)