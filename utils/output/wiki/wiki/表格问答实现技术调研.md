---
author: "王宇"
title: "表格问答实现技术调研"
date: 九月28,2023
description: "黄婷"
tags: ["黄婷"]
ShowReadingTime: "12s"
weight: 237
---
*   1[1\. 概述](#id-表格问答实现技术调研-概述)
    *   1.1[1.1. 什么是表格问答？](#id-表格问答实现技术调研-什么是表格问答？)
    *   1.2[1.2. 表格问答支持的问题类型有哪些？](#id-表格问答实现技术调研-表格问答支持的问题类型有哪些？)
    *   1.3[1.3. 表格问答任务细分](#id-表格问答实现技术调研-表格问答任务细分)
    *   1.4[1.4. 一种表格问答系统架构](#id-表格问答实现技术调研-一种表格问答系统架构)
*   2[2\. 表格问答相关方法-学术界](#id-表格问答实现技术调研-表格问答相关方法-学术界)
    *   2.1[2.1. 表格检索 (Table Retrieval)](#id-表格问答实现技术调研-表格检索\(TableRetrieval\))
        *   2.1.1[2.1.1. 表格候选检索](#id-表格问答实现技术调研-表格候选检索)
        *   2.1.2[2.1.2. 表格候选打分](#id-表格问答实现技术调研-表格候选打分)
    *   2.2[2.2. 基于语义分析的方法](#id-表格问答实现技术调研-基于语义分析的方法)
    *   2.3[2.3. 基于非语义解析的方法](#id-表格问答实现技术调研-基于非语义解析的方法)
        *   2.3.1[2.3.1. 生成式方法（Generative methods）](#id-表格问答实现技术调研-生成式方法（Generativemethods）)
        *   2.3.2[2.3.2. 提取式方法（Extractive methods）](#id-表格问答实现技术调研-提取式方法（Extractivemethods）)
        *   2.3.3[2.3.3. 匹配式方法（Match-Based methods）](#id-表格问答实现技术调研-匹配式方法（Match-Basedmethods）)
*   3[3\. 表格问答常见实现方案](#id-表格问答实现技术调研-表格问答常见实现方案)
    *   3.1[3.1. 端到端的 NL2SQL](#id-表格问答实现技术调研-端到端的NL2SQL)
    *   3.2[3.2. 基于多轮对话形式的 SQL 关键字提取](#id-表格问答实现技术调研-基于多轮对话形式的SQL关键字提取)
    *   3.3[3.3. 七鱼表格问答落地方案](#id-表格问答实现技术调研-七鱼表格问答落地方案)
    *   3.4[3.4. FTT系统表格问答解决方案](#id-表格问答实现技术调研-FTT系统表格问答解决方案)
*   4[4\. 未来的技术展望](#id-表格问答实现技术调研-未来的技术展望)
*   5[5\. 参考文档](#id-表格问答实现技术调研-参考文档)

1\. 概述
======

企业数据在很多情况下是以一种二维表形式保存在数据库中，如果针对二维表配置 FAQ，会导致 FAQ 数量剧增；若客户修改了其中某条记录，还需要去修改之前配置的 FAQ，不利于维护。如果问答系统具备从表格中直接提取信息进行问答的功能，则可以完美地解决此类问题，这就是表格问答的优势。表格问答实现方案有多种，大多数都集中在论文或者比赛范畴内，难以商业落地。本文参考网易七鱼客服场景，梳理表格问答落地方案。

1.1. 什么是表格问答？
-------------

**表格问答**（TableQA），是指根据给定的表格，针对表格相关内容的**查询、推理**等问题，提供对应的智能问答能力。表格问答是基于表格数据来进行问答的技能。其中表格数据是由**实体和属性**构成。

狭义上的表格问答是**仅针对表格**的问答，但随着相关研究的进行，出现了许多**表格+文本**的、类似文档形式的混合数据集。这些数据集依赖对表格的理解，也因此，广义上的表格问答可看做是**包含表格数据**的问答。

**从技术层面上看，表格问答是基于自然语言处理（NLP）技术，把用户的问句话术转换成SQL语句，去执行对有关表格数据的查询与推理****，并基于此对用户问句进行回复。**表格问答根据用户的问法和实体在表格中进行搜索，输出与之对应的属性值。具体如下图所示：

![](/download/attachments/109717533/image2023-9-27_18-45-1.png?version=1&modificationDate=1695811501789&api=v2)

1.2. 表格问答支持的问题类型有哪些？
--------------------

![图片](https://simg.baai.ac.cn/uploads/2022/12/c15b92a735e8242b51b92b9f1490e664.png)

1.3. 表格问答任务细分
-------------

对于表格问答，参考相关研究和[综述](https://github.com/BDBC-KG-NLP/QA-Survey-CN/blob/master/%E8%A1%A8%E6%A0%BC%E9%97%AE%E7%AD%94\(Table_Question_Answering%2CTQA\)-%E5%AD%A6%E6%9C%AF%E7%95%8C.md#zs)，可以将任务按以下角度进行细分。

角度

分类

解释

备注

问题类别  
  

事实(Factoid)

询问一个特定的事实，答案来自于表格中的一个片段或由聚合操作得到的值

  

自由形式(Free Form)

回答无固定格式，通常较长，类似于对话，如ChatGPT一样

  

多项选择(Multiple Choice)

问题要求从多个选项中选择一个作为答案

  

数据类别

仅包含表格(Table Only)

数据集里仅包含表格这一种数据形式

  

表格+其他数据形式(Non Table Only)

除了表格本体，还包含表格附近的文本或其他文本信息，甚至是其他数据模态

  

表格类别

普通表格(Flat)

表格较为规整，一般只有一级的列表头

  

层次化表格(Hierarchical)

表格可能包含行表头和列表头，同时表格不止一级，具有层次化的结构

  

Domain Type

开放域(Open Domain)

面向真实场景，需要先从大量数据中检索得到候选表格及其他文本，再从中推理出答案

  

封闭域(Close Domain)

面向有限数量的表格或文本，一般仅包含一个表格或少量的文本片段，从中推理得到答案

  

1.4. 一种表格问答系统架构
---------------

![](/download/attachments/109717533/image2023-9-27_23-31-17.png?version=1&modificationDate=1695828678136&api=v2)

*   数据预处理模块，对用户提出的问题文本进行中文分词、正则去模糊处理；实现问题文本与知识库实体的语义填充完善。
*   文本编码模块，将用户提出的问题文本与知识库实体转化为计算机形式的数据类型和计算单元；即采用预训练模型，对问题文本与知识库实体进行语义表示；
*   结构化查询语句生成模块，利用槽位填充，根据文本编码生成问题对应的结构化查询语句；
*   自然答案生成模块，根据生成的结构化查询语句进行自然答案的生成，包含主语生成、谓语生成和宾语生成。

2\. 表格问答相关方法-学术界
================

目前，与表格相关的自然语言处理研究发展迅速，数据集大幅增加，学术界已有许多成熟的方法，可以将与表格问答相关的任务定义为以下五类：

*   **表格检索：**从表格集合中找到与输入问题最相关的表格
*   **语义解析：**将自然语言问题转换成可被机器理解的语义表示（meaning representation，一般指SQL语句），在表格中执行该表示即可获得答案
*   **问题生成：**可看作语义解析的逆过程，能减轻语义解析器对大量标注训练数据的依赖
*   **对话：**主要用于多轮对话场景的语义解析任务，需有效解决上下文中的省略和指代现象
*   **文本生成**：使用自然语言描述表格中（如给定的一行）的内容

2.1. 表格检索 (Table Retrieval)
---------------------------

对于给定的自然语言q和给定的表格全集T={T1, T2, .., Tn}，表格检索任务的目的是从T中找到与q内容最相关的表格，如下图所示。每个表格通常由三部分构成：表头/列名（table header）、表格单元（table cell）和表格标题（table caption）。广义上的表格问答有时也会面对包含表格的一个或多个文档，在面向开放域或混合数据问答时，需要依赖表格检索模块得到候选的表格或其他文本。

![](/download/attachments/109717533/image2023-9-25_16-33-20.png?version=1&modificationDate=1695630800976&api=v2)

在方法实现上，**表格检索往往包含表格候选检索和表格候选打分两个步骤。**

### 2.1.1. 表格候选检索

**从表格全集中快速筛选得到一个表格子集T={T1, T2, .., Tn}，并尽量保证与Q最相关的表格包含在T之中。**

*   **表格全集相对有限**：可以将每个表格的结构打散并将内容顺序连接构成一个“文档”，然后基于现有文本检索技术找到与输入问题Q最相关的表格子集T。
*   **表格全集为互联网所有表格**：需要先基于搜索引擎找到与问题最相关的结果页面集合。然后抽取该结果网页集合中包含的全部表格作为表格子集T。这一过程无法保证排名靠前网页中包含的表格和输入问题之间也存在较高的相关性，这也就引入了下一个任务。

### 2.1.2. 表格候选打分

**表格候选打分负责计算表格子集T中每个表格和问题Q的相关度，并选择与Q相关度最高的表格[![](https://camo.githubusercontent.com/0e6ff8ba97405c3ffec63315df89ca7d403a9125d1585267161aeaa9bd4ea880/687474703a2f2f6c617465782e636f6465636f67732e636f6d2f6769662e6c617465783f545f25374262657374253744)](https://camo.githubusercontent.com/0e6ff8ba97405c3ffec63315df89ca7d403a9125d1585267161aeaa9bd4ea880/687474703a2f2f6c617465782e636f6465636f67732e636f6d2f6769662e6c617465783f545f25374262657374253744)作为表格检索的结果**：

[![](https://camo.githubusercontent.com/f5e23d27052775ad600f6db7c06c69231ae3c0de1cd3c33f602e37e423fe2db4/687474703a2f2f6c617465782e636f6465636f67732e636f6d2f6769662e6c617465783f545f253742626573742537443d6172676d61785f253742545f25374269253744253543696e2537425425374425374425354373756d5f253742693d312537442535452537424e2537442535436c616d6264615f2537426925374425354363646f74253742685f2537426925374428512c545f2537426925374429253744)](https://camo.githubusercontent.com/f5e23d27052775ad600f6db7c06c69231ae3c0de1cd3c33f602e37e423fe2db4/687474703a2f2f6c617465782e636f6465636f67732e636f6d2f6769662e6c617465783f545f253742626573742537443d6172676d61785f253742545f25374269253744253543696e2537425425374425374425354373756d5f253742693d312537442535452537424e2537442535436c616d6264615f2537426925374425354363646f74253742685f2537426925374428512c545f2537426925374429253744)

其中[![](https://camo.githubusercontent.com/50a6f53786072b6c28c0a5923acf4f08a8c3d2723d8e0a0eeaae13fa6874ac5e/687474703a2f2f6c617465782e636f6465636f67732e636f6d2f6769662e6c617465783f253742685f2537426925374428512c545f25374269253744292537445f253742693d312537442535452537424e253744)](https://camo.githubusercontent.com/50a6f53786072b6c28c0a5923acf4f08a8c3d2723d8e0a0eeaae13fa6874ac5e/687474703a2f2f6c617465782e636f6465636f67732e636f6d2f6769662e6c617465783f253742685f2537426925374428512c545f25374269253744292537445f253742693d312537442535452537424e253744)表示N个特征函数，每个特征函数用来衡量Q和[![](https://camo.githubusercontent.com/b2ddfbb0f4bf19b32145ef437a821cedb720d0434578a05b4e62d752de423721/687474703a2f2f6c617465782e636f6465636f67732e636f6d2f6769662e6c617465783f545f25374269253744)](https://camo.githubusercontent.com/b2ddfbb0f4bf19b32145ef437a821cedb720d0434578a05b4e62d752de423721/687474703a2f2f6c617465782e636f6465636f67732e636f6d2f6769662e6c617465783f545f25374269253744)的某种相关性。[![](https://camo.githubusercontent.com/3d7d8f343b6589816522f4340c9884b23a348ecbbf103373050ceb650c7edf7b/687474703a2f2f6c617465782e636f6465636f67732e636f6d2f6769662e6c617465783f2537422535436c616d6264615f253742692537442537445f253742693d312537442535452537424e253744)](https://camo.githubusercontent.com/3d7d8f343b6589816522f4340c9884b23a348ecbbf103373050ceb650c7edf7b/687474703a2f2f6c617465782e636f6465636f67732e636f6d2f6769662e6c617465783f2537422535436c616d6264615f253742692537442537445f253742693d312537442535452537424e253744)是特征函数集合对应的特征权重集合，它通过在标注数据上使用机器学习算法训练得到。

*   如果将表格看作文档，可以采用文本检索中最常见的BM25作为一个表格候选打分特征。
    
*   如果将表格看作字符串，忽略表格结构，最长公共子串、编辑距离在内的多种字符串匹配方法都可以用来设计匹配特征。
    

2.2. 基于语义分析的方法
--------------

基于语义分析的方法通过两步完成任务。第一步，基于表格T对问题Q进行语义分析，将其转化为对应的语义表示LF（Logical Form）；第二步，将LF作为结构化查询，通过在T上执行得到问题对应的答案。和KBQA类似，基于表格的语义分析方法既可以基于<问题，答案>标注间接训练语义分析模型，也可以基于<问题，语义表示>标注直接训练语义分析模型。

以下所示的是基于语义分析的方法的一个示例。

![](/download/attachments/109717533/image2023-9-25_16-40-30.png?version=1&modificationDate=1695631230778&api=v2)

2.3. 基于非语义解析的方法
---------------

该类方法在问答时不会生成LF，而是直接由模型得到答案。此类方法省去了设计模板的成本，一般只需要答案、答案所在的一个或多个单元格、聚合操作等少量信息即可完成训练。**非语义解析的方法主要可分为生成式方法、提取式方法和匹配式的方法。**

### 2.3.1. 生成式方法（Generative methods）

生成式方法类似于Encoder-Decoder的结构，通过Encoder对问题和表格编码，得到问题和表格的语义表示，在通过Decoder从中解码出答案。自由形式的问答往往需要依赖Decoder来生成自由形式的答案。

### 2.3.2. 提取式方法（Extractive methods）

提取式方法类似于Encoder-Classification Layer的结构，其不依赖Decoder生成答案，而是通过分类等方式，从表格中选取token spans作为答案或答案依据。一个典型的提取式方法是[TaPas](https://github.com/BDBC-KG-NLP/QA-Survey-CN/blob/master/%E8%A1%A8%E6%A0%BC%E9%97%AE%E7%AD%94\(Table_Question_Answering%2CTQA\)-%E5%AD%A6%E6%9C%AF%E7%95%8C.md#TaPas)模型，TaPas模型基于Bert模型实现，将问题与线性化的表格作为模型的输入。输出包含了对表格的每一个单元格的预测，判断该单元格是答案或答案依据的可能性。

### 2.3.3. 匹配式方法（Match-Based methods）

匹配式方法类似于KBQA里的向量建模的方法，对问题和表格的片段（如特定的行、列）进行编码，再通过特定方法得到与问题相似度较高的表格片段，从表格片段中推理出答案。一个典型的匹配式方法是[RCI](https://github.com/BDBC-KG-NLP/QA-Survey-CN/blob/master/%E8%A1%A8%E6%A0%BC%E9%97%AE%E7%AD%94\(Table_Question_Answering%2CTQA\)-%E5%AD%A6%E6%9C%AF%E7%95%8C.md#RCI)模型，将问题与表格的所有行列进行匹配，选择得到相似度最高的行列，行列相交即得到答案所在的单元格。

3\. 表格问答常见实现方案
==============

当前表格知识问答的实现方案主要有：端到端的 NL2SQL、多轮对话形式的 SQL 关键字提取等。这些方案当前主要在学术界进行研究，工业界落地的挑战包括：**领域可迁移性不强、标注成本太高、算法预测结果不可控、综合效果未达预期等。**

3.1. 端到端的 NL2SQL
----------------

NL2SQL（Natural Language to SQL）是一项将用户的自然语言语句转成可执行的 SQL 语句的技术，有很大的实际应用价值，**对改善用户与数据库之间的交互方式有重大意义。**

在深度学习端到端解决方案流行之前，NL2SQL 的解决方案主要是通过高质量的语法树和词典来构建语义解析器，分析访客的诉求，再将分析的结果依据规则转写成相应的 SQL。**最新的解决方案是基于端到端模型与 SQL 特征规则相结合，**例如 X-SQL，HydraNet 等。

3.2. 基于多轮对话形式的 SQL 关键字提取
------------------------

**这种方式是把访客的意图看成一个任务型对话过程，**首先把 SQL 常见的查询方式整理成一个对话流程，完成这个查询需要的条件，设置成对话中的槽位，通过一轮或者多轮从用户获取需要的 SQL 关键字，最后和用户确认查询的含义，并且返回最后的答案。

这种方式和 NL2SQL 表格问答最大的差别是， **NL2SQL 的表格问答是模型自动抽取 SQL 中的所有关键字，不需要人工介入。而多轮对话形式的 SQL 是把 SQL 关键字提取转成对话的槽位，系统没理解的部分，可以通过澄清话术再次询问用户，降低了难度。但是这种方式需要事先配置多个对话流程，把主流的 SQL 语法都涵盖进去，人工成本巨大，不利于领域迁移。**

3.3. 七鱼表格问答落地方案
---------------

**网易七鱼在线客服场景使用的表格问答，通过创新方式，把表格问答转成基于多轮对话形式的实体和属性识别。**用户可以在澄清话术的引导下，通过单轮或者多轮对话的方式自然地提供查询所需的实体和属性，从而为用户精准地找到表格中的答案。

七鱼的表格问答，采用的是一种创新的实现方式，把表格问答转成实体和属性的识别。实体为二维表中的列；属性为二维表中的行。实体和属性的识别有成熟的落地方案，例如可以通过关键词识别，也可以通过语义相似度算法识别。同时，根据七鱼客服机器人的实际落地场景，把表格问答设计成一种多轮对话的形式，用户可以在话术引导下，分多次提供有效的实体和属性信息，不需要一次对话就必须提供实体和属性信息，同时还可以支持实体或者属性的反问和推荐，进一步提升实用性。

**七鱼通过成熟的实体、属性识别来实现表格问答。**属性识别采用了当前最先进的预训练语言模型，效果优异。**七鱼的表格问答采用多轮对话框架，支持用户上下文多次问答，逐渐澄清意图。**如果用户一轮对话只说了实体或者只说了属性，系统具备反问和推荐功能，让用户提供查询所需要的完整信息。

3.4. FTT系统表格问答解决方案
------------------

![](/download/attachments/109717533/image2023-9-27_23-47-10.png?version=1&modificationDate=1695829631148&api=v2)

**分析：**结合之前的沟通情况来看，FTT系统大概率会采用**基于多轮对话形式的 SQL 关键字提取**方案来实现表格问答，与网易七鱼使用的技术相近。需要基于主流sql填写对应的话术，把 SQL 关键字提取转化为对应实体和属性槽位的提取，相比指令系统，增加多轮对话的实体和属性继承功能。表格内容基本涵盖以下内容：

![](/download/attachments/109717533/image2023-9-27_23-58-44.png?version=1&modificationDate=1695830324865&api=v2)

4\. 未来的技术展望
===========

TableQA 从单轮到多轮，从单表到多表，从下游模型到上游预训练表格模型，初步形成了比较体系的创新。但总体上，TableQA 还是一个新方向，面向未来，还有很多难题需要研究：

1.  大规模预训练表格理解模型；
    
2.  大规模预训练表格生成模型；
    
3.  更强大的 Text-to-SQL 模型；
    
4.  忠实流畅类人的 TableNLG；
    
5.  端到端开箱即用的 TableQA 系统；
    
6.  推广到更多的应用场景。
    

5\. 参考文档
========

1.  [表格问答在客服场景下的落地应用-网易七鱼](https://zhuanlan.zhihu.com/p/431970230)
2.  [TQA调研——学术界](https://github.com/BDBC-KG-NLP/QA-Survey-CN/blob/master/%E8%A1%A8%E6%A0%BC%E9%97%AE%E7%AD%94\(Table_Question_Answering%2CTQA\)-%E5%AD%A6%E6%9C%AF%E7%95%8C.md#zs)
3.  [基于表格问答的自然答案生成系统及其方法](https://patents.google.com/patent/CN114780582A/zh)
4.  [NL2SQL模型介绍](https://cloud.tencent.com/developer/article/1617204)

[Filter table data](#)[Create a pivot table](#)[Create a chart from data series](#)

[Configure buttons visibility](/users/tfac-settings.action)